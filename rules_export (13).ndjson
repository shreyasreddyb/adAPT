{"id":"0be9dd5e-f5bb-485d-917c-c992322f6419","rule_id":"34a95d73-9dda-4a91-bc26-461cee560102","name":"Scheduled Task Creation via PowerShell Cmdlets","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":2,"updated_at":"2025-12-08T21:59:27.252Z","updated_by":"aswin","created_at":"2025-12-05T12:16:07.979Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects creation of scheduled tasks using PowerShell cmdlets (Register-ScheduledTask, New-ScheduledTaskAction,\nNew-ScheduledTaskTrigger). APT28 and other threat actors use scheduled tasks for persistence, ensuring their\nmalicious payloads execute automatically at system startup, user logon, or at specified intervals.","tags":["MITRE","APT28","Windows","Persistance"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0003","name":"Persistence","reference":"https://attack.mitre.org/tactics/TA0003/"},"technique":[{"id":"T1053","name":"Scheduled Task/Job","reference":"https://attack.mitre.org/techniques/T1053/","subtechnique":[{"id":"T1053.005","name":"Scheduled Task","reference":"https://attack.mitre.org/techniques/T1053/005/"}]}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1053","name":"Scheduled Task/Job","reference":"https://attack.mitre.org/techniques/T1053/","subtechnique":[{"id":"T1053.005","name":"Scheduled Task","reference":"https://attack.mitre.org/techniques/T1053/005/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"a6b74c57-a48f-4edc-9bba-994f5997b4a9","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"event.category:process and host.os.type:windows and\n  (\n    process.command_line : *Register-ScheduledTask* or\n    (process.command_line : *New-ScheduledTaskAction* and process.command_line : *New-ScheduledTaskTrigger*) or\n    process.args : *Register-ScheduledTask* or\n    (process.args : *New-ScheduledTaskAction* and process.args : *New-ScheduledTaskTrigger*)\n  ) and\n  not process.parent.executable : (\"C:\\\\Windows\\\\System32\\\\*\" or \"C:\\\\Program Files\\\\*\" or \"C:\\\\Program Files (x86)\\\\*\") and\n  not process.command_line : (*Microsoft* or *Windows Defender* or *WindowsUpdate* or *GoogleUpdate* or *Adobe* or *OneDrive* or *Teams* or *Office*) and\n  not user.name : (\"SYSTEM\" or \"LOCAL SERVICE\" or \"NETWORK SERVICE\")","filters":[]}
{"id":"36839c77-1bbd-4271-b090-94dcebee61b5","rule_id":"85acf2b6-d48f-4a87-bc13-b702849ca56c","name":"DNS → Excessive TXT Queries","immutable":false,"rule_source":{"type":"internal"},"version":1,"revision":0,"updated_at":"2025-12-09T00:14:39.033Z","updated_by":"aswin","created_at":"2025-12-09T00:14:39.033Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-6m","to":"now","description":"Detects hosts performing excessive TXT DNS queries, a common technique used for DNS tunneling. Investigate the host and block outbound DNS if needed.\n","tags":[],"author":[],"license":"","threat":[],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"4aacb2e2-62df-4a61-99eb-1efb301219c9","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security"},"type":"threshold","language":"kuery","index":["auditbeat-*","zeek-*"],"query":"event.dataset: \"zeek.dns\" and dns.question.type: \"TXT\"","filters":[],"threshold":{"field":["source.ip.keyword"],"value":20,"cardinality":[]}}
{"id":"e819daf1-215a-4c38-9d18-dad605322009","rule_id":"11dd9713-0ec6-4110-9707-32daae1ee68c","name":"PowerShell Script with Token Impersonation Capabilities","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":117,"revision":1,"updated_at":"2025-12-05T18:48:20.631Z","updated_by":"aswin","created_at":"2025-12-05T17:32:44.885Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Detects scripts that contain PowerShell functions, structures, or Windows API functions related to token impersonation/theft. Attackers may duplicate then impersonate another user's token to escalate privileges and bypass access controls.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Privilege Escalation","Data Source: PowerShell Logs","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0004","name":"Privilege Escalation","reference":"https://attack.mitre.org/tactics/TA0004/"},"technique":[{"id":"T1134","name":"Access Token Manipulation","reference":"https://attack.mitre.org/techniques/T1134/","subtechnique":[{"id":"T1134.001","name":"Token Impersonation/Theft","reference":"https://attack.mitre.org/techniques/T1134/001/"}]}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.001","name":"PowerShell","reference":"https://attack.mitre.org/techniques/T1059/001/"}]},{"id":"T1106","name":"Native API","reference":"https://attack.mitre.org/techniques/T1106/"}]}],"related_integrations":[{"package":"windows","version":"^3.0.0"}],"required_fields":[{"name":"event.category","type":"keyword","ecs":true},{"name":"file.directory","type":"keyword","ecs":true},{"name":"file.path","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"powershell.file.script_block_text","type":"unknown","ecs":false},{"name":"user.id","type":"keyword","ecs":true}],"setup":"The 'PowerShell Script Block Logging' logging policy must be configured (Enable).\n\nSteps to implement the logging policy with Advanced Audit Configuration:\n\n```\nComputer Configuration >\nAdministrative Templates >\nWindows PowerShell >\nTurn on PowerShell Script Block Logging (Enable)\n```\n\nSteps to implement the logging policy via registry:\n\n```\nreg add \"hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging\" /v EnableScriptBlockLogging /t REG_DWORD /d 1\n```","note":"## Triage and analysis\n\n### Investigating PowerShell Script with Token Impersonation Capabilities\n\nPowerShell is one of the main tools system administrators use for automation, report routines, and other tasks. This makes it available for use in various environments, and creates an attractive way for attackers to execute code.\n\nAdversaries can abuse PowerShell to perform token impersonation, which involves duplicating and impersonating another user's token to escalate privileges and bypass access controls. This rule identifies scripts containing PowerShell functions, structures, or Windows API functions related to token impersonation/theft.\n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/current/invest-guide-run-osquery.html) introduced in Elastic Stack version 8.5.0. Older Elastic Stack versions will display unrendered Markdown in this guide.\n\n### Possible investigation steps\n\n- Examine the script content that triggered the detection; look for suspicious DLL imports, collection or exfiltration capabilities, suspicious functions, encoded or compressed data, and other potentially malicious characteristics.\n- Investigate the script execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Examine PowerShell process creation and script block logs to identify command line arguments or hardcoded information that can indicate which user was the target of the impersonation.\n- Investigate any abnormal behavior by the subject process (PowerShell), such as network connections, registry or file modifications, and any spawned child processes.\n- Evaluate whether the user needs to use PowerShell to complete tasks.\n- Examine the host for derived artifacts that indicate suspicious activities:\n  - Analyze the script using a private sandboxed analysis system.\n  - Observe and collect information about the following activities in both the sandbox and the alert subject host:\n    - Attempts to contact external domains and addresses.\n      - Use the Elastic Defend network events to determine domains and addresses contacted by the subject process by filtering by the process' `process.entity_id`.\n      - Examine the DNS cache for suspicious or anomalous entries.\n        - !{osquery{\"label\":\"Osquery - Retrieve DNS Cache\",\"query\":\"SELECT * FROM dns_cache\"}}\n    - Use the Elastic Defend registry events to examine registry keys accessed, modified, or created by the related processes in the process tree.\n    - Examine the host services for suspicious or anomalous entries.\n      - !{osquery{\"label\":\"Osquery - Retrieve All Services\",\"query\":\"SELECT description, display_name, name, path, pid, service_type, start_type, status, user_account FROM services\"}}\n      - !{osquery{\"label\":\"Osquery - Retrieve Services Running on User Accounts\",\"query\":\"SELECT description, display_name, name, path, pid, service_type, start_type, status, user_account FROM services WHERE\\nNOT (user_account LIKE '%LocalSystem' OR user_account LIKE '%LocalService' OR user_account LIKE '%NetworkService' OR\\nuser_account == null)\\n\"}}\n      - !{osquery{\"label\":\"Osquery - Retrieve Service Unsigned Executables with Virustotal Link\",\"query\":\"SELECT concat('https://www.virustotal.com/gui/file/', sha1) AS VtLink, name, description, start_type, status, pid,\\nservices.path FROM services JOIN authenticode ON services.path = authenticode.path OR services.module_path =\\nauthenticode.path JOIN hash ON services.path = hash.path WHERE authenticode.result != 'trusted'\\n\"}}\n  - Retrieve the files' SHA-256 hash values using the PowerShell `Get-FileHash` cmdlet and search for the existence and reputation of the hashes in resources like VirusTotal, Hybrid-Analysis, CISCO Talos, Any.run, etc.\n- Investigate potentially compromised accounts. Analysts can do this by searching for login events (for example, 4624) to the target host after the registry modification.\n\n### False positive analysis\n\n- Regular users should not need to impersonate other users, which makes false positives unlikely. In the case of authorized benign true positives (B-TPs), exceptions can be added.\n\n### Related Rules\n\n- PowerShell PSReflect Script - 56f2e9b5-4803-4e44-a0a4-a52dc79d57fe\n- Potential Process Injection via PowerShell - 2e29e96a-b67c-455a-afe4-de6183431d0d\n\n### Response and Remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved hosts to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors like reverse shells, reverse proxies, or droppers that attackers could use to reinfect the system.\n- Remove and block malicious artifacts identified during triage.\n- Restrict PowerShell usage outside of IT and engineering business units using GPOs, AppLocker, Intune, or similar software.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).","false_positives":[],"references":["https://github.com/decoder-it/psgetsystem","https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/Get-System.ps1","https://github.com/EmpireProject/Empire/blob/master/data/module_source/privesc/Invoke-MS16032.ps1","https://github.com/atc-project/atc-data/blob/master/docs/Logging_Policies/LP_0109_windows_powershell_script_block_log.md"],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"644ccc12-f7bb-438f-8159-2b4f8a9fbfb2","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"query","language":"kuery","index":["winlogbeat-*","logs-windows.powershell*"],"query":"event.category:process and host.os.type:windows and\n  powershell.file.script_block_text:(\n    \"Invoke-TokenManipulation\" or\n    \"ImpersonateNamedPipeClient\" or\n    \"NtImpersonateThread\" or\n    (\n      \"STARTUPINFOEX\" and\n      \"UpdateProcThreadAttribute\"\n    ) or\n    (\n      \"AdjustTokenPrivileges\" and\n      \"SeDebugPrivilege\"\n    ) or\n    (\n      (\"DuplicateToken\" or\n      \"DuplicateTokenEx\") and\n      (\"SetThreadToken\" or\n      \"ImpersonateLoggedOnUser\" or\n      \"CreateProcessWithTokenW\" or\n      \"CreatePRocessAsUserW\" or\n      \"CreateProcessAsUserA\")\n    ) \n  ) and\n  not (\n    user.id:(\"S-1-5-18\" or \"S-1-5-19\" or \"S-1-5-20\") and\n    file.directory: \"C:\\\\ProgramData\\\\Microsoft\\\\Windows Defender Advanced Threat Protection\\\\Downloads\"\n  ) and\n  not powershell.file.script_block_text : (\n    \"sentinelbreakpoints\" and \"Set-PSBreakpoint\" and \"PowerSploitIndicators\"\n  ) and\n  not (\n    powershell.file.script_block_text : \"New-HPPrivateToastNotificationLogo\" and\n    file.path : \"C:\\Program Files\\HPConnect\\hp-cmsl-wl\\modules\\HP.Notifications\\HP.Notifications.psm1\"\n  )\n"}
{"id":"4cfc2b33-99b0-42b4-8790-a81c81fffd89","rule_id":"cde1bafa-9f01-4f43-a872-605b678968b0","name":"Potential PowerShell HackTool Script by Function Names","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":218,"revision":1,"updated_at":"2025-12-05T18:48:20.800Z","updated_by":"aswin","created_at":"2025-12-04T15:02:22.091Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Detects known PowerShell offensive tooling functions names in PowerShell scripts. Attackers commonly use out-of-the-box offensive tools without modifying the code. This rule aim is to take advantage of that.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Execution","Data Source: PowerShell Logs","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.001","name":"PowerShell","reference":"https://attack.mitre.org/techniques/T1059/001/"}]}]}],"related_integrations":[{"package":"windows","version":"^3.0.0"}],"required_fields":[{"name":"event.category","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"powershell.file.script_block_text","type":"unknown","ecs":false},{"name":"user.id","type":"keyword","ecs":true}],"setup":"## Setup\n\nThe 'PowerShell Script Block Logging' logging policy must be enabled.\nSteps to implement the logging policy with Advanced Audit Configuration:\n\n```\nComputer Configuration >\nAdministrative Templates >\nWindows PowerShell >\nTurn on PowerShell Script Block Logging (Enable)\n```\n\nSteps to implement the logging policy via registry:\n\n```\nreg add \"hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging\" /v EnableScriptBlockLogging /t REG_DWORD /d 1\n```\n","note":"## Triage and analysis\n\n### Investigating Potential PowerShell HackTool Script by Function Names\n\nPowerShell is one of the main tools system administrators use for automation, report routines, and other tasks. This makes it available for use in various environments, and creates an attractive way for attackers to execute code.\n\nAdversaries often exploit PowerShell's capabilities to execute malicious scripts and perform various attacks. This rule identifies known offensive tooling function names in PowerShell scripts, as attackers commonly use out-of-the-box tools without modifying the code. By monitoring these specific function names, the rule aims to detect and alert potential malicious PowerShell activity.\n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/current/invest-guide-run-osquery.html) introduced in Elastic Stack version 8.5.0. Older Elastic Stack versions will display unrendered Markdown in this guide.\n\n### Possible investigation steps\n\n- Examine the script content that triggered the detection; look for suspicious DLL imports, collection or exfiltration capabilities, suspicious functions, encoded or compressed data, and other potentially malicious characteristics.\n- Investigate the script execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n- Examine the script's execution context, such as the user account, privileges, the role of the system on which it was executed, and any relevant timestamps.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Evaluate whether the user needs to use PowerShell to complete tasks.\n- Investigate the origin of the PowerShell script, including its source, download method, and any associated URLs or IP addresses.\n- Examine the host for derived artifacts that indicate suspicious activities:\n  - Analyze the script using a private sandboxed analysis system.\n  - Observe and collect information about the following activities in both the sandbox and the alert subject host:\n    - Attempts to contact external domains and addresses.\n      - Use the Elastic Defend network events to determine domains and addresses contacted by the subject process by filtering by the process's `process.entity_id`.\n      - Examine the DNS cache for suspicious or anomalous entries.\n        - !{osquery{\"label\":\"Osquery - Retrieve DNS Cache\",\"query\":\"SELECT * FROM dns_cache\"}}\n    - Use the Elastic Defend registry events to examine registry keys accessed, modified, or created by the related processes in the process tree.\n    - Examine the host services for suspicious or anomalous entries.\n      - !{osquery{\"label\":\"Osquery - Retrieve All Services\",\"query\":\"SELECT description, display_name, name, path, pid, service_type, start_type, status, user_account FROM services\"}}\n      - !{osquery{\"label\":\"Osquery - Retrieve Services Running on User Accounts\",\"query\":\"SELECT description, display_name, name, path, pid, service_type, start_type, status, user_account FROM services WHERE\\nNOT (user_account LIKE '%LocalSystem' OR user_account LIKE '%LocalService' OR user_account LIKE '%NetworkService' OR\\nuser_account == null)\\n\"}}\n      - !{osquery{\"label\":\"Osquery - Retrieve Service Unsigned Executables with Virustotal Link\",\"query\":\"SELECT concat('https://www.virustotal.com/gui/file/', sha1) AS VtLink, name, description, start_type, status, pid,\\nservices.path FROM services JOIN authenticode ON services.path = authenticode.path OR services.module_path =\\nauthenticode.path JOIN hash ON services.path = hash.path WHERE authenticode.result != 'trusted'\\n\"}}\n  - Retrieve the files' SHA-256 hash values using the PowerShell `Get-FileHash` cmdlet and search for the existence and reputation of the hashes in resources like VirusTotal, Hybrid-Analysis, CISCO Talos, Any.run, etc.\n- Investigate potentially compromised accounts. Analysts can do this by searching for login events (for example, 4624) to the target host after the registry modification.\n\n\n### False positive analysis\n\n- This rule may generate false positives if legitimate scripts or tools used by administrators contain any of the listed function names. These function names are commonly associated with offensive tooling, but they may also be present in benign scripts or tools.\n- To handle these false positives consider adding exceptions - preferably with a combination of full file path and users.\n\n### Related Rules\n\n- PowerShell Invoke-NinjaCopy script - b8386923-b02c-4b94-986a-d223d9b01f88\n- PowerShell Suspicious Discovery Related Windows API Functions - 61ac3638-40a3-44b2-855a-985636ca985e\n- Potential Process Injection via PowerShell - 2e29e96a-b67c-455a-afe4-de6183431d0d\n- PowerShell Keylogging Script - bd2c86a0-8b61-4457-ab38-96943984e889\n\n### Response and Remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n  - If malicious activity is confirmed, perform a broader investigation to identify the scope of the compromise and determine the appropriate remediation steps.\n- Isolate the involved hosts to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors like reverse shells, reverse proxies, or droppers that attackers could use to reinfect the system.\n- Remove and block malicious artifacts identified during triage.\n- Reimage the host operating system or restore the compromised files to clean versions.\n- Restrict PowerShell usage outside of IT and engineering business units using GPOs, AppLocker, Intune, or similar software.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n","false_positives":[],"references":["https://github.com/atc-project/atc-data/blob/master/docs/Logging_Policies/LP_0109_windows_powershell_script_block_log.md","https://github.com/BC-SECURITY/Empire","https://www.microsoft.com/en-us/security/blog/2025/05/27/new-russia-affiliated-actor-void-blizzard-targets-critical-sectors-for-espionage/"],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"fa02147e-052e-4bdb-92a9-2b6c4486d166","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"query","language":"kuery","index":["winlogbeat-*","logs-windows.powershell*"],"query":"event.category:process and host.os.type:windows and\n  powershell.file.script_block_text : (\n    \"Add-DomainGroupMember\" or \"Add-DomainObjectAcl\" or\n    \"Add-RemoteConnection\" or \"Add-ServiceDacl\" or\n    \"Add-Win32Type\" or \"Convert-ADName\" or\n    \"Convert-LDAPProperty\" or \"ConvertFrom-LDAPLogonHours\" or\n    \"ConvertFrom-UACValue\" or \"Copy-ArrayOfMemAddresses\" or\n    \"Create-NamedPipe\" or \"Create-ProcessWithToken\" or\n    \"Create-RemoteThread\" or \"Create-SuspendedWinLogon\" or\n    \"Create-WinLogonProcess\" or \"Emit-CallThreadStub\" or\n    \"Enable-SeAssignPrimaryTokenPrivilege\" or \"Enable-SeDebugPrivilege\" or\n    \"Enum-AllTokens\" or \"Export-PowerViewCSV\" or\n    \"Find-AVSignature\" or \"Find-AppLockerLog\" or\n    \"Find-DomainLocalGroupMember\" or \"Find-DomainObjectPropertyOutlier\" or\n    \"Find-DomainProcess\" or \"Find-DomainShare\" or\n    \"Find-DomainUserEvent\" or \"Find-DomainUserLocation\" or\n    \"Find-InterestingDomainAcl\" or \"Find-InterestingDomainShareFile\" or\n    \"Find-InterestingFile\" or \"Find-LocalAdminAccess\" or\n    \"Find-PSScriptsInPSAppLog\" or \"Find-PathDLLHijack\" or\n    \"Find-ProcessDLLHijack\" or \"Find-RDPClientConnection\" or\n    \"Get-AllAttributesForClass\" or \"Get-CachedGPPPassword\" or\n    \"Get-DecryptedCpassword\" or \"Get-DecryptedSitelistPassword\" or\n    \"Get-DelegateType\" or \"New-RelayEnumObject\" or\n    \"Get-DomainDFSShare\" or \"Get-DomainDFSShareV1\" or\n    \"Get-DomainDFSShareV2\" or \"Get-DomainDNSRecord\" or\n    \"Get-DomainDNSZone\" or \"Get-DomainFileServer\" or\n    \"Get-DomainForeignGroupMember\" or \"Get-DomainForeignUser\" or\n    \"Get-DomainGPO\" or \"Get-DomainGPOComputerLocalGroupMapping\" or\n    \"Get-DomainGPOLocalGroup\" or \"Get-DomainGPOUserLocalGroupMapping\" or\n    \"Get-DomainGUIDMap\" or \"Get-DomainGroup\" or\n    \"Get-DomainGroupMember\" or \"Get-DomainGroupMemberDeleted\" or\n    \"Get-DomainManagedSecurityGroup\" or \"Get-DomainOU\" or\n    \"Get-DomainObject\" or \"Get-DomainObjectAcl\" or\n    \"Get-DomainObjectAttributeHistory\" or \"Get-DomainObjectLinkedAttributeHistory\" or\n    \"Get-DomainPolicyData\" or \"Get-DomainSID\" or\n    \"Get-DomainSPNTicket\" or \"Get-DomainSearcher\" or\n    \"Get-DomainSite\" or \"Get-DomainSubnet\" or\n    \"Get-DomainTrust\" or \"Get-DomainTrustMapping\" or\n    \"Get-DomainUser\" or \"Get-DomainUserEvent\" or\n    \"Get-Forest\" or \"Get-ForestDomain\" or\n    \"Get-ForestGlobalCatalog\" or \"Get-ForestSchemaClass\" or\n    \"Get-ForestTrust\" or \"Get-GPODelegation\" or\n    \"Get-GPPAutologon\" or \"Get-GPPInnerField\" or\n    \"Get-GPPInnerFields\" or \"Get-GPPPassword\" or\n    \"Get-GptTmpl\" or \"Get-GroupsXML\" or\n    \"Get-HttpStatus\" or \"Get-ImageNtHeaders\" or\n    \"Get-Keystrokes\" or \"New-SOASerialNumberArray\" or\n    \"Get-MemoryProcAddress\" or \"Get-MicrophoneAudio\" or\n    \"Get-ModifiablePath\" or \"Get-ModifiableRegistryAutoRun\" or\n    \"Get-ModifiableScheduledTaskFile\" or \"Get-ModifiableService\" or\n    \"Get-ModifiableServiceFile\" or \"Get-Name\" or\n    \"Get-NetComputerSiteName\" or \"Get-NetLocalGroup\" or\n    \"Get-NetLocalGroupMember\" or \"Get-NetLoggedon\" or\n    \"Get-NetRDPSession\" or \"Get-NetSession\" or\n    \"Get-NetShare\" or \"Get-PEArchitecture\" or\n    \"Get-PEBasicInfo\" or \"Get-PEDetailedInfo\" or\n    \"Get-PathAcl\" or \"Get-PrimaryToken\" or\n    \"Get-ProcAddress\" or \"Get-ProcessTokenGroup\" or\n    \"Get-ProcessTokenPrivilege\" or \"Get-ProcessTokenType\" or\n    \"Get-RegLoggedOn\" or \"Get-RegistryAlwaysInstallElevated\" or\n    \"Get-RegistryAutoLogon\" or \"Get-RemoteProcAddress\" or\n    \"Get-Screenshot\" or \"Get-ServiceDetail\" or\n    \"Get-SiteListPassword\" or \"Get-SitelistField\" or\n    \"Get-System\" or \"Get-SystemNamedPipe\" or\n    \"Get-SystemToken\" or \"Get-ThreadToken\" or\n    \"Get-TimedScreenshot\" or \"Get-TokenInformation\" or\n    \"Get-TopPort\" or \"Get-UnattendedInstallFile\" or\n    \"Get-UniqueTokens\" or \"Get-UnquotedService\" or\n    \"Get-VaultCredential\" or \"Get-VaultElementValue\" or\n    \"Get-VirtualProtectValue\" or \"Get-VolumeShadowCopy\" or\n    \"Get-WMIProcess\" or \"Get-WMIRegCachedRDPConnection\" or\n    \"Get-WMIRegLastLoggedOn\" or \"Get-WMIRegMountedDrive\" or\n    \"Get-WMIRegProxy\" or \"Get-WebConfig\" or\n    \"Get-Win32Constants\" or \"Get-Win32Functions\" or\n    \"Get-Win32Types\" or \"Import-DllImports\" or\n    \"Import-DllInRemoteProcess\" or \"Inject-LocalShellcode\" or\n    \"Inject-RemoteShellcode\" or \"Install-ServiceBinary\" or\n    \"Invoke-CompareAttributesForClass\" or \"Invoke-CreateRemoteThread\" or\n    \"Invoke-CredentialInjection\" or \"Invoke-DllInjection\" or\n    \"Invoke-EventVwrBypass\" or \"Invoke-ImpersonateUser\" or\n    \"Invoke-Kerberoast\" or \"Invoke-MemoryFreeLibrary\" or\n    \"Invoke-MemoryLoadLibrary\" or\n    \"Invoke-Mimikatz\" or \"Invoke-NinjaCopy\" or\n    \"Invoke-PatchDll\" or \"Invoke-Portscan\" or\n    \"Invoke-PrivescAudit\" or \"Invoke-ReflectivePEInjection\" or\n    \"Invoke-ReverseDnsLookup\" or \"Invoke-RevertToSelf\" or\n    \"Invoke-ServiceAbuse\" or \"Invoke-Shellcode\" or\n    \"Invoke-TokenManipulation\" or \"Invoke-UserImpersonation\" or\n    \"Invoke-WmiCommand\" or \"Mount-VolumeShadowCopy\" or\n    \"New-ADObjectAccessControlEntry\" or \"New-DomainGroup\" or\n    \"New-DomainUser\" or \"New-DynamicParameter\" or\n    \"New-InMemoryModule\" or\n    \"New-ThreadedFunction\" or \"New-VolumeShadowCopy\" or\n    \"Out-CompressedDll\" or \"Out-EncodedCommand\" or\n    \"Out-EncryptedScript\" or \"Out-Minidump\" or\n    \"PortScan-Alive\" or \"Portscan-Port\" or\n    \"Remove-DomainGroupMember\" or \"Remove-DomainObjectAcl\" or\n    \"Remove-RemoteConnection\" or \"Remove-VolumeShadowCopy\" or\n    \"Restore-ServiceBinary\" or \"Set-DesktopACLToAllowEveryone\" or\n    \"Set-DesktopACLs\" or \"Set-DomainObject\" or\n    \"Set-DomainObjectOwner\" or \"Set-DomainUserPassword\" or\n    \"Set-ServiceBinaryPath\" or \"Sub-SignedIntAsUnsigned\" or\n    \"Test-AdminAccess\" or \"Test-MemoryRangeValid\" or\n    \"Test-ServiceDaclPermission\" or \"Update-ExeFunctions\" or\n    \"Update-MemoryAddresses\" or \"Update-MemoryProtectionFlags\" or\n    \"Write-BytesToMemory\" or \"Write-HijackDll\" or\n    \"Write-PortscanOut\" or \"Write-ServiceBinary\" or\n    \"Write-UserAddMSI\" or \"Invoke-Privesc\" or\n    \"func_get_proc_address\" or \"Invoke-BloodHound\" or\n    \"Invoke-HostEnum\" or \"Get-BrowserInformation\" or\n    \"Get-DomainAccountPolicy\" or \"Get-DomainAdmins\" or\n    \"Get-AVProcesses\" or \"Get-AVInfo\" or\n    \"Get-RecycleBin\" or \"Invoke-BruteForce\" or\n    \"Get-PassHints\" or \"Invoke-SessionGopher\" or\n    \"Get-LSASecret\" or \"Get-PassHashes\" or\n    \"Invoke-WdigestDowngrade\" or \"Get-ChromeDump\" or\n    \"Invoke-DomainPasswordSpray\" or \"Get-FoxDump\" or\n    \"New-HoneyHash\" or \"Invoke-DCSync\" or\n    \"Invoke-PowerDump\" or \"Invoke-SSIDExfil\" or\n    \"Invoke-PowerShellTCP\" or \"Add-Exfiltration\" or\n    \"Do-Exfiltration\" or \"Invoke-DropboxUpload\" or\n    \"Invoke-ExfilDataToGitHub\" or \"Invoke-EgressCheck\" or\n    \"Invoke-PostExfil\" or \"Create-MultipleSessions\" or\n    \"Invoke-NetworkRelay\" or \"New-GPOImmediateTask\" or\n    \"Invoke-WMIDebugger\" or \"Invoke-SQLOSCMD\" or\n    \"Invoke-SMBExec\" or \"Invoke-PSRemoting\" or\n    \"Invoke-ExecuteMSBuild\" or \"Invoke-DCOM\" or\n    \"Invoke-InveighRelay\" or \"Invoke-PsExec\" or\n    \"Find-ActiveUsersWMI\" or\n    \"Get-SystemDrivesWMI\" or \"Get-ActiveNICSWMI\" or\n    \"Remove-Persistence\" or \"DNS_TXT_Pwnage\" or\n    \"Execute-OnTime\" or \"HTTP-Backdoor\" or\n    \"Add-ConstrainedDelegationBackdoor\" or \"Add-RegBackdoor\" or\n    \"Add-ScrnSaveBackdoor\" or \"Gupt-Backdoor\" or\n    \"Invoke-ADSBackdoor\" or \"Add-Persistence\" or\n    \"Invoke-ResolverBackdoor\" or \"Invoke-EventLogBackdoor\" or\n    \"Invoke-DeadUserBackdoor\" or \"Invoke-DisableMachineAcctChange\" or\n    \"Invoke-AccessBinary\" or \"Add-NetUser\" or\n    \"Invoke-Schtasks\" or \"Invoke-JSRatRegsvr\" or\n    \"Invoke-JSRatRundll\" or \"Invoke-PoshRatHttps\" or\n    \"Invoke-PsGcatAgent\" or \"Remove-PoshRat\" or\n    \"Install-SSP\" or \"Invoke-BackdoorLNK\" or\n    \"PowerBreach\" or \"InstallEXE-Persistence\" or\n    \"RemoveEXE-Persistence\" or \"Install-ServiceLevel-Persistence\" or\n    \"Remove-ServiceLevel-Persistence\" or \"Invoke-Prompt\" or\n    \"Invoke-PacketCapture\" or \"Start-WebcamRecorder\" or\n    \"Get-USBKeyStrokes\" or \"Invoke-KeeThief\" or\n    \"Get-Keystrokes\" or \"Invoke-NetRipper\" or\n    \"Get-EmailItems\" or \"Invoke-MailSearch\" or\n    \"Invoke-SearchGAL\" or \"Get-WebCredentials\" or\n    \"Start-CaptureServer\" or \"Invoke-PowerShellIcmp\" or\n    \"Invoke-PowerShellTcpOneLine\" or \"Invoke-PowerShellTcpOneLineBind\" or\n    \"Invoke-PowerShellUdp\" or \"Invoke-PowerShellUdpOneLine\" or\n    \"Run-EXEonRemote\" or \"Download-Execute-PS\" or\n    \"Out-RundllCommand\" or \"Set-RemoteWMI\" or\n    \"Set-DCShadowPermissions\" or \"Invoke-PowerShellWMI\" or\n    \"Invoke-Vnc\" or \"Invoke-LockWorkStation\" or\n    \"Invoke-EternalBlue\" or \"Invoke-ShellcodeMSIL\" or\n    \"Invoke-MetasploitPayload\" or \"Invoke-DowngradeAccount\" or\n    \"Invoke-RunAs\" or \"ExetoText\" or\n    \"Disable-SecuritySettings\" or \"Set-MacAttribute\" or\n    \"Invoke-MS16032\" or \"Invoke-BypassUACTokenManipulation\" or\n    \"Invoke-SDCLTBypass\" or \"Invoke-FodHelperBypass\" or\n    \"Invoke-EventVwrBypass\" or \"Invoke-EnvBypass\" or\n    \"Get-ServiceUnquoted\" or \"Get-ServiceFilePermission\" or\n    \"Get-ServicePermission\" or\n    \"Enable-DuplicateToken\" or \"Invoke-PsUaCme\" or\n    \"Invoke-Tater\" or \"Invoke-WScriptBypassUAC\" or\n    \"Invoke-AllChecks\" or \"Find-TrustedDocuments\" or\n    \"Invoke-Interceptor\" or \"Invoke-PoshRatHttp\" or\n    \"Invoke-ExecCommandWMI\" or \"Invoke-KillProcessWMI\" or\n    \"Invoke-CreateShareandExecute\" or \"Invoke-RemoteScriptWithOutput\" or\n    \"Invoke-SchedJobManipulation\" or \"Invoke-ServiceManipulation\" or\n    \"Invoke-PowerOptionsWMI\" or \"Invoke-DirectoryListing\" or\n    \"Invoke-FileTransferOverWMI\" or \"Invoke-WMImplant\" or\n    \"Invoke-WMIObfuscatedPSCommand\" or \"Invoke-WMIDuplicateClass\" or\n    \"Invoke-WMIUpload\" or \"Invoke-WMIRemoteExtract\" or \"Invoke-winPEAS\" or\n    \"Invoke-AzureHound\" or \"Invoke-SharpHound\"\n  ) and\n  not powershell.file.script_block_text : (\n    \"sentinelbreakpoints\" and \"Set-PSBreakpoint\"\n  ) and\n  not user.id : (\"S-1-5-18\" or \"S-1-5-19\")\n","filters":[{"meta":{"negate":true},"query":{"wildcard":{"file.path":{"case_insensitive":true,"value":"?:\\\\ProgramData\\\\Microsoft\\\\Windows Defender Advanced Threat Protection\\\\DataCollection\\\\*"}}}}]}
{"id":"c0ef57e2-f306-41b7-bce9-b3824f04446f","rule_id":"781f8746-2180-4691-890c-4c96d11ca91d","name":"Potential Network Sweep Detected","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":13,"revision":0,"updated_at":"2025-12-08T19:09:25.895Z","updated_by":"aswin","created_at":"2025-12-08T19:09:24.192Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"This rule identifies a potential network sweep. A network sweep is a method used by attackers to scan a target network, identifying active hosts, open ports, and available services to gather information on vulnerabilities and weaknesses. This reconnaissance helps them plan subsequent attacks and exploit potential entry points for unauthorized access, data theft, or other malicious activities. This rule defines a threshold-based approach to detect multiple connection attempts from a single host to numerous destination hosts over commonly used network services.","tags":["Domain: Network","Tactic: Discovery","Tactic: Reconnaissance","Use Case: Network Security Monitoring","Data Source: PAN-OS","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0007","name":"Discovery","reference":"https://attack.mitre.org/tactics/TA0007/"},"technique":[{"id":"T1046","name":"Network Service Discovery","reference":"https://attack.mitre.org/techniques/T1046/"}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0043","name":"Reconnaissance","reference":"https://attack.mitre.org/tactics/TA0043/"},"technique":[{"id":"T1595","name":"Active Scanning","reference":"https://attack.mitre.org/techniques/T1595/","subtechnique":[{"id":"T1595.001","name":"Scanning IP Blocks","reference":"https://attack.mitre.org/techniques/T1595/001/"}]}]}],"related_integrations":[{"package":"network_traffic","version":"^1.33.0"},{"package":"panw","version":"^5.2.0"}],"required_fields":[{"name":"destination.port","type":"long","ecs":true},{"name":"event.action","type":"keyword","ecs":true},{"name":"source.ip","type":"ip","ecs":true}],"setup":"","note":"## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating Potential Network Sweep Detected\n\nNetwork sweeps are reconnaissance techniques where attackers scan networks to identify active hosts and services, often targeting common ports. This activity helps adversaries map out network vulnerabilities for future exploitation. The detection rule identifies such sweeps by monitoring connection attempts from a single source to multiple destinations on key ports, flagging potential reconnaissance activities for further investigation.\n\n### Possible investigation steps\n\n- Review the source IP address to determine if it belongs to a known or trusted entity within the network, focusing on the private IP ranges specified in the query (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16).\n- Analyze the destination IP addresses to identify any patterns or commonalities, such as specific subnets or devices, that could indicate targeted reconnaissance.\n- Check historical logs for previous connection attempts from the same source IP to see if there is a pattern of repeated scanning behavior or if this is an isolated incident.\n- Investigate the specific ports targeted (21, 22, 23, 25, 139, 445, 3389, 5985, 5986) to determine if they are associated with critical services or known vulnerabilities within the network.\n- Correlate the detected activity with any recent changes or incidents in the network environment that might explain the behavior, such as new device deployments or configuration changes.\n- Consult threat intelligence sources to determine if the source IP or similar scanning patterns have been associated with known threat actors or campaigns.\n\n### False positive analysis\n\n- Internal network scans by IT teams can trigger the rule. Regularly scheduled scans for security assessments should be documented and their source IPs added to an exception list to prevent false alerts.\n- Automated monitoring tools that check network health might cause false positives. Identify these tools and exclude their IP addresses from the rule to avoid unnecessary alerts.\n- Load balancers or network devices that perform health checks across multiple hosts can be mistaken for network sweeps. Exclude these devices by adding their IPs to a whitelist.\n- Development or testing environments where multiple connections are made for legitimate purposes can trigger the rule. Ensure these environments are recognized and their IP ranges are excluded from monitoring.\n- Misconfigured devices that repeatedly attempt to connect to multiple hosts can appear as network sweeps. Investigate and correct the configuration, then exclude these devices if necessary.\n\n### Response and remediation\n\n- Isolate the source IP: Immediately isolate the source IP address identified in the alert from the network to prevent further reconnaissance or potential exploitation of identified vulnerabilities.\n\n- Block suspicious ports: Implement firewall rules to block incoming and outgoing traffic on the commonly targeted ports (21, 22, 23, 25, 139, 445, 3389, 5985, 5986) from the source IP to mitigate further scanning attempts.\n\n- Conduct a network-wide scan: Perform a comprehensive scan of the network to identify any unauthorized access or changes that may have occurred as a result of the network sweep.\n\n- Review and update access controls: Ensure that access controls and permissions are appropriately configured to limit exposure of critical services and sensitive data.\n\n- Monitor for recurrence: Set up enhanced monitoring and alerting for any future connection attempts from the source IP or similar patterns of network sweep activity.\n\n- Escalate to security operations: Notify the security operations team to conduct a deeper investigation into the source of the network sweep and assess any potential threats or breaches.\n\n- Document and report: Record all findings, actions taken, and lessons learned in an incident report to inform future response strategies and improve network defenses.","false_positives":[],"references":[],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":5,"exceptions_list":[],"actions":[],"type":"threshold","language":"kuery","index":["packetbeat-*","filebeat-*","logs-network_traffic.*","logs-panw.panos*"],"query":"event.action:network_flow and destination.port:(21 or 22 or 23 or 25 or 139 or 445 or 3389 or 5985 or 5986) and\nsource.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16)\n","threshold":{"field":["source.ip"],"value":1,"cardinality":[{"field":"destination.ip","value":100}]}}
{"id":"034d5510-a6cf-412f-b4ca-7f4155191a86","rule_id":"717f82c2-7741-4f9b-85b8-d06aeb853f4f","name":"Modification of Dynamic Linker Preload Shared Object","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":212,"revision":1,"updated_at":"2025-12-05T18:48:21.640Z","updated_by":"aswin","created_at":"2025-12-03T17:17:15.286Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Identifies modification of the dynamic linker preload shared object (ld.so.preload). Adversaries may execute malicious payloads by hijacking the dynamic linker used to load libraries.","tags":["Domain: Endpoint","OS: Linux","Use Case: Threat Detection","Tactic: Privilege Escalation","Data Source: Elastic Endgame","Data Source: Elastic Defend","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0004","name":"Privilege Escalation","reference":"https://attack.mitre.org/tactics/TA0004/"},"technique":[{"id":"T1574","name":"Hijack Execution Flow","reference":"https://attack.mitre.org/techniques/T1574/","subtechnique":[{"id":"T1574.006","name":"Dynamic Linker Hijacking","reference":"https://attack.mitre.org/techniques/T1574/006/"}]}]}],"related_integrations":[{"package":"endpoint","version":"^9.0.0"}],"required_fields":[{"name":"event.action","type":"keyword","ecs":true},{"name":"event.category","type":"keyword","ecs":true},{"name":"event.type","type":"keyword","ecs":true},{"name":"file.path","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.name","type":"keyword","ecs":true}],"setup":"## Setup\n\nThis rule requires data coming in from one of the following integrations:\n- Elastic Defend\n- Auditbeat\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n\n### Auditbeat Setup\nAuditbeat is a lightweight shipper that you can install on your servers to audit the activities of users and processes on your systems. For example, you can use Auditbeat to collect and centralize audit events from the Linux Audit Framework. You can also use Auditbeat to detect changes to critical files, like binaries and configuration files, and identify potential security policy violations.\n\n#### The following steps should be executed in order to add the Auditbeat on a Linux System:\n- Elastic provides repositories available for APT and YUM-based distributions. Note that we provide binary packages, but no source packages.\n- To install the APT and YUM repositories follow the setup instructions in this [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/setup-repositories.html).\n- To run Auditbeat on Docker follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/running-on-docker.html).\n- To run Auditbeat on Kubernetes follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/running-on-kubernetes.html).\n- For complete “Setup and Run Auditbeat” information refer to the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/setting-up-and-running.html).\n","note":"## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating Modification of Dynamic Linker Preload Shared Object\n\nThe dynamic linker preload mechanism in Linux, via `/etc/ld.so.preload`, allows preloading of shared libraries, influencing how executables load dependencies. Adversaries exploit this by inserting malicious libraries, hijacking execution flow for privilege escalation. The detection rule monitors changes to this file, excluding benign processes, to identify unauthorized modifications indicative of such abuse.\n\n### Possible investigation steps\n\n- Review the alert details to confirm the file path involved is /etc/ld.so.preload and verify the event action is one of the specified actions: updated, renamed, or file_rename_event.\n- Identify the process responsible for the modification by examining the process.name field, ensuring it is not one of the excluded processes (wine or oneagentinstallaction).\n- Investigate the process that triggered the alert by gathering additional context such as process ID, command line arguments, and parent process to understand its origin and purpose.\n- Check the modification timestamp and correlate it with other system events or logs to identify any suspicious activity or patterns around the time of the modification.\n- Analyze the contents of /etc/ld.so.preload to determine if any unauthorized or suspicious libraries have been added, and assess their potential impact on the system.\n- Review user accounts and permissions associated with the process to determine if there has been any unauthorized access or privilege escalation attempt.\n- If malicious activity is confirmed, isolate the affected system and follow incident response procedures to mitigate the threat and prevent further exploitation.\n\n### False positive analysis\n\n- Legitimate software installations or updates may modify /etc/ld.so.preload. To handle this, monitor the process names associated with these activities and consider adding them to the exclusion list if they are verified as benign.\n- System management tools like configuration management software might update /etc/ld.so.preload as part of routine operations. Identify these tools and exclude their process names from the detection rule to prevent false alerts.\n- Custom scripts or administrative tasks executed by trusted users could inadvertently trigger the rule. Review these scripts and, if necessary, exclude their process names or user accounts from the detection criteria.\n- Security agents or monitoring tools that interact with system files might cause false positives. Verify these tools' activities and exclude their process names if they are known to be safe and necessary for system operations.\n\n### Response and remediation\n\n- Immediately isolate the affected system from the network to prevent further exploitation or lateral movement by the adversary.\n- Terminate any suspicious processes that are not part of the baseline or known benign applications, especially those related to the modification of `/etc/ld.so.preload`.\n- Restore the `/etc/ld.so.preload` file from a known good backup to ensure no malicious libraries are preloaded.\n- Conduct a thorough review of recent system changes and installed packages to identify any unauthorized software or modifications that may have facilitated the attack.\n- Escalate the incident to the security operations team for a deeper forensic analysis to determine the scope of the compromise and identify any additional affected systems.\n- Implement additional monitoring on the affected system and similar environments to detect any further attempts to modify the dynamic linker preload file.\n- Review and enhance access controls and permissions on critical system files like `/etc/ld.so.preload` to prevent unauthorized modifications in the future.","false_positives":[],"references":["https://www.anomali.com/blog/rocke-evolves-its-arsenal-with-a-new-malware-family-written-in-golang"],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"843c3722-58f4-4aa7-8e34-370f7ec4baf2","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"new_terms","query":"host.os.type:linux and event.category:file and event.action:(file_rename_event or rename or renamed or updated) and\nnot event.type:deletion and file.path:/etc/ld.so.preload and\nprocess.name:(* and not (oneagentinstallaction or passwd or wine))\n","new_terms_fields":["host.id","user.id","process.executable"],"history_window_start":"now-10d","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"language":"kuery"}
{"id":"621bd8cc-11fd-4627-959a-14c4702f2863","rule_id":"45ac4800-840f-414c-b221-53dd36a5aaf7","name":"Windows Event Logs Cleared","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":215,"revision":1,"updated_at":"2025-12-05T18:48:20.804Z","updated_by":"aswin","created_at":"2025-12-04T15:12:18.712Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Identifies attempts to clear Windows event log stores. This is often done by attackers in an attempt to evade detection or destroy forensic evidence on a system.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Defense Evasion","Resources: Investigation Guide","Data Source: Windows Security Event Logs","Data Source: Windows System Event Logs"],"author":["Elastic","Anabella Cristaldi"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1070","name":"Indicator Removal","reference":"https://attack.mitre.org/techniques/T1070/","subtechnique":[{"id":"T1070.001","name":"Clear Windows Event Logs","reference":"https://attack.mitre.org/techniques/T1070/001/"}]}]}],"related_integrations":[{"package":"system","version":"^2.0.0"},{"package":"windows","version":"^3.0.0"}],"required_fields":[{"name":"event.action","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"winlog.provider_name","type":"keyword","ecs":false}],"setup":"","note":"## Triage and analysis\n\n### Investigating Windows Event Logs Cleared\n\nWindows event logs are a fundamental data source for security monitoring, forensics, and incident response. Adversaries can tamper, clear, and delete this data to break SIEM detections, cover their tracks, and slow down incident response.\n\nThis rule looks for the occurrence of clear actions on the `security` event log.\n\n#### Possible investigation steps\n\n- Investigate the process execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n- Identify the user account that performed the action and whether it should perform this kind of action.\n- Contact the account owner and confirm whether they are aware of this activity.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n  - Verify if any other anti-forensics behaviors were observed.\n- Investigate the event logs prior to the action for suspicious behaviors that an attacker may be trying to cover up.\n\n### False positive analysis\n\n- This activity is unlikely to happen legitimately. Benign true positives (B-TPs) can be added as exceptions if necessary.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n  - This activity is potentially done after the adversary achieves its objectives on the host. Ensure that previous actions, if any, are investigated accordingly with their response playbooks.\n- Isolate the involved host to prevent further post-compromise behavior.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n","false_positives":[],"references":[],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"e3710029-c495-4dc5-aeff-4c370c87f502","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"query","language":"kuery","index":["winlogbeat-*","logs-system.security*","logs-system.system*","logs-windows.forwarded*"],"query":"host.os.type:windows and event.action:(\"audit-log-cleared\" or \"Log clear\") and\n  not winlog.provider_name:\"AD FS Auditing\"\n"}
{"id":"1ca7d576-a84d-4bef-ae23-a4f4599d162a","rule_id":"daafdf96-e7b1-4f14-b494-27e0d24b11f6","name":"Potential Pass-the-Hash (PtH) Attempt","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":110,"revision":1,"updated_at":"2025-12-05T18:48:20.808Z","updated_by":"aswin","created_at":"2025-12-04T15:07:58.725Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Adversaries may pass the hash using stolen password hashes to move laterally within an environment, bypassing normal system access controls. Pass the hash (PtH) is a method of authenticating as a user without having access to the user's cleartext password.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Lateral Movement","Data Source: Windows Security Event Logs","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0008","name":"Lateral Movement","reference":"https://attack.mitre.org/tactics/TA0008/"},"technique":[{"id":"T1550","name":"Use Alternate Authentication Material","reference":"https://attack.mitre.org/techniques/T1550/","subtechnique":[{"id":"T1550.002","name":"Pass the Hash","reference":"https://attack.mitre.org/techniques/T1550/002/"}]}]}],"related_integrations":[{"package":"windows","version":"^3.0.0"},{"package":"system","version":"^2.0.0"}],"required_fields":[{"name":"event.action","type":"keyword","ecs":true},{"name":"event.category","type":"keyword","ecs":true},{"name":"event.outcome","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"user.id","type":"keyword","ecs":true},{"name":"winlog.event_data.LogonProcessName","type":"keyword","ecs":false},{"name":"winlog.logon.type","type":"unknown","ecs":false}],"setup":"","note":"## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating Potential Pass-the-Hash (PtH) Attempt\n\nPass-the-Hash (PtH) is a technique where attackers use stolen password hashes to authenticate and move laterally across systems without needing plaintext passwords. This method exploits the authentication process in Windows environments. The detection rule identifies suspicious logins using specific logon types and processes, indicating potential PtH activity, by monitoring successful authentications with certain user IDs and logon processes.\n\n### Possible investigation steps\n\n- Review the event logs for the specific user IDs (S-1-5-21-* or S-1-12-1-*) to identify any unusual or unauthorized access patterns, focusing on the time and source of the logon events.\n- Examine the winlog.event_data.LogonProcessName field for \"seclogo\" to determine if this process is commonly used in your environment or if it appears suspicious or unexpected.\n- Correlate the successful authentication events with other security logs to identify any lateral movement or access to sensitive systems that occurred after the initial logon.\n- Investigate the source IP addresses and hostnames associated with the logon events to determine if they are known and trusted within the network or if they originate from unusual or external locations.\n- Check for any recent changes or anomalies in the accounts associated with the suspicious user IDs, such as password resets, privilege escalations, or unusual account activity.\n- Consult threat intelligence sources to see if there are any known campaigns or threat actors using similar techniques or targeting similar environments.\n\n### False positive analysis\n\n- Legitimate administrative tools or scripts that use the \"NewCredentials\" logon type for automation or scheduled tasks can trigger false positives. Review and whitelist known benign processes or scripts that are part of regular operations.\n- Security software or monitoring tools that perform regular checks using the \"seclogo\" logon process may be misidentified. Identify and exclude these tools from the detection rule to prevent unnecessary alerts.\n- Service accounts with user IDs matching the specified patterns (S-1-5-21-* or S-1-12-1-*) might be flagged during routine operations. Ensure these accounts are documented and create exceptions for their expected activities.\n- Regularly scheduled tasks or maintenance activities that involve authentication processes similar to PtH can cause false positives. Document these activities and adjust the detection rule to account for their occurrence.\n- User behavior analytics might incorrectly flag normal user activities as suspicious. Implement user behavior baselining to differentiate between typical and atypical logon patterns, refining the detection criteria accordingly.\n\n### Response and remediation\n\n- Immediately isolate the affected system from the network to prevent further lateral movement by the attacker.\n- Revoke any active sessions associated with the compromised user IDs (S-1-5-21-* or S-1-12-1-*) to disrupt the attacker's access.\n- Conduct a password reset for the affected accounts and any other accounts that may have been accessed using the compromised hashes.\n- Review and update access controls and permissions for the affected accounts to ensure they adhere to the principle of least privilege.\n- Deploy endpoint detection and response (EDR) tools to monitor for any further suspicious activity or attempts to use stolen hashes.\n- Escalate the incident to the security operations center (SOC) or incident response team for further investigation and to determine the scope of the breach.\n- Implement additional logging and monitoring for the \"seclogo\" logon process to enhance detection of future pass-the-hash attempts.","false_positives":[],"references":["https://attack.mitre.org/techniques/T1550/002/"],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"ca1d3263-b8ba-4850-9f4f-fd5448eb3d14","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"new_terms","query":"host.os.type:\"windows\" and\nevent.category : \"authentication\" and event.action : \"logged-in\" and\nwinlog.logon.type : \"NewCredentials\" and event.outcome : \"success\" and\nuser.id : (S-1-5-21-* or S-1-12-1-*) and winlog.event_data.LogonProcessName : \"seclogo\"\n","new_terms_fields":["user.id"],"history_window_start":"now-10d","index":["winlogbeat-*","logs-windows.forwarded*","logs-system.security*"],"language":"kuery"}
{"id":"2a7ee7af-3a5f-408d-a2d7-c5d11b54ec57","rule_id":"2553a9af-52a4-4a05-bb03-85b2a479a0a0","name":"Potential PowerShell HackTool Script by Author","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":108,"revision":1,"updated_at":"2025-12-05T18:48:20.807Z","updated_by":"aswin","created_at":"2025-12-04T15:02:56.517Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Detects known PowerShell offensive tooling author's name in PowerShell scripts. Attackers commonly use out-of-the-box offensive tools without modifying the code, which may still contain the author artifacts. This rule identifies common author handles found in popular PowerShell scripts used for red team exercises.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Execution","Data Source: PowerShell Logs","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.001","name":"PowerShell","reference":"https://attack.mitre.org/techniques/T1059/001/"}]}]}],"related_integrations":[{"package":"windows","version":"^3.0.0"}],"required_fields":[{"name":"event.category","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"powershell.file.script_block_text","type":"unknown","ecs":false}],"setup":"## Setup\n\nThe 'PowerShell Script Block Logging' logging policy must be enabled.\nSteps to implement the logging policy with Advanced Audit Configuration:\n\n```\nComputer Configuration >\nAdministrative Templates >\nWindows PowerShell >\nTurn on PowerShell Script Block Logging (Enable)\n```\n\nSteps to implement the logging policy via registry:\n\n```\nreg add \"hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging\" /v EnableScriptBlockLogging /t REG_DWORD /d 1\n```\n","note":"## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating Potential PowerShell HackTool Script by Author\n\nPowerShell is a powerful scripting language and automation framework used in Windows environments for task automation and configuration management. Adversaries exploit PowerShell's capabilities to execute malicious scripts, often leveraging well-known offensive tools without altering the original code. The detection rule identifies scripts containing specific author names linked to these tools, flagging potential misuse by recognizing unmodified author artifacts in the script block text.\n\n### Possible investigation steps\n\n- Review the PowerShell script block text associated with the alert to identify the specific author name that triggered the detection. This can provide insight into the potential tool or script being used.\n- Examine the process details, including the parent process and command line arguments, to understand the context in which the PowerShell script was executed. This can help determine if the execution was part of a legitimate task or a suspicious activity.\n- Check the host's recent activity logs for any other unusual or related events, such as network connections, file modifications, or other process executions, to identify potential lateral movement or data exfiltration attempts.\n- Investigate the user account under which the PowerShell script was executed to determine if it has been compromised or if the activity aligns with the user's typical behavior.\n- Correlate the alert with other security tools and logs, such as antivirus or endpoint detection and response (EDR) solutions, to gather additional context and confirm whether the activity is malicious.\n\n### False positive analysis\n\n- Scripts used in legitimate red team exercises may trigger the rule due to the presence of known author names. To manage this, create exceptions for scripts verified as part of authorized security assessments.\n- PowerShell scripts from open-source security tools used for internal testing or training might be flagged. Ensure these tools are documented and approved, then exclude them from the rule.\n- Automated scripts for system administration that include code snippets from well-known authors could be mistakenly identified. Review and whitelist these scripts if they are part of routine operations.\n- Security research and development activities using sample scripts from recognized authors may cause alerts. Maintain a list of such activities and exclude them from detection to avoid unnecessary alerts.\n- Internal development teams using PowerShell scripts for legitimate purposes might inadvertently use code from popular authors. Conduct regular reviews and exclude these scripts if they are deemed non-threatening.\n\n### Response and remediation\n\n- Immediately isolate the affected system from the network to prevent further execution of potentially malicious scripts and lateral movement.\n- Terminate any suspicious PowerShell processes identified by the alert to halt ongoing malicious activity.\n- Conduct a thorough review of the PowerShell script block text to confirm the presence of known offensive tool author names and assess the potential impact.\n- Remove any unauthorized or malicious scripts from the affected system and ensure that all legitimate scripts are verified and restored from a clean backup.\n- Update endpoint protection and antivirus signatures to detect and block the specific PowerShell scripts and associated indicators of compromise (IOCs) identified in the alert.\n- Escalate the incident to the security operations center (SOC) or incident response team for further investigation and to determine if additional systems are affected.\n- Implement enhanced monitoring and logging for PowerShell activity across the network to detect similar threats in the future, leveraging the MITRE ATT&CK framework for guidance on relevant techniques and tactics.","false_positives":[],"references":["https://github.com/atc-project/atc-data/blob/master/docs/Logging_Policies/LP_0109_windows_powershell_script_block_log.md"],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"ada8ff54-d104-4efc-bcf6-e50af582e99d","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"query","language":"kuery","index":["winlogbeat-*","logs-windows.powershell*"],"query":"host.os.type:windows and event.category:process and\n  powershell.file.script_block_text : (\n      \"mattifestation\" or \"JosephBialek\" or\n      \"harmj0y\" or \"ukstufus\" or\n      \"SecureThisShit\" or \"Matthew Graeber\" or\n      \"secabstraction\" or \"mgeeky\" or\n      \"oddvarmoe\" or \"am0nsec\" or\n      \"obscuresec\" or \"sixdub\" or\n      \"darkoperator\" or \"funoverip\" or\n      \"rvrsh3ll\" or \"kevin_robertson\" or\n      \"dafthack\" or \"r4wd3r\" or\n      \"danielhbohannon\" or \"OneLogicalMyth\" or\n      \"cobbr_io\" or \"xorrior\" or\n      \"PetrMedonos\" or \"citronneur\" or\n      \"eladshamir\" or \"RastaMouse\" or\n      \"enigma0x3\" or \"FuzzySec\" or\n      \"424f424f\" or \"jaredhaight\" or\n      \"fullmetalcache\" or \"Hubbl3\" or\n      \"curi0usJack\" or \"Cx01N\" or\n      \"itm4n\" or \"nurfed1\" or\n      \"cfalta\" or \"Scott Sutherland\" or\n      \"_nullbind\" or \"_tmenochet\" or\n      \"jaredcatkinson\" or \"ChrisTruncer\" or\n      \"monoxgas\" or \"TheRealWover\" or\n      \"splinter_code\"\n  ) and\n  not powershell.file.script_block_text : (\"Get-UEFIDatabaseSigner\" or \"Posh-SSH\")\n"}
{"id":"cd347d38-a2e7-472b-a4ad-8868d83b5b06","rule_id":"7c58e3fc-c702-4d02-8b39-102407c7dc2d","name":"Suspicious SSH Key Generation Activity","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.324Z","updated_by":"aswin","created_at":"2025-12-08T19:15:33.005Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects creation of SSH keys which may indicate adversary preparing for remote access (Acquire Access - T1650)","tags":["MITRE"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0042","name":"Resource Development","reference":"https://attack.mitre.org/tactics/TA0042/"},"technique":[{"id":"T1650","name":"Acquire Access","reference":"https://attack.mitre.org/techniques/T1650/","subtechnique":[]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["auditbeat-*","winlogbeat-*"],"query":"event.type: \"start\" AND\nprocess.name: (\"ssh-keygen\" OR \"ssh-keygen.exe\") AND\nNOT process.args: (\"-l\" OR \"-L\" OR \"-F\") AND\nNOT user.name: (\"ansible\" OR \"jenkins\" OR \"gitlab-runner\")\n","filters":[]}
{"id":"66bee13c-5b9d-4477-90dc-b1278b540060","rule_id":"4d4e2a84-2f59-41c6-abe2-1726cabaef81","name":"DNS → High-entropy first label","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:27.240Z","updated_by":"aswin","created_at":"2025-12-06T22:35:07.280Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"High-entropy first label (possible DGA / DNS tunneling payloads)","tags":[],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0011","name":"Command and Control","reference":"https://attack.mitre.org/tactics/TA0011/"},"technique":[{"id":"T1071","name":"Application Layer Protocol","reference":"https://attack.mitre.org/techniques/T1071/","subtechnique":[{"id":"T1071.004","name":"DNS","reference":"https://attack.mitre.org/techniques/T1071/004/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"2e1491a4-a656-46e3-aeb4-fcaee1e6f971","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["auditbeat-*","zeek-*"],"query":"event.dataset: \"zeek.dns\" and domain_entropy > 3.5 and domain_length > 12\n","filters":[]}
{"id":"1af9c553-6265-4b9d-b0aa-5574f9e0e4e5","rule_id":"f036953a-4615-4707-a1ca-dc53bf69dcd5","name":"Unusual Child Processes of RunDLL32","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":213,"revision":1,"updated_at":"2025-12-05T18:48:20.791Z","updated_by":"aswin","created_at":"2025-12-04T16:39:24.815Z","created_by":"aswin","enabled":true,"interval":"30m","from":"now-60m","to":"now","description":"Identifies child processes of unusual instances of RunDLL32 where the command line parameters were suspicious. Misuse of RunDLL32 could indicate malicious activity.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Defense Evasion","Data Source: Elastic Defend","Data Source: Sysmon","Data Source: Crowdstrike","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1218","name":"System Binary Proxy Execution","reference":"https://attack.mitre.org/techniques/T1218/","subtechnique":[{"id":"T1218.011","name":"Rundll32","reference":"https://attack.mitre.org/techniques/T1218/011/"}]}]}],"related_integrations":[{"package":"endpoint","version":"^9.0.0"},{"package":"windows","version":"^3.0.0"},{"package":"crowdstrike","version":"^2.0.0"}],"required_fields":[{"name":"event.type","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.args_count","type":"long","ecs":true},{"name":"process.command_line","type":"wildcard","ecs":true},{"name":"process.entity_id","type":"keyword","ecs":true},{"name":"process.name","type":"keyword","ecs":true},{"name":"process.parent.entity_id","type":"keyword","ecs":true},{"name":"process.parent.name","type":"keyword","ecs":true},{"name":"process.pe.original_file_name","type":"keyword","ecs":true}],"setup":"","note":"## Triage and analysis\n\n### Investigating Unusual Child Processes of RunDLL32\n\nBy examining the specific traits of Windows binaries -- such as process trees, command lines, network connections, registry modifications, and so on -- it's possible to establish a baseline of normal activity. Deviations from this baseline can indicate malicious activity, such as masquerading and deserve further investigation.\n\nRunDLL32 is a legitimate Windows utility used to load and execute functions within dynamic-link libraries (DLLs). However, adversaries may abuse RunDLL32 to execute malicious code, bypassing security measures and evading detection. This rule identifies potential abuse by looking for an unusual process creation with no arguments followed by the creation of a child process.\n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/current/invest-guide-run-osquery.html) introduced in Elastic Stack version 8.5.0. Older Elastic Stack versions will display unrendered Markdown in this guide.\n\n### Possible investigation steps\n\n- Investigate the process execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Investigate any abnormal behavior by the subject process, such as network connections, registry or file modifications, and any spawned child processes.\n- Investigate the behavior of child processes, such as network connections, registry or file modifications, and any spawned processes.\n- Inspect the host for suspicious or abnormal behavior in the alert timeframe.\n- Assess whether this behavior is prevalent in the environment by looking for similar occurrences across hosts.\n- Examine the host for derived artifacts that indicate suspicious activities:\n  - Analyze the process executable using a private sandboxed analysis system.\n  - Observe and collect information about the following activities in both the sandbox and the subject host:\n    - Attempts to contact external domains and addresses.\n      - Use the Elastic Defend network events to determine domains and addresses contacted by the subject process by filtering by the process' `process.entity_id`.\n      - Examine the DNS cache for suspicious or anomalous entries.\n        - !{osquery{\"label\":\"Osquery - Retrieve DNS Cache\",\"query\":\"SELECT * FROM dns_cache\"}}\n    - Use the Elastic Defend registry events to examine registry keys accessed, modified, or created by the related processes in the process tree.\n    - Examine the host services for suspicious or anomalous entries.\n      - !{osquery{\"label\":\"Osquery - Retrieve All Services\",\"query\":\"SELECT description, display_name, name, path, pid, service_type, start_type, status, user_account FROM services\"}}\n      - !{osquery{\"label\":\"Osquery - Retrieve Services Running on User Accounts\",\"query\":\"SELECT description, display_name, name, path, pid, service_type, start_type, status, user_account FROM services WHERE\\nNOT (user_account LIKE '%LocalSystem' OR user_account LIKE '%LocalService' OR user_account LIKE '%NetworkService' OR\\nuser_account == null)\\n\"}}\n      - !{osquery{\"label\":\"Osquery - Retrieve Service Unsigned Executables with Virustotal Link\",\"query\":\"SELECT concat('https://www.virustotal.com/gui/file/', sha1) AS VtLink, name, description, start_type, status, pid,\\nservices.path FROM services JOIN authenticode ON services.path = authenticode.path OR services.module_path =\\nauthenticode.path JOIN hash ON services.path = hash.path WHERE authenticode.result != 'trusted'\\n\"}}\n  - Retrieve the files' SHA-256 hash values using the PowerShell `Get-FileHash` cmdlet and search for the existence and reputation of the hashes in resources like VirusTotal, Hybrid-Analysis, CISCO Talos, Any.run, etc.\n\n### False positive analysis\n\n- This activity is unlikely to happen legitimately. Benign true positives (B-TPs) can be added as exceptions if necessary.\n\n### Related Rules\n\n- Unusual Network Connection via RunDLL32 - 52aaab7b-b51c-441a-89ce-4387b3aea886\n\n### Response and Remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors like reverse shells, reverse proxies, or droppers that attackers could use to reinfect the system.\n- Remove and block malicious artifacts identified during triage.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"03836032-fc21-4a0e-bd80-b25da8a1be46","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["logs-endpoint.events.process-*","winlogbeat-*","logs-windows.sysmon_operational-*","logs-crowdstrike.fdr*"],"query":"sequence with maxspan=1h\n  [process where host.os.type == \"windows\" and event.type == \"start\" and\n     (process.name : \"rundll32.exe\" or process.pe.original_file_name == \"RUNDLL32.EXE\") and\n      (process.args_count == 1 and\n        /* Excludes bug where a missing closing quote sets args_count to 1 despite extra args */\n        not process.command_line regex~ \"\"\"\\\".*\\.exe[^\\\"].*\"\"\")\n  ] by process.entity_id\n  [process where host.os.type == \"windows\" and event.type == \"start\" and process.parent.name : \"rundll32.exe\"\n  ] by process.parent.entity_id\n"}
{"id":"0a291d7f-cda0-4209-abaf-ab9790eec93a","rule_id":"1ebb7d4d-911c-4a28-af14-77d192a14990","name":"Threat Intel - MalwareBazaar File Hash Match","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.372Z","updated_by":"aswin","created_at":"2025-12-07T18:46:57.490Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects known malware file hashes from MalwareBazaar abuse.ch feed","tags":["ThreatIntel"],"author":[],"license":"","threat":[],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":99,"risk_score_mapping":[],"severity":"critical","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}"}]},"action_type_id":".index","uuid":"0b628fd4-7f11-4f67-9c9f-33a49d21db7b","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"threat_match","language":"kuery","index":["zeek-*","winlogbeat-*","auditbeat-*","pfsense-*"],"query":"*:*","filters":[],"threat_filters":[],"threat_query":"@timestamp >= \"now-30d/d\"","threat_mapping":[{"entries":[{"field":"file.hash.sha256","type":"mapping","value":"threat.indicator.file.hash.sha256","negate":false}]},{"entries":[{"field":"file.hash.md5","type":"mapping","value":"threat.indicator.file.hash.md5","negate":false}]},{"entries":[{"field":"file.hash.sha1","type":"mapping","value":"threat.indicator.file.hash.sha1","negate":false}]},{"entries":[{"field":"process.hash.sha256","type":"mapping","value":"threat.indicator.file.hash.sha256","negate":false}]},{"entries":[{"field":"process.hash.md5","type":"mapping","value":"threat.indicator.file.hash.md5","negate":false}]},{"entries":[{"field":"dll.hash.sha256","type":"mapping","value":"threat.indicator.file.hash.sha256","negate":false}]}],"threat_language":"kuery","threat_index":["logs-ti_*"],"threat_indicator_path":"threat.indicator"}
{"id":"fc2c9077-1941-4bad-b3f5-978422611487","rule_id":"1fc79542-e257-4943-b7a0-3dd06b599a55","name":"PowerShell Compiled Binary Masquerading as System Executable","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:27.237Z","updated_by":"aswin","created_at":"2025-12-06T22:54:27.696Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects PowerShell generating and executing a binary compiled at runtime using Add-Type -OutputAssembly, often masquerading as a legitimate Windows system executable such as svchost.exe. Adversaries use this technique to bypass application controls, evade detection, and run arbitrary payloads under trusted-looking filenames.","tags":["MITRE","Windows","APT36"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1036","name":"Masquerading","reference":"https://attack.mitre.org/techniques/T1036/","subtechnique":[{"id":"T1036.005","name":"Match Legitimate Resource Name or Location","reference":"https://attack.mitre.org/techniques/T1036/005/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"c663ab88-4836-412b-a54c-5661c6e036cd","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.1.21:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type: \"windows\"\nand (\n  (\n    event.code: \"4104\"\n    and powershell.file.script_block_text : (\n        \"*Add-Type*\" and \"*-OutputAssembly*\" and \"*.exe*\"\n    )\n  )\n  or\n  (\n    event.type: \"start\"\n    and process.parent.name: \"powershell.exe\"\n    and process.name : \"*.exe\"\n    and process.executable : \"?:\\\\Windows\\\\Temp\\\\*\"\n  )\n)\n","filters":[]}
{"id":"b27c3a46-5f72-43c0-a3b2-2462f5842edd","rule_id":"af7cef99-b62e-4a1f-8794-43aa86ee4113","name":"Microsoft Defender ASR Rules Disabled or Deleted via PowerShell","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.225Z","updated_by":"aswin","created_at":"2025-12-08T21:32:45.440Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"This rule detects PowerShell modifying or deleting Microsoft Defender Attack Surface Reduction (ASR) rules through Group Policy–controlled registry paths:\n\nHKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\\n    Windows Defender Exploit Guard\\ASR\\Rules","tags":["MITRE","Windows","Kill_chain"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1562","name":"Impair Defenses","reference":"https://attack.mitre.org/techniques/T1562/","subtechnique":[{"id":"T1562.001","name":"Disable or Modify Tools","reference":"https://attack.mitre.org/techniques/T1562/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:\"windows\" and\nprocess.command_line: *Windows*Defender*Exploit*Guard* and\nprocess.command_line: *ASR* and\n(\n  process.command_line: *New-ItemProperty* or\n  process.command_line: *Remove-ItemProperty*\n)\n","filters":[]}
{"id":"66e132b1-8385-4a0a-b579-320495e313ea","rule_id":"dae0763d-a0cc-4354-9b27-562f2878fc3b","name":"PowerShell Invocation of Encoded VBS Macro via Invoke-MalDoc","immutable":false,"rule_source":{"type":"internal"},"version":1,"revision":1,"updated_at":"2025-12-08T22:27:19.775Z","updated_by":"aswin","created_at":"2025-12-08T22:26:35.764Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-2m","to":"now","description":"Detects PowerShell execution of Visual Basic Script (VBS) macro payloads delivered through malicious documents by abusing the Invoke-MalDoc framework.\nThis behavior is consistent with attackers executing embedded VBS code using PowerShell loaders that fetch and run remote scripts (e.g., via Invoke-WebRequest / IWR), often bypassing execution policies (Set-ExecutionPolicy Bypass).","tags":["MITRE","APT36","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.005","name":"Visual Basic","reference":"https://attack.mitre.org/techniques/T1059/005/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type: \"windows\" and\nprocess.command_line: (*Invoke-MalDoc* or *Invoke-Maldoc*) and\nprocess.command_line: (*macroFile* or *Auto_Open*) and\nprocess.command_line: (*IWR* or *Invoke-WebRequest*) and\nprocess.command_line: (*Set-ExecutionPolicy* or *Bypass*)\n","filters":[]}
{"id":"112271b9-fa9b-4115-ac7d-7bda6e42817a","rule_id":"70a5d814-a74e-448d-b3d1-3c909bead6a9","name":"Compilation of Custom Malware or Tools","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":2,"updated_at":"2025-12-08T21:59:26.257Z","updated_by":"aswin","created_at":"2025-12-08T19:20:00.075Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects suspicious compilation activity that may indicate Develop Capabilities (T1587)","tags":["MITRE"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0042","name":"Resource Development","reference":"https://attack.mitre.org/tactics/TA0042/"},"technique":[{"id":"T1587","name":"Develop Capabilities","reference":"https://attack.mitre.org/techniques/T1587/","subtechnique":[{"id":"T1587.001","name":"Malware","reference":"https://attack.mitre.org/techniques/T1587/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*","auditbeat-*","filebeat-*"],"query":"event.type: \"start\" AND\nprocess.name: (\n  \"gcc\" OR \"g++\" OR \"clang\" OR \"cl.exe\" OR \"csc.exe\" OR \n  \"vbc.exe\" OR \"msbuild.exe\" OR \"mingw32-gcc.exe\"\n) AND\nprocess.args: (\n  \"*keylog*\" OR \"*inject*\" OR \"*dump*\" OR \"*mimikatz*\" OR\n  \"*bypass*\" OR \"*payload*\" OR \"*shellcode*\" OR \"*reverse*\" OR \"*shell*\"\n) AND\nNOT process.parent.name: (\"make\" OR \"cmake\" OR \"devenv.exe\" OR \"VisualStudio\")\n","filters":[]}
{"id":"c75c9bc0-cb6b-4dab-a34d-32a82a1b9909","rule_id":"0e758535-6632-431c-8fc3-cee140ea4cb2","name":"T1005 – Data from Local System","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":4,"updated_at":"2025-12-08T21:59:26.340Z","updated_by":"aswin","created_at":"2025-12-02T16:59:30.955Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Data from Local System (Find Files)","tags":["Linux","Auditbeat","MITRE","T1005"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0009","name":"Collection","reference":"https://attack.mitre.org/tactics/TA0009/"},"technique":[{"id":"T1005","name":"Data from Local System","reference":"https://attack.mitre.org/techniques/T1005/","subtechnique":[]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":40,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"e638fcbb-638f-4c8d-86d2-bb90b00e6f82","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["auditbeat-*"],"query":"event.category: \"process\" AND event.type: \"start\" AND\nprocess.name: (\"find\" or \"grep\" or \"locate\") AND (\n\n  process.args: (\n    \"*id_rsa*\" or \"*.pem\" or \"*.ppk*\" or \"*.key\" or\n    \"*shadow*\" or \"*.kdbx*\" or \"*credentials*\" or\n    \"*signons.sqlite*\" or \"*.aws/credentials*\" or \"*.kube/config*\" or\n    \"*.env\" or \"*config.php*\" or \"*wp-config.php*\" or \"*.bash_history*\"\n  )\n\n  OR\n\n  (\n    process.args: (\"*.yml\" or \"*.yaml\" or \"*.json\" or \"*.env\") AND\n    process.args: (\"/etc/*\" or \"/root/*\" or \"/home/*\" or \"/var/www/*\")\n  )\n\n  OR\n  process.title: (\n    \"find /root/*\" or \"find /etc/*\" or \"find /home/*\" or \"find /var/www/*\" or\n    \"*grep -R /root/*\" or \"*grep -R /etc/*\"\n  )\n\n  OR\n\n  (\n    process.title: (\"find /\" or \"find / *\" or \"grep -R /*\") AND\n    NOT user.id: \"0\" AND\n    NOT process.title: \"*updatedb*\" AND\n    NOT process.title: \"*locate.updatedb*\" AND\n    NOT process.title: \"*apt*\" AND\n    NOT process.title: \"*dpkg*\" AND\n    NOT process.title: \"*systemd*\" AND\n    NOT process.title: \"*update-notifier*\" AND\n    NOT process.title: \"*cron*\"\n  )\n)\n","filters":[]}
{"id":"88fd2a06-7737-49c5-957d-b2bf98c49769","rule_id":"e57b5a0c-80a3-4788-8e20-eca00bb1da7d","name":"Threat Intel - JA3 Fingerprint Match (Quakbot/Malware)","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.416Z","updated_by":"aswin","created_at":"2025-12-07T19:05:12.842Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects TLS connections using malicious JA3 fingerprints from abuse.ch threat intelligence","tags":["ThreatIntel"],"author":[],"license":"","threat":[],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}"}]},"action_type_id":".index","uuid":"1bbf110d-5e90-49e0-bfdf-8f598c926e32","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"threat_match","language":"kuery","index":["winlogbeat-*","auditbeat-*","zeek-*","pfsense-*"],"query":"*:*","filters":[],"threat_filters":[],"threat_query":"@timestamp >= \"now-30d/d\"","threat_mapping":[{"entries":[{"field":"tls.client.ja3","type":"mapping","value":"threat.indicator.name","negate":false}]},{"entries":[{"field":"tls.client.ja3","type":"mapping","value":"related.hash","negate":false}]},{"entries":[{"field":"tls.server.ja3s","type":"mapping","value":"threat.indicator.name","negate":false}]}],"threat_language":"kuery","threat_index":["logs-ti_*"],"threat_indicator_path":"threat.indicator"}
{"id":"c2f64bb6-82fc-4cf3-a9f3-60f941ae13d6","rule_id":"2eaf5f4e-6e13-459a-97b2-9c208f34395d","name":"Suspicious Remote PowerShell User Enumeration via Invoke-Command","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.292Z","updated_by":"aswin","created_at":"2025-12-08T20:45:14.885Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"This rule detects the execution of a PowerShell command that remotely queries user session information on a Windows host using Invoke-Command together with Get-Process -IncludeUserName.","tags":["MITRE","Kill_chain"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.001","name":"PowerShell","reference":"https://attack.mitre.org/techniques/T1059/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:\"windows\" and event.code:\"403\" and\n(\n  process.command_line: *Invoke-Command* or\n  process.command_line: *ICM* or\n  process.command_line: *Invoke-Expression*\n) and (\n  process.command_line: *Get-Process* or\n  process.command_line: *gps*\n) and\nprocess.command_line: *IncludeUserName* and\nprocess.command_line: *hostname*\n","filters":[]}
{"id":"729fa343-817d-44b0-860d-e5b37b851883","rule_id":"c2bde3f4-12fa-4849-b3da-158e78b2b445","name":"LDAP or Active Directory Enumeration","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.241Z","updated_by":"aswin","created_at":"2025-12-08T19:30:52.279Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects LDAP queries used to gather victim identity information (T1589)","tags":["MITRE"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0043","name":"Reconnaissance","reference":"https://attack.mitre.org/tactics/TA0043/"},"technique":[{"id":"T1589","name":"Gather Victim Identity Information","reference":"https://attack.mitre.org/techniques/T1589/","subtechnique":[{"id":"T1589.002","name":"Email Addresses","reference":"https://attack.mitre.org/techniques/T1589/002/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"event.category: process AND event.type: start AND\n(\n  process.name: (\n    \"ldapsearch\" OR \"ldapwhoami\" OR \"dsquery.exe\" OR \"dsget.exe\" OR\n    \"adfind.exe\" OR \"ldp.exe\" OR \"csvde.exe\" OR \"ldifde.exe\"\n  )\n\n  OR\n\n  (\n    process.command_line: \"*ldap*\" AND\n    process.command_line: (\"*CN=*\"\n                           OR \"*OU=*\"\n                           OR \"*DC=*\"\n                           OR \"*objectClass=*\"\n                           OR \"*memberOf=*\"\n                           OR \"*userAccountControl=*\")\n  )\n\n  OR\n  process.command_line: (\n    \"*Get-ADUser*\" OR \"*Get-ADGroup*\" OR \"*Get-ADComputer*\" OR\n    \"*Get-ADObject*\" OR \"*Get-ADDomain*\"\n  )\n)\n\nAND NOT process.parent.name: (\"wsmprovhost.exe\" OR \"svchost.exe\")\n","filters":[]}
{"id":"4a4a56f0-b9c6-453a-b639-fd7c03c2e408","rule_id":"478fae8a-7408-4af4-9fa0-c6db359fb138","name":"PowerShell Creation of Startup Folder LNK Persistence","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.313Z","updated_by":"aswin","created_at":"2025-12-08T21:03:00.579Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"This rule detects the creation of a malicious persistence mechanism in which an attacker uses PowerShell to generate a .lnk shortcut file inside the user's Startup folder.","tags":["MITRE","Kill_chain","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0003","name":"Persistence","reference":"https://attack.mitre.org/tactics/TA0003/"},"technique":[{"id":"T1547","name":"Boot or Logon Autostart Execution","reference":"https://attack.mitre.org/techniques/T1547/","subtechnique":[{"id":"T1547.001","name":"Registry Run Keys / Startup Folder","reference":"https://attack.mitre.org/techniques/T1547/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:\"windows\" and\nprocess.command_line: *WScript.Shell* and\nprocess.command_line: *CreateShortcut* and\nprocess.command_line: *Startup*\n","filters":[]}
{"id":"dc0aaf95-4fab-4b71-b90d-3e5ec8689974","rule_id":"5f234aaf-2ed4-4c9e-b526-8def7abd4971","name":"VPN or Proxy Client Installation","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.297Z","updated_by":"aswin","created_at":"2025-12-08T19:22:43.124Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects installation of VPN/proxy tools that may indicate infrastructure preparation (Acquire Infrastructure - T1583)","tags":["MITRE"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0042","name":"Resource Development","reference":"https://attack.mitre.org/tactics/TA0042/"},"technique":[{"id":"T1583","name":"Acquire Infrastructure","reference":"https://attack.mitre.org/techniques/T1583/","subtechnique":[{"id":"T1583.003","name":"Virtual Private Server","reference":"https://attack.mitre.org/techniques/T1583/003/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*","auditbeat-*"],"query":"event.type: \"start\" AND\n(\n  process.name: (\n    \"openvpn\" OR \"wireguard\" OR \"tor\" OR \"proxychains\" OR\n    \"proxychains4\" OR \"openvpn.exe\" OR \"wireguard.exe\"\n  )\n  OR\n  process.command_line: (\n    \"*install*vpn*\" OR \"*install*proxy*\" OR \"*install*tor*\" OR \"*install*privoxy*\" OR \"*install*shadowsocks*\" OR \"*install*v2ray*\" OR\n    \"*setup*vpn*\"   OR \"*setup*proxy*\"   OR \"*setup*tor*\"   OR \"*setup*privoxy*\"   OR \"*setup*shadowsocks*\"   OR \"*setup*v2ray*\"\n  )\n) AND\nNOT process.parent.name: (\"apt\" OR \"yum\" OR \"dnf\" OR \"zypper\" OR \"msiexec.exe\")\n","filters":[]}
{"id":"a76baa23-7475-447f-a3d5-c611ef576fc1","rule_id":"b66e54dc-a07c-4d35-ba50-102bb9b940fd","name":"Keybd_Event Win+R Keyboard Simulation","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.366Z","updated_by":"aswin","created_at":"2025-12-08T05:28:34.775Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects keybd_event DLL import with Win+R keyboard simulation for paste-and-run attacks.\nAPT36 simulates keyboard input (Win+R) to open Run dialog, then uses SendKeys to paste and execute commands.\nThis bypasses user awareness by automating the clipboard-paste attack flow.","tags":["MITRE","Windows","APT36"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0001","name":"Initial Access","reference":"https://attack.mitre.org/tactics/TA0001/"},"technique":[{"id":"T1566","name":"Phishing","reference":"https://attack.mitre.org/techniques/T1566/","subtechnique":[{"id":"T1566.002","name":"Spearphishing Link","reference":"https://attack.mitre.org/techniques/T1566/002/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"550889d1-eafa-4272-9427-705a5a66a5be","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type: \"windows\" AND\nevent.code: \"600\" AND\n(\n  (process.command_line: *Add-Type* AND process.command_line: *DllImport* AND process.command_line: *keybd_event*) OR\n  (process.command_line: *SendKeys* AND process.command_line: *ToBase64String*) OR\n  (process.command_line: *user32.dll* AND process.command_line: *keybd_event* AND process.command_line: *SendKeys*)\n)","filters":[]}
{"id":"53e03c13-6821-4c50-ae4a-ef9162000877","rule_id":"3cf1f78c-9dca-40ad-8e7c-a3ad62e6ae0e","name":"Threat Intel - URLhaus Malicious URL Access","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":5,"updated_at":"2025-12-08T21:59:26.389Z","updated_by":"aswin","created_at":"2025-12-07T18:43:42.435Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects access to malicious URLs and domains from URLhaus abuse.ch feed","tags":["ThreatIntel"],"author":[],"license":"","threat":[],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}"}]},"action_type_id":".index","uuid":"48b43b40-a59e-4b10-845f-70df5d7c6396","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"threat_match","language":"kuery","index":["auditbeat-*","zeek-*","pfsense-*"],"query":"*:*","filters":[],"threat_filters":[],"threat_query":"@timestamp >= \"now-30d/d\"","threat_mapping":[{"entries":[{"field":"dns.question.name","type":"mapping","value":"threat.indicator.url.domain","negate":false}]},{"entries":[{"field":"destination.domain","type":"mapping","value":"threat.indicator.url.domain","negate":false}]}],"threat_language":"kuery","threat_index":["logs-ti_*"],"threat_indicator_path":"threat.indicator"}
{"id":"de2b6e09-7dd6-40bc-b7db-a27636cf9829","rule_id":"8f132122-2416-4eb4-8f87-9702e130ca7b","name":"SSH Brute Force – Multiple Failed Logins from Single IP","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":2,"updated_at":"2025-12-08T21:59:27.255Z","updated_by":"aswin","created_at":"2025-12-03T13:56:19.363Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Multiple Failed Logins from Single IP indicating Classic SSH Bruteforce","tags":[],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0006","name":"Credential Access","reference":"https://attack.mitre.org/tactics/TA0006/"},"technique":[{"id":"T1110","name":"Brute Force","reference":"https://attack.mitre.org/techniques/T1110/","subtechnique":[{"id":"T1110.001","name":"Password Guessing","reference":"https://attack.mitre.org/techniques/T1110/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"b7010299-bd78-47a2-89a0-1c923b9cfa8c","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"eql","language":"eql","index":["auditbeat-*"],"query":"sequence by source.ip, user.name with maxspan=10m\n  [ authentication\n      where event.dataset == \"login\"\n      and event.category == \"authentication\"\n      and event.outcome == \"failure\"\n      and event.type == \"authentication_failure\"\n  ] with runs=5","filters":[]}
{"id":"3cec2f76-d361-41b6-9a76-b64b58a00267","rule_id":"a1ec94ac-ebdc-40f1-adb8-c0684c56cf10","name":"ARP Cache Enumeration via PowerShell","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":2,"updated_at":"2025-12-08T21:59:27.250Z","updated_by":"aswin","created_at":"2025-12-05T12:27:35.181Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects execution of the arp command via PowerShell for network host discovery. The arp -a command displays the\nARP cache which contains IP-to-MAC address mappings of recently contacted hosts. APT28 and other threat actors\nuse this technique during the discovery phase to identify other systems on the local network for lateral movement.","tags":["MITRE","Windows","APT28","Discovery"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0007","name":"Discovery","reference":"https://attack.mitre.org/tactics/TA0007/"},"technique":[{"id":"T1018","name":"Remote System Discovery","reference":"https://attack.mitre.org/techniques/T1018/","subtechnique":[]},{"id":"T1016","name":"System Network Configuration Discovery","reference":"https://attack.mitre.org/techniques/T1016/","subtechnique":[]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"e27c5957-8558-4cba-b7ef-fbb3f056b57f","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"event.category:process and host.os.type:windows and\n  (\n    (process.name : \"arp.exe\" and process.args : \"-a\") or\n    (process.command_line : *arp* and process.command_line : *-a*) or\n    process.command_line : *Get-NetNeighbor*\n  ) and\n  not process.parent.executable : (\"C:\\\\Windows\\\\System32\\\\svchost.exe\" or \"C:\\\\Windows\\\\System32\\\\services.exe\" or \"C:\\\\Windows\\\\explorer.exe\") and\n  not process.parent.executable : \"C:\\\\Program Files\\\\*\" and\n  not process.parent.executable : \"C:\\\\Program Files (x86)\\\\*\"","filters":[]}
{"id":"a0bb6b65-29c9-4539-b1b2-cf24bf747263","rule_id":"2972cad9-a409-456f-950f-fea01417b131","name":"Hidden Files and Directories via Attrib","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.421Z","updated_by":"aswin","created_at":"2025-12-06T22:57:57.714Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects creation of hidden files and directories using attrib.exe (+h flag) or PowerShell attributes modification.\nAPT36 uses this technique to hide malware and artifacts from user view. Monitors for attrib.exe execution with +h or +s flags,\nand PowerShell Set-ItemProperty operations targeting file attributes.","tags":["MITRE","Windows","APT36"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1564","name":"Hide Artifacts","reference":"https://attack.mitre.org/techniques/T1564/","subtechnique":[{"id":"T1564.001","name":"Hidden Files and Directories","reference":"https://attack.mitre.org/techniques/T1564/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"8c6c7870-ab19-47aa-a99d-cd8c1fac69d7","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.1.21:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and event.code:(1 or 4104) and\n(\n  (process.name:attrib.exe and process.command_line:(*+h* or *+s*)) or\n  \n  (event.code:4104 and powershell.file.script_block_text:*Set-ItemProperty* and \n   powershell.file.script_block_text:*attributes* and \n   (powershell.file.script_block_text:*Hidden* or powershell.file.script_block_text:*System*)) or\n  \n  (event.code:4104 and powershell.file.script_block_text:*Get-Item* and \n   powershell.file.script_block_text:*-Force* and\n   powershell.file.script_block_text:*attributes*)\n)","filters":[]}
{"id":"7fe08e0f-a6bd-4845-a628-c4d1a06cce50","rule_id":"166727ab-6768-4e26-b80c-948b228ffc06","name":"File Creation Time Changed","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":109,"revision":1,"updated_at":"2025-12-05T18:48:20.622Z","updated_by":"aswin","created_at":"2025-12-05T17:34:57.405Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Identifies modification of a file creation time. Adversaries may modify file time attributes to blend malicious content with existing files. Timestomping is a technique that modifies the timestamps of a file often to mimic files that are in trusted directories.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Defense Evasion","Data Source: Sysmon","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1070","name":"Indicator Removal","reference":"https://attack.mitre.org/techniques/T1070/","subtechnique":[{"id":"T1070.006","name":"Timestomp","reference":"https://attack.mitre.org/techniques/T1070/006/"}]}]}],"related_integrations":[{"package":"windows","version":"^3.0.0"}],"required_fields":[{"name":"event.code","type":"keyword","ecs":true},{"name":"event.provider","type":"keyword","ecs":true},{"name":"file.extension","type":"keyword","ecs":true},{"name":"file.name","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.executable","type":"keyword","ecs":true},{"name":"user.name","type":"keyword","ecs":true}],"setup":"","note":"## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating File Creation Time Changed\nFile creation timestamps are crucial for tracking file history and integrity. Adversaries may alter these timestamps, a tactic known as timestomping, to disguise malicious files as benign. This detection rule leverages Sysmon logs to identify suspicious changes in file creation times, excluding trusted processes and file types, thus highlighting potential evasion attempts by attackers.\n\n### Possible investigation steps\n\n- Review the Sysmon logs to confirm the event code 2, which indicates a file creation time change, and verify the associated process and file details.\n- Identify the process executable path that triggered the alert and determine if it is outside the list of trusted paths specified in the query.\n- Check the file extension and name to ensure they are not part of the excluded types such as \"temp\", \"tmp\", or \"LOG\".\n- Investigate the user account associated with the event to determine if it is a non-system account, as the query excludes \"SYSTEM\", \"Local Service\", and \"Network Service\".\n- Correlate the file creation time change event with other security events or logs to identify any related suspicious activities or patterns.\n- Assess the file's location and context to determine if it is in a sensitive or unusual directory that could indicate malicious intent.\n- If necessary, perform a deeper forensic analysis on the file and process to identify any potential malicious behavior or indicators of compromise.\n\n### False positive analysis\n\n- Trusted software updates or installations may alter file creation times. Exclude known update processes like msiexec.exe from detection to reduce noise.\n- System maintenance tasks, such as disk cleanup, can modify timestamps. Exclude cleanmgr.exe to prevent these benign changes from triggering alerts.\n- User-initiated actions in trusted applications like Chrome or Firefox might change file creation times. Exclude these applications to avoid unnecessary alerts.\n- Temporary files created by legitimate processes may have altered timestamps. Exclude file extensions like temp and tmp to minimize false positives.\n- System accounts such as SYSTEM or Local Service may perform legitimate file operations. Exclude these user names to focus on suspicious activities.\n\n### Response and remediation\n\n- Isolate the affected system from the network to prevent further malicious activity and lateral movement by the adversary.\n- Conduct a thorough review of the file in question to determine if it is malicious. Use a combination of antivirus scans and manual analysis to assess the file's behavior and origin.\n- If the file is confirmed to be malicious, remove it from the system and any other locations it may have been copied to. Ensure that all associated processes are terminated.\n- Restore any affected files from a known good backup to ensure data integrity and continuity.\n- Review and update endpoint protection settings to ensure that similar threats are detected and blocked in the future. This may include adjusting Sysmon configurations to enhance logging and detection capabilities.\n- Escalate the incident to the security operations center (SOC) or incident response team for further investigation and to determine if additional systems have been compromised.\n- Document the incident, including all actions taken, to improve future response efforts and update threat intelligence databases with any new indicators of compromise (IOCs) identified.","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"ea39741c-5170-4b63-8393-8a65566fbef2","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["winlogbeat-*","logs-windows.sysmon_operational-*"],"query":"file where host.os.type == \"windows\" and\n  event.provider == \"Microsoft-Windows-Sysmon\" and\n  /* File creation time change */\n  event.code == \"2\" and\n  not process.executable :\n           (\"?:\\\\Program Files\\\\*\",\n            \"?:\\\\Program Files (x86)\\\\*\",\n            \"?:\\\\Windows\\\\system32\\\\cleanmgr.exe\",\n            \"?:\\\\Windows\\\\system32\\\\msiexec.exe\",\n            \"?:\\\\Windows\\\\syswow64\\\\msiexec.exe\",\n            \"?:\\\\Windows\\\\system32\\\\svchost.exe\",\n            \"?:\\\\WINDOWS\\\\system32\\\\backgroundTaskHost.exe\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Mozilla Firefox\\\\firefox.exe\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\slack\\\\app-*\\\\slack.exe\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\GitHubDesktop\\\\app-*\\\\GitHubDesktop.exe\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Microsoft\\\\Teams\\\\current\\\\Teams.exe\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\OneDrive.exe\") and\n  not file.extension : (\"temp\", \"tmp\", \"~tmp\", \"xml\", \"newcfg\") and not user.name : (\"SYSTEM\", \"Local Service\", \"Network Service\") and\n  not file.name : (\"LOG\", \"temp-index\", \"license.rtf\", \"iconcache_*.db\")\n"}
{"id":"11d31b4e-a7ae-451f-9bd8-439246544cb4","rule_id":"a5f8e52f-d0fe-41fd-952f-376ffc1a012a","name":"PowerShell Spawned from Command Prompt","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":2,"updated_at":"2025-12-08T21:59:27.253Z","updated_by":"aswin","created_at":"2025-12-05T18:32:53.289Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects PowerShell execution spawned from Command Prompt (cmd.exe).\nAPT29 uses cmd.exe to spawn PowerShell for command execution. This is a common technique\nto evade detection or as part of a script chain. The rule focuses on cmd.exe spawning\npowershell.exe which is suspicious in many environments.","tags":["MITRE","APT29","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.001","name":"PowerShell","reference":"https://attack.mitre.org/techniques/T1059/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"e974f371-e97d-478f-be25-5eb48cffad67","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and event.category:process and\nprocess.name : (\"powershell.exe\" or \"powershell\" or \"pwsh.exe\" or \"pwsh\") and\nprocess.parent.name : \"cmd.exe\" and\n\nnot process.command_line : \"*\\\\Windows\\\\System32\\\\*\" and\nnot process.command_line : \"*\\\\Microsoft Corporation*\" and\n\nnot process.args : (\"-File\" or \"-Command\" or \"Get-Help\")","filters":[]}
{"id":"28d3cf0e-7ad8-489f-9633-298b429ce67b","rule_id":"a7e814cd-eb5f-43be-93ac-e1b9a52df29c","name":"Digital Certificate Creation or Export","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.246Z","updated_by":"aswin","created_at":"2025-12-08T19:24:56.172Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects creation or export of digital certificates that may be used in attacks (Develop Capabilities - T1587.003)","tags":["MITRE"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0042","name":"Resource Development","reference":"https://attack.mitre.org/tactics/TA0042/"},"technique":[{"id":"T1587","name":"Develop Capabilities","reference":"https://attack.mitre.org/techniques/T1587/","subtechnique":[{"id":"T1587.003","name":"Digital Certificates","reference":"https://attack.mitre.org/techniques/T1587/003/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*","auditbeat-*"],"query":"event.type: \"start\" AND\n(\n  (\n    host.os.type: \"windows\" AND\n    (\n      process.name: (\"certutil.exe\" OR \"makecert.exe\" OR \"pvk2pfx.exe\") OR\n      process.command_line: (\n        \"*exportPFX*\" OR \"*-export*\" OR \"*-ss*\" OR \"*-pe*\"\n      )\n    )\n  )\n  OR\n  (\n    host.os.type: \"linux\" AND\n    process.name: (\"openssl\" OR \"keytool\") AND\n    process.args: (\n      \"req\" OR \"x509\" OR \"pkcs12\" OR \"-genkey\" OR \"-export\"\n    )\n  )\n)\n","filters":[]}
{"id":"235700f3-ddaf-4648-bb98-3227c44e384c","rule_id":"4778a971-f480-48e5-8a09-74e4530c8aec","name":"Word Spawning Command Shell With External IP in Command Line","immutable":false,"rule_source":{"type":"internal"},"version":1,"revision":0,"updated_at":"2025-12-08T22:09:31.399Z","updated_by":"aswin","created_at":"2025-12-08T22:09:31.399Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-2m","to":"now","description":"Detects Microsoft Word launching PowerShell or another shell interpreter that references an external IP address in the command line.\nThis behavior is commonly associated with malicious macro execution, weaponized Office documents, and phishing attachments that attempt to execute payloads through PowerShell or CMD. The detection identifies PowerShell invoked via Word and containing suspicious indicators such as ping, external IPs, Invoke-MalDoc, or download-and-execute patterns.","tags":["MITRE","APT36","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0001","name":"Initial Access","reference":"https://attack.mitre.org/tactics/TA0001/"},"technique":[{"id":"T1566","name":"Phishing","reference":"https://attack.mitre.org/techniques/T1566/","subtechnique":[{"id":"T1566.001","name":"Spearphishing Attachment","reference":"https://attack.mitre.org/techniques/T1566/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type: \"windows\" and\nprocess.command_line: *Invoke-MalDoc* and\nprocess.command_line: (*Word* or *officeProduct*) and\n(\n  process.command_line: *iwr* or\n  process.command_line: *Shell* or\n  process.command_line: *ping*\n)\n","filters":[]}
{"id":"01056776-f52b-4db0-8f65-69b9e0375720","rule_id":"8a116d5f-d1ce-4b18-85e6-957c2fa5ccb3","name":"Invoke-MalDoc VBS Macro Execution","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.409Z","updated_by":"aswin","created_at":"2025-12-08T09:25:20.301Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects Invoke-MalDoc PowerShell function execution for VBS macro execution.\nAPT36 downloads and executes Invoke-MalDoc to create malicious Office documents with embedded macros.\nMonitors PowerShell script blocks for Invoke-MalDoc with VBS macro file patterns.","tags":["MITRE","Windows","APT36"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1204","name":"User Execution","reference":"https://attack.mitre.org/techniques/T1204/","subtechnique":[]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"70326762-e824-4d11-bee2-127c0760d16b","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type: \"windows\" AND\nevent.code: \"600\" AND\nprocess.command_line: (\n  (*IEX* OR *Invoke-Expression*) AND\n  (*iwr* OR *Invoke-WebRequest*) AND\n  *-UseBasicParsing* AND\n  (*Invoke-Maldoc* OR *Invoke-MalDoc*)\n) AND\nprocess.command_line: (\n  *choice* AND */C* AND */N* AND */D* AND */T*\n)","filters":[]}
{"id":"11dce622-0fe9-453e-88b8-2a89fa31c019","rule_id":"9694bff7-c66b-440e-be94-2a8254f85111","name":"Account Discovery","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:27.247Z","updated_by":"aswin","created_at":"2025-12-05T19:24:21.101Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects account discovery commands. APT29 uses 'net user /domain' and 'net user %USERNAME% /domain'\nto enumerate domain user accounts and gather information about specific users for targeting\nin privilege escalation or lateral movement.","tags":["MITRE","APT29","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0007","name":"Discovery","reference":"https://attack.mitre.org/tactics/TA0007/"},"technique":[{"id":"T1087","name":"Account Discovery","reference":"https://attack.mitre.org/techniques/T1087/","subtechnique":[]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"67c50923-3bdc-4ecf-9119-162acc99138b","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and\n(\n  (event.category : process and (process.name : \"net.exe\" or process.name : \"net1.exe\") and \n   process.command_line : *user* and process.command_line : */domain*) or\n  (event.code : \"4104\" and \n   powershell.file.script_block_text : (*Get-ADUser* or *Get-DomainUser* or *net*user*/domain*))\n)","filters":[]}
{"id":"19cb423f-5768-4b3e-926e-f3b680c70623","rule_id":"13f9276e-3bd4-4b7e-97e0-0d4229fae695","name":"LNK File Download via PowerShell","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.395Z","updated_by":"aswin","created_at":"2025-12-08T07:09:34.734Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects LNK file download and execution via PowerShell.\nAPT36 downloads malicious shortcut (.lnk) files from GitHub and executes them using Start-Process.\nLNK files can launch hidden processes, execute arbitrary commands, or retrieve additional payloads.","tags":["MITRE","APT36","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1204","name":"User Execution","reference":"https://attack.mitre.org/techniques/T1204/","subtechnique":[{"id":"T1204.002","name":"Malicious File","reference":"https://attack.mitre.org/techniques/T1204/002/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"d811d328-9995-47a6-8f02-76c1ef7fc67a","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type: \"windows\" AND\nevent.code: \"600\" AND\nprocess.command_line: (\n  (*Invoke-WebRequest* OR *iwr* OR *wget* OR *curl*) AND\n  (*OutFile* OR *-O*) AND\n  *.lnk*\n) AND\nprocess.command_line: (*Start-Process* OR *Invoke-Item* OR *ii*)\n","filters":[]}
{"id":"ded93c25-8b6a-4f32-b7b8-ba905e6567cd","rule_id":"bff64425-2af6-4062-8930-451c5acdbf11","name":"PowerShell ExecutionPolicy Disabled via Registry and Forced Bypass","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.276Z","updated_by":"aswin","created_at":"2025-12-08T21:27:46.316Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"This rule detects attempts to disable PowerShell’s Execution Policy by modifying:\n\nHKLM\\Software\\Policies\\Microsoft\\Windows\\PowerShell\\ExecutionPolicy\n\n\nto ByPass, combined with the use of:\n\nSet-ExecutionPolicy Bypass\n\nWscript.Shell with .SendKeys() to auto-confirm prompts","tags":["MITRE","Kill_chain","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1562","name":"Impair Defenses","reference":"https://attack.mitre.org/techniques/T1562/","subtechnique":[{"id":"T1562.001","name":"Disable or Modify Tools","reference":"https://attack.mitre.org/techniques/T1562/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:\"windows\" and\nprocess.command_line: *ExecutionPolicy* and\n(\n  process.command_line: \"*HKLM:\\\\Software\\\\Policies\\\\Microsoft\\\\Windows\\\\PowerShell*\" or\n  process.command_line: *Set-ExecutionPolicy*\n) and\n(\n  process.command_line: *Wscript.Shell* or\n  process.command_line: *sendkeys*\n)\n","filters":[]}
{"id":"b8fd0ed8-6b4f-4d88-ad89-65fb776e2bb5","rule_id":"f5360644-d7ed-4bf9-865e-33c19633ee04","name":"Steganography File Staging","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":2,"updated_at":"2025-12-08T21:59:29.245Z","updated_by":"aswin","created_at":"2025-12-05T19:42:56.488Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects staging of files disguised with legitimate extensions like .png for steganography.\nAPT29 stages a 'monkey.png' file containing hidden encoded payloads that are later decoded\nusing System.Drawing.Bitmap and GetPixel operations. This technique hides malicious code\ninside seemingly innocent image files.","tags":["MITRE","APT29","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1036","name":"Masquerading","reference":"https://attack.mitre.org/techniques/T1036/","subtechnique":[{"id":"T1036.005","name":"Match Legitimate Resource Name or Location","reference":"https://attack.mitre.org/techniques/T1036/005/"}]},{"id":"T1027","name":"Obfuscated Files or Information","reference":"https://attack.mitre.org/techniques/T1027/","subtechnique":[{"id":"T1027.003","name":"Steganography","reference":"https://attack.mitre.org/techniques/T1027/003/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"d56d1c1a-5aa0-419f-95cc-a81570d3d9c6","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and event.code : \"4104\" and\n(\n  (powershell.file.script_block_text : *System.Drawing.Bitmap* and \n   powershell.file.script_block_text : *GetPixel* and \n   (powershell.file.script_block_text : *IEX* or powershell.file.script_block_text : *Invoke-Expression*)) or\n\n  (powershell.file.script_block_text : *Bitmap* and \n   powershell.file.script_block_text : *GetPixel* and \n   powershell.file.script_block_text : *Byte* and\n   powershell.file.script_block_text : *GetString*) or\n\n  (powershell.file.script_block_text : *Drawing.Bitmap* and \n   powershell.file.script_block_text : *ASCII* and\n   powershell.file.script_block_text : *GetString*)\n)","filters":[]}
{"id":"bb3601b2-dbe9-4b17-a481-1a32cb54adb8","rule_id":"dfa7a86c-9277-4cb3-90cc-44ad626c669c","name":"Rundll32 DLL Execution via PowerShell","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":3,"updated_at":"2025-12-08T21:59:29.247Z","updated_by":"aswin","created_at":"2025-12-05T12:04:53.781Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects execution of rundll32.exe to load and execute a DLL via PowerShell Start-Process. This technique is commonly\nused by APT28 and other threat actors to execute malicious DLLs while evading detection by leveraging a legitimate\nWindows binary. The rule specifically looks for rundll32 execution patterns in PowerShell script blocks.","tags":["MITRE","APT28","Windows","Execution"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.001","name":"PowerShell","reference":"https://attack.mitre.org/techniques/T1059/001/"}]}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1218","name":"System Binary Proxy Execution","reference":"https://attack.mitre.org/techniques/T1218/","subtechnique":[{"id":"T1218.011","name":"Rundll32","reference":"https://attack.mitre.org/techniques/T1218/011/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"d99f5743-c538-4078-9b34-6c4ec5fb02a8","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and\n(\n  (event.code : \"4104\" and powershell.file.script_block_text : *Start-Process* and powershell.file.script_block_text : *rundll32*) or\n  (event.category:process and process.command_line : *Start-Process* and process.command_line : *rundll32*) or\n  (event.category:process and process.name : \"rundll32.exe\" and process.args : *.dll* and \n    not process.args : (*shell32.dll* or *user32.dll* or *kernel32.dll* or *PcaSvc.dll* or *setupapi.dll* or *printui.dll* or *advapi32.dll* or *dfshim.dll* or *comctl32.dll* or *prncache.dll* or *inetcpl.cpl* or *desk.cpl*) and\n    not process.executable : \"C:\\\\Windows\\\\System32\\\\rundll32.exe\" and\n    not user.name : \"SYSTEM\"\n  )\n)","filters":[]}
{"id":"f96476c7-0eaa-47d3-adb5-148905f74fba","rule_id":"87de4644-bee5-4dce-ba14-903a6adc0cdd","name":"PowerShell Execution Policy Bypass","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":2,"updated_at":"2025-12-08T21:59:26.410Z","updated_by":"aswin","created_at":"2025-12-05T18:39:40.429Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects PowerShell execution with execution policy bypass (-ep bypass, -exec bypass, -executionpolicy bypass).\nAPT29 uses execution policy bypass to run unsigned scripts without restrictions.\nThis is commonly combined with -nop (no profile) and -noni (non-interactive) flags\nin their attack chain (e.g., \"-nop -exec bypass -EncodedCommand\").","tags":["MITRE","APT29","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.001","name":"PowerShell","reference":"https://attack.mitre.org/techniques/T1059/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"39683032-7eec-4136-87bb-c4e910ac90fc","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and event.category : process and \nprocess.name : \"powershell.exe\" and \n(\n  process.command_line : (*-ep*bypass* or *-exec*bypass* or *-executionpolicy*bypass*) and\n  process.command_line : (*-nop* or *-noni* or *-enc* or *-command*)\n)","filters":[]}
{"id":"fbc61f61-1bbe-4990-9763-2a9e82533599","rule_id":"462114d6-73c6-49cc-8b64-da2d090bd5a8","name":"Query Registry for Security Policies","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:27.246Z","updated_by":"aswin","created_at":"2025-12-05T19:27:10.148Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects registry query commands targeting security-relevant keys. APT29 uses \n'reg query HKLM\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\System' to check\nUAC settings and security policies, helping them plan UAC bypass techniques.","tags":["MITRE","Windows","APT29"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0007","name":"Discovery","reference":"https://attack.mitre.org/tactics/TA0007/"},"technique":[{"id":"T1012","name":"Query Registry","reference":"https://attack.mitre.org/techniques/T1012/","subtechnique":[]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"e67d0ef9-d0cc-48c3-8293-50f32953e957","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and\n(\n  (event.category : process and process.name : \"reg.exe\" and process.command_line : *query* and\n   process.command_line : (*Policies*System* or *CurrentVersion*Run* or *SecurityProviders* or \n                           *terminal*server* or *Winlogon*)) or\n  (event.code : \"4104\" and powershell.file.script_block_text : *Get-ItemProperty* and\n   powershell.file.script_block_text : (*HKLM* or *HKCU*) and\n   powershell.file.script_block_text : (*Policies* or *Run* or *Winlogon*))\n)","filters":[]}
{"id":"574aba7a-f4a0-4e30-9d35-3ba018315b66","rule_id":"652a7489-984b-4a71-99c6-dc2cd2e6591f","name":"APT-36 Sequence","immutable":false,"rule_source":{"type":"internal"},"version":1,"revision":0,"updated_at":"2025-12-08T23:06:14.554Z","updated_by":"aswin","created_at":"2025-12-08T23:06:14.554Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-2m","to":"now","description":"Sequence of APT36","tags":["MITRE","APT36","Windows"],"author":[],"license":"","threat":[],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":99,"risk_score_mapping":[],"severity":"critical","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security"},"type":"eql","language":"eql","index":[".internal.alerts-security.alerts-default-*",".internal.alerts-*"],"query":"sequence by host.id with maxspan=30m\n  \n  [ any where kibana.alert.rule.name in (\n      \"Macro-Enabled Office Download via PowerShel\",\n      \"Word Spawning Command Shell With External IP in Command Line\"\n    )\n  ]\n\n  [ any where kibana.alert.rule.name in (\n      \"Keybd_Event Win+R Keyboard Simulation\",\n      \"Creation of Hidden System File via PowerShell\"\n    )\n  ]\n\n  [ any where (\n      kibana.alert.rule.name in (\n        \"Masquerading via Add-Type OutputAssembly\",\n        \"PowerShell Invocation of Encoded VBS Macro via Invoke-MalDoc\"\n      )\n      or true\n    )\n  ]\n\n  [ any where (\n      kibana.alert.rule.name in (\n        \"PowerShell Execution of Visual Basic Script via cscript\",\n        \"Creation of Hidden System File via PowerShell\"\n      )\n      or true\n    )\n  ]\n\n  [ any where (\n      kibana.alert.rule.name in (\n        \"PowerShell Encoded Payload Execution (Base64 → IEX / File Write)\",\n        \"PowerShell Decrypting Encrypted Payload via SecureString\"\n      )\n      or true\n    )\n  ]\n\n  [ any where (\n      kibana.alert.rule.name in (\n        \"RunMRU Registry Modification for Mshta\",\n        \"Excel4MacroSheets XLM Creation\"\n      )\n      or true\n    )\n  ]\n\n  [ any where (\n      kibana.alert.rule.name in (\n        \"LNK File Download via PowerShell\",\n        \"Invoke-MalDoc VBS Macro Execution\"\n      )\n      or true\n    )\n  ]\n\n  [ any where (\n      kibana.alert.rule.name in (\n        \"Word Spawning Command Shell With External IP in Command Line\",\n        \"PowerShell Execution of Batch Script via Start-Process\"\n      )\n      or true\n    )\n  ]\n","filters":[]}
{"id":"9c6bcae2-d8c3-4d4e-9409-a62656583e5c","rule_id":"657cb86d-4769-4ffe-bfe0-ac2ee83acd31","name":"APT-36","immutable":false,"rule_source":{"type":"internal"},"version":1,"revision":3,"updated_at":"2025-12-09T00:25:15.217Z","updated_by":"aswin","created_at":"2025-12-08T23:24:26.932Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-2m","to":"now","description":"APT36 chaining","tags":["MITRE","APT36","Windows"],"author":[],"license":"","threat":[],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security"},"type":"eql","language":"eql","index":[".internal.alerts-security.alerts-default-*"],"query":"sequence by host.id with maxspan=2h\n  [ any where kibana.alert.rule.name == \"Macro-Enabled Office Download via PowerShel\" ]\n  [ any where kibana.alert.rule.name == \"Word Spawning Command Shell With External IP in Command Line\" ]\n  [ any where kibana.alert.rule.name == \"PowerShell Spawned from Command Prompt\"]\n  [ any where kibana.alert.rule.name == \"Keybd_Event Win+R Keyboard Simulation\" ]\n  [ any where kibana.alert.rule.name == \"PowerShell Encoded Command Execution\" ]\n  [ any where kibana.alert.rule.name == \"APT-36 Sequence\" ]\n  [ any where kibana.alert.rule.name == \"Creation of Hidden System File via PowerShell\" ]\n  [ any where kibana.alert.rule.name == \"Masquerading via Add-Type OutputAssembly\" ]\n  [ any where kibana.alert.rule.name == \"PowerShell Invocation of Encoded VBS Macro via Invoke-MalDoc\" ]\n  [ any where kibana.alert.rule.name == \"Creation of Hidden System File via PowerShell\" ]\n  [ any where kibana.alert.rule.name == \"PowerShell Decrypting Encrypted Payload via SecureString\" ]\n  [ any where kibana.alert.rule.name == \"PowerShell Encoded Payload Execution (Base64 → IEX / File Write)\" ]\n  [ any where kibana.alert.rule.name == \"RunMRU Registry Modification for Mshta\" ]\n  [ any where kibana.alert.rule.name == \"Excel4MacroSheets XLM Creation\" ]\n  [ any where kibana.alert.rule.name == \"LNK File Download via PowerShell\" ]\n  [ any where kibana.alert.rule.name == \"Word Spawning Command Shell With External IP in Command Line\"]\n  [ any where kibana.alert.rule.name == \"Invoke-MalDoc VBS Macro Execution\" ]","filters":[]}
{"id":"c69e72b4-5f35-4ac6-9a42-219a88b89042","rule_id":"000c942b-182d-4cb1-8e15-c7ebe88be1ec","name":"Rubeus Password Brute Force via PowerShell","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":2,"updated_at":"2025-12-08T21:59:29.248Z","updated_by":"aswin","created_at":"2025-12-05T11:50:04.522Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects execution of Rubeus.exe with brute-force password spraying arguments via PowerShell. Rubeus brute module\nattempts to authenticate against Active Directory accounts using a password list, which is a common technique\nused by APT28 and other threat actors for credential access and lateral movement preparation.","tags":["MITRE","Windows","APT28"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0006","name":"Credential Access","reference":"https://attack.mitre.org/tactics/TA0006/"},"technique":[{"id":"T1110","name":"Brute Force","reference":"https://attack.mitre.org/techniques/T1110/","subtechnique":[{"id":"T1110.003","name":"Password Spraying","reference":"https://attack.mitre.org/techniques/T1110/003/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"dc8b49a0-c5fd-43cc-b8b4-5a06a2452c80","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"event.category:process and host.os.type:windows and\n  (\n    (process.command_line : *Rubeus* and (process.command_line : *brute* or process.command_line : *spray* or process.command_line : *passwords* or process.command_line : */user*)) or\n    (process.args : *Rubeus* and (process.args : *brute* or process.args : *spray* or process.args : *passwords* or process.args : */user*))\n  )","filters":[]}
{"id":"ac7d8ecc-f991-4a44-aaaf-7868792e59c4","rule_id":"51bbf88c-6bd8-4b4c-ba85-0fd86b929f31","name":"Threat Intel - SSL Blacklist Certificate Detection","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":2,"updated_at":"2025-12-08T21:59:26.411Z","updated_by":"aswin","created_at":"2025-12-07T18:50:53.562Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects SSL/TLS connections using blacklisted certificates from abuse.ch SSL Blacklist","tags":["ThreatIntel"],"author":[],"license":"","threat":[],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}"}]},"action_type_id":".index","uuid":"499c4b15-8b79-450f-a799-ce52bf24e2de","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"threat_match","language":"kuery","index":["auditbeat-*","zeek-*","pfsense-*","winlogbeat-*"],"query":"*:*","filters":[],"threat_filters":[],"threat_query":"@timestamp >= \"now-30d/d\"","threat_mapping":[{"entries":[{"field":"tls.server.hash.sha1","type":"mapping","value":"threat.indicator.file.x509.serial_number","negate":false}]},{"entries":[{"field":"tls.server.x509.serial_number","type":"mapping","value":"threat.indicator.file.x509.serial_number","negate":false}]},{"entries":[{"field":"tls.server.x509.serial_number","type":"mapping","value":"threat.indicator.name","negate":false}]},{"entries":[{"field":"tls.server.hash.sha1","type":"mapping","value":"threat.indicator.name","negate":false}]},{"entries":[{"field":"tls.server.hash.sha1","type":"mapping","value":"related.hash","negate":false}]}],"threat_language":"kuery","threat_index":["logs-ti_*"],"threat_indicator_path":"threat.indicator"}
{"id":"c80cc09a-ef74-45fe-a760-e45d5a5a01fe","rule_id":"c96f5b7d-1f05-45af-8896-f46b05c1975b","name":"PowerShell Encoded Payload Execution (Base64 → IEX / File Write)","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":3,"updated_at":"2025-12-08T21:59:26.354Z","updated_by":"aswin","created_at":"2025-12-08T05:54:57.310Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects decoding of base64/encrypted data to file output in PowerShell.\nAPT36 uses FromBase64String and ConvertTo-SecureString to decode/decrypt embedded payloads, then writes to file with Out-File.\nThis combines encoding bypass with file persistence for malware staging.","tags":["MITRE","APT36","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1027","name":"Obfuscated Files or Information","reference":"https://attack.mitre.org/techniques/T1027/","subtechnique":[{"id":"T1027.013","name":"Encrypted/Encoded File","reference":"https://attack.mitre.org/techniques/T1027/013/"}]}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.001","name":"PowerShell","reference":"https://attack.mitre.org/techniques/T1059/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"f487bdb6-c104-48b3-8930-58caba6c9050","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type: \"windows\" AND\nevent.code: \"600\" AND\nprocess.command_line: *FromBase64String* AND\n(\n  process.command_line: (*Out-File* OR *Set-Content*) OR\n  process.command_line: (*Invoke-Expression* OR *IEX* OR *iex*) OR\n  process.command_line: (*Start-Process* OR *& * OR *. *)\n)","filters":[]}
{"id":"76200667-b92d-47ae-9ca3-d1399acc2a81","rule_id":"7024486d-f3e5-425f-a1a0-39b171b993c5","name":"DNS Tunnel or Dynamic DNS Service Registration","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.303Z","updated_by":"aswin","created_at":"2025-12-08T19:17:29.031Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects connections to dynamic DNS services that adversaries use for Acquire Infrastructure (T1583)","tags":["MITRE"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0042","name":"Resource Development","reference":"https://attack.mitre.org/tactics/TA0042/"},"technique":[{"id":"T1583","name":"Acquire Infrastructure","reference":"https://attack.mitre.org/techniques/T1583/","subtechnique":[{"id":"T1583.002","name":"DNS Server","reference":"https://attack.mitre.org/techniques/T1583/002/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*","auditbeat-*","zeek-*"],"query":"event.type: \"connection\" AND\ndestination.domain: (\n  \"*duckdns.*\" OR \"*no-ip.*\" OR \"*freedns.*\" OR \"*dynu.*\" OR \"*afraid.*\" OR\n  \"*changeip.*\" OR \"*dnsdynamic.*\" OR \"*ddnss.*\" OR \"*zapto.*\" OR\n  \"*servebeer.*\" OR \"*servegame.*\" OR \"*serveminecraft.*\"\n) AND\nNOT process.name: (\"chrome\" OR \"firefox\" OR \"msedge.exe\" OR \"iexplore.exe\")\n","filters":[]}
{"id":"1b94e9d7-26ff-448f-a634-a0ba964cbc49","rule_id":"99791706-d303-40bb-89da-17c10c720190","name":"Phishing Email","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.330Z","updated_by":"aswin","created_at":"2025-12-08T14:24:10.553Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detect Phishing emails","tags":["Phishing","Email"],"author":[],"license":"","threat":[],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","data_view_id":"ad5cbb0e-1098-4229-ac42-e0c4ad566ea5","query":"event.original: \"*ML_Label=phishing*\"\n","filters":[]}
{"id":"49c8ec9d-1a94-4bcd-b190-5f749ede2ae8","rule_id":"168b5887-8555-4b8c-b36a-6c82061492c1","name":"Hidden Files and Directories via Attrib","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.378Z","updated_by":"aswin","created_at":"2025-12-08T05:42:54.069Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects creation of hidden files and directories using attrib.exe (+h flag) or PowerShell attributes modification.\nAPT36 uses this technique to hide malware and artifacts from user view. Monitors for attrib.exe execution with +h or +s flags,\nand PowerShell Set-ItemProperty operations targeting file attributes.","tags":["MITRE","APT36","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1564","name":"Hide Artifacts","reference":"https://attack.mitre.org/techniques/T1564/","subtechnique":[{"id":"T1564.001","name":"Hidden Files and Directories","reference":"https://attack.mitre.org/techniques/T1564/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"d11e4e5a-093d-4f87-8be0-bf1b3417328f","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type: \"windows\" AND\n(\n  (\n    event.code: \"600\" AND\n    process.command_line: (*Get-Item* OR *gi* OR *gci* OR *Get-ChildItem*) AND\n    process.command_line: *.attributes* AND\n    process.command_line: (*Hidden* OR *System*)\n  )\n  OR\n  (\n    event.code: \"1\" AND\n    process.name: \"attrib.exe\" AND\n    process.command_line: (*+h* OR *+s* OR */h* OR */s*)\n  )\n)","filters":[]}
{"id":"1e2c6e80-8e52-499c-958d-969a80cfc3f4","rule_id":"24e5f935-4019-407b-ba25-48d09c4decbc","name":"PowerShell Download & Execution of Mimikatz via PowerSploit (Invoke-Mimikatz)","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.251Z","updated_by":"aswin","created_at":"2025-12-08T20:50:57.003Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"This rule detects the execution of Mimikatz using the PowerSploit framework’s Invoke-Mimikatz.ps1 script.\nThe activity involves downloading the script directly from a remote GitHub repository using:\n\nIEX (Invoke-Expression)\n\n(New-Object Net.WebClient).DownloadString()\n\nExecution of Invoke-Mimikatz -DumpCreds\n\nThis technique is commonly used by attackers to dump credentials stored in memory, including NTLM hashes, Kerberos tickets, and plaintext passwords.","tags":["MITRE","Kill_chain","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.001","name":"PowerShell","reference":"https://attack.mitre.org/techniques/T1059/001/"}]}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0006","name":"Credential Access","reference":"https://attack.mitre.org/tactics/TA0006/"},"technique":[{"id":"T1003","name":"OS Credential Dumping","reference":"https://attack.mitre.org/techniques/T1003/","subtechnique":[{"id":"T1003.001","name":"LSASS Memory","reference":"https://attack.mitre.org/techniques/T1003/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:\"windows\" and\nevent.code:\"600\" and\nprocess.command_line: *IEX* and\nprocess.command_line: *DownloadString* and\nprocess.command_line: *PowerSploit* and\nprocess.command_line: *Invoke-Mimikatz*\n","filters":[]}
{"id":"0693a904-e9e4-4c32-b368-6bf599eb33f3","rule_id":"bf004f86-7b73-443c-a750-dc223e3c3977","name":"RunMRU Registry Abuse for Execution","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.418Z","updated_by":"aswin","created_at":"2025-12-06T23:05:33.864Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects abuse of RunMRU registry key to launch mshta or other suspicious executables.\nAPT36 writes to HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU to bypass execution restrictions\nand launch mshta.exe or cmd.exe with malicious payloads. This is then triggered via user interaction or Run dialog.","tags":["MITRE","Windows","APT36"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1204","name":"User Execution","reference":"https://attack.mitre.org/techniques/T1204/","subtechnique":[{"id":"T1204.002","name":"Malicious File","reference":"https://attack.mitre.org/techniques/T1204/002/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"e9a486d4-544d-401d-8c36-c40d37770fda","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.1.21:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and event.code:4104 and\npowershell.file.script_block_text:*Set-ItemProperty* and\npowershell.file.script_block_text:*RunMRU* and\n(\n  powershell.file.script_block_text:*mshta.exe* or\n  \n  (powershell.file.script_block_text:*cmd.exe* and powershell.file.script_block_text:*/c*) or\n  \n  powershell.file.script_block_text:(*http* or *.hta* or *.bat* or *.cmd* or *.vbs*)\n)","filters":[]}
{"id":"595653fc-0485-4f22-8898-824eec7c0aa9","rule_id":"ed3cdacf-85c9-46c2-94db-4a3b92aa7c27","name":"Encrypted/Encoded File Decoding to Disk","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.422Z","updated_by":"aswin","created_at":"2025-12-06T23:01:39.787Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects decoding of base64/encrypted data to file output in PowerShell.\nAPT36 uses FromBase64String and ConvertTo-SecureString to decode/decrypt embedded payloads, then writes to file with Out-File.\nThis combines encoding bypass with file persistence for malware staging.","tags":["MITRE","Windows","APT36"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1027","name":"Obfuscated Files or Information","reference":"https://attack.mitre.org/techniques/T1027/","subtechnique":[{"id":"T1027.013","name":"Encrypted/Encoded File","reference":"https://attack.mitre.org/techniques/T1027/013/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"82616f83-8fa0-4f35-be6a-d7c6182cf872","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.1.21:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and event.code:4104 and\n(\n  (powershell.file.script_block_text:*FromBase64String* and\n   (powershell.file.script_block_text:*Out-File* or powershell.file.script_block_text:*Set-Content* or powershell.file.script_block_text:*Add-Content*)) or\n  \n  (powershell.file.script_block_text:*ConvertTo-SecureString* and\n   powershell.file.script_block_text:*-Key* and\n   (powershell.file.script_block_text:*Out-File* or powershell.file.script_block_text:*Set-Content*)) or\n  \n  (powershell.file.script_block_text:*System.Security.Cryptography.AesManaged* and\n   (powershell.file.script_block_text:*Out-File* or powershell.file.script_block_text:*Set-Content*)) or\n  \n  (powershell.file.script_block_text:*[System.Convert]* and\n   powershell.file.script_block_text:*GetBytes* and\n   (powershell.file.script_block_text:*Out-File* or powershell.file.script_block_text:*WriteAllBytes*))\n)","filters":[]}
{"id":"0d21602b-675d-4efc-9cc5-1d6e109853bc","rule_id":"74b39694-ef12-470c-8e15-13dbfb0f15b3","name":"Process Discovery","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.420Z","updated_by":"aswin","created_at":"2025-12-05T19:16:13.836Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects process discovery commands. APT29 uses 'tasklist /v' for verbose process listing\nand custom PowerShell functions like 'ProcessList' to enumerate running processes.\nThis helps attackers identify security software, interesting targets, and running applications.","tags":["MITRE","Windows","APT29"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0007","name":"Discovery","reference":"https://attack.mitre.org/tactics/TA0007/"},"technique":[{"id":"T1057","name":"Process Discovery","reference":"https://attack.mitre.org/techniques/T1057/","subtechnique":[]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"b151aa0c-60a2-4663-911b-0601e2987733","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and\n(\n  (event.category : process and process.name : \"tasklist.exe\" and \n   process.command_line : (*/v* or */s* or */m*)) or\n  (event.code : \"4104\" and \n   powershell.file.script_block_text : (*ProcessList* or *Get-Process* or *ps.ps1*))\n)","filters":[]}
{"id":"6ab2707e-0a62-4b8d-85b3-86683abff619","rule_id":"1349b253-0f87-4a0d-a840-7a82a36c8936","name":"System Service Discovery","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:27.249Z","updated_by":"aswin","created_at":"2025-12-05T19:17:52.871Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects system service discovery commands. APT29 uses 'sc query' and 'net start' to enumerate\nrunning services on compromised systems. This helps attackers identify security software,\npotential persistence mechanisms, and services that could be exploited.","tags":["MITRE","APT29","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0007","name":"Discovery","reference":"https://attack.mitre.org/tactics/TA0007/"},"technique":[{"id":"T1007","name":"System Service Discovery","reference":"https://attack.mitre.org/techniques/T1007/","subtechnique":[]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"a8d60547-123b-4f2b-b788-452c7fb60ed6","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and\n(\n  (event.category : process and process.name : \"sc.exe\" and process.command_line : *query*) or\n  (event.category : process and (process.name : \"net.exe\" or process.name : \"net1.exe\") and \n   process.command_line : *start* and not process.command_line : (*/y* or *start /wait*)) or\n  (event.code : \"4104\" and \n   powershell.file.script_block_text : (*Get-Service* or *sc*query*))\n)","filters":[]}
{"id":"7d0b61fe-72a0-4900-bf0c-2b518e385928","rule_id":"e54b6ed8-820f-4ca3-be4e-9c0e7f7d2d2f","name":"Right-to-Left Override Masquerading (EQL)","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":2,"updated_at":"2025-12-08T22:08:18.790Z","updated_by":"aswin","created_at":"2025-12-05T18:25:36.141Z","created_by":"aswin","enabled":false,"interval":"1m","from":"now-120s","to":"now","description":"Detects Right-to-Left Override (RTLO) character abuse for filename masquerading using EQL.\nAPT29 uses RTLO (Unicode U+202E) to disguise malicious executables, making files appear to have \ninnocent extensions like .txt or .png while actually being executables. This EQL rule provides\nmore reliable detection of the actual RTLO Unicode character in process names, command lines,\nand file names.","tags":["MITRE","Windows","APT29"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1036","name":"Masquerading","reference":"https://attack.mitre.org/techniques/T1036/","subtechnique":[{"id":"T1036.002","name":"Right-to-Left Override","reference":"https://attack.mitre.org/techniques/T1036/002/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"d87d9ec3-65b8-49b7-ad8e-15cf92600dbd","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"eql","language":"eql","index":["winlogbeat-*"],"query":"process where \n  process.name : (\"*cod*scr*\", \"*scr*cod*\", \"*txt.exe\", \"*doc.exe\", \"*pdf.exe\", \"*png.exe\", \"*jpg.exe\") or\n  process.command_line : (\"*cod*scr*\", \"*scr*cod*\") or\n  process.executable : (\"*cod*scr*\", \"*scr*cod*\", \"*txt.exe\", \"*doc.exe\", \"*pdf.exe\", \"*png.exe\")","filters":[]}
{"id":"fe657fec-3395-4855-b453-d84829531b38","type":"action","updated_at":"2025-12-05T18:53:05.288Z","created_at":"2025-12-05T18:53:05.288Z","version":"WzEwNDQxNywxMl0=","attributes":{"actionTypeId":".index","name":"Security_alerts_indexer","isMissingSecrets":false,"config":{"refresh":false,"index":"adapt-security-alerts","executionTimeField":null},"secrets":{}},"references":[],"managed":false,"coreMigrationVersion":"8.8.0","typeMigrationVersion":"10.1.0"}
{"exported_count":55,"exported_rules_count":54,"missing_rules":[],"missing_rules_count":0,"exported_exception_list_count":0,"exported_exception_list_item_count":0,"missing_exception_list_item_count":0,"missing_exception_list_items":[],"missing_exception_lists":[],"missing_exception_lists_count":0,"exported_action_connector_count":1,"missing_action_connection_count":0,"missing_action_connections":[],"excluded_action_connection_count":0,"excluded_action_connections":[]}
