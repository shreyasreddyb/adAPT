{"id":"1af9c553-6265-4b9d-b0aa-5574f9e0e4e5","rule_id":"f036953a-4615-4707-a1ca-dc53bf69dcd5","name":"Unusual Child Processes of RunDLL32","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":213,"revision":1,"updated_at":"2025-12-05T18:48:20.791Z","updated_by":"aswin","created_at":"2025-12-04T16:39:24.815Z","created_by":"aswin","enabled":true,"interval":"30m","from":"now-60m","to":"now","description":"Identifies child processes of unusual instances of RunDLL32 where the command line parameters were suspicious. Misuse of RunDLL32 could indicate malicious activity.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Defense Evasion","Data Source: Elastic Defend","Data Source: Sysmon","Data Source: Crowdstrike","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1218","name":"System Binary Proxy Execution","reference":"https://attack.mitre.org/techniques/T1218/","subtechnique":[{"id":"T1218.011","name":"Rundll32","reference":"https://attack.mitre.org/techniques/T1218/011/"}]}]}],"related_integrations":[{"package":"endpoint","version":"^9.0.0"},{"package":"windows","version":"^3.0.0"},{"package":"crowdstrike","version":"^2.0.0"}],"required_fields":[{"name":"event.type","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.args_count","type":"long","ecs":true},{"name":"process.command_line","type":"wildcard","ecs":true},{"name":"process.entity_id","type":"keyword","ecs":true},{"name":"process.name","type":"keyword","ecs":true},{"name":"process.parent.entity_id","type":"keyword","ecs":true},{"name":"process.parent.name","type":"keyword","ecs":true},{"name":"process.pe.original_file_name","type":"keyword","ecs":true}],"setup":"","note":"## Triage and analysis\n\n### Investigating Unusual Child Processes of RunDLL32\n\nBy examining the specific traits of Windows binaries -- such as process trees, command lines, network connections, registry modifications, and so on -- it's possible to establish a baseline of normal activity. Deviations from this baseline can indicate malicious activity, such as masquerading and deserve further investigation.\n\nRunDLL32 is a legitimate Windows utility used to load and execute functions within dynamic-link libraries (DLLs). However, adversaries may abuse RunDLL32 to execute malicious code, bypassing security measures and evading detection. This rule identifies potential abuse by looking for an unusual process creation with no arguments followed by the creation of a child process.\n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/current/invest-guide-run-osquery.html) introduced in Elastic Stack version 8.5.0. Older Elastic Stack versions will display unrendered Markdown in this guide.\n\n### Possible investigation steps\n\n- Investigate the process execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Investigate any abnormal behavior by the subject process, such as network connections, registry or file modifications, and any spawned child processes.\n- Investigate the behavior of child processes, such as network connections, registry or file modifications, and any spawned processes.\n- Inspect the host for suspicious or abnormal behavior in the alert timeframe.\n- Assess whether this behavior is prevalent in the environment by looking for similar occurrences across hosts.\n- Examine the host for derived artifacts that indicate suspicious activities:\n  - Analyze the process executable using a private sandboxed analysis system.\n  - Observe and collect information about the following activities in both the sandbox and the subject host:\n    - Attempts to contact external domains and addresses.\n      - Use the Elastic Defend network events to determine domains and addresses contacted by the subject process by filtering by the process' `process.entity_id`.\n      - Examine the DNS cache for suspicious or anomalous entries.\n        - !{osquery{\"label\":\"Osquery - Retrieve DNS Cache\",\"query\":\"SELECT * FROM dns_cache\"}}\n    - Use the Elastic Defend registry events to examine registry keys accessed, modified, or created by the related processes in the process tree.\n    - Examine the host services for suspicious or anomalous entries.\n      - !{osquery{\"label\":\"Osquery - Retrieve All Services\",\"query\":\"SELECT description, display_name, name, path, pid, service_type, start_type, status, user_account FROM services\"}}\n      - !{osquery{\"label\":\"Osquery - Retrieve Services Running on User Accounts\",\"query\":\"SELECT description, display_name, name, path, pid, service_type, start_type, status, user_account FROM services WHERE\\nNOT (user_account LIKE '%LocalSystem' OR user_account LIKE '%LocalService' OR user_account LIKE '%NetworkService' OR\\nuser_account == null)\\n\"}}\n      - !{osquery{\"label\":\"Osquery - Retrieve Service Unsigned Executables with Virustotal Link\",\"query\":\"SELECT concat('https://www.virustotal.com/gui/file/', sha1) AS VtLink, name, description, start_type, status, pid,\\nservices.path FROM services JOIN authenticode ON services.path = authenticode.path OR services.module_path =\\nauthenticode.path JOIN hash ON services.path = hash.path WHERE authenticode.result != 'trusted'\\n\"}}\n  - Retrieve the files' SHA-256 hash values using the PowerShell `Get-FileHash` cmdlet and search for the existence and reputation of the hashes in resources like VirusTotal, Hybrid-Analysis, CISCO Talos, Any.run, etc.\n\n### False positive analysis\n\n- This activity is unlikely to happen legitimately. Benign true positives (B-TPs) can be added as exceptions if necessary.\n\n### Related Rules\n\n- Unusual Network Connection via RunDLL32 - 52aaab7b-b51c-441a-89ce-4387b3aea886\n\n### Response and Remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors like reverse shells, reverse proxies, or droppers that attackers could use to reinfect the system.\n- Remove and block malicious artifacts identified during triage.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"03836032-fc21-4a0e-bd80-b25da8a1be46","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["logs-endpoint.events.process-*","winlogbeat-*","logs-windows.sysmon_operational-*","logs-crowdstrike.fdr*"],"query":"sequence with maxspan=1h\n  [process where host.os.type == \"windows\" and event.type == \"start\" and\n     (process.name : \"rundll32.exe\" or process.pe.original_file_name == \"RUNDLL32.EXE\") and\n      (process.args_count == 1 and\n        /* Excludes bug where a missing closing quote sets args_count to 1 despite extra args */\n        not process.command_line regex~ \"\"\"\\\".*\\.exe[^\\\"].*\"\"\")\n  ] by process.entity_id\n  [process where host.os.type == \"windows\" and event.type == \"start\" and process.parent.name : \"rundll32.exe\"\n  ] by process.parent.entity_id\n"}
{"id":"93d53a60-7e77-4b10-b6ce-6d23342f7659","rule_id":"aab184d3-72b3-4639-b242-6597c99d8bca","name":"Threat Intel Hash Indicator Match","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":10,"revision":1,"updated_at":"2025-12-05T18:48:20.815Z","updated_by":"aswin","created_at":"2025-12-01T16:44:51.616Z","created_by":"aswin","enabled":true,"interval":"1h","from":"now-65m","to":"now","description":"This rule is triggered when a hash indicator from the Threat Intel Filebeat module or integrations has a match against an event that contains file hashes, such as antivirus alerts, process creation, library load, and file operation events.","tags":["OS: Windows","Data Source: Elastic Endgame","Rule Type: Threat Match","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[],"timeline_id":"495ad7a7-316e-4544-8a0f-9c098daee76e","timeline_title":"Generic Threat Match Timeline","related_integrations":[],"required_fields":[{"name":"dll.hash.*","type":"unknown","ecs":false},{"name":"file.hash.*","type":"unknown","ecs":false},{"name":"process.hash.*","type":"unknown","ecs":false}],"setup":"## Setup\n\nThis rule needs threat intelligence indicators to work.\nThreat intelligence indicators can be collected using an [Elastic Agent integration](https://www.elastic.co/guide/en/security/current/es-threat-intel-integrations.html#agent-ti-integration),\nthe [Threat Intel module](https://www.elastic.co/guide/en/security/current/es-threat-intel-integrations.html#ti-mod-integration),\nor a [custom integration](https://www.elastic.co/guide/en/security/current/es-threat-intel-integrations.html#custom-ti-integration).\n\nMore information can be found [here](https://www.elastic.co/guide/en/security/current/es-threat-intel-integrations.html).\n","note":"## Triage and analysis\n\n### Investigating Threat Intel Hash Indicator Match\n\nThreat Intel indicator match rules allow matching from a local observation, such as an endpoint event that records a file hash with an entry of a file hash stored within the Threat Intel integrations index.\n\nMatches are based on threat intelligence data that's been ingested during the last 30 days. Some integrations don't place expiration dates on their threat indicators, so we strongly recommend validating ingested threat indicators and reviewing match results. When reviewing match results, check associated activity to determine whether the event requires additional investigation.\n\nThis rule is triggered when a hash indicator from the Threat Intel Filebeat module or an indicator ingested from a threat intelligence integration matches against an event that contains file hashes, such as antivirus alerts, file operation events, etc.\n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/current/invest-guide-run-osquery.html) introduced in Elastic Stack version 8.5.0. Older Elastic Stack versions will display unrendered Markdown in this guide.\n\n#### Possible investigation steps\n\n- Gain context about the field that matched the local observation. This information can be found in the `threat.indicator.matched.field` field.\n- Investigate the hash , which can be found in the `threat.indicator.matched.atomic` field:\n  - Search for the existence and reputation of the hash in resources like VirusTotal, Hybrid-Analysis, CISCO Talos, Any.run, etc.\n  - Scope other potentially compromised hosts in your environment by mapping hosts with file operations involving the same hash.\n- Identify the process that created the file.\n  - Investigate the process execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n  - Enrich the information that you have right now by determining how the file was dropped, where it was downloaded from, etc. This can help you determine if the event is part of an ongoing campaign against the organization.\n- Retrieve the involved file and examine the host for derived artifacts that indicate suspicious activities:\n  - Analyze the process executable using a private sandboxed analysis system.\n  - Observe and collect information about the following activities in both the sandbox and the alert subject host:\n    - Attempts to contact external domains and addresses.\n      - Use the Elastic Defend network events to determine domains and addresses contacted by the subject process by filtering by the process' `process.entity_id`.\n      - Examine the DNS cache for suspicious or anomalous entries.\n        - !{osquery{\"label\":\"Osquery - Retrieve DNS Cache\",\"query\":\"SELECT * FROM dns_cache\"}}\n    - Use the Elastic Defend registry events to examine registry keys accessed, modified, or created by the related processes in the process tree.\n    - Examine the host services for suspicious or anomalous entries.\n      - !{osquery{\"label\":\"Osquery - Retrieve All Services\",\"query\":\"SELECT description, display_name, name, path, pid, service_type, start_type, status, user_account FROM services\"}}\n      - !{osquery{\"label\":\"Osquery - Retrieve Services Running on User Accounts\",\"query\":\"SELECT description, display_name, name, path, pid, service_type, start_type, status, user_account FROM services WHERE\\nNOT (user_account LIKE '%LocalSystem' OR user_account LIKE '%LocalService' OR user_account LIKE '%NetworkService' OR\\nuser_account == null)\\n\"}}\n      - !{osquery{\"label\":\"Osquery - Retrieve Service Unsigned Executables with Virustotal Link\",\"query\":\"SELECT concat('https://www.virustotal.com/gui/file/', sha1) AS VtLink, name, description, start_type, status, pid,\\nservices.path FROM services JOIN authenticode ON services.path = authenticode.path OR services.module_path =\\nauthenticode.path JOIN hash ON services.path = hash.path WHERE authenticode.result != 'trusted'\\n\"}}\n- Using the data collected through the analysis, scope users targeted and other machines infected in the environment.\n\n### False Positive Analysis\n\n- Adversaries often use legitimate tools as network administrators, such as `PsExec` or `AdFind`. These tools are often included in indicator lists, which creates the potential for false positives.\n\n### Response and Remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors like reverse shells, reverse proxies, or droppers that attackers could use to reinfect the system.\n- Remove and block malicious artifacts identified during triage.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n","false_positives":[],"references":["https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-threatintel.html","https://www.elastic.co/guide/en/security/current/es-threat-intel-integrations.html","https://www.elastic.co/security/tip"],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"d7286268-1981-448d-a105-75d8f0990a17","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"threat_match","language":"kuery","index":["auditbeat-*","endgame-*","filebeat-*","logs-*","winlogbeat-*"],"query":"file.hash.*:* or process.hash.*:* or dll.hash.*:*\n","threat_filters":[{"$state":{"store":"appState"},"meta":{"disabled":false,"key":"event.category","negate":false,"params":{"query":"threat"},"type":"phrase"},"query":{"match_phrase":{"event.category":"threat"}}},{"$state":{"store":"appState"},"meta":{"disabled":false,"key":"event.kind","negate":false,"params":{"query":"enrichment"},"type":"phrase"},"query":{"match_phrase":{"event.kind":"enrichment"}}},{"$state":{"store":"appState"},"meta":{"disabled":false,"key":"event.type","negate":false,"params":{"query":"indicator"},"type":"phrase"},"query":{"match_phrase":{"event.type":"indicator"}}}],"threat_query":"@timestamp >= \"now-30d/d\" and event.module:(threatintel or ti_*) and (threat.indicator.file.hash.*:* or threat.indicator.file.pe.imphash:*) and not labels.is_ioc_transform_source:\"true\"","threat_mapping":[{"entries":[{"field":"file.hash.md5","type":"mapping","value":"threat.indicator.file.hash.md5"}]},{"entries":[{"field":"file.hash.sha1","type":"mapping","value":"threat.indicator.file.hash.sha1"}]},{"entries":[{"field":"file.hash.sha256","type":"mapping","value":"threat.indicator.file.hash.sha256"}]},{"entries":[{"field":"dll.hash.md5","type":"mapping","value":"threat.indicator.file.hash.md5"}]},{"entries":[{"field":"dll.hash.sha1","type":"mapping","value":"threat.indicator.file.hash.sha1"}]},{"entries":[{"field":"dll.hash.sha256","type":"mapping","value":"threat.indicator.file.hash.sha256"}]},{"entries":[{"field":"process.hash.md5","type":"mapping","value":"threat.indicator.file.hash.md5"}]},{"entries":[{"field":"process.hash.sha1","type":"mapping","value":"threat.indicator.file.hash.sha1"}]},{"entries":[{"field":"process.hash.sha256","type":"mapping","value":"threat.indicator.file.hash.sha256"}]}],"threat_language":"kuery","threat_index":["filebeat-*","logs-ti_*"],"threat_indicator_path":"threat.indicator"}
{"id":"0a291d7f-cda0-4209-abaf-ab9790eec93a","rule_id":"1ebb7d4d-911c-4a28-af14-77d192a14990","name":"Threat Intel - MalwareBazaar File Hash Match","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.372Z","updated_by":"aswin","created_at":"2025-12-07T18:46:57.490Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects known malware file hashes from MalwareBazaar abuse.ch feed","tags":["ThreatIntel"],"author":[],"license":"","threat":[],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":99,"risk_score_mapping":[],"severity":"critical","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}"}]},"action_type_id":".index","uuid":"0b628fd4-7f11-4f67-9c9f-33a49d21db7b","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"threat_match","language":"kuery","index":["zeek-*","winlogbeat-*","auditbeat-*","pfsense-*"],"query":"*:*","filters":[],"threat_filters":[],"threat_query":"@timestamp >= \"now-30d/d\"","threat_mapping":[{"entries":[{"field":"file.hash.sha256","type":"mapping","value":"threat.indicator.file.hash.sha256","negate":false}]},{"entries":[{"field":"file.hash.md5","type":"mapping","value":"threat.indicator.file.hash.md5","negate":false}]},{"entries":[{"field":"file.hash.sha1","type":"mapping","value":"threat.indicator.file.hash.sha1","negate":false}]},{"entries":[{"field":"process.hash.sha256","type":"mapping","value":"threat.indicator.file.hash.sha256","negate":false}]},{"entries":[{"field":"process.hash.md5","type":"mapping","value":"threat.indicator.file.hash.md5","negate":false}]},{"entries":[{"field":"dll.hash.sha256","type":"mapping","value":"threat.indicator.file.hash.sha256","negate":false}]}],"threat_language":"kuery","threat_index":["logs-ti_*"],"threat_indicator_path":"threat.indicator"}
{"id":"de2b6e09-7dd6-40bc-b7db-a27636cf9829","rule_id":"8f132122-2416-4eb4-8f87-9702e130ca7b","name":"SSH Brute Force – Multiple Failed Logins from Single IP","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":2,"updated_at":"2025-12-08T21:59:27.255Z","updated_by":"aswin","created_at":"2025-12-03T13:56:19.363Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Multiple Failed Logins from Single IP indicating Classic SSH Bruteforce","tags":[],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0006","name":"Credential Access","reference":"https://attack.mitre.org/tactics/TA0006/"},"technique":[{"id":"T1110","name":"Brute Force","reference":"https://attack.mitre.org/techniques/T1110/","subtechnique":[{"id":"T1110.001","name":"Password Guessing","reference":"https://attack.mitre.org/techniques/T1110/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"b7010299-bd78-47a2-89a0-1c923b9cfa8c","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"eql","language":"eql","index":["auditbeat-*"],"query":"sequence by source.ip, user.name with maxspan=10m\n  [ authentication\n      where event.dataset == \"login\"\n      and event.category == \"authentication\"\n      and event.outcome == \"failure\"\n      and event.type == \"authentication_failure\"\n  ] with runs=5","filters":[]}
{"id":"a0bb6b65-29c9-4539-b1b2-cf24bf747263","rule_id":"2972cad9-a409-456f-950f-fea01417b131","name":"Hidden Files and Directories via Attrib","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.421Z","updated_by":"aswin","created_at":"2025-12-06T22:57:57.714Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects creation of hidden files and directories using attrib.exe (+h flag) or PowerShell attributes modification.\nAPT36 uses this technique to hide malware and artifacts from user view. Monitors for attrib.exe execution with +h or +s flags,\nand PowerShell Set-ItemProperty operations targeting file attributes.","tags":["MITRE","Windows","APT36"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1564","name":"Hide Artifacts","reference":"https://attack.mitre.org/techniques/T1564/","subtechnique":[{"id":"T1564.001","name":"Hidden Files and Directories","reference":"https://attack.mitre.org/techniques/T1564/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"8c6c7870-ab19-47aa-a99d-cd8c1fac69d7","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.1.21:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and event.code:(1 or 4104) and\n(\n  (process.name:attrib.exe and process.command_line:(*+h* or *+s*)) or\n  \n  (event.code:4104 and powershell.file.script_block_text:*Set-ItemProperty* and \n   powershell.file.script_block_text:*attributes* and \n   (powershell.file.script_block_text:*Hidden* or powershell.file.script_block_text:*System*)) or\n  \n  (event.code:4104 and powershell.file.script_block_text:*Get-Item* and \n   powershell.file.script_block_text:*-Force* and\n   powershell.file.script_block_text:*attributes*)\n)","filters":[]}
{"id":"3cec2f76-d361-41b6-9a76-b64b58a00267","rule_id":"a1ec94ac-ebdc-40f1-adb8-c0684c56cf10","name":"ARP Cache Enumeration via PowerShell","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":2,"updated_at":"2025-12-08T21:59:27.250Z","updated_by":"aswin","created_at":"2025-12-05T12:27:35.181Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects execution of the arp command via PowerShell for network host discovery. The arp -a command displays the\nARP cache which contains IP-to-MAC address mappings of recently contacted hosts. APT28 and other threat actors\nuse this technique during the discovery phase to identify other systems on the local network for lateral movement.","tags":["MITRE","Windows","APT28","Discovery"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0007","name":"Discovery","reference":"https://attack.mitre.org/tactics/TA0007/"},"technique":[{"id":"T1018","name":"Remote System Discovery","reference":"https://attack.mitre.org/techniques/T1018/","subtechnique":[]},{"id":"T1016","name":"System Network Configuration Discovery","reference":"https://attack.mitre.org/techniques/T1016/","subtechnique":[]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"e27c5957-8558-4cba-b7ef-fbb3f056b57f","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"event.category:process and host.os.type:windows and\n  (\n    (process.name : \"arp.exe\" and process.args : \"-a\") or\n    (process.command_line : *arp* and process.command_line : *-a*) or\n    process.command_line : *Get-NetNeighbor*\n  ) and\n  not process.parent.executable : (\"C:\\\\Windows\\\\System32\\\\svchost.exe\" or \"C:\\\\Windows\\\\System32\\\\services.exe\" or \"C:\\\\Windows\\\\explorer.exe\") and\n  not process.parent.executable : \"C:\\\\Program Files\\\\*\" and\n  not process.parent.executable : \"C:\\\\Program Files (x86)\\\\*\"","filters":[]}
{"id":"112271b9-fa9b-4115-ac7d-7bda6e42817a","rule_id":"70a5d814-a74e-448d-b3d1-3c909bead6a9","name":"Compilation of Custom Malware or Tools","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":2,"updated_at":"2025-12-08T21:59:26.257Z","updated_by":"aswin","created_at":"2025-12-08T19:20:00.075Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects suspicious compilation activity that may indicate Develop Capabilities (T1587)","tags":["MITRE"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0042","name":"Resource Development","reference":"https://attack.mitre.org/tactics/TA0042/"},"technique":[{"id":"T1587","name":"Develop Capabilities","reference":"https://attack.mitre.org/techniques/T1587/","subtechnique":[{"id":"T1587.001","name":"Malware","reference":"https://attack.mitre.org/techniques/T1587/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*","auditbeat-*","filebeat-*"],"query":"event.type: \"start\" AND\nprocess.name: (\n  \"gcc\" OR \"g++\" OR \"clang\" OR \"cl.exe\" OR \"csc.exe\" OR \n  \"vbc.exe\" OR \"msbuild.exe\" OR \"mingw32-gcc.exe\"\n) AND\nprocess.args: (\n  \"*keylog*\" OR \"*inject*\" OR \"*dump*\" OR \"*mimikatz*\" OR\n  \"*bypass*\" OR \"*payload*\" OR \"*shellcode*\" OR \"*reverse*\" OR \"*shell*\"\n) AND\nNOT process.parent.name: (\"make\" OR \"cmake\" OR \"devenv.exe\" OR \"VisualStudio\")\n","filters":[]}
{"id":"c75c9bc0-cb6b-4dab-a34d-32a82a1b9909","rule_id":"0e758535-6632-431c-8fc3-cee140ea4cb2","name":"T1005 – Data from Local System","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":4,"updated_at":"2025-12-08T21:59:26.340Z","updated_by":"aswin","created_at":"2025-12-02T16:59:30.955Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Data from Local System (Find Files)","tags":["Linux","Auditbeat","MITRE","T1005"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0009","name":"Collection","reference":"https://attack.mitre.org/tactics/TA0009/"},"technique":[{"id":"T1005","name":"Data from Local System","reference":"https://attack.mitre.org/techniques/T1005/","subtechnique":[]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":40,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"e638fcbb-638f-4c8d-86d2-bb90b00e6f82","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["auditbeat-*"],"query":"event.category: \"process\" AND event.type: \"start\" AND\nprocess.name: (\"find\" or \"grep\" or \"locate\") AND (\n\n  process.args: (\n    \"*id_rsa*\" or \"*.pem\" or \"*.ppk*\" or \"*.key\" or\n    \"*shadow*\" or \"*.kdbx*\" or \"*credentials*\" or\n    \"*signons.sqlite*\" or \"*.aws/credentials*\" or \"*.kube/config*\" or\n    \"*.env\" or \"*config.php*\" or \"*wp-config.php*\" or \"*.bash_history*\"\n  )\n\n  OR\n\n  (\n    process.args: (\"*.yml\" or \"*.yaml\" or \"*.json\" or \"*.env\") AND\n    process.args: (\"/etc/*\" or \"/root/*\" or \"/home/*\" or \"/var/www/*\")\n  )\n\n  OR\n  process.title: (\n    \"find /root/*\" or \"find /etc/*\" or \"find /home/*\" or \"find /var/www/*\" or\n    \"*grep -R /root/*\" or \"*grep -R /etc/*\"\n  )\n\n  OR\n\n  (\n    process.title: (\"find /\" or \"find / *\" or \"grep -R /*\") AND\n    NOT user.id: \"0\" AND\n    NOT process.title: \"*updatedb*\" AND\n    NOT process.title: \"*locate.updatedb*\" AND\n    NOT process.title: \"*apt*\" AND\n    NOT process.title: \"*dpkg*\" AND\n    NOT process.title: \"*systemd*\" AND\n    NOT process.title: \"*update-notifier*\" AND\n    NOT process.title: \"*cron*\"\n  )\n)\n","filters":[]}
{"id":"66e132b1-8385-4a0a-b579-320495e313ea","rule_id":"dae0763d-a0cc-4354-9b27-562f2878fc3b","name":"PowerShell Invocation of Encoded VBS Macro via Invoke-MalDoc","immutable":false,"rule_source":{"type":"internal"},"version":1,"revision":1,"updated_at":"2025-12-08T22:27:19.775Z","updated_by":"aswin","created_at":"2025-12-08T22:26:35.764Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-2m","to":"now","description":"Detects PowerShell execution of Visual Basic Script (VBS) macro payloads delivered through malicious documents by abusing the Invoke-MalDoc framework.\nThis behavior is consistent with attackers executing embedded VBS code using PowerShell loaders that fetch and run remote scripts (e.g., via Invoke-WebRequest / IWR), often bypassing execution policies (Set-ExecutionPolicy Bypass).","tags":["MITRE","APT36","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.005","name":"Visual Basic","reference":"https://attack.mitre.org/techniques/T1059/005/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type: \"windows\" and\nprocess.command_line: (*Invoke-MalDoc* or *Invoke-Maldoc*) and\nprocess.command_line: (*macroFile* or *Auto_Open*) and\nprocess.command_line: (*IWR* or *Invoke-WebRequest*) and\nprocess.command_line: (*Set-ExecutionPolicy* or *Bypass*)\n","filters":[]}
{"id":"b27c3a46-5f72-43c0-a3b2-2462f5842edd","rule_id":"af7cef99-b62e-4a1f-8794-43aa86ee4113","name":"Microsoft Defender ASR Rules Disabled or Deleted via PowerShell","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.225Z","updated_by":"aswin","created_at":"2025-12-08T21:32:45.440Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"This rule detects PowerShell modifying or deleting Microsoft Defender Attack Surface Reduction (ASR) rules through Group Policy–controlled registry paths:\n\nHKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\\n    Windows Defender Exploit Guard\\ASR\\Rules","tags":["MITRE","Windows","Kill_chain"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1562","name":"Impair Defenses","reference":"https://attack.mitre.org/techniques/T1562/","subtechnique":[{"id":"T1562.001","name":"Disable or Modify Tools","reference":"https://attack.mitre.org/techniques/T1562/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:\"windows\" and\nprocess.command_line: *Windows*Defender*Exploit*Guard* and\nprocess.command_line: *ASR* and\n(\n  process.command_line: *New-ItemProperty* or\n  process.command_line: *Remove-ItemProperty*\n)\n","filters":[]}
{"id":"88fd2a06-7737-49c5-957d-b2bf98c49769","rule_id":"e57b5a0c-80a3-4788-8e20-eca00bb1da7d","name":"Threat Intel - JA3 Fingerprint Match (Quakbot/Malware)","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.416Z","updated_by":"aswin","created_at":"2025-12-07T19:05:12.842Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects TLS connections using malicious JA3 fingerprints from abuse.ch threat intelligence","tags":["ThreatIntel"],"author":[],"license":"","threat":[],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}"}]},"action_type_id":".index","uuid":"1bbf110d-5e90-49e0-bfdf-8f598c926e32","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"threat_match","language":"kuery","index":["winlogbeat-*","auditbeat-*","zeek-*","pfsense-*"],"query":"*:*","filters":[],"threat_filters":[],"threat_query":"@timestamp >= \"now-30d/d\"","threat_mapping":[{"entries":[{"field":"tls.client.ja3","type":"mapping","value":"threat.indicator.name","negate":false}]},{"entries":[{"field":"tls.client.ja3","type":"mapping","value":"related.hash","negate":false}]},{"entries":[{"field":"tls.server.ja3s","type":"mapping","value":"threat.indicator.name","negate":false}]}],"threat_language":"kuery","threat_index":["logs-ti_*"],"threat_indicator_path":"threat.indicator"}
{"id":"c2f64bb6-82fc-4cf3-a9f3-60f941ae13d6","rule_id":"2eaf5f4e-6e13-459a-97b2-9c208f34395d","name":"Suspicious Remote PowerShell User Enumeration via Invoke-Command","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.292Z","updated_by":"aswin","created_at":"2025-12-08T20:45:14.885Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"This rule detects the execution of a PowerShell command that remotely queries user session information on a Windows host using Invoke-Command together with Get-Process -IncludeUserName.","tags":["MITRE","Kill_chain"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.001","name":"PowerShell","reference":"https://attack.mitre.org/techniques/T1059/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:\"windows\" and event.code:\"403\" and\n(\n  process.command_line: *Invoke-Command* or\n  process.command_line: *ICM* or\n  process.command_line: *Invoke-Expression*\n) and (\n  process.command_line: *Get-Process* or\n  process.command_line: *gps*\n) and\nprocess.command_line: *IncludeUserName* and\nprocess.command_line: *hostname*\n","filters":[]}
{"id":"729fa343-817d-44b0-860d-e5b37b851883","rule_id":"c2bde3f4-12fa-4849-b3da-158e78b2b445","name":"LDAP or Active Directory Enumeration","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.241Z","updated_by":"aswin","created_at":"2025-12-08T19:30:52.279Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects LDAP queries used to gather victim identity information (T1589)","tags":["MITRE"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0043","name":"Reconnaissance","reference":"https://attack.mitre.org/tactics/TA0043/"},"technique":[{"id":"T1589","name":"Gather Victim Identity Information","reference":"https://attack.mitre.org/techniques/T1589/","subtechnique":[{"id":"T1589.002","name":"Email Addresses","reference":"https://attack.mitre.org/techniques/T1589/002/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"event.category: process AND event.type: start AND\n(\n  process.name: (\n    \"ldapsearch\" OR \"ldapwhoami\" OR \"dsquery.exe\" OR \"dsget.exe\" OR\n    \"adfind.exe\" OR \"ldp.exe\" OR \"csvde.exe\" OR \"ldifde.exe\"\n  )\n\n  OR\n\n  (\n    process.command_line: \"*ldap*\" AND\n    process.command_line: (\"*CN=*\"\n                           OR \"*OU=*\"\n                           OR \"*DC=*\"\n                           OR \"*objectClass=*\"\n                           OR \"*memberOf=*\"\n                           OR \"*userAccountControl=*\")\n  )\n\n  OR\n  process.command_line: (\n    \"*Get-ADUser*\" OR \"*Get-ADGroup*\" OR \"*Get-ADComputer*\" OR\n    \"*Get-ADObject*\" OR \"*Get-ADDomain*\"\n  )\n)\n\nAND NOT process.parent.name: (\"wsmprovhost.exe\" OR \"svchost.exe\")\n","filters":[]}
{"id":"dc0aaf95-4fab-4b71-b90d-3e5ec8689974","rule_id":"5f234aaf-2ed4-4c9e-b526-8def7abd4971","name":"VPN or Proxy Client Installation","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.297Z","updated_by":"aswin","created_at":"2025-12-08T19:22:43.124Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects installation of VPN/proxy tools that may indicate infrastructure preparation (Acquire Infrastructure - T1583)","tags":["MITRE"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0042","name":"Resource Development","reference":"https://attack.mitre.org/tactics/TA0042/"},"technique":[{"id":"T1583","name":"Acquire Infrastructure","reference":"https://attack.mitre.org/techniques/T1583/","subtechnique":[{"id":"T1583.003","name":"Virtual Private Server","reference":"https://attack.mitre.org/techniques/T1583/003/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*","auditbeat-*"],"query":"event.type: \"start\" AND\n(\n  process.name: (\n    \"openvpn\" OR \"wireguard\" OR \"tor\" OR \"proxychains\" OR\n    \"proxychains4\" OR \"openvpn.exe\" OR \"wireguard.exe\"\n  )\n  OR\n  process.command_line: (\n    \"*install*vpn*\" OR \"*install*proxy*\" OR \"*install*tor*\" OR \"*install*privoxy*\" OR \"*install*shadowsocks*\" OR \"*install*v2ray*\" OR\n    \"*setup*vpn*\"   OR \"*setup*proxy*\"   OR \"*setup*tor*\"   OR \"*setup*privoxy*\"   OR \"*setup*shadowsocks*\"   OR \"*setup*v2ray*\"\n  )\n) AND\nNOT process.parent.name: (\"apt\" OR \"yum\" OR \"dnf\" OR \"zypper\" OR \"msiexec.exe\")\n","filters":[]}
{"id":"a76baa23-7475-447f-a3d5-c611ef576fc1","rule_id":"b66e54dc-a07c-4d35-ba50-102bb9b940fd","name":"Keybd_Event Win+R Keyboard Simulation","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.366Z","updated_by":"aswin","created_at":"2025-12-08T05:28:34.775Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects keybd_event DLL import with Win+R keyboard simulation for paste-and-run attacks.\nAPT36 simulates keyboard input (Win+R) to open Run dialog, then uses SendKeys to paste and execute commands.\nThis bypasses user awareness by automating the clipboard-paste attack flow.","tags":["MITRE","Windows","APT36"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0001","name":"Initial Access","reference":"https://attack.mitre.org/tactics/TA0001/"},"technique":[{"id":"T1566","name":"Phishing","reference":"https://attack.mitre.org/techniques/T1566/","subtechnique":[{"id":"T1566.002","name":"Spearphishing Link","reference":"https://attack.mitre.org/techniques/T1566/002/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"550889d1-eafa-4272-9427-705a5a66a5be","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type: \"windows\" AND\nevent.code: \"600\" AND\n(\n  (process.command_line: *Add-Type* AND process.command_line: *DllImport* AND process.command_line: *keybd_event*) OR\n  (process.command_line: *SendKeys* AND process.command_line: *ToBase64String*) OR\n  (process.command_line: *user32.dll* AND process.command_line: *keybd_event* AND process.command_line: *SendKeys*)\n)","filters":[]}
{"id":"53e03c13-6821-4c50-ae4a-ef9162000877","rule_id":"3cf1f78c-9dca-40ad-8e7c-a3ad62e6ae0e","name":"Threat Intel - URLhaus Malicious URL Access","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":5,"updated_at":"2025-12-08T21:59:26.389Z","updated_by":"aswin","created_at":"2025-12-07T18:43:42.435Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects access to malicious URLs and domains from URLhaus abuse.ch feed","tags":["ThreatIntel"],"author":[],"license":"","threat":[],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}"}]},"action_type_id":".index","uuid":"48b43b40-a59e-4b10-845f-70df5d7c6396","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"threat_match","language":"kuery","index":["auditbeat-*","zeek-*","pfsense-*"],"query":"*:*","filters":[],"threat_filters":[],"threat_query":"@timestamp >= \"now-30d/d\"","threat_mapping":[{"entries":[{"field":"dns.question.name","type":"mapping","value":"threat.indicator.url.domain","negate":false}]},{"entries":[{"field":"destination.domain","type":"mapping","value":"threat.indicator.url.domain","negate":false}]}],"threat_language":"kuery","threat_index":["logs-ti_*"],"threat_indicator_path":"threat.indicator"}
{"id":"cd347d38-a2e7-472b-a4ad-8868d83b5b06","rule_id":"7c58e3fc-c702-4d02-8b39-102407c7dc2d","name":"Suspicious SSH Key Generation Activity","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.324Z","updated_by":"aswin","created_at":"2025-12-08T19:15:33.005Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects creation of SSH keys which may indicate adversary preparing for remote access (Acquire Access - T1650)","tags":["MITRE"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0042","name":"Resource Development","reference":"https://attack.mitre.org/tactics/TA0042/"},"technique":[{"id":"T1650","name":"Acquire Access","reference":"https://attack.mitre.org/techniques/T1650/","subtechnique":[]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["auditbeat-*","winlogbeat-*"],"query":"event.type: \"start\" AND\nprocess.name: (\"ssh-keygen\" OR \"ssh-keygen.exe\") AND\nNOT process.args: (\"-l\" OR \"-L\" OR \"-F\") AND\nNOT user.name: (\"ansible\" OR \"jenkins\" OR \"gitlab-runner\")\n","filters":[]}
{"id":"66bee13c-5b9d-4477-90dc-b1278b540060","rule_id":"4d4e2a84-2f59-41c6-abe2-1726cabaef81","name":"DNS → High-entropy first label","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:27.240Z","updated_by":"aswin","created_at":"2025-12-06T22:35:07.280Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"High-entropy first label (possible DGA / DNS tunneling payloads)","tags":[],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0011","name":"Command and Control","reference":"https://attack.mitre.org/tactics/TA0011/"},"technique":[{"id":"T1071","name":"Application Layer Protocol","reference":"https://attack.mitre.org/techniques/T1071/","subtechnique":[{"id":"T1071.004","name":"DNS","reference":"https://attack.mitre.org/techniques/T1071/004/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"2e1491a4-a656-46e3-aeb4-fcaee1e6f971","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["auditbeat-*","zeek-*"],"query":"event.dataset: \"zeek.dns\" and domain_entropy > 3.5 and domain_length > 12\n","filters":[]}
{"id":"235700f3-ddaf-4648-bb98-3227c44e384c","rule_id":"4778a971-f480-48e5-8a09-74e4530c8aec","name":"Word Spawning Command Shell With External IP in Command Line","immutable":false,"rule_source":{"type":"internal"},"version":1,"revision":0,"updated_at":"2025-12-08T22:09:31.399Z","updated_by":"aswin","created_at":"2025-12-08T22:09:31.399Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-2m","to":"now","description":"Detects Microsoft Word launching PowerShell or another shell interpreter that references an external IP address in the command line.\nThis behavior is commonly associated with malicious macro execution, weaponized Office documents, and phishing attachments that attempt to execute payloads through PowerShell or CMD. The detection identifies PowerShell invoked via Word and containing suspicious indicators such as ping, external IPs, Invoke-MalDoc, or download-and-execute patterns.","tags":["MITRE","APT36","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0001","name":"Initial Access","reference":"https://attack.mitre.org/tactics/TA0001/"},"technique":[{"id":"T1566","name":"Phishing","reference":"https://attack.mitre.org/techniques/T1566/","subtechnique":[{"id":"T1566.001","name":"Spearphishing Attachment","reference":"https://attack.mitre.org/techniques/T1566/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type: \"windows\" and\nprocess.command_line: *Invoke-MalDoc* and\nprocess.command_line: (*Word* or *officeProduct*) and\n(\n  process.command_line: *iwr* or\n  process.command_line: *Shell* or\n  process.command_line: *ping*\n)\n","filters":[]}
{"id":"11d31b4e-a7ae-451f-9bd8-439246544cb4","rule_id":"a5f8e52f-d0fe-41fd-952f-376ffc1a012a","name":"PowerShell Spawned from Command Prompt","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":2,"updated_at":"2025-12-08T21:59:27.253Z","updated_by":"aswin","created_at":"2025-12-05T18:32:53.289Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects PowerShell execution spawned from Command Prompt (cmd.exe).\nAPT29 uses cmd.exe to spawn PowerShell for command execution. This is a common technique\nto evade detection or as part of a script chain. The rule focuses on cmd.exe spawning\npowershell.exe which is suspicious in many environments.","tags":["MITRE","APT29","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.001","name":"PowerShell","reference":"https://attack.mitre.org/techniques/T1059/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"e974f371-e97d-478f-be25-5eb48cffad67","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and event.category:process and\nprocess.name : (\"powershell.exe\" or \"powershell\" or \"pwsh.exe\" or \"pwsh\") and\nprocess.parent.name : \"cmd.exe\" and\n\nnot process.command_line : \"*\\\\Windows\\\\System32\\\\*\" and\nnot process.command_line : \"*\\\\Microsoft Corporation*\" and\n\nnot process.args : (\"-File\" or \"-Command\" or \"Get-Help\")","filters":[]}
{"id":"28d3cf0e-7ad8-489f-9633-298b429ce67b","rule_id":"a7e814cd-eb5f-43be-93ac-e1b9a52df29c","name":"Digital Certificate Creation or Export","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.246Z","updated_by":"aswin","created_at":"2025-12-08T19:24:56.172Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects creation or export of digital certificates that may be used in attacks (Develop Capabilities - T1587.003)","tags":["MITRE"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0042","name":"Resource Development","reference":"https://attack.mitre.org/tactics/TA0042/"},"technique":[{"id":"T1587","name":"Develop Capabilities","reference":"https://attack.mitre.org/techniques/T1587/","subtechnique":[{"id":"T1587.003","name":"Digital Certificates","reference":"https://attack.mitre.org/techniques/T1587/003/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*","auditbeat-*"],"query":"event.type: \"start\" AND\n(\n  (\n    host.os.type: \"windows\" AND\n    (\n      process.name: (\"certutil.exe\" OR \"makecert.exe\" OR \"pvk2pfx.exe\") OR\n      process.command_line: (\n        \"*exportPFX*\" OR \"*-export*\" OR \"*-ss*\" OR \"*-pe*\"\n      )\n    )\n  )\n  OR\n  (\n    host.os.type: \"linux\" AND\n    process.name: (\"openssl\" OR \"keytool\") AND\n    process.args: (\n      \"req\" OR \"x509\" OR \"pkcs12\" OR \"-genkey\" OR \"-export\"\n    )\n  )\n)\n","filters":[]}
{"id":"fc2c9077-1941-4bad-b3f5-978422611487","rule_id":"1fc79542-e257-4943-b7a0-3dd06b599a55","name":"PowerShell Compiled Binary Masquerading as System Executable","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:27.237Z","updated_by":"aswin","created_at":"2025-12-06T22:54:27.696Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects PowerShell generating and executing a binary compiled at runtime using Add-Type -OutputAssembly, often masquerading as a legitimate Windows system executable such as svchost.exe. Adversaries use this technique to bypass application controls, evade detection, and run arbitrary payloads under trusted-looking filenames.","tags":["MITRE","Windows","APT36"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1036","name":"Masquerading","reference":"https://attack.mitre.org/techniques/T1036/","subtechnique":[{"id":"T1036.005","name":"Match Legitimate Resource Name or Location","reference":"https://attack.mitre.org/techniques/T1036/005/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"c663ab88-4836-412b-a54c-5661c6e036cd","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.1.21:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type: \"windows\"\nand (\n  (\n    event.code: \"4104\"\n    and powershell.file.script_block_text : (\n        \"*Add-Type*\" and \"*-OutputAssembly*\" and \"*.exe*\"\n    )\n  )\n  or\n  (\n    event.type: \"start\"\n    and process.parent.name: \"powershell.exe\"\n    and process.name : \"*.exe\"\n    and process.executable : \"?:\\\\Windows\\\\Temp\\\\*\"\n  )\n)\n","filters":[]}
{"id":"4a4a56f0-b9c6-453a-b639-fd7c03c2e408","rule_id":"478fae8a-7408-4af4-9fa0-c6db359fb138","name":"PowerShell Creation of Startup Folder LNK Persistence","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.313Z","updated_by":"aswin","created_at":"2025-12-08T21:03:00.579Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"This rule detects the creation of a malicious persistence mechanism in which an attacker uses PowerShell to generate a .lnk shortcut file inside the user's Startup folder.","tags":["MITRE","Kill_chain","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0003","name":"Persistence","reference":"https://attack.mitre.org/tactics/TA0003/"},"technique":[{"id":"T1547","name":"Boot or Logon Autostart Execution","reference":"https://attack.mitre.org/techniques/T1547/","subtechnique":[{"id":"T1547.001","name":"Registry Run Keys / Startup Folder","reference":"https://attack.mitre.org/techniques/T1547/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:\"windows\" and\nprocess.command_line: *WScript.Shell* and\nprocess.command_line: *CreateShortcut* and\nprocess.command_line: *Startup*\n","filters":[]}
{"id":"ac7d8ecc-f991-4a44-aaaf-7868792e59c4","rule_id":"51bbf88c-6bd8-4b4c-ba85-0fd86b929f31","name":"Threat Intel - SSL Blacklist Certificate Detection","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":2,"updated_at":"2025-12-08T21:59:26.411Z","updated_by":"aswin","created_at":"2025-12-07T18:50:53.562Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects SSL/TLS connections using blacklisted certificates from abuse.ch SSL Blacklist","tags":["ThreatIntel"],"author":[],"license":"","threat":[],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}"}]},"action_type_id":".index","uuid":"499c4b15-8b79-450f-a799-ce52bf24e2de","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"threat_match","language":"kuery","index":["auditbeat-*","zeek-*","pfsense-*","winlogbeat-*"],"query":"*:*","filters":[],"threat_filters":[],"threat_query":"@timestamp >= \"now-30d/d\"","threat_mapping":[{"entries":[{"field":"tls.server.hash.sha1","type":"mapping","value":"threat.indicator.file.x509.serial_number","negate":false}]},{"entries":[{"field":"tls.server.x509.serial_number","type":"mapping","value":"threat.indicator.file.x509.serial_number","negate":false}]},{"entries":[{"field":"tls.server.x509.serial_number","type":"mapping","value":"threat.indicator.name","negate":false}]},{"entries":[{"field":"tls.server.hash.sha1","type":"mapping","value":"threat.indicator.name","negate":false}]},{"entries":[{"field":"tls.server.hash.sha1","type":"mapping","value":"related.hash","negate":false}]}],"threat_language":"kuery","threat_index":["logs-ti_*"],"threat_indicator_path":"threat.indicator"}
{"id":"1b94e9d7-26ff-448f-a634-a0ba964cbc49","rule_id":"99791706-d303-40bb-89da-17c10c720190","name":"Phishing Email","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.330Z","updated_by":"aswin","created_at":"2025-12-08T14:24:10.553Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detect Phishing emails","tags":["Phishing","Email"],"author":[],"license":"","threat":[],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","data_view_id":"ad5cbb0e-1098-4229-ac42-e0c4ad566ea5","query":"event.original: \"*ML_Label=phishing*\"\n","filters":[]}
{"id":"c80cc09a-ef74-45fe-a760-e45d5a5a01fe","rule_id":"c96f5b7d-1f05-45af-8896-f46b05c1975b","name":"PowerShell Encoded Payload Execution (Base64 → IEX / File Write)","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":3,"updated_at":"2025-12-08T21:59:26.354Z","updated_by":"aswin","created_at":"2025-12-08T05:54:57.310Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects decoding of base64/encrypted data to file output in PowerShell.\nAPT36 uses FromBase64String and ConvertTo-SecureString to decode/decrypt embedded payloads, then writes to file with Out-File.\nThis combines encoding bypass with file persistence for malware staging.","tags":["MITRE","APT36","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1027","name":"Obfuscated Files or Information","reference":"https://attack.mitre.org/techniques/T1027/","subtechnique":[{"id":"T1027.013","name":"Encrypted/Encoded File","reference":"https://attack.mitre.org/techniques/T1027/013/"}]}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.001","name":"PowerShell","reference":"https://attack.mitre.org/techniques/T1059/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"f487bdb6-c104-48b3-8930-58caba6c9050","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type: \"windows\" AND\nevent.code: \"600\" AND\nprocess.command_line: *FromBase64String* AND\n(\n  process.command_line: (*Out-File* OR *Set-Content*) OR\n  process.command_line: (*Invoke-Expression* OR *IEX* OR *iex*) OR\n  process.command_line: (*Start-Process* OR *& * OR *. *)\n)","filters":[]}
{"id":"49c8ec9d-1a94-4bcd-b190-5f749ede2ae8","rule_id":"168b5887-8555-4b8c-b36a-6c82061492c1","name":"Hidden Files and Directories via Attrib","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.378Z","updated_by":"aswin","created_at":"2025-12-08T05:42:54.069Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects creation of hidden files and directories using attrib.exe (+h flag) or PowerShell attributes modification.\nAPT36 uses this technique to hide malware and artifacts from user view. Monitors for attrib.exe execution with +h or +s flags,\nand PowerShell Set-ItemProperty operations targeting file attributes.","tags":["MITRE","APT36","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1564","name":"Hide Artifacts","reference":"https://attack.mitre.org/techniques/T1564/","subtechnique":[{"id":"T1564.001","name":"Hidden Files and Directories","reference":"https://attack.mitre.org/techniques/T1564/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"d11e4e5a-093d-4f87-8be0-bf1b3417328f","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type: \"windows\" AND\n(\n  (\n    event.code: \"600\" AND\n    process.command_line: (*Get-Item* OR *gi* OR *gci* OR *Get-ChildItem*) AND\n    process.command_line: *.attributes* AND\n    process.command_line: (*Hidden* OR *System*)\n  )\n  OR\n  (\n    event.code: \"1\" AND\n    process.name: \"attrib.exe\" AND\n    process.command_line: (*+h* OR *+s* OR */h* OR */s*)\n  )\n)","filters":[]}
{"id":"595653fc-0485-4f22-8898-824eec7c0aa9","rule_id":"ed3cdacf-85c9-46c2-94db-4a3b92aa7c27","name":"Encrypted/Encoded File Decoding to Disk","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.422Z","updated_by":"aswin","created_at":"2025-12-06T23:01:39.787Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects decoding of base64/encrypted data to file output in PowerShell.\nAPT36 uses FromBase64String and ConvertTo-SecureString to decode/decrypt embedded payloads, then writes to file with Out-File.\nThis combines encoding bypass with file persistence for malware staging.","tags":["MITRE","Windows","APT36"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1027","name":"Obfuscated Files or Information","reference":"https://attack.mitre.org/techniques/T1027/","subtechnique":[{"id":"T1027.013","name":"Encrypted/Encoded File","reference":"https://attack.mitre.org/techniques/T1027/013/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"82616f83-8fa0-4f35-be6a-d7c6182cf872","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.1.21:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and event.code:4104 and\n(\n  (powershell.file.script_block_text:*FromBase64String* and\n   (powershell.file.script_block_text:*Out-File* or powershell.file.script_block_text:*Set-Content* or powershell.file.script_block_text:*Add-Content*)) or\n  \n  (powershell.file.script_block_text:*ConvertTo-SecureString* and\n   powershell.file.script_block_text:*-Key* and\n   (powershell.file.script_block_text:*Out-File* or powershell.file.script_block_text:*Set-Content*)) or\n  \n  (powershell.file.script_block_text:*System.Security.Cryptography.AesManaged* and\n   (powershell.file.script_block_text:*Out-File* or powershell.file.script_block_text:*Set-Content*)) or\n  \n  (powershell.file.script_block_text:*[System.Convert]* and\n   powershell.file.script_block_text:*GetBytes* and\n   (powershell.file.script_block_text:*Out-File* or powershell.file.script_block_text:*WriteAllBytes*))\n)","filters":[]}
{"id":"1e2c6e80-8e52-499c-958d-969a80cfc3f4","rule_id":"24e5f935-4019-407b-ba25-48d09c4decbc","name":"PowerShell Download & Execution of Mimikatz via PowerSploit (Invoke-Mimikatz)","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.251Z","updated_by":"aswin","created_at":"2025-12-08T20:50:57.003Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"This rule detects the execution of Mimikatz using the PowerSploit framework’s Invoke-Mimikatz.ps1 script.\nThe activity involves downloading the script directly from a remote GitHub repository using:\n\nIEX (Invoke-Expression)\n\n(New-Object Net.WebClient).DownloadString()\n\nExecution of Invoke-Mimikatz -DumpCreds\n\nThis technique is commonly used by attackers to dump credentials stored in memory, including NTLM hashes, Kerberos tickets, and plaintext passwords.","tags":["MITRE","Kill_chain","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.001","name":"PowerShell","reference":"https://attack.mitre.org/techniques/T1059/001/"}]}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0006","name":"Credential Access","reference":"https://attack.mitre.org/tactics/TA0006/"},"technique":[{"id":"T1003","name":"OS Credential Dumping","reference":"https://attack.mitre.org/techniques/T1003/","subtechnique":[{"id":"T1003.001","name":"LSASS Memory","reference":"https://attack.mitre.org/techniques/T1003/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:\"windows\" and\nevent.code:\"600\" and\nprocess.command_line: *IEX* and\nprocess.command_line: *DownloadString* and\nprocess.command_line: *PowerSploit* and\nprocess.command_line: *Invoke-Mimikatz*\n","filters":[]}
{"id":"0d21602b-675d-4efc-9cc5-1d6e109853bc","rule_id":"74b39694-ef12-470c-8e15-13dbfb0f15b3","name":"Process Discovery","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.420Z","updated_by":"aswin","created_at":"2025-12-05T19:16:13.836Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects process discovery commands. APT29 uses 'tasklist /v' for verbose process listing\nand custom PowerShell functions like 'ProcessList' to enumerate running processes.\nThis helps attackers identify security software, interesting targets, and running applications.","tags":["MITRE","Windows","APT29"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0007","name":"Discovery","reference":"https://attack.mitre.org/tactics/TA0007/"},"technique":[{"id":"T1057","name":"Process Discovery","reference":"https://attack.mitre.org/techniques/T1057/","subtechnique":[]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"b151aa0c-60a2-4663-911b-0601e2987733","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and\n(\n  (event.category : process and process.name : \"tasklist.exe\" and \n   process.command_line : (*/v* or */s* or */m*)) or\n  (event.code : \"4104\" and \n   powershell.file.script_block_text : (*ProcessList* or *Get-Process* or *ps.ps1*))\n)","filters":[]}
{"id":"76200667-b92d-47ae-9ca3-d1399acc2a81","rule_id":"7024486d-f3e5-425f-a1a0-39b171b993c5","name":"DNS Tunnel or Dynamic DNS Service Registration","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.303Z","updated_by":"aswin","created_at":"2025-12-08T19:17:29.031Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects connections to dynamic DNS services that adversaries use for Acquire Infrastructure (T1583)","tags":["MITRE"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0042","name":"Resource Development","reference":"https://attack.mitre.org/tactics/TA0042/"},"technique":[{"id":"T1583","name":"Acquire Infrastructure","reference":"https://attack.mitre.org/techniques/T1583/","subtechnique":[{"id":"T1583.002","name":"DNS Server","reference":"https://attack.mitre.org/techniques/T1583/002/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*","auditbeat-*","zeek-*"],"query":"event.type: \"connection\" AND\ndestination.domain: (\n  \"*duckdns.*\" OR \"*no-ip.*\" OR \"*freedns.*\" OR \"*dynu.*\" OR \"*afraid.*\" OR\n  \"*changeip.*\" OR \"*dnsdynamic.*\" OR \"*ddnss.*\" OR \"*zapto.*\" OR\n  \"*servebeer.*\" OR \"*servegame.*\" OR \"*serveminecraft.*\"\n) AND\nNOT process.name: (\"chrome\" OR \"firefox\" OR \"msedge.exe\" OR \"iexplore.exe\")\n","filters":[]}
{"id":"0693a904-e9e4-4c32-b368-6bf599eb33f3","rule_id":"bf004f86-7b73-443c-a750-dc223e3c3977","name":"RunMRU Registry Abuse for Execution","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.418Z","updated_by":"aswin","created_at":"2025-12-06T23:05:33.864Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects abuse of RunMRU registry key to launch mshta or other suspicious executables.\nAPT36 writes to HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU to bypass execution restrictions\nand launch mshta.exe or cmd.exe with malicious payloads. This is then triggered via user interaction or Run dialog.","tags":["MITRE","Windows","APT36"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1204","name":"User Execution","reference":"https://attack.mitre.org/techniques/T1204/","subtechnique":[{"id":"T1204.002","name":"Malicious File","reference":"https://attack.mitre.org/techniques/T1204/002/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"e9a486d4-544d-401d-8c36-c40d37770fda","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.1.21:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and event.code:4104 and\npowershell.file.script_block_text:*Set-ItemProperty* and\npowershell.file.script_block_text:*RunMRU* and\n(\n  powershell.file.script_block_text:*mshta.exe* or\n  \n  (powershell.file.script_block_text:*cmd.exe* and powershell.file.script_block_text:*/c*) or\n  \n  powershell.file.script_block_text:(*http* or *.hta* or *.bat* or *.cmd* or *.vbs*)\n)","filters":[]}
{"id":"6ab2707e-0a62-4b8d-85b3-86683abff619","rule_id":"1349b253-0f87-4a0d-a840-7a82a36c8936","name":"System Service Discovery","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:27.249Z","updated_by":"aswin","created_at":"2025-12-05T19:17:52.871Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects system service discovery commands. APT29 uses 'sc query' and 'net start' to enumerate\nrunning services on compromised systems. This helps attackers identify security software,\npotential persistence mechanisms, and services that could be exploited.","tags":["MITRE","APT29","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0007","name":"Discovery","reference":"https://attack.mitre.org/tactics/TA0007/"},"technique":[{"id":"T1007","name":"System Service Discovery","reference":"https://attack.mitre.org/techniques/T1007/","subtechnique":[]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"a8d60547-123b-4f2b-b788-452c7fb60ed6","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and\n(\n  (event.category : process and process.name : \"sc.exe\" and process.command_line : *query*) or\n  (event.category : process and (process.name : \"net.exe\" or process.name : \"net1.exe\") and \n   process.command_line : *start* and not process.command_line : (*/y* or *start /wait*)) or\n  (event.code : \"4104\" and \n   powershell.file.script_block_text : (*Get-Service* or *sc*query*))\n)","filters":[]}
{"id":"ded93c25-8b6a-4f32-b7b8-ba905e6567cd","rule_id":"bff64425-2af6-4062-8930-451c5acdbf11","name":"PowerShell ExecutionPolicy Disabled via Registry and Forced Bypass","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.276Z","updated_by":"aswin","created_at":"2025-12-08T21:27:46.316Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"This rule detects attempts to disable PowerShell’s Execution Policy by modifying:\n\nHKLM\\Software\\Policies\\Microsoft\\Windows\\PowerShell\\ExecutionPolicy\n\n\nto ByPass, combined with the use of:\n\nSet-ExecutionPolicy Bypass\n\nWscript.Shell with .SendKeys() to auto-confirm prompts","tags":["MITRE","Kill_chain","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1562","name":"Impair Defenses","reference":"https://attack.mitre.org/techniques/T1562/","subtechnique":[{"id":"T1562.001","name":"Disable or Modify Tools","reference":"https://attack.mitre.org/techniques/T1562/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:\"windows\" and\nprocess.command_line: *ExecutionPolicy* and\n(\n  process.command_line: \"*HKLM:\\\\Software\\\\Policies\\\\Microsoft\\\\Windows\\\\PowerShell*\" or\n  process.command_line: *Set-ExecutionPolicy*\n) and\n(\n  process.command_line: *Wscript.Shell* or\n  process.command_line: *sendkeys*\n)\n","filters":[]}
{"id":"19cb423f-5768-4b3e-926e-f3b680c70623","rule_id":"13f9276e-3bd4-4b7e-97e0-0d4229fae695","name":"LNK File Download via PowerShell","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.395Z","updated_by":"aswin","created_at":"2025-12-08T07:09:34.734Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects LNK file download and execution via PowerShell.\nAPT36 downloads malicious shortcut (.lnk) files from GitHub and executes them using Start-Process.\nLNK files can launch hidden processes, execute arbitrary commands, or retrieve additional payloads.","tags":["MITRE","APT36","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1204","name":"User Execution","reference":"https://attack.mitre.org/techniques/T1204/","subtechnique":[{"id":"T1204.002","name":"Malicious File","reference":"https://attack.mitre.org/techniques/T1204/002/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"d811d328-9995-47a6-8f02-76c1ef7fc67a","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type: \"windows\" AND\nevent.code: \"600\" AND\nprocess.command_line: (\n  (*Invoke-WebRequest* OR *iwr* OR *wget* OR *curl*) AND\n  (*OutFile* OR *-O*) AND\n  *.lnk*\n) AND\nprocess.command_line: (*Start-Process* OR *Invoke-Item* OR *ii*)\n","filters":[]}
{"id":"01056776-f52b-4db0-8f65-69b9e0375720","rule_id":"8a116d5f-d1ce-4b18-85e6-957c2fa5ccb3","name":"Invoke-MalDoc VBS Macro Execution","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.409Z","updated_by":"aswin","created_at":"2025-12-08T09:25:20.301Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects Invoke-MalDoc PowerShell function execution for VBS macro execution.\nAPT36 downloads and executes Invoke-MalDoc to create malicious Office documents with embedded macros.\nMonitors PowerShell script blocks for Invoke-MalDoc with VBS macro file patterns.","tags":["MITRE","Windows","APT36"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1204","name":"User Execution","reference":"https://attack.mitre.org/techniques/T1204/","subtechnique":[]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"70326762-e824-4d11-bee2-127c0760d16b","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type: \"windows\" AND\nevent.code: \"600\" AND\nprocess.command_line: (\n  (*IEX* OR *Invoke-Expression*) AND\n  (*iwr* OR *Invoke-WebRequest*) AND\n  *-UseBasicParsing* AND\n  (*Invoke-Maldoc* OR *Invoke-MalDoc*)\n) AND\nprocess.command_line: (\n  *choice* AND */C* AND */N* AND */D* AND */T*\n)","filters":[]}
{"id":"b8fd0ed8-6b4f-4d88-ad89-65fb776e2bb5","rule_id":"f5360644-d7ed-4bf9-865e-33c19633ee04","name":"Steganography File Staging","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":2,"updated_at":"2025-12-08T21:59:29.245Z","updated_by":"aswin","created_at":"2025-12-05T19:42:56.488Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects staging of files disguised with legitimate extensions like .png for steganography.\nAPT29 stages a 'monkey.png' file containing hidden encoded payloads that are later decoded\nusing System.Drawing.Bitmap and GetPixel operations. This technique hides malicious code\ninside seemingly innocent image files.","tags":["MITRE","APT29","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1036","name":"Masquerading","reference":"https://attack.mitre.org/techniques/T1036/","subtechnique":[{"id":"T1036.005","name":"Match Legitimate Resource Name or Location","reference":"https://attack.mitre.org/techniques/T1036/005/"}]},{"id":"T1027","name":"Obfuscated Files or Information","reference":"https://attack.mitre.org/techniques/T1027/","subtechnique":[{"id":"T1027.003","name":"Steganography","reference":"https://attack.mitre.org/techniques/T1027/003/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"d56d1c1a-5aa0-419f-95cc-a81570d3d9c6","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and event.code : \"4104\" and\n(\n  (powershell.file.script_block_text : *System.Drawing.Bitmap* and \n   powershell.file.script_block_text : *GetPixel* and \n   (powershell.file.script_block_text : *IEX* or powershell.file.script_block_text : *Invoke-Expression*)) or\n\n  (powershell.file.script_block_text : *Bitmap* and \n   powershell.file.script_block_text : *GetPixel* and \n   powershell.file.script_block_text : *Byte* and\n   powershell.file.script_block_text : *GetString*) or\n\n  (powershell.file.script_block_text : *Drawing.Bitmap* and \n   powershell.file.script_block_text : *ASCII* and\n   powershell.file.script_block_text : *GetString*)\n)","filters":[]}
{"id":"11dce622-0fe9-453e-88b8-2a89fa31c019","rule_id":"9694bff7-c66b-440e-be94-2a8254f85111","name":"Account Discovery","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:27.247Z","updated_by":"aswin","created_at":"2025-12-05T19:24:21.101Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects account discovery commands. APT29 uses 'net user /domain' and 'net user %USERNAME% /domain'\nto enumerate domain user accounts and gather information about specific users for targeting\nin privilege escalation or lateral movement.","tags":["MITRE","APT29","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0007","name":"Discovery","reference":"https://attack.mitre.org/tactics/TA0007/"},"technique":[{"id":"T1087","name":"Account Discovery","reference":"https://attack.mitre.org/techniques/T1087/","subtechnique":[]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"67c50923-3bdc-4ecf-9119-162acc99138b","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and\n(\n  (event.category : process and (process.name : \"net.exe\" or process.name : \"net1.exe\") and \n   process.command_line : *user* and process.command_line : */domain*) or\n  (event.code : \"4104\" and \n   powershell.file.script_block_text : (*Get-ADUser* or *Get-DomainUser* or *net*user*/domain*))\n)","filters":[]}
{"id":"bb3601b2-dbe9-4b17-a481-1a32cb54adb8","rule_id":"dfa7a86c-9277-4cb3-90cc-44ad626c669c","name":"Rundll32 DLL Execution via PowerShell","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":3,"updated_at":"2025-12-08T21:59:29.247Z","updated_by":"aswin","created_at":"2025-12-05T12:04:53.781Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects execution of rundll32.exe to load and execute a DLL via PowerShell Start-Process. This technique is commonly\nused by APT28 and other threat actors to execute malicious DLLs while evading detection by leveraging a legitimate\nWindows binary. The rule specifically looks for rundll32 execution patterns in PowerShell script blocks.","tags":["MITRE","APT28","Windows","Execution"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.001","name":"PowerShell","reference":"https://attack.mitre.org/techniques/T1059/001/"}]}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1218","name":"System Binary Proxy Execution","reference":"https://attack.mitre.org/techniques/T1218/","subtechnique":[{"id":"T1218.011","name":"Rundll32","reference":"https://attack.mitre.org/techniques/T1218/011/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"d99f5743-c538-4078-9b34-6c4ec5fb02a8","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and\n(\n  (event.code : \"4104\" and powershell.file.script_block_text : *Start-Process* and powershell.file.script_block_text : *rundll32*) or\n  (event.category:process and process.command_line : *Start-Process* and process.command_line : *rundll32*) or\n  (event.category:process and process.name : \"rundll32.exe\" and process.args : *.dll* and \n    not process.args : (*shell32.dll* or *user32.dll* or *kernel32.dll* or *PcaSvc.dll* or *setupapi.dll* or *printui.dll* or *advapi32.dll* or *dfshim.dll* or *comctl32.dll* or *prncache.dll* or *inetcpl.cpl* or *desk.cpl*) and\n    not process.executable : \"C:\\\\Windows\\\\System32\\\\rundll32.exe\" and\n    not user.name : \"SYSTEM\"\n  )\n)","filters":[]}
{"id":"f96476c7-0eaa-47d3-adb5-148905f74fba","rule_id":"87de4644-bee5-4dce-ba14-903a6adc0cdd","name":"PowerShell Execution Policy Bypass","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":2,"updated_at":"2025-12-08T21:59:26.410Z","updated_by":"aswin","created_at":"2025-12-05T18:39:40.429Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects PowerShell execution with execution policy bypass (-ep bypass, -exec bypass, -executionpolicy bypass).\nAPT29 uses execution policy bypass to run unsigned scripts without restrictions.\nThis is commonly combined with -nop (no profile) and -noni (non-interactive) flags\nin their attack chain (e.g., \"-nop -exec bypass -EncodedCommand\").","tags":["MITRE","APT29","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.001","name":"PowerShell","reference":"https://attack.mitre.org/techniques/T1059/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"39683032-7eec-4136-87bb-c4e910ac90fc","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and event.category : process and \nprocess.name : \"powershell.exe\" and \n(\n  process.command_line : (*-ep*bypass* or *-exec*bypass* or *-executionpolicy*bypass*) and\n  process.command_line : (*-nop* or *-noni* or *-enc* or *-command*)\n)","filters":[]}
{"id":"fbc61f61-1bbe-4990-9763-2a9e82533599","rule_id":"462114d6-73c6-49cc-8b64-da2d090bd5a8","name":"Query Registry for Security Policies","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:27.246Z","updated_by":"aswin","created_at":"2025-12-05T19:27:10.148Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects registry query commands targeting security-relevant keys. APT29 uses \n'reg query HKLM\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\System' to check\nUAC settings and security policies, helping them plan UAC bypass techniques.","tags":["MITRE","Windows","APT29"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0007","name":"Discovery","reference":"https://attack.mitre.org/tactics/TA0007/"},"technique":[{"id":"T1012","name":"Query Registry","reference":"https://attack.mitre.org/techniques/T1012/","subtechnique":[]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"e67d0ef9-d0cc-48c3-8293-50f32953e957","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and\n(\n  (event.category : process and process.name : \"reg.exe\" and process.command_line : *query* and\n   process.command_line : (*Policies*System* or *CurrentVersion*Run* or *SecurityProviders* or \n                           *terminal*server* or *Winlogon*)) or\n  (event.code : \"4104\" and powershell.file.script_block_text : *Get-ItemProperty* and\n   powershell.file.script_block_text : (*HKLM* or *HKCU*) and\n   powershell.file.script_block_text : (*Policies* or *Run* or *Winlogon*))\n)","filters":[]}
{"id":"574aba7a-f4a0-4e30-9d35-3ba018315b66","rule_id":"652a7489-984b-4a71-99c6-dc2cd2e6591f","name":"APT-36 Sequence","immutable":false,"rule_source":{"type":"internal"},"version":1,"revision":0,"updated_at":"2025-12-08T23:06:14.554Z","updated_by":"aswin","created_at":"2025-12-08T23:06:14.554Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-2m","to":"now","description":"Sequence of APT36","tags":["MITRE","APT36","Windows"],"author":[],"license":"","threat":[],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":99,"risk_score_mapping":[],"severity":"critical","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security"},"type":"eql","language":"eql","index":[".internal.alerts-security.alerts-default-*",".internal.alerts-*"],"query":"sequence by host.id with maxspan=30m\n  \n  [ any where kibana.alert.rule.name in (\n      \"Macro-Enabled Office Download via PowerShel\",\n      \"Word Spawning Command Shell With External IP in Command Line\"\n    )\n  ]\n\n  [ any where kibana.alert.rule.name in (\n      \"Keybd_Event Win+R Keyboard Simulation\",\n      \"Creation of Hidden System File via PowerShell\"\n    )\n  ]\n\n  [ any where (\n      kibana.alert.rule.name in (\n        \"Masquerading via Add-Type OutputAssembly\",\n        \"PowerShell Invocation of Encoded VBS Macro via Invoke-MalDoc\"\n      )\n      or true\n    )\n  ]\n\n  [ any where (\n      kibana.alert.rule.name in (\n        \"PowerShell Execution of Visual Basic Script via cscript\",\n        \"Creation of Hidden System File via PowerShell\"\n      )\n      or true\n    )\n  ]\n\n  [ any where (\n      kibana.alert.rule.name in (\n        \"PowerShell Encoded Payload Execution (Base64 → IEX / File Write)\",\n        \"PowerShell Decrypting Encrypted Payload via SecureString\"\n      )\n      or true\n    )\n  ]\n\n  [ any where (\n      kibana.alert.rule.name in (\n        \"RunMRU Registry Modification for Mshta\",\n        \"Excel4MacroSheets XLM Creation\"\n      )\n      or true\n    )\n  ]\n\n  [ any where (\n      kibana.alert.rule.name in (\n        \"LNK File Download via PowerShell\",\n        \"Invoke-MalDoc VBS Macro Execution\"\n      )\n      or true\n    )\n  ]\n\n  [ any where (\n      kibana.alert.rule.name in (\n        \"Word Spawning Command Shell With External IP in Command Line\",\n        \"PowerShell Execution of Batch Script via Start-Process\"\n      )\n      or true\n    )\n  ]\n","filters":[]}
{"id":"9c6bcae2-d8c3-4d4e-9409-a62656583e5c","rule_id":"657cb86d-4769-4ffe-bfe0-ac2ee83acd31","name":"APT-36","immutable":false,"rule_source":{"type":"internal"},"version":1,"revision":3,"updated_at":"2025-12-09T00:25:15.217Z","updated_by":"aswin","created_at":"2025-12-08T23:24:26.932Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-2m","to":"now","description":"APT36 chaining","tags":["MITRE","APT36","Windows"],"author":[],"license":"","threat":[],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security"},"type":"eql","language":"eql","index":[".internal.alerts-security.alerts-default-*"],"query":"sequence by host.id with maxspan=2h\n  [ any where kibana.alert.rule.name == \"Macro-Enabled Office Download via PowerShel\" ]\n  [ any where kibana.alert.rule.name == \"Word Spawning Command Shell With External IP in Command Line\" ]\n  [ any where kibana.alert.rule.name == \"PowerShell Spawned from Command Prompt\"]\n  [ any where kibana.alert.rule.name == \"Keybd_Event Win+R Keyboard Simulation\" ]\n  [ any where kibana.alert.rule.name == \"PowerShell Encoded Command Execution\" ]\n  [ any where kibana.alert.rule.name == \"APT-36 Sequence\" ]\n  [ any where kibana.alert.rule.name == \"Creation of Hidden System File via PowerShell\" ]\n  [ any where kibana.alert.rule.name == \"Masquerading via Add-Type OutputAssembly\" ]\n  [ any where kibana.alert.rule.name == \"PowerShell Invocation of Encoded VBS Macro via Invoke-MalDoc\" ]\n  [ any where kibana.alert.rule.name == \"Creation of Hidden System File via PowerShell\" ]\n  [ any where kibana.alert.rule.name == \"PowerShell Decrypting Encrypted Payload via SecureString\" ]\n  [ any where kibana.alert.rule.name == \"PowerShell Encoded Payload Execution (Base64 → IEX / File Write)\" ]\n  [ any where kibana.alert.rule.name == \"RunMRU Registry Modification for Mshta\" ]\n  [ any where kibana.alert.rule.name == \"Excel4MacroSheets XLM Creation\" ]\n  [ any where kibana.alert.rule.name == \"LNK File Download via PowerShell\" ]\n  [ any where kibana.alert.rule.name == \"Word Spawning Command Shell With External IP in Command Line\"]\n  [ any where kibana.alert.rule.name == \"Invoke-MalDoc VBS Macro Execution\" ]","filters":[]}
{"id":"c69e72b4-5f35-4ac6-9a42-219a88b89042","rule_id":"000c942b-182d-4cb1-8e15-c7ebe88be1ec","name":"Rubeus Password Brute Force via PowerShell","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":2,"updated_at":"2025-12-08T21:59:29.248Z","updated_by":"aswin","created_at":"2025-12-05T11:50:04.522Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects execution of Rubeus.exe with brute-force password spraying arguments via PowerShell. Rubeus brute module\nattempts to authenticate against Active Directory accounts using a password list, which is a common technique\nused by APT28 and other threat actors for credential access and lateral movement preparation.","tags":["MITRE","Windows","APT28"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0006","name":"Credential Access","reference":"https://attack.mitre.org/tactics/TA0006/"},"technique":[{"id":"T1110","name":"Brute Force","reference":"https://attack.mitre.org/techniques/T1110/","subtechnique":[{"id":"T1110.003","name":"Password Spraying","reference":"https://attack.mitre.org/techniques/T1110/003/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"dc8b49a0-c5fd-43cc-b8b4-5a06a2452c80","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"event.category:process and host.os.type:windows and\n  (\n    (process.command_line : *Rubeus* and (process.command_line : *brute* or process.command_line : *spray* or process.command_line : *passwords* or process.command_line : */user*)) or\n    (process.args : *Rubeus* and (process.args : *brute* or process.args : *spray* or process.args : *passwords* or process.args : */user*))\n  )","filters":[]}
{"id":"c2385e8c-37d5-403a-8dae-f98cab5c803c","rule_id":"d33ea3bf-9a11-463e-bd46-f648f2a0f4b1","name":"Remote Windows Service Installed","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":112,"revision":1,"updated_at":"2025-12-05T18:48:20.781Z","updated_by":"aswin","created_at":"2025-12-04T15:11:18.703Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Identifies a network logon followed by Windows service creation with same LogonId. This could be indicative of lateral movement, but will be noisy if commonly done by administrators.\"","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Lateral Movement","Tactic: Persistence","Data Source: Windows Security Event Logs","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0008","name":"Lateral Movement","reference":"https://attack.mitre.org/tactics/TA0008/"},"technique":[{"id":"T1021","name":"Remote Services","reference":"https://attack.mitre.org/techniques/T1021/"}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0003","name":"Persistence","reference":"https://attack.mitre.org/tactics/TA0003/"},"technique":[{"id":"T1543","name":"Create or Modify System Process","reference":"https://attack.mitre.org/techniques/T1543/","subtechnique":[{"id":"T1543.003","name":"Windows Service","reference":"https://attack.mitre.org/techniques/T1543/003/"}]}]}],"related_integrations":[{"package":"system","version":"^2.0.0"},{"package":"windows","version":"^3.0.0"}],"required_fields":[{"name":"event.action","type":"keyword","ecs":true},{"name":"event.outcome","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"source.ip","type":"ip","ecs":true},{"name":"winlog.computer_name","type":"keyword","ecs":false},{"name":"winlog.event_data.ServiceFileName","type":"unknown","ecs":false},{"name":"winlog.event_data.SubjectLogonId","type":"keyword","ecs":false},{"name":"winlog.logon.id","type":"unknown","ecs":false},{"name":"winlog.logon.type","type":"unknown","ecs":false}],"setup":"","note":"## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating Remote Windows Service Installed\n\nWindows services are crucial for running background processes. Adversaries exploit this by installing services remotely to maintain persistence or move laterally within a network. The detection rule identifies suspicious service installations following a network logon, excluding known legitimate services, to flag potential unauthorized activities. This helps in identifying and mitigating threats early.\n\n### Possible investigation steps\n\n- Review the source IP address from the authentication event to determine if it is from a known or trusted network segment. Investigate any unfamiliar or suspicious IP addresses.\n- Check the winlog.logon.id to correlate the logon session with the service installation event, ensuring they are part of the same session.\n- Investigate the user account associated with the logon session to determine if the activity aligns with their typical behavior or role within the organization.\n- Examine the service file path from the service-installed event to identify if it is a known or legitimate application. Pay special attention to any paths not excluded in the query.\n- Look into the history of the computer where the service was installed (winlog.computer_name) for any previous suspicious activities or alerts.\n- Assess the timing and frequency of similar events to determine if this is an isolated incident or part of a broader pattern of suspicious behavior.\n\n### False positive analysis\n\n- Administrative activities can trigger false positives when administrators frequently install or update services remotely. To manage this, create exceptions for known administrative accounts or specific IP addresses used by IT staff.\n- Legitimate software installations or updates may appear as suspicious service installations. Maintain an updated list of authorized software paths and exclude these from the detection rule.\n- Automated deployment tools like PDQ Deploy or Veeam Backup can cause false positives. Identify and exclude the service paths associated with these tools to reduce noise.\n- Scheduled tasks that install or update services as part of routine maintenance can be mistaken for threats. Document and exclude these tasks from the rule to prevent unnecessary alerts.\n- Internal security tools that perform regular checks or updates may also trigger alerts. Ensure these tools are recognized and their service paths are excluded from the detection criteria.\n\n### Response and remediation\n\n- Isolate the affected system from the network to prevent further lateral movement by the adversary. This can be done by disabling network interfaces or using network segmentation tools.\n- Terminate any unauthorized services identified by the alert to stop any malicious processes from running. Use task management tools or command-line utilities to stop and disable these services.\n- Conduct a thorough review of recent logon events and service installations on the affected system to identify any additional unauthorized activities or compromised accounts.\n- Change passwords for any accounts that were used in the unauthorized service installation, especially if they have administrative privileges, to prevent further unauthorized access.\n- Restore the affected system from a known good backup if any malicious changes or persistence mechanisms are detected that cannot be easily remediated.\n- Implement network monitoring and alerting for similar suspicious activities, such as unexpected service installations or network logons, to enhance detection and response capabilities.\n- Escalate the incident to the security operations center (SOC) or incident response team for further investigation and to determine if additional systems or accounts have been compromised.","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"6074c8ec-5346-409e-ba86-c729763f2b57","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["logs-system.security*","logs-windows.forwarded*","winlogbeat-*"],"query":"sequence by winlog.logon.id, winlog.computer_name with maxspan=1m\n[authentication where host.os.type == \"windows\" and event.action == \"logged-in\" and winlog.logon.type : \"Network\" and\n event.outcome == \"success\" and source.ip != null and source.ip != \"127.0.0.1\" and source.ip != \"::1\"]\n[iam where host.os.type == \"windows\" and event.action == \"service-installed\" and\n not winlog.event_data.SubjectLogonId : \"0x3e7\" and\n not winlog.event_data.ServiceFileName :\n               (\"?:\\\\Windows\\\\ADCR_Agent\\\\adcrsvc.exe\",\n                \"?:\\\\Windows\\\\System32\\\\VSSVC.exe\",\n                \"?:\\\\Windows\\\\servicing\\\\TrustedInstaller.exe\",\n                \"?:\\\\Windows\\\\System32\\\\svchost.exe\",\n                \"?:\\\\Program Files (x86)\\\\*.exe\",\n                \"?:\\\\Program Files\\\\*.exe\",\n                \"?:\\\\Windows\\\\PSEXESVC.EXE\",\n                \"?:\\\\Windows\\\\System32\\\\sppsvc.exe\",\n                \"?:\\\\Windows\\\\System32\\\\wbem\\\\WmiApSrv.exe\",\n                \"?:\\\\WINDOWS\\\\RemoteAuditService.exe\",\n                \"?:\\\\Windows\\\\VeeamVssSupport\\\\VeeamGuestHelper.exe\",\n                \"?:\\\\Windows\\\\VeeamLogShipper\\\\VeeamLogShipper.exe\",\n                \"?:\\\\Windows\\\\CAInvokerService.exe\",\n                \"?:\\\\Windows\\\\System32\\\\upfc.exe\",\n                \"?:\\\\Windows\\\\AdminArsenal\\\\PDQ*.exe\",\n                \"?:\\\\Windows\\\\System32\\\\vds.exe\",\n                \"?:\\\\Windows\\\\Veeam\\\\Backup\\\\VeeamDeploymentSvc.exe\",\n                \"?:\\\\Windows\\\\ProPatches\\\\Scheduler\\\\STSchedEx.exe\",\n                \"?:\\\\Windows\\\\System32\\\\certsrv.exe\",\n                \"?:\\\\Windows\\\\eset-remote-install-service.exe\",\n                \"?:\\\\Pella Corporation\\\\Pella Order Management\\\\GPAutoSvc.exe\",\n                \"?:\\\\Pella Corporation\\\\OSCToGPAutoService\\\\OSCToGPAutoSvc.exe\",\n                \"?:\\\\Pella Corporation\\\\Pella Order Management\\\\GPAutoSvc.exe\",\n                \"?:\\\\Windows\\\\SysWOW64\\\\NwxExeSvc\\\\NwxExeSvc.exe\",\n                \"?:\\\\Windows\\\\System32\\\\taskhostex.exe\")]\n"}
{"id":"4c7d3b89-93ae-4791-b228-4c8d7ce7a8f3","rule_id":"dc9c1f74-dac3-48e3-b47f-eb79db358f57","name":"Volume Shadow Copy Deletion via WMIC","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":316,"revision":1,"updated_at":"2025-12-05T18:48:20.763Z","updated_by":"aswin","created_at":"2025-12-04T15:18:50.262Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Identifies use of wmic.exe for shadow copy deletion on endpoints. This commonly occurs in tandem with ransomware or other destructive attacks.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Impact","Tactic: Execution","Resources: Investigation Guide","Data Source: Elastic Endgame","Data Source: Elastic Defend","Data Source: Windows Security Event Logs","Data Source: Microsoft Defender for Endpoint","Data Source: Sysmon","Data Source: SentinelOne","Data Source: Crowdstrike"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0040","name":"Impact","reference":"https://attack.mitre.org/tactics/TA0040/"},"technique":[{"id":"T1490","name":"Inhibit System Recovery","reference":"https://attack.mitre.org/techniques/T1490/"}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1047","name":"Windows Management Instrumentation","reference":"https://attack.mitre.org/techniques/T1047/"}]}],"related_integrations":[{"package":"endpoint","version":"^9.0.0"},{"package":"windows","version":"^3.0.0"},{"package":"system","version":"^2.0.0"},{"package":"m365_defender","version":"^5.0.0"},{"package":"sentinel_one_cloud_funnel","version":"^1.9.0"},{"package":"crowdstrike","version":"^2.0.0"}],"required_fields":[{"name":"event.type","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.args","type":"keyword","ecs":true},{"name":"process.name","type":"keyword","ecs":true},{"name":"process.pe.original_file_name","type":"keyword","ecs":true}],"setup":"","note":"## Triage and analysis\n\n### Investigating Volume Shadow Copy Deletion via WMIC\n\nThe Volume Shadow Copy Service (VSS) is a Windows feature that enables system administrators to take snapshots of volumes that can later be restored or mounted to recover specific files or folders.\n\nA typical step in the playbook of an attacker attempting to deploy ransomware is to delete Volume Shadow Copies to ensure that victims have no alternative to paying the ransom, making any action that deletes shadow copies worth monitoring.\n\nThis rule monitors the execution of `wmic.exe` to interact with VSS via the `shadowcopy` alias and delete parameter.\n\n#### Possible investigation steps\n\n- Investigate the program execution chain (parent process tree).\n- Check whether the account is authorized to perform this operation.\n- Contact the account owner and confirm whether they are aware of this activity.\n- In the case of a resize operation, check if the resize value is equal to suspicious values, like 401MB.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- If unsigned files are found on the process tree, retrieve them and determine if they are malicious:\n  - Use a private sandboxed malware analysis system to perform analysis.\n    - Observe and collect information about the following activities:\n      - Attempts to contact external domains and addresses.\n      - File and registry access, modification, and creation activities.\n      - Service creation and launch activities.\n      - Scheduled task creation.\n  - Use the PowerShell Get-FileHash cmdlet to get the files' SHA-256 hash values.\n    - Search for the existence and reputation of the hashes in resources like VirusTotal, Hybrid-Analysis, CISCO Talos, Any.run, etc.\n- Use process name, command line, and file hash to search for occurrences in other hosts.\n- Check if any files on the host machine have been encrypted.\n\n\n### False positive analysis\n\n- This rule has chances of producing benign true positives (B-TPs). If this activity is expected and noisy in your environment, consider adding exceptions — preferably with a combination of user and command line conditions.\n\n### Related rules\n\n- Volume Shadow Copy Deleted or Resized via VssAdmin - b5ea4bfe-a1b2-421f-9d47-22a75a6f2921\n- Volume Shadow Copy Deletion via PowerShell - d99a037b-c8e2-47a5-97b9-170d076827c4\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Priority should be given due to the advanced stage of this activity on the attack.\n- Consider isolating the involved host to prevent destructive behavior, which is commonly associated with this activity.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors like reverse shells, reverse proxies, or droppers that attackers could use to reinfect the system.\n- Remove and block malicious artifacts identified during triage.\n- If data was encrypted, deleted, or modified, activate your data recovery plan.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Perform data recovery locally or restore the backups from replicated copies (cloud, other servers, etc.).\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"a7dd00f4-a845-4eee-b403-b4c49464f664","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["endgame-*","logs-crowdstrike.fdr*","logs-endpoint.events.process-*","logs-m365_defender.event-*","logs-sentinel_one_cloud_funnel.*","logs-system.security*","logs-windows.forwarded*","logs-windows.sysmon_operational-*","winlogbeat-*"],"query":"process where host.os.type == \"windows\" and event.type == \"start\" and\n  (process.name : \"WMIC.exe\" or ?process.pe.original_file_name == \"wmic.exe\") and\n  process.args : \"delete\" and process.args : \"shadowcopy\"\n"}
{"id":"c6ccf7b2-2389-416b-86f7-48b1a3c94685","rule_id":"2856446a-34e6-435b-9fb5-f8f040bfa7ed","name":"Account Discovery Command via SYSTEM Account","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":214,"revision":1,"updated_at":"2025-12-05T18:48:21.150Z","updated_by":"aswin","created_at":"2025-12-04T15:09:14.429Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Identifies when the SYSTEM account uses an account discovery utility. This could be a sign of discovery activity after an adversary has achieved privilege escalation.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Discovery","Tactic: Privilege Escalation","Resources: Investigation Guide","Data Source: Elastic Defend","Data Source: Sysmon"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0007","name":"Discovery","reference":"https://attack.mitre.org/tactics/TA0007/"},"technique":[{"id":"T1033","name":"System Owner/User Discovery","reference":"https://attack.mitre.org/techniques/T1033/"}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0004","name":"Privilege Escalation","reference":"https://attack.mitre.org/tactics/TA0004/"},"technique":[{"id":"T1078","name":"Valid Accounts","reference":"https://attack.mitre.org/techniques/T1078/","subtechnique":[{"id":"T1078.003","name":"Local Accounts","reference":"https://attack.mitre.org/techniques/T1078/003/"}]}]}],"related_integrations":[{"package":"endpoint","version":"^9.0.0"},{"package":"windows","version":"^3.0.0"}],"required_fields":[{"name":"event.type","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.Ext.token.integrity_level_name","type":"unknown","ecs":false},{"name":"process.args","type":"keyword","ecs":true},{"name":"process.name","type":"keyword","ecs":true},{"name":"process.parent.args","type":"keyword","ecs":true},{"name":"process.parent.executable","type":"keyword","ecs":true},{"name":"process.parent.name","type":"keyword","ecs":true},{"name":"process.working_directory","type":"keyword","ecs":true},{"name":"winlog.event_data.IntegrityLevel","type":"keyword","ecs":false}],"setup":"## Setup\n\nIf enabling an EQL rule on a non-elastic-agent index (such as beats) for versions <8.2,\nevents will not define `event.ingested` and default fallback for EQL rules was not added until version 8.2.\nHence for this rule to work effectively, users will need to add a custom ingest pipeline to populate\n`event.ingested` to @timestamp.\nFor more details on adding a custom ingest pipeline refer - https://www.elastic.co/guide/en/fleet/current/data-streams-pipeline-tutorial.html\n","note":"## Triage and analysis\n\n### Investigating Account Discovery Command via SYSTEM Account\n\nAfter successfully compromising an environment, attackers may try to gain situational awareness to plan their next steps. This can happen by running commands to enumerate network resources, users, connections, files, and installed security software.\n\nThis rule looks for the execution of account discovery utilities using the SYSTEM account, which is commonly observed after attackers successfully perform privilege escalation or exploit web applications.\n\n#### Possible investigation steps\n\n- Investigate the process execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n  - If the process tree includes a web-application server process such as w3wp, httpd.exe, nginx.exe and alike, investigate any suspicious file creation or modification in the last 48 hours to assess the presence of any potential webshell backdoor.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Determine how the SYSTEM account is being used. For example, users with administrator privileges can spawn a system shell using Windows services, scheduled tasks or other third party utilities.\n\n### False positive analysis\n\n- Discovery activities are not inherently malicious if they occur in isolation. As long as the analyst did not identify suspicious activity related to the user or host, such alerts can be dismissed.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved hosts to prevent further post-compromise behavior.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection via the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n- Use the data collected through the analysis to investigate other machines affected in the environment.\n","false_positives":[],"references":[],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"39e7b24c-3bba-4f82-ba57-163c17332bbc","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["winlogbeat-*","logs-endpoint.events.process-*","logs-windows.sysmon_operational-*"],"query":"process where host.os.type == \"windows\" and event.type == \"start\" and\n  (?process.Ext.token.integrity_level_name : \"System\" or\n  ?winlog.event_data.IntegrityLevel : \"System\") and\n  (\n    process.name : \"whoami.exe\" or\n    (\n      process.name : \"net1.exe\" and not process.parent.name : \"net.exe\" and not process.args : (\"start\", \"stop\", \"/active:*\")\n    )\n  ) and \nprocess.parent.executable != null and \nnot (process.name : \"net1.exe\" and process.working_directory : \"C:\\\\ProgramData\\\\Microsoft\\\\Windows Defender Advanced Threat Protection\\\\Downloads\\\\\") and \nnot process.parent.executable : \n                (\"C:\\\\Program Files\\\\Microsoft Monitoring Agent\\\\Agent\\\\MonitoringHost.exe\", \n                 \"C:\\\\Program Files\\\\Dell\\\\SupportAssistAgent\\\\SRE\\\\SRE.exe\", \n                 \"C:\\\\Program Files\\\\Obkio Agent\\\\main.dist\\\\ObkioAgentSoftware.exe\", \n                 \"C:\\\\Windows\\\\Temp\\\\WinGet\\\\defaultState\\\\PostgreSQL.PostgreSQL*\\\\postgresql-*-windows-x64.exe\", \n                 \"C:\\\\Program Files\\\\Obkio Agent\\\\main.dist\\\\ObkioAgentSoftware.exe\", \n                 \"C:\\\\Program Files (x86)\\\\SolarWinds\\\\Agent\\\\Plugins\\\\JobEngine\\\\SWJobEngineWorker2.exe\") and \nnot (process.parent.executable : \"C:\\\\Windows\\\\Sys?????\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\" and \n     process.parent.args : (\"C:\\\\Program Files (x86)\\\\Microsoft Intune Management Extension\\\\*.ps1\", \n                            \"Agent\\\\Modules\\\\AdHealthConfiguration\\\\AdHealthConfiguration.psd1'\")) and \nnot (process.parent.name : \"cmd.exe\" and process.working_directory : \"C:\\\\Program Files\\\\Infraon Corp\\\\SecuraAgent\\\\\")\n"}
{"id":"ed6debf6-3859-4ba8-b3ea-d9579702e4a5","rule_id":"43d6ec12-2b1c-47b5-8f35-e9de65551d3b","name":"Linux User Added to Privileged Group","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":112,"revision":1,"updated_at":"2025-12-05T18:48:21.645Z","updated_by":"aswin","created_at":"2025-12-03T15:33:13.598Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Identifies attempts to add a user to a privileged group. Attackers may add users to a privileged group in order to establish persistence on a system.","tags":["Domain: Endpoint","OS: Linux","Use Case: Threat Detection","Tactic: Persistence","Data Source: Elastic Endgame","Resources: Investigation Guide","Data Source: Elastic Defend","Data Source: Auditd Manager","Data Source: Crowdstrike","Data Source: SentinelOne"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0003","name":"Persistence","reference":"https://attack.mitre.org/tactics/TA0003/"},"technique":[{"id":"T1136","name":"Create Account","reference":"https://attack.mitre.org/techniques/T1136/","subtechnique":[{"id":"T1136.001","name":"Local Account","reference":"https://attack.mitre.org/techniques/T1136/001/"}]}]}],"related_integrations":[{"package":"endpoint","version":"^9.0.0"},{"package":"auditd_manager","version":"^1.18.0"},{"package":"crowdstrike","version":"^2.0.0"},{"package":"sentinel_one_cloud_funnel","version":"^1.9.0"}],"required_fields":[{"name":"event.action","type":"keyword","ecs":true},{"name":"event.type","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.args","type":"keyword","ecs":true},{"name":"process.name","type":"keyword","ecs":true}],"setup":"## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n","note":"## Triage and analysis\n\n### Investigating Linux User Added to Privileged Group\n\nThe `usermod`, `adduser`, and `gpasswd` commands can be used to assign user accounts to new groups in Linux-based operating systems.\n\nAttackers may add users to a privileged group in order to escalate privileges or establish persistence on a system or domain.\n\nThis rule identifies the usages of `usermod`, `adduser` and `gpasswd` to assign user accounts to a privileged group.\n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/current/invest-guide-run-osquery.html) introduced in Elastic Stack version 8.5.0. Older Elastic Stack versions will display unrendered Markdown in this guide.\n> This investigation guide uses [placeholder fields](https://www.elastic.co/guide/en/security/current/osquery-placeholder-fields.html) to dynamically pass alert data into Osquery queries. Placeholder fields were introduced in Elastic Stack version 8.7.0. If you're using Elastic Stack version 8.6.0 or earlier, you'll need to manually adjust this investigation guide's queries to ensure they properly run.\n\n#### Possible investigation steps\n\n- Investigate whether the user was succesfully added to the privileged group.\n  - !{osquery{\"label\":\"Osquery - Retrieve Information for a Specific User\",\"query\":\"SELECT * FROM users WHERE username = {{user.name}}\"}}\n- Investigate whether the user is currently logged in and active.\n  - !{osquery{\"label\":\"Osquery - Investigate the Account Authentication Status\",\"query\":\"SELECT * FROM logged_in_users WHERE user = {{user.name}}\"}}\n- Retrieve information about the privileged group to which the user was added.\n  - !{osquery{\"label\":\"Osquery - Retrieve Information for a Specific Group\",\"query\":\"SELECT * FROM groups WHERE groupname = {{group.name}}\"}}\n- Investigate the process execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence and whether they are located in expected locations.\n  - !{osquery{\"label\":\"Osquery - Retrieve Running Processes by User\",\"query\":\"SELECT pid, username, name FROM processes p JOIN users u ON u.uid = p.uid ORDER BY username\"}}\n- Identify the user account that performed the action and whether it should perform this kind of action.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n\n### False positive analysis\n\n- Adding accounts to a group is a common administrative task, so there is a high chance of the activity being legitimate. Before investigating further, verify that this activity is not benign.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors like reverse shells, reverse proxies, or droppers that attackers could use to reinfect the system.\n- Review the privileges assigned to the involved users to ensure that the least privilege principle is being followed.\n- Delete the account that seems to be involved in malicious activity.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n","false_positives":[],"references":["https://www.elastic.co/security-labs/primer-on-persistence-mechanisms"],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"ca65a465-b6eb-40a3-8e07-6a5704629aa3","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["auditbeat-*","endgame-*","logs-auditd_manager.auditd-*","logs-crowdstrike.fdr*","logs-endpoint.events.process*","logs-sentinel_one_cloud_funnel.*"],"query":"process where host.os.type == \"linux\" and event.type == \"start\" and\n  event.action in (\"exec\", \"exec_event\", \"start\", \"ProcessRollup2\", \"executed\", \"process_started\") and\n  process.args in (\n    \"root\", \"admin\", \"wheel\", \"staff\", \"sudo\",\"disk\", \"video\", \"shadow\", \"lxc\", \"lxd\"\n  ) and\n  (\n    process.name in (\"usermod\", \"adduser\") or\n    (process.name == \"gpasswd\" and process.args in (\"-a\", \"--add\", \"-M\", \"--members\"))\n  )\n"}
{"id":"9eed0d3f-01fb-463e-b440-7d1dc0b9abcd","rule_id":"edfd5ca9-9d6c-44d9-b615-1e56b920219c","name":"Linux User Account Creation","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":9,"revision":1,"updated_at":"2025-12-05T18:48:21.643Z","updated_by":"aswin","created_at":"2025-12-03T15:32:24.627Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Identifies attempts to create new users. Attackers may add new users to establish persistence on a system.","tags":["Domain: Endpoint","OS: Linux","Use Case: Threat Detection","Tactic: Persistence","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0003","name":"Persistence","reference":"https://attack.mitre.org/tactics/TA0003/"},"technique":[{"id":"T1136","name":"Create Account","reference":"https://attack.mitre.org/techniques/T1136/","subtechnique":[{"id":"T1136.001","name":"Local Account","reference":"https://attack.mitre.org/techniques/T1136/001/"}]}]}],"related_integrations":[{"package":"system","version":"^2.0.0"}],"required_fields":[{"name":"event.type","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.name","type":"keyword","ecs":true},{"name":"user.name","type":"keyword","ecs":true}],"setup":"## Setup\n\nThis rule requires data coming in from Filebeat.\n\n### Filebeat Setup\nFilebeat is a lightweight shipper for forwarding and centralizing log data. Installed as an agent on your servers, Filebeat monitors the log files or locations that you specify, collects log events, and forwards them either to Elasticsearch or Logstash for indexing.\n\n#### The following steps should be executed in order to add the Filebeat on a Linux System:\n- Elastic provides repositories available for APT and YUM-based distributions. Note that we provide binary packages, but no source packages.\n- To install the APT and YUM repositories follow the setup instructions in this [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/setup-repositories.html).\n- To run Filebeat on Docker follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/running-on-docker.html).\n- To run Filebeat on Kubernetes follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/running-on-kubernetes.html).\n- For quick start information for Filebeat refer to the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/8.11/filebeat-installation-configuration.html).\n- For complete “Setup and Run Filebeat” information refer to the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/setting-up-and-running.html).\n\n#### Rule Specific Setup Note\n- This rule requires the “Filebeat System Module” to be enabled.\n- The system module collects and parses logs created by the system logging service of common Unix/Linux based distributions.\n- To run the system module of Filebeat on Linux follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-system.html).\n","note":"## Triage and analysis\n\n### Investigating Linux User Account Creation\n\nThe `useradd` and `adduser` commands are used to create new user accounts in Linux-based operating systems.\n\nAttackers may create new accounts (both local and domain) to maintain access to victim systems.\n\nThis rule identifies the usage of `useradd` and `adduser` to create new accounts.\n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/current/invest-guide-run-osquery.html) introduced in Elastic Stack version 8.5.0. Older Elastic Stack versions will display unrendered Markdown in this guide.\n> This investigation guide uses [placeholder fields](https://www.elastic.co/guide/en/security/current/osquery-placeholder-fields.html) to dynamically pass alert data into Osquery queries. Placeholder fields were introduced in Elastic Stack version 8.7.0. If you're using Elastic Stack version 8.6.0 or earlier, you'll need to manually adjust this investigation guide's queries to ensure they properly run.\n\n#### Possible investigation steps\n\n- Investigate whether the user was created succesfully.\n  - !{osquery{\"label\":\"Osquery - Retrieve Information for a Specific User\",\"query\":\"SELECT * FROM users WHERE username = {{user.name}}\"}}\n- Investigate whether the user is currently logged in and active.\n  - !{osquery{\"label\":\"Osquery - Investigate the Account Authentication Status\",\"query\":\"SELECT * FROM logged_in_users WHERE user = {{user.name}}\"}}\n- Identify if the account was added to privileged groups or assigned special privileges after creation.\n  - !{osquery{\"label\":\"Osquery - Retrieve Information for a Specific Group\",\"query\":\"SELECT * FROM groups WHERE groupname = {{group.name}}\"}}\n- Identify the user account that performed the action and whether it should perform this kind of action.\n- Investigate the process execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence and whether they are located in expected locations.\n  - !{osquery{\"label\":\"Osquery - Retrieve Running Processes by User\",\"query\":\"SELECT pid, username, name FROM processes p JOIN users u ON u.uid = p.uid ORDER BY username\"}}\n- Investigate other alerts associated with the user/host during the past 48 hours.\n\n### False positive analysis\n\n- Account creation is a common administrative task, so there is a high chance of the activity being legitimate. Before investigating further, verify that this activity is not benign.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors like reverse shells, reverse proxies, or droppers that attackers could use to reinfect the system.\n- Review the privileges assigned to the involved users to ensure that the least privilege principle is being followed.\n- Delete the created account.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n","false_positives":[],"references":["https://www.elastic.co/security-labs/primer-on-persistence-mechanisms"],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"e189c208-5e73-4e04-bc64-ff96a84f5516","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["filebeat-*","logs-system.auth-*"],"query":"iam where host.os.type == \"linux\" and (event.type == \"user\" and event.type == \"creation\") and\nprocess.name in (\"useradd\", \"adduser\") and user.name != null\n"}
{"id":"4aaee94b-a427-4c46-9dfc-7adc05141863","rule_id":"f770ce79-05fd-4d74-9866-1c5d66c9b34b","name":"Potential Malicious PowerShell Based on Alert Correlation","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":3,"revision":1,"updated_at":"2025-12-05T18:48:20.680Z","updated_by":"aswin","created_at":"2025-12-04T15:14:43.687Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Identifies PowerShell script blocks associated with multiple distinct detections, indicating likely malicious behavior.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Execution","Rule Type: Higher-Order Rule","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.001","name":"PowerShell","reference":"https://attack.mitre.org/techniques/T1059/001/"}]}]}],"related_integrations":[],"required_fields":[{"name":"Esql._id_values","type":"keyword","ecs":false},{"name":"Esql.kibana_alert_rule_name_count_distinct","type":"long","ecs":false},{"name":"Esql.kibana_alert_rule_name_values","type":"keyword","ecs":false},{"name":"Esql.script_block_id","type":"keyword","ecs":false}],"setup":"","note":"## Triage and analysis\n\n### Investigating Potential Malicious PowerShell Based on Alert Correlation\n\nThis detection rule aggregates alert data to identify PowerShell Scripts that have triggered various PowerShell-related detection logic, thereby producing higher-fidelity results.\n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/current/invest-guide-run-osquery.html) introduced in Elastic Stack version 8.5.0. Older Elastic Stack versions will display unrendered Markdown in this guide.\n\n### Possible investigation steps\n\n- Analyzing the detections triggered by the script should offer insight into the suspicious behaviors it exhibits. This information can be found in the `distinct_alerts` field.\n- Examine the script content that triggered the detection; look for suspicious DLL imports, collection or exfiltration capabilities, suspicious functions, encoded or compressed data, and other potentially malicious characteristics.\n- Investigate the script execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n- Examine the script's execution context, such as the user account, privileges, the role of the system on which it was executed, and any relevant timestamps.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Evaluate whether the user needs to use PowerShell to complete tasks.\n- Investigate the origin of the PowerShell script, including its source, download method, and any associated URLs or IP addresses.\n- Examine the host for derived artifacts that indicate suspicious activities:\n  - Analyze the script using a private sandboxed analysis system.\n  - Observe and collect information about the following activities in both the sandbox and the alert subject host:\n    - Attempts to contact external domains and addresses.\n      - Use the Elastic Defend network events to determine domains and addresses contacted by the subject process by filtering by the process's `process.entity_id`.\n      - Examine the DNS cache for suspicious or anomalous entries.\n        - !{osquery{\"label\":\"Osquery - Retrieve DNS Cache\",\"query\":\"SELECT * FROM dns_cache\"}}\n    - Use the Elastic Defend registry events to examine registry keys accessed, modified, or created by the related processes in the process tree.\n    - Examine the host services for suspicious or anomalous entries.\n      - !{osquery{\"label\":\"Osquery - Retrieve All Services\",\"query\":\"SELECT description, display_name, name, path, pid, service_type, start_type, status, user_account FROM services\"}}\n      - !{osquery{\"label\":\"Osquery - Retrieve Services Running on User Accounts\",\"query\":\"SELECT description, display_name, name, path, pid, service_type, start_type, status, user_account FROM services WHERE\\nNOT (user_account LIKE '%LocalSystem' OR user_account LIKE '%LocalService' OR user_account LIKE '%NetworkService' OR\\nuser_account == null)\\n\"}}\n      - !{osquery{\"label\":\"Osquery - Retrieve Service Unsigned Executables with Virustotal Link\",\"query\":\"SELECT concat('https://www.virustotal.com/gui/file/', sha1) AS VtLink, name, description, start_type, status, pid,\\nservices.path FROM services JOIN authenticode ON services.path = authenticode.path OR services.module_path =\\nauthenticode.path JOIN hash ON services.path = hash.path WHERE authenticode.result != 'trusted'\\n\"}}\n  - Retrieve the files' SHA-256 hash values using the PowerShell `Get-FileHash` cmdlet and search for the existence and reputation of the hashes in resources like VirusTotal, Hybrid-Analysis, CISCO Talos, Any.run, etc.\n- Investigate potentially compromised accounts. Analysts can do this by searching for login events (for example, 4624) to the target host after the registry modification.\n\n### False positive analysis\n\n- This rule is unlikely to trigger on legitimate activity. Benign true positives (B-TPs) can be added as exceptions if necessary.\n\n### Response and Remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n  - If malicious activity is confirmed, perform a broader investigation to identify the scope of the compromise and determine the appropriate remediation steps.\n- Isolate the involved hosts to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors like reverse shells, reverse proxies, or droppers that attackers could use to reinfect the system.\n- Remove and block malicious artifacts identified during triage.\n- Reimage the host operating system or restore the compromised files to clean versions.\n- Restrict PowerShell usage outside of IT and engineering business units using GPOs, AppLocker, Intune, or similar software.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"51c07b83-1ff4-4e75-9998-2b139cbaaf74","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"esql","language":"esql","query":"from .alerts-security.* metadata _id\n\n// Filter for PowerShell related alerts\n| where kibana.alert.rule.name like \"*PowerShell*\"\n\n// as alerts don't have non-ECS fields, parse the script block ID using grok\n| grok message \"ScriptBlock ID: (?<Esql.script_block_id>.+)\"\n| where Esql.script_block_id is not null\n\n// keep relevant fields for further processing\n| keep kibana.alert.rule.name, Esql.script_block_id, _id\n\n// count distinct alerts and filter for matches above the threshold\n| stats\n    Esql.kibana_alert_rule_name_count_distinct = count_distinct(kibana.alert.rule.name),\n    Esql.kibana_alert_rule_name_values = values(kibana.alert.rule.name),\n    Esql._id_values = values(_id)\n  by Esql.script_block_id\n\n// Apply detection threshold\n| where Esql.kibana_alert_rule_name_count_distinct >= 5\n"}
{"id":"08d4df43-a5e3-4404-bcfd-1ad8e74f74ef","rule_id":"ef862985-3f13-4262-a686-5f357bbb9bc2","name":"Whoami Process Activity","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":216,"revision":1,"updated_at":"2025-12-05T18:48:20.649Z","updated_by":"aswin","created_at":"2025-12-04T15:09:46.542Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Identifies suspicious use of whoami.exe which displays user, group, and privileges information for the user who is currently logged on to the local system.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Discovery","Resources: Investigation Guide","Data Source: Elastic Endgame","Data Source: Elastic Defend","Data Source: Microsoft Defender for Endpoint","Data Source: Sysmon","Data Source: Windows Security Event Logs"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0007","name":"Discovery","reference":"https://attack.mitre.org/tactics/TA0007/"},"technique":[{"id":"T1033","name":"System Owner/User Discovery","reference":"https://attack.mitre.org/techniques/T1033/"}]}],"related_integrations":[{"package":"endpoint","version":"^9.0.0"},{"package":"system","version":"^2.0.0"},{"package":"windows","version":"^3.0.0"},{"package":"m365_defender","version":"^5.0.0"}],"required_fields":[{"name":"event.dataset","type":"keyword","ecs":true},{"name":"event.type","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.Ext.token.integrity_level_name","type":"unknown","ecs":false},{"name":"process.name","type":"keyword","ecs":true},{"name":"process.parent.args","type":"keyword","ecs":true},{"name":"process.parent.executable","type":"keyword","ecs":true},{"name":"process.parent.name","type":"keyword","ecs":true},{"name":"user.domain","type":"keyword","ecs":true},{"name":"user.id","type":"keyword","ecs":true},{"name":"winlog.event_data.IntegrityLevel","type":"keyword","ecs":false},{"name":"winlog.event_data.SubjectUserName","type":"keyword","ecs":false}],"setup":"","note":"## Triage and analysis\n\n### Investigating Whoami Process Activity\n\nAfter successfully compromising an environment, attackers may try to gain situational awareness to plan their next steps. This can happen by running commands to enumerate network resources, users, connections, files, and installed security software.\n\nThis rule looks for the execution of the `whoami` utility. Attackers commonly use this utility to measure their current privileges, discover the current user, determine if a privilege escalation was successful, etc.\n\n#### Possible investigation steps\n\n- Investigate the process execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n- Identify the user account that performed the action and whether it should perform this kind of action.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Investigate any abnormal account behavior, such as command executions, file creations or modifications, and network connections.\n\n### False positive analysis\n\n- Discovery activities are not inherently malicious if they occur in isolation. As long as the analyst did not identify suspicious activity related to the user or host, such alerts can be dismissed.\n\n### Related rules\n\n- Account Discovery Command via SYSTEM Account - 2856446a-34e6-435b-9fb5-f8f040bfa7ed\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved hosts to prevent further post-compromise behavior.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n","false_positives":["Some normal use of this program, at varying levels of frequency, may originate from scripts, automation tools and frameworks. Usage by non-engineers and ordinary users is unusual."],"references":[],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"e4dc1dab-d1ff-4ced-9d0b-b544ffa0d823","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["endgame-*","logs-endpoint.events.process-*","logs-m365_defender.event-*","logs-system.security*","logs-windows.forwarded*","logs-windows.sysmon_operational-*","winlogbeat-*"],"query":"process where host.os.type == \"windows\" and event.type == \"start\" and process.name : \"whoami.exe\" and\n(\n  (\n    /* scoped for whoami execution under system privileges */\n    (\n      (\n        user.domain : (\"NT *\", \"* NT\", \"IIS APPPOOL\") and\n        user.id : (\"S-1-5-18\", \"S-1-5-19\", \"S-1-5-20\", \"S-1-5-82-*\") and\n        not ?winlog.event_data.SubjectUserName : \"*$\" and\n\n        /* Sysmon will always populate user.id as S-1-5-18, leading to FPs */\n        not event.dataset : (\"windows.sysmon_operational\", \"windows.sysmon\")\n      ) or\n      (?process.Ext.token.integrity_level_name : \"System\" or ?winlog.event_data.IntegrityLevel : \"System\")\n    ) and\n    not (\n      process.parent.name : \"cmd.exe\" and\n      process.parent.args : (\n          \"chcp 437>nul 2>&1 & C:\\\\WINDOWS\\\\System32\\\\whoami.exe  /groups\",\n          \"chcp 437>nul 2>&1 & %systemroot%\\\\system32\\\\whoami /user\",\n          \"C:\\\\WINDOWS\\\\System32\\\\whoami.exe /groups\",\n          \"*WINDOWS\\\\system32\\\\config\\\\systemprofile*\"\n      )\n    ) and\n    not (process.parent.executable : \"C:\\\\Windows\\\\system32\\\\inetsrv\\\\appcmd.exe\" and process.parent.args : \"LIST\") and\n    not process.parent.executable : (\n        \"C:\\\\Program Files\\\\Microsoft Monitoring Agent\\\\Agent\\\\MonitoringHost.exe\",\n        \"C:\\\\Program Files\\\\Cohesity\\\\cohesity_windows_agent_service.exe\"\n    )\n  ) or\n  process.parent.name : (\"wsmprovhost.exe\", \"w3wp.exe\", \"wmiprvse.exe\", \"rundll32.exe\", \"regsvr32.exe\")\n)\n"}
{"id":"553c9d6e-c1b3-4332-9fb8-d46030c3be36","rule_id":"1aa9181a-492b-4c01-8b16-fa0735786b2b","name":"User Account Creation","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":314,"revision":1,"updated_at":"2025-12-05T18:48:21.148Z","updated_by":"aswin","created_at":"2025-12-04T15:13:16.011Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Identifies attempts to create new users. This is sometimes done by attackers to increase access or establish persistence on a system or domain.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Persistence","Resources: Investigation Guide","Data Source: Elastic Endgame","Data Source: Elastic Defend","Data Source: Windows Security Event Logs","Data Source: Microsoft Defender for Endpoint","Data Source: Sysmon","Data Source: SentinelOne","Data Source: Crowdstrike"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0003","name":"Persistence","reference":"https://attack.mitre.org/tactics/TA0003/"},"technique":[{"id":"T1136","name":"Create Account","reference":"https://attack.mitre.org/techniques/T1136/","subtechnique":[{"id":"T1136.001","name":"Local Account","reference":"https://attack.mitre.org/techniques/T1136/001/"}]}]}],"related_integrations":[{"package":"endpoint","version":"^9.0.0"},{"package":"windows","version":"^3.0.0"},{"package":"system","version":"^2.0.0"},{"package":"m365_defender","version":"^5.0.0"},{"package":"sentinel_one_cloud_funnel","version":"^1.9.0"},{"package":"crowdstrike","version":"^2.0.0"}],"required_fields":[{"name":"event.type","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.args","type":"keyword","ecs":true},{"name":"process.name","type":"keyword","ecs":true},{"name":"process.parent.name","type":"keyword","ecs":true}],"setup":"","note":"## Triage and analysis\n\n### Investigating User Account Creation\n\nAttackers may create new accounts (both local and domain) to maintain access to victim systems.\n\nThis rule identifies the usage of `net.exe` to create new accounts.\n\n#### Possible investigation steps\n\n- Investigate the process execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n- Identify the user account that performed the action and whether it should perform this kind of action.\n- Identify if the account was added to privileged groups or assigned special privileges after creation.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n\n### False positive analysis\n\n- Account creation is a common administrative task, so there is a high chance of the activity being legitimate. Before investigating further, verify that this activity is not benign.\n\n### Related rules\n\n- Creation of a Hidden Local User Account - 2edc8076-291e-41e9-81e4-e3fcbc97ae5e\n- Windows User Account Creation - 38e17753-f581-4644-84da-0d60a8318694\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- Delete the created account.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n","false_positives":[],"references":[],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"688b2275-ac79-448f-8ce4-5311d959df8a","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["endgame-*","logs-crowdstrike.fdr*","logs-endpoint.events.process-*","logs-m365_defender.event-*","logs-sentinel_one_cloud_funnel.*","logs-system.security*","logs-windows.forwarded*","logs-windows.sysmon_operational-*","winlogbeat-*"],"query":"process where host.os.type == \"windows\" and event.type == \"start\" and\n  (process.name : (\"net.exe\", \"net1.exe\") and not process.parent.name : \"net.exe\") and\n  (process.args : \"user\" and process.args : (\"/ad\", \"/add\"))\n"}
{"id":"b6c0aec6-d92b-44a1-aa30-3b8da1b33f06","rule_id":"a4c59bdf-c2e5-4d8b-9477-67a0857b1a5d","name":"System Owner/User Discovery","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:27.249Z","updated_by":"aswin","created_at":"2025-12-05T19:14:20.894Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects system owner/user discovery commands. APT29 uses 'echo %USERDOMAIN%\\\\%USERNAME%' \nto identify the current user and domain context. This technique helps attackers understand\ntheir current access level and plan privilege escalation or lateral movement.","tags":["MITRE","APT29","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0007","name":"Discovery","reference":"https://attack.mitre.org/tactics/TA0007/"},"technique":[{"id":"T1033","name":"System Owner/User Discovery","reference":"https://attack.mitre.org/techniques/T1033/","subtechnique":[]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"7f482852-26f2-4c7d-b6d2-baff974e8404","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type: \"windows\" and\n(\n  (\n    event.category: process and process.name: \"cmd.exe\" and \n    (\n      process.command_line : \"*%USERNAME%*\" or\n      process.command_line : \"*%USERDOMAIN%*\" or\n      process.command_line : \"*%USERPROFILE%*\"\n    )\n  ) or\n\n  (event.category: process and process.name: \"whoami.exe\") or\n\n  (\n    event.code: 4104 and \n    (\n      powershell.file.script_block_text : \"*$env:USERNAME*\" or\n      powershell.file.script_block_text : \"*$env:USERDOMAIN*\" or\n      powershell.file.script_block_text : \"*[Environment]::UserName*\"\n    )\n  )\n)\n","filters":[]}
{"id":"17c1961a-5ad2-4caa-b5c3-23946dd56455","rule_id":"4477c9f4-0f6c-4c3d-bd3e-bdb9550c6cc6","name":"Potential Execution via FileFix Phishing Attack","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:29.244Z","updated_by":"aswin","created_at":"2025-12-06T22:43:01.433Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Identifies the execution of Windows commands or downloaded files via the browser's dialog box. Adversaries may use phishing\nto instruct the victim to copy and paste malicious commands for execution via crafted phsihing web pages.","tags":["MITRE","Windows","APT36"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0001","name":"Initial Access","reference":"https://attack.mitre.org/tactics/TA0001/"},"technique":[{"id":"T1566","name":"Phishing","reference":"https://attack.mitre.org/techniques/T1566/","subtechnique":[{"id":"T1566.001","name":"Spearphishing Attachment","reference":"https://attack.mitre.org/techniques/T1566/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}"}]},"action_type_id":".index","uuid":"72584c33-cb8d-4846-88d4-fc9c55b72168","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.1.21:5601/app/security","from":"1m"},"type":"eql","language":"eql","index":["winlogbeat-*"],"query":"process where host.os.type == \"windows\" and event.type == \"start\" and\n(\n  (\n    process.parent.args == \"--message-loop-type-ui\" and \n    process.parent.args == \"--service-sandbox-type=none\" and\n    (\n      process.name : (\"pwsh.exe\", \"powershell.exe\", \"curl.exe\", \"msiexec.exe\", \n                      \"mshta.exe\", \"wscript.exe\", \"cscript.exe\", \"rundll32.exe\", \n                      \"certutil.exe\", \"certreq.exe\", \"cmd.exe\") or\n      process.executable : \"?:\\\\Users\\\\*\\\\Downloads\\\\*\"\n    ) and\n    not (process.name : \"rundll32.exe\" and \n         process.args : (\"ndfapi.dll,NdfRunDllDiagnoseWithAnswerFile\", \n                         \"shwebsvc.dll,AddNetPlaceRunDll\"))\n  )\n  or\n  (\n    process.parent.name : \"explorer.exe\" and\n    process.name : (\"cmd.exe\", \"powershell.exe\", \"pwsh.exe\") and\n    (\n      process.command_line : (\"*-ec *\", \"*-encodedcommand *\", \"*-e *\") or\n      process.command_line : (\"*cmd /c powershell*\", \"*cmd.exe /c powershell*\") or\n      process.command_line : (\"*IEX*\", \"*Invoke-Expression*\", \"*downloadstring*\", \n                              \"*wget *\", \"*curl *\", \"*Net.WebClient*\")\n    )\n  )\n)","filters":[]}
{"id":"4b60bd74-55ba-4db8-9f29-e08305225a5f","rule_id":"7c61a37a-3d47-4a02-9e8d-dc6a9678f52a","name":"SSH Password Spraying","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":2,"updated_at":"2025-12-08T21:59:27.258Z","updated_by":"aswin","created_at":"2025-12-03T14:04:09.476Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"SSH Bruteforce with Multiple Users Targeted From Single IP","tags":["MITRE","Linux","SSH","PasswordSpray"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0006","name":"Credential Access","reference":"https://attack.mitre.org/tactics/TA0006/"},"technique":[{"id":"T1110","name":"Brute Force","reference":"https://attack.mitre.org/techniques/T1110/","subtechnique":[{"id":"T1110.003","name":"Password Spraying","reference":"https://attack.mitre.org/techniques/T1110/003/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"5bfcc794-b3ac-4476-9c99-13d2c4022a7d","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"eql","language":"eql","index":["auditbeat-*"],"query":"sequence by source.ip with maxspan=10m\n  [ authentication\n      where event.category == \"authentication\"\n      and event.outcome == \"failure\"\n      and event.type == \"authentication_failure\"\n  ] with runs=5","filters":[]}
{"id":"7270b3a4-126c-4fe0-8daf-1ce302de3a80","rule_id":"25b46163-1860-4434-b27a-315124e4e7f4","name":"Linux Data Staging and Exfiltration Chain - Thief","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":4,"updated_at":"2025-12-08T21:59:27.254Z","updated_by":"aswin","created_at":"2025-12-02T18:37:52.826Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects a complete threat chain sequence involving local data staging, sensitive file discovery, compression, and exfiltration. This rule correlates alerts from five distinct detection rules to identify high-confidence APT-like activity where an attacker stages data in a temporary directory before exfiltrating it.","tags":["Linux","Thief"],"author":[],"license":"","threat":[],"timeline_id":"495ad7a7-316e-4544-8a0f-9c098daee76e","timeline_title":"Generic Threat Match Timeline","related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"f64cd61e-3297-4d67-851a-da799daa7c93","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"eql","language":"eql","index":[".internal.alerts-security.alerts-default-*"],"query":"sequence by host.id with maxspan=1h\n  [any where kibana.alert.rule.name in (\n       \"T1074.001 - Suspicious Staging Directory Creation\",\n       \"T1005 – Data from Local System\",\n       \"T1560.001 - Staged Data Compressed in Linux\",\n       \"Auditbeat Process-Based Exfiltration (T1041)\"\n  )]\n  [any where kibana.alert.rule.name in (\n       \"T1074.001 - Suspicious Staging Directory Creation\",\n       \"T1005 – Data from Local System\",\n       \"T1560.001 - Staged Data Compressed in Linux\",\n       \"Auditbeat Process-Based Exfiltration (T1041)\"\n  )]\n  [any where kibana.alert.rule.name in (\n       \"T1074.001 - Suspicious Staging Directory Creation\",\n       \"T1005 – Data from Local System\",\n       \"T1560.001 - Staged Data Compressed in Linux\",\n       \"Auditbeat Process-Based Exfiltration (T1041)\"\n  )]\n  [any where kibana.alert.rule.name in (\n       \"T1074.001 - Suspicious Staging Directory Creation\",\n       \"T1005 – Data from Local System\",\n       \"T1560.001 - Staged Data Compressed in Linux\",\n       \"Auditbeat Process-Based Exfiltration (T1041)\"\n  )]\n","filters":[]}
{"id":"a5be8680-ed6a-44e2-8a32-48e13c4e06a9","rule_id":"d122fe88-f20d-4b19-b371-7a01fd464522","name":"SSH Low-and-Slow Brute Force","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":2,"updated_at":"2025-12-08T21:59:27.257Z","updated_by":"aswin","created_at":"2025-12-03T14:15:48.703Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Low-and-Slow Brute Force – Multiple Failures Over Extended Window","tags":["MITRE","SSH","Linux"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0006","name":"Credential Access","reference":"https://attack.mitre.org/tactics/TA0006/"},"technique":[{"id":"T1110","name":"Brute Force","reference":"https://attack.mitre.org/techniques/T1110/","subtechnique":[{"id":"T1110.001","name":"Password Guessing","reference":"https://attack.mitre.org/techniques/T1110/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"d4e84065-4092-4c33-b11a-3998d10e67a8","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"eql","language":"eql","index":["auditbeat-*"],"query":"sequence by source.ip, user.name with maxspan=6h\n  [ authentication \n      where event.category == \"authentication\" \n      and event.outcome == \"failure\" \n      and not user.name in (\"root\", \"admin\") \n  ] with runs=10","filters":[]}
{"id":"8c70a084-bea5-438c-92e9-9a27d5c01e29","rule_id":"4f10b81d-707f-4cb5-9f80-a1275b4e4c8c","name":"PowerShell Execution of Visual Basic Script via cscript","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":3,"updated_at":"2025-12-09T00:07:17.853Z","updated_by":"aswin","created_at":"2025-12-07T18:24:30.064Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-2m","to":"now","description":"Detects PowerShell launching a Visual Basic Script (.vbs) via cscript.exe using PowerShell’s HostApplication command line.\nThis behavior is commonly associated with execution techniques used by adversaries to gather system information, evade detection, or run malicious scripts delivered through phishing, loaders, or initial access tooling.\nThe detection specifically monitors PowerShell Operational Event ID 600, where the full PowerShell host command line reveals the use of cscript and a .vbs script.","tags":["MITRE","APT36","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.001","name":"PowerShell","reference":"https://attack.mitre.org/techniques/T1059/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}"}]},"action_type_id":".index","uuid":"843df8e5-1a66-44e2-84dd-afc883e2b7cd","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type: \"windows\" AND\nevent.code: \"600\" AND\n(process.command_line: *cscript* OR process.command_line.text: *cscript*) AND\n(process.command_line: *.vbs* OR process.command_line.text: *.vbs*)","filters":[]}
{"id":"2d0a7cf2-271c-4aa8-aeee-4f22204d9cc9","rule_id":"b4331863-218a-44a7-8188-7aabb347bb02","name":"Macro-Enabled Office Download via PowerShel","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.413Z","updated_by":"aswin","created_at":"2025-12-08T05:12:53.462Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects Invoke-WebRequest download of macro-enabled Office files (.xlsm, .docm).\nAPT36 downloads phishing attachments from GitHub and stores in $env:TEMP for later macro execution.\nThese files contain malicious VBA/XLM macros that execute upon opening or macro enablement.","tags":["MITRE","Windows","APT36"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0001","name":"Initial Access","reference":"https://attack.mitre.org/tactics/TA0001/"},"technique":[{"id":"T1566","name":"Phishing","reference":"https://attack.mitre.org/techniques/T1566/","subtechnique":[{"id":"T1566.001","name":"Spearphishing Attachment","reference":"https://attack.mitre.org/techniques/T1566/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"b3ff5aa6-31c2-454e-ba87-08d14b8818c0","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type: \"windows\" AND\nevent.code: \"600\" AND\nwinlog.channel: \"Windows PowerShell\" AND\nprocess.command_line: *Invoke-WebRequest* AND\nprocess.command_line: (*xlsm* OR *docm* OR *pptm* OR *xls* OR *doc* OR *ppt*) AND\nprocess.command_line: (*http* OR *https*)","filters":[]}
{"id":"6b427c2c-994b-434d-b471-e64f8bd87695","rule_id":"c2d90150-0133-451c-a783-533e736c12d7","name":"Mshta Making Network Connections","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":212,"revision":0,"updated_at":"2025-12-06T22:46:02.973Z","updated_by":"aswin","created_at":"2025-12-06T22:45:59.957Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-20m","to":"now","description":"Identifies Mshta.exe making outbound network connections. This may indicate adversarial activity, as Mshta is often leveraged by adversaries to execute malicious scripts and evade detection.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Defense Evasion","Data Source: Elastic Defend","Data Source: SentinelOne","Data Source: Sysmon","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1218","name":"System Binary Proxy Execution","reference":"https://attack.mitre.org/techniques/T1218/","subtechnique":[{"id":"T1218.005","name":"Mshta","reference":"https://attack.mitre.org/techniques/T1218/005/"}]}]}],"related_integrations":[{"package":"endpoint","version":"^9.0.0"},{"package":"windows","version":"^3.0.0"},{"package":"sentinel_one_cloud_funnel","version":"^1.9.0"}],"required_fields":[{"name":"event.type","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.args","type":"keyword","ecs":true},{"name":"process.entity_id","type":"keyword","ecs":true},{"name":"process.name","type":"keyword","ecs":true},{"name":"process.parent.executable","type":"keyword","ecs":true},{"name":"process.parent.name","type":"keyword","ecs":true}],"setup":"","note":"## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating Mshta Making Network Connections\n\nMshta.exe is a legitimate Windows utility used to execute Microsoft HTML Application (HTA) files. Adversaries exploit it to run malicious scripts, leveraging its trusted status to bypass security measures. The detection rule identifies suspicious network activity by Mshta.exe, excluding known benign processes, to flag potential threats. This approach helps in identifying unauthorized network connections indicative of malicious intent.\n\n### Possible investigation steps\n\n- Review the process tree to understand the parent-child relationship of mshta.exe, focusing on any unusual or unexpected parent processes that are not excluded by the rule, such as Microsoft.ConfigurationManagement.exe or known benign executables.\n- Analyze the command-line arguments used by mshta.exe to identify any suspicious or unexpected scripts being executed, especially those not matching the excluded ADSelfService_Enroll.hta.\n- Examine the network connections initiated by mshta.exe, including destination IP addresses, domains, and ports, to identify any connections to known malicious or suspicious endpoints.\n- Check for any related alerts or logs from the same host around the time of the mshta.exe activity to identify potential lateral movement or additional malicious behavior.\n- Investigate the user account associated with the mshta.exe process to determine if it has been compromised or is exhibiting unusual activity patterns.\n\n### False positive analysis\n\n- Mshta.exe may be triggered by legitimate software updates or installations, such as those from Microsoft Configuration Management. To handle this, add exceptions for processes with parent names like Microsoft.ConfigurationManagement.exe.\n- Certain applications like Amazon Assistant and TeamViewer may use Mshta.exe for legitimate purposes. Exclude these by specifying their executable paths, such as C:\\Amazon\\Amazon Assistant\\amazonAssistantService.exe and C:\\TeamViewer\\TeamViewer.exe.\n- Custom scripts or internal tools that utilize HTA files for automation might cause false positives. Identify these scripts and exclude them by their specific arguments, such as ADSelfService_Enroll.hta.\n- Regularly review and update the list of exceptions to ensure that only verified benign activities are excluded, minimizing the risk of overlooking genuine threats.\n\n### Response and remediation\n\n- Isolate the affected system from the network to prevent further unauthorized access or data exfiltration.\n- Terminate the mshta.exe process if it is confirmed to be making unauthorized network connections.\n- Conduct a thorough scan of the affected system using updated antivirus and anti-malware tools to identify and remove any malicious scripts or files.\n- Review and analyze the process tree and network connections associated with mshta.exe to identify any additional compromised processes or systems.\n- Restore the system from a known good backup if malicious activity is confirmed and cannot be fully remediated.\n- Implement application whitelisting to prevent unauthorized execution of mshta.exe and similar system binaries.\n- Escalate the incident to the security operations center (SOC) or incident response team for further investigation and to assess the potential impact on the broader network.","false_positives":[],"references":["https://www.elastic.co/security-labs/elastic-protects-against-data-wiper-malware-targeting-ukraine-hermeticwiper"],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"type":"eql","language":"eql","index":["logs-endpoint.events.process-*","logs-endpoint.events.network-*","winlogbeat-*","logs-windows.sysmon_operational-*","logs-sentinel_one_cloud_funnel.*"],"query":"sequence by process.entity_id with maxspan=10m\n  [process where host.os.type == \"windows\" and event.type == \"start\" and process.name : \"mshta.exe\" and\n     not process.parent.name : \"Microsoft.ConfigurationManagement.exe\" and\n     not (process.parent.executable : \"C:\\\\Amazon\\\\Amazon Assistant\\\\amazonAssistantService.exe\" or\n          process.parent.executable : \"C:\\\\TeamViewer\\\\TeamViewer.exe\") and\n     not process.args : \"ADSelfService_Enroll.hta\"]\n  [network where host.os.type == \"windows\" and process.name : \"mshta.exe\"]\n"}
{"id":"67a4e845-4cc4-4af9-9355-7e3ef34f98b9","rule_id":"5c495612-9992-49a7-afe3-0f647671fb60","name":"Successful SSH Authentication from Unusual IP Address","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":3,"revision":0,"updated_at":"2025-12-08T19:33:20.603Z","updated_by":"aswin","created_at":"2025-12-08T19:33:18.790Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"This rule leverages the new_terms rule type to detect successful SSH authentications by an IP- address that has not been authenticated in the last 10 days. This behavior may indicate an attacker attempting to gain access to the system using a valid account.","tags":["Domain: Endpoint","OS: Linux","Use Case: Threat Detection","Tactic: Initial Access","Data Source: Elastic Defend","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0001","name":"Initial Access","reference":"https://attack.mitre.org/tactics/TA0001/"},"technique":[{"id":"T1078","name":"Valid Accounts","reference":"https://attack.mitre.org/techniques/T1078/"}]}],"related_integrations":[{"package":"system","version":"^2.0.0"}],"required_fields":[{"name":"event.action","type":"keyword","ecs":true},{"name":"event.category","type":"keyword","ecs":true},{"name":"event.outcome","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true}],"setup":"## Setup\n\nThis rule requires data coming in from one of the following integrations:\n- Filebeat\n\n### Filebeat Setup\nFilebeat is a lightweight shipper for forwarding and centralizing log data. Installed as an agent on your servers, Filebeat monitors the log files or locations that you specify, collects log events, and forwards them either to Elasticsearch or Logstash for indexing.\n\n#### The following steps should be executed in order to add the Filebeat for the Linux System:\n- Elastic provides repositories available for APT and YUM-based distributions. Note that we provide binary packages, but no source packages.\n- To install the APT and YUM repositories follow the setup instructions in this [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/setup-repositories.html).\n- To run Filebeat on Docker follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/running-on-docker.html).\n- To run Filebeat on Kubernetes follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/running-on-kubernetes.html).\n- For quick start information for Filebeat refer to the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/8.11/filebeat-installation-configuration.html).\n- For complete Setup and Run Filebeat information refer to the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/setting-up-and-running.html).\n\n#### Rule Specific Setup Note\n- This rule requires the Filebeat System Module to be enabled.\n- The system module collects and parses logs created by the system logging service of common Unix/Linux based distributions.\n- To run the system module of Filebeat on Linux follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-system.html).\n","note":" ## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating Successful SSH Authentication from Unusual IP Address\n\nSecure Shell (SSH) is a protocol used to securely access and manage Linux systems. Adversaries may exploit SSH by using stolen credentials to gain unauthorized access. The detection rule identifies successful logins from IPs not seen in the past 10 days, flagging potential intrusions. This approach helps in spotting unusual access patterns that could indicate compromised accounts.\n\n### Possible investigation steps\n\n- Review the IP address flagged in the alert to determine its geolocation and assess if it aligns with expected access patterns for the user account involved.\n- Check historical authentication logs for the user account to identify any other unusual or unauthorized access attempts, focusing on the event.category:authentication and event.action:ssh_login fields.\n- Investigate the user account's recent activity on the system to identify any suspicious commands or actions executed post-authentication.\n- Correlate the flagged IP address with known threat intelligence sources to determine if it is associated with any malicious activity or previously reported incidents.\n- Contact the user associated with the account to verify if they recognize the login attempt and if they have recently accessed the system from a new location or device.\n\n### False positive analysis\n\n- New employee or contractor access from a previously unseen IP address may trigger the rule. Regularly update the list of known IP addresses for new users to prevent unnecessary alerts.\n- Remote workers or employees traveling may log in from different IP addresses. Implement a process to whitelist IP ranges associated with common travel destinations or VPNs used by the organization.\n- Automated scripts or services that occasionally run from different IPs can cause false positives. Identify and document these services, then create exceptions for their known IP addresses.\n- Cloud-based infrastructure changes, such as new instances or containers, might authenticate from new IPs. Maintain an updated inventory of cloud resources and their expected IP ranges to adjust the rule accordingly.\n- Third-party vendors accessing systems for maintenance or support might use different IPs. Establish a protocol for temporary exceptions for vendor IPs during their access periods.\n\n### Response and remediation\n\n- Immediately isolate the affected system from the network to prevent further unauthorized access or lateral movement by the attacker.\n- Verify the legitimacy of the login by contacting the account owner to confirm whether the access was authorized. If unauthorized, proceed with further steps.\n- Change the password of the compromised account and any other accounts that may have been accessed using the same credentials.\n- Review and analyze the system logs for any additional suspicious activity or changes made during the unauthorized access period.\n- Escalate the incident to the security operations team for a thorough investigation and to determine if further systems are affected.\n- Implement IP whitelisting or geofencing to restrict SSH access to known and trusted IP addresses only.\n- Update and enhance monitoring rules to detect similar unauthorized access attempts in the future, ensuring that alerts are promptly reviewed and acted upon.\n","false_positives":[],"references":[],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"type":"new_terms","query":"event.category:authentication and host.os.type:linux and event.action:ssh_login and event.outcome:success\n","new_terms_fields":["related.ip"],"history_window_start":"now-10d","index":["logs-system.auth-*","filebeat-*"],"language":"kuery"}
{"id":"42db3a7c-1db7-4091-8100-1dda3efeed76","rule_id":"f9790abf-bd0c-45f9-8b5f-d0b74015e029","name":"Privileged Account Brute Force","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":115,"revision":1,"updated_at":"2025-12-05T18:48:20.686Z","updated_by":"aswin","created_at":"2025-12-04T16:44:05.876Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Identifies multiple consecutive logon failures targeting an Admin account from the same source address and within a short time interval. Adversaries will often brute force login attempts across multiple users with a common or known password, in an attempt to gain access to accounts.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Credential Access","Resources: Investigation Guide","Data Source: Windows Security Event Logs"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0006","name":"Credential Access","reference":"https://attack.mitre.org/tactics/TA0006/"},"technique":[{"id":"T1110","name":"Brute Force","reference":"https://attack.mitre.org/techniques/T1110/","subtechnique":[{"id":"T1110.001","name":"Password Guessing","reference":"https://attack.mitre.org/techniques/T1110/001/"},{"id":"T1110.003","name":"Password Spraying","reference":"https://attack.mitre.org/techniques/T1110/003/"}]}]}],"related_integrations":[{"package":"system","version":"^2.0.0"},{"package":"windows","version":"^3.0.0"}],"required_fields":[{"name":"event.action","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"source.ip","type":"ip","ecs":true},{"name":"user.name","type":"keyword","ecs":true},{"name":"winlog.computer_name","type":"keyword","ecs":false},{"name":"winlog.event_data.Status","type":"keyword","ecs":false},{"name":"winlog.logon.type","type":"unknown","ecs":false}],"setup":"","note":"## Triage and analysis\n\n### Investigating Privileged Account Brute Force\n\nAdversaries with no prior knowledge of legitimate credentials within the system or environment may guess passwords to attempt access to accounts. Without knowledge of the password for an account, an adversary may opt to guess the password using a repetitive or iterative mechanism systematically. More details can be found [here](https://attack.mitre.org/techniques/T1110/001/).\n\nThis rule identifies potential password guessing/brute force activity from a single address against an account that contains the `admin` pattern on its name, which is likely a highly privileged account.\n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/current/invest-guide-run-osquery.html) introduced in Elastic Stack version 8.5.0. Older Elastic Stack versions will display unrendered Markdown in this guide.\n\n#### Possible investigation steps\n\n- Investigate the logon failure reason code and the targeted user name.\n  - Prioritize the investigation if the account is critical or has administrative privileges over the domain.\n- Investigate the source IP address of the failed Network Logon attempts.\n  - Identify whether these attempts are coming from the internet or are internal.\n- Investigate other alerts associated with the involved users and source host during the past 48 hours.\n- Identify the source and the target computer and their roles in the IT environment.\n- Check whether the involved credentials are used in automation or scheduled tasks.\n- If this activity is suspicious, contact the account owner and confirm whether they are aware of it.\n- Examine the source host for derived artifacts that indicate compromise:\n  - Observe and collect information about the following activities in the alert source host:\n    - Attempts to contact external domains and addresses.\n      - Examine the DNS cache for suspicious or anomalous entries.\n        - !{osquery{\"label\":\"Osquery - Retrieve DNS Cache\",\"query\":\"SELECT * FROM dns_cache\"}}\n    - Examine the host services for suspicious or anomalous entries.\n      - !{osquery{\"label\":\"Osquery - Retrieve All Services\",\"query\":\"SELECT description, display_name, name, path, pid, service_type, start_type, status, user_account FROM services\"}}\n      - !{osquery{\"label\":\"Osquery - Retrieve Services Running on User Accounts\",\"query\":\"SELECT description, display_name, name, path, pid, service_type, start_type, status, user_account FROM services WHERE\\nNOT (user_account LIKE '%LocalSystem' OR user_account LIKE '%LocalService' OR user_account LIKE '%NetworkService' OR\\nuser_account == null)\\n\"}}\n      - !{osquery{\"label\":\"Osquery - Retrieve Service Unsigned Executables with Virustotal Link\",\"query\":\"SELECT concat('https://www.virustotal.com/gui/file/', sha1) AS VtLink, name, description, start_type, status, pid,\\nservices.path FROM services JOIN authenticode ON services.path = authenticode.path OR services.module_path =\\nauthenticode.path JOIN hash ON services.path = hash.path WHERE authenticode.result != 'trusted'\\n\"}}\n- Investigate potentially compromised accounts. Analysts can do this by searching for login events (for example, 4624) to the host which is the source of this activity.\n\n### False positive analysis\n\n- Authentication misconfiguration or obsolete credentials.\n- Service account password expired.\n- Domain trust relationship issues.\n- Infrastructure or availability issues.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the source host to prevent further post-compromise behavior.\n- If the asset is exposed to the internet with RDP or other remote services available, take the necessary measures to restrict access to the asset. If not possible, limit the access via the firewall to only the needed IP addresses. Also, ensure the system uses robust authentication mechanisms and is patched regularly.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n","false_positives":[],"references":["https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4625"],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"b782649c-88a0-427f-a9c6-9a5b5769e1c0","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["logs-system.security*","logs-windows.forwarded*","winlogbeat-*"],"query":"sequence by winlog.computer_name, source.ip with maxspan=10s\n  [authentication where host.os.type == \"windows\" and\n    event.action == \"logon-failed\" and winlog.logon.type : \"Network\" and\n    source.ip != null and source.ip != \"127.0.0.1\" and source.ip != \"::1\" and user.name : \"*admin*\" and\n\n    /* noisy failure status codes often associated to authentication misconfiguration */\n    not winlog.event_data.Status : (\"0xC000015B\", \"0XC000005E\", \"0XC0000133\", \"0XC0000192\")] with runs=5\n"}
{"id":"cbd6642a-28d9-4c26-82b3-2299ed1cb3e3","rule_id":"a023b3a2-7d5e-49e7-8a50-9ec04096b5da","name":"T1074.001 – Staging Sensitive Files","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":3,"updated_at":"2025-12-08T21:59:26.406Z","updated_by":"aswin","created_at":"2025-12-02T17:15:10.209Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects the copying, moving, or creation of files in world-writable directories (/tmp, /dev/shm), specifically targeting sensitive file extensions.","tags":["MITRE","Linux","Auditbeat"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0009","name":"Collection","reference":"https://attack.mitre.org/tactics/TA0009/"},"technique":[{"id":"T1074","name":"Data Staged","reference":"https://attack.mitre.org/techniques/T1074/","subtechnique":[{"id":"T1074.001","name":"Local Data Staging","reference":"https://attack.mitre.org/techniques/T1074/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":75,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"b743a413-3949-450b-af38-04435ef2befe","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["auditbeat-*"],"query":"agent.type: \"auditbeat\" AND\nevent.action: \"executed\" AND\nprocess.name: (\"cp\" OR \"mv\" OR \"rsync\" OR \"cat\" OR \"dd\") AND\nprocess.args: (\"/tmp/*\" OR \"/var/tmp/*\" OR \"/dev/shm/*\" OR \"/run/shm/*\") AND\nprocess.args: (\n    \"*.tar.gz\" OR \"*.zip\" OR \"*.gz\" OR \"*.rar\" OR\n    \"*id_rsa*\" OR \"*.pem\" OR \"*.key\" OR\n    \"*.kdbx\" OR \"*.db\" OR \"*.sqlite\" OR\n    \"*.env\" OR \"*token*\" OR \"*secret*\" OR \"*password*\"\n) AND\nNOT process.args: (\n    \"/tmp/apt-key-gpghome*\" OR\n    \"/tmp/systemd-private-*\" OR\n    \"/var/tmp/systemd*\" OR\n    \"/var/tmp/snap.*\" OR\n    \"/var/tmp/apt-*\" OR\n    \"/tmp/krb5cc_*\" OR\n    \"/tmp/pip-*\" OR\n    \"/tmp/tmp.*\"\n) \n","filters":[]}
{"id":"825e891c-c55f-4603-a38f-3212931fee77","rule_id":"834f8750-9075-4e4b-87d4-f04129f18bd8","name":"Network Scanning with Nmap or Similar Tools","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.308Z","updated_by":"aswin","created_at":"2025-12-08T19:28:55.242Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects network scanning activity to gather victim host information (T1592)","tags":["MITRE"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0043","name":"Reconnaissance","reference":"https://attack.mitre.org/tactics/TA0043/"},"technique":[{"id":"T1592","name":"Gather Victim Host Information","reference":"https://attack.mitre.org/techniques/T1592/","subtechnique":[{"id":"T1592.002","name":"Software","reference":"https://attack.mitre.org/techniques/T1592/002/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*","auditbeat-*","zeek-*"],"query":"event.category: process AND event.type: start AND\n(\n  process.name: (\n    \"nmap\" OR \"masscan\" OR \"zmap\" OR \"unicornscan\" OR\n    \"nmap.exe\" OR \"masscan.exe\" OR \"angry_ip_scanner.exe\" OR\n    \"Advanced Port Scanner.exe\"\n  )\n  OR\n  process.command_line: (\n    \"*port*scan*\" OR \"*host*discovery*\" OR \"*-sS*\" OR \"*-sT*\" OR \"*-sU*\" OR\n    \"*-sV*\" OR \"*-O*\" OR \"*--script*\"\n  )\n)\nAND NOT user.name: (\"nessus\" OR \"qualys\" OR \"rapid7\" OR \"openvas\")\n","filters":[]}
{"id":"85e537fe-6ead-4c41-89c9-328fbec431cf","rule_id":"a5eb21b7-13cc-4b94-9fe2-29bb2914e037","name":"Potential Reverse Shell via UDP","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":10,"revision":1,"updated_at":"2025-12-05T18:48:21.138Z","updated_by":"aswin","created_at":"2025-12-03T15:25:39.819Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"This detection rule identifies suspicious network traffic patterns associated with UDP reverse shell activity. This activity consists of a sample of an execve, socket and connect syscall executed by the same process, where the auditd.data.a0-1 indicate a UDP connection, ending with an egress connection event. An attacker may establish a Linux UDP reverse shell to bypass traditional firewall restrictions and gain remote access to a target system covertly.","tags":["Data Source: Auditd Manager","Domain: Endpoint","OS: Linux","Use Case: Threat Detection","Tactic: Execution","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.004","name":"Unix Shell","reference":"https://attack.mitre.org/techniques/T1059/004/"}]}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0011","name":"Command and Control","reference":"https://attack.mitre.org/tactics/TA0011/"},"technique":[{"id":"T1071","name":"Application Layer Protocol","reference":"https://attack.mitre.org/techniques/T1071/"}]}],"related_integrations":[{"package":"auditd_manager","version":"^1.18.0"}],"required_fields":[{"name":"auditd.data.a1","type":"unknown","ecs":false},{"name":"auditd.data.syscall","type":"unknown","ecs":false},{"name":"destination.ip","type":"ip","ecs":true},{"name":"event.action","type":"keyword","ecs":true},{"name":"event.type","type":"keyword","ecs":true},{"name":"host.id","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"network.direction","type":"keyword","ecs":true},{"name":"process.name","type":"keyword","ecs":true},{"name":"process.parent.pid","type":"long","ecs":true},{"name":"process.pid","type":"long","ecs":true}],"setup":"## Setup\n\nThis rule requires data coming in from one of the following integrations:\n- Auditbeat\n- Auditd Manager\n\n### Auditbeat Setup\nAuditbeat is a lightweight shipper that you can install on your servers to audit the activities of users and processes on your systems. For example, you can use Auditbeat to collect and centralize audit events from the Linux Audit Framework. You can also use Auditbeat to detect changes to critical files, like binaries and configuration files, and identify potential security policy violations.\n\n#### The following steps should be executed in order to add the Auditbeat on a Linux System:\n- Elastic provides repositories available for APT and YUM-based distributions. Note that we provide binary packages, but no source packages.\n- To install the APT and YUM repositories follow the setup instructions in this [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/setup-repositories.html).\n- To run Auditbeat on Docker follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/running-on-docker.html).\n- To run Auditbeat on Kubernetes follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/running-on-kubernetes.html).\n- For complete “Setup and Run Auditbeat” information refer to the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/setting-up-and-running.html).\n\n### Auditd Manager Integration Setup\nThe Auditd Manager Integration receives audit events from the Linux Audit Framework which is a part of the Linux kernel.\nAuditd Manager provides a user-friendly interface and automation capabilities for configuring and monitoring system auditing through the auditd daemon. With `auditd_manager`, administrators can easily define audit rules, track system events, and generate comprehensive audit reports, improving overall security and compliance in the system.\n\n#### The following steps should be executed in order to add the Elastic Agent System integration \"auditd_manager\" on a Linux System:\n- Go to the Kibana home page and click “Add integrations”.\n- In the query bar, search for “Auditd Manager” and select the integration to see more details about it.\n- Click “Add Auditd Manager”.\n- Configure the integration name and optionally add a description.\n- Review optional and advanced settings accordingly.\n- Add the newly installed “auditd manager” to an existing or a new agent policy, and deploy the agent on a Linux system from which auditd log files are desirable.\n- Click “Save and Continue”.\n- For more details on the integration refer to the [helper guide](https://docs.elastic.co/integrations/auditd_manager).\n\n#### Rule Specific Setup Note\nAuditd Manager subscribes to the kernel and receives events as they occur without any additional configuration.\nHowever, if more advanced configuration is required to detect specific behavior, audit rules can be added to the integration in either the \"audit rules\" configuration box or the \"auditd rule files\" box by specifying a file to read the audit rules from.\n- For this detection rule no additional audit rules are required to be added to the integration.\n","note":"## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating Potential Reverse Shell via UDP\n\nReverse shells over UDP can be exploited by attackers to bypass firewalls and gain unauthorized access to systems. This technique leverages UDP's connectionless nature, making it harder to detect. Adversaries may use scripting languages or network tools to initiate these connections. The detection rule identifies suspicious processes executing network-related syscalls and egress connections, flagging potential reverse shell activity.\n\n### Possible investigation steps\n\n- Review the process details such as process.pid, process.parent.pid, and process.name to identify the specific process that triggered the alert and its parent process.\n- Examine the command line arguments and environment variables associated with the suspicious process to understand its intended function and origin.\n- Check the network connection details, including destination.ip and network.direction, to determine the external entity the process attempted to connect to and assess if it is a known malicious IP or domain.\n- Investigate the user account associated with the process to determine if it has been compromised or if there are any signs of unauthorized access.\n- Analyze historical logs for any previous instances of similar process executions or network connections to identify patterns or repeated attempts.\n- Correlate the alert with other security events or alerts from the same host.id to gather additional context and assess the scope of potential compromise.\n\n### False positive analysis\n\n- Legitimate administrative scripts or tools may trigger the rule if they use UDP for valid network operations. Users can create exceptions for specific scripts or processes that are known to perform routine administrative tasks.\n- Automated monitoring or network management tools that use UDP for health checks or status updates might be flagged. Identify these tools and exclude their process names or network patterns from the rule.\n- Development or testing environments where developers frequently use scripting languages or network tools for legitimate purposes can cause false positives. Consider excluding specific host IDs or process names associated with these environments.\n- Custom applications that use UDP for communication, especially if they are developed in-house, may be mistakenly identified. Review these applications and whitelist their process names or network behaviors if they are verified as safe.\n- Network scanning or diagnostic tools that use UDP for troubleshooting can be misinterpreted as malicious. Ensure these tools are recognized and excluded from the detection rule if they are part of regular network maintenance activities.\n\n### Response and remediation\n\n- Immediately isolate the affected host from the network to prevent further unauthorized access or data exfiltration.\n- Terminate any suspicious processes identified by the detection rule, particularly those associated with known reverse shell tools or scripting languages.\n- Conduct a forensic analysis of the affected system to identify any additional indicators of compromise, such as unauthorized user accounts or modified system files.\n- Review and update firewall rules to block outbound UDP traffic from unauthorized applications or processes, ensuring legitimate traffic is not disrupted.\n- Reset credentials for any accounts accessed from the affected host, especially if they have administrative privileges.\n- Escalate the incident to the security operations center (SOC) or incident response team for further investigation and to determine if other systems may be affected.\n- Implement enhanced monitoring and logging for similar suspicious activities, focusing on the execution of network-related syscalls and egress connections from scripting languages or network tools.","false_positives":[],"references":["https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md","https://www.elastic.co/security-labs/primer-on-persistence-mechanisms","https://www.elastic.co/security-labs/linux-detection-engineering-with-auditd"],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"25c5c5d1-a53e-41dd-831b-ed65431b9612","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["auditbeat-*","logs-auditd_manager.auditd-*"],"query":"sample by host.id, process.pid, process.parent.pid\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"executed\" and process.name : (\n    \"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\", \"perl\", \"python*\", \"nc\", \"ncat\", \"netcat\", \"php*\",\n    \"ruby\", \"openssl\", \"awk\", \"telnet\", \"lua*\", \"socat\"\n    )]\n  [process where host.os.type == \"linux\" and auditd.data.syscall == \"socket\" and process.name : (\n    \"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\", \"perl\", \"python*\", \"nc\", \"ncat\", \"netcat\", \"php*\",\n    \"ruby\", \"openssl\", \"awk\", \"telnet\", \"lua*\", \"socat\"\n    ) and auditd.data.a1 == \"2\"]\n  [network where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"connected-to\" and\n   process.name : (\n    \"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\", \"perl\", \"python*\", \"nc\", \"ncat\", \"netcat\", \"php*\",\n    \"ruby\", \"openssl\", \"awk\", \"telnet\", \"lua*\", \"socat\"\n    ) and network.direction == \"egress\" and destination.ip != null and\n   not cidrmatch(destination.ip, \"127.0.0.0/8\", \"169.254.0.0/16\", \"224.0.0.0/4\", \"::1\")]\n"}
{"id":"8c549de3-c674-48ed-8b65-05b1468dc716","rule_id":"229b5fdd-b2cf-4f28-9f5f-3a12b078bcdd","name":"SSH Distributed Brute Force","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":2,"updated_at":"2025-12-08T21:59:27.256Z","updated_by":"aswin","created_at":"2025-12-03T14:10:31.613Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Distributed Brute Force – Multiple IPs Targeting Same User","tags":[],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0006","name":"Credential Access","reference":"https://attack.mitre.org/tactics/TA0006/"},"technique":[{"id":"T1110","name":"Brute Force","reference":"https://attack.mitre.org/techniques/T1110/","subtechnique":[{"id":"T1110.001","name":"Password Guessing","reference":"https://attack.mitre.org/techniques/T1110/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"e9d91849-45de-478e-97a2-6225c94f0781","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"eql","language":"eql","index":["auditbeat-*"],"query":"sequence by user.name with maxspan=10m\n  [ authentication\n      where event.category == \"authentication\"\n      and event.outcome == \"failure\"\n      and event.type == \"authentication_failure\"\n  ] with runs=5\n","filters":[]}
{"id":"e125b673-d107-44be-85c9-8da876ccf6d4","rule_id":"aa896b9d-8efd-4070-a6f4-8432c2b72895","name":"DNS → Long DNS query (possible tunneling)","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.407Z","updated_by":"aswin","created_at":"2025-12-06T22:46:12.493Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Long subdomain / long first label","tags":[],"author":[],"license":"","threat":[],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"68531c6a-9a34-444d-875c-1c3e52833002","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["auditbeat-*","zeek-*"],"query":"event.dataset: \"zeek.dns\" and domain_length >= 60 and domain_entropy > 3\n","filters":[]}
{"id":"7e709951-7571-4c87-9a3e-9c2837fabacc","rule_id":"bf3ad3dc-b962-419c-9cf2-35bcbde1dee1","name":"UAC Disabled via Registry Modification (EnableLUA Set to 0)","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.237Z","updated_by":"aswin","created_at":"2025-12-08T21:23:32.234Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"This rule detects attempts to disable User Account Control (UAC) by setting the registry value EnableLUA to 0 under:\n\nHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System","tags":["MITRE","Kill_chain","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0004","name":"Privilege Escalation","reference":"https://attack.mitre.org/tactics/TA0004/"},"technique":[{"id":"T1548","name":"Abuse Elevation Control Mechanism","reference":"https://attack.mitre.org/techniques/T1548/","subtechnique":[{"id":"T1548.002","name":"Bypass User Account Control","reference":"https://attack.mitre.org/techniques/T1548/002/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:\"windows\" and\nprocess.command_line: *EnableLUA* and\nprocess.command_line: *Value* and\nprocess.command_line: *0*\n","filters":[]}
{"id":"65411c2e-57b2-4418-b45b-7c3da967b844","rule_id":"c1392880-df8a-43af-b46e-3f6717c65b16","name":"RunMRU Registry Modification for Mshta","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.383Z","updated_by":"aswin","created_at":"2025-12-08T06:47:27.307Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects SetItemProperty for RunMRU registry modification with mshta executable.\nAPT36 writes to HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU to store mshta.exe commands.\nWhen user opens Run dialog (Win+R), the MRU history is populated with malicious commands for quick execution.","tags":["MITRE","Windows","APT36"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1204","name":"User Execution","reference":"https://attack.mitre.org/techniques/T1204/","subtechnique":[{"id":"T1204.002","name":"Malicious File","reference":"https://attack.mitre.org/techniques/T1204/002/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"0dc70f9e-4493-4628-a68d-be4ef82ed0c4","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type: \"windows\" AND\nevent.code: \"600\" AND\n(\n  process.command_line: (*Set-ItemProperty* OR *New-ItemProperty* OR *Set-Item*) AND\n  (    (process.command_line: *RunMRU* AND \n     process.command_line: (*mshta* OR *http* OR *.hta*)) OR\n    \n    (process.command_line: (*\\\\Run* OR *\\\\RunOnce*) AND\n     process.command_line: (*mshta* OR *rundll32* OR *regsvr32*)) OR\n    \n    (process.command_line: *\\\\Startup\\\\* AND\n     process.command_line: (*.hta* OR *.vbs* OR *.js*)) OR\n    \n    (process.command_line: *Userinit* AND\n     process.command_line: *mshta*)\n  )\n)","filters":[]}
{"id":"6054bf42-a01b-44de-b28e-6c74984887ca","rule_id":"0d878853-425a-46db-8dee-f210d53dc1cc","name":"Suspicious BAT File Download and Execution via PowerShell","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.415Z","updated_by":"aswin","created_at":"2025-12-08T11:27:54.689Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects PowerShell downloading a BAT file to the TEMP directory and immediately executing it, a technique commonly associated with ClickFix social engineering campaigns. Attackers use this method to trick users into executing malicious batch scripts that appear to be legitimate troubleshooting solutions. This behavior is highly suspicious as legitimate administrative scripts rarely combine web downloads with immediate batch file execution in TEMP directories.","tags":["MITRE","APT36","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1204","name":"User Execution","reference":"https://attack.mitre.org/techniques/T1204/","subtechnique":[{"id":"T1204.002","name":"Malicious File","reference":"https://attack.mitre.org/techniques/T1204/002/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}"}]},"action_type_id":".index","uuid":"aa736871-abfd-46de-b4ed-0231f0c2286f","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:\"windows\" AND event.code:\"600\" AND process.command_line:(*Invoke-WebRequest* OR *iwr*) AND process.command_line:(*-Uri* OR *-OutFile*) AND process.command_line:*-UseBasicParsing* AND process.command_line:(*$env\\:TEMP* OR *%TEMP%*) AND process.command_line:*.bat* AND process.command_line:*Start-Process* AND process.command_line:(*-FilePath* OR *-PassThru*)","filters":[]}
{"id":"8f6ffcca-9992-4930-95e2-d7dfd4c327fd","rule_id":"e989ede5-7ae5-41ff-bbfe-d4e095b1b771","name":"PowerShell Decrypting Encrypted Payload via SecureString","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.408Z","updated_by":"aswin","created_at":"2025-12-08T06:03:17.470Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects PowerShell activity where an encrypted or encoded payload is decrypted using ConvertTo-SecureString -Key and SecureStringToBSTR, a technique commonly used by malware to unpack hidden payloads. This behavior aligns with MITRE ATT&CK technique T1027.013 – Encrypted/Encoded Files, often used to evade detection by decrypting malicious content at runtime.","tags":["MITRE","APT36","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1027","name":"Obfuscated Files or Information","reference":"https://attack.mitre.org/techniques/T1027/","subtechnique":[{"id":"T1027.013","name":"Encrypted/Encoded File","reference":"https://attack.mitre.org/techniques/T1027/013/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"73a8762f-e771-413c-b130-e7616aa62814","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type: \"windows\" AND\nevent.code: \"600\" AND\n(\n  (\n    process.command_line: *ConvertTo-SecureString* AND\n    process.command_line: *-Key* AND\n    process.command_line: (*SecureStringToBSTR* OR *PtrToStringBSTR*)\n  )\n  OR\n  (\n    process.command_line: *Runtime.InteropServices.Marshal* AND\n    process.command_line: *SecureStringToBSTR* AND\n    process.command_line: (*Out-File* OR *Set-Content* OR *Add-Content*)\n  )\n  OR\n  (\n    process.command_line: *ConvertTo-SecureString* AND\n    process.command_line: *[byte]* AND\n    process.command_line: (*PtrToStringBSTR* OR *PtrToStringUni* OR *PtrToStringAnsi*)\n  )\n)","filters":[]}
{"id":"4c3a015a-7d19-4cca-a3d0-948de3402ea3","rule_id":"08c86b70-1746-43f8-a5c0-465a21864392","name":"Masquerading via Add-Type OutputAssembly","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.423Z","updated_by":"aswin","created_at":"2025-12-06T22:59:55.751Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects masquerading via Add-Type -OutputAssembly to create fake system executables.\nAPT36 uses Add-Type to compile C# code and output to Windows\\Temp with system executable names (svchost.exe, etc).\nThis technique masks malware as legitimate system processes by placing imposters in temp directories.","tags":["MITRE","Windows","APT36"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1036","name":"Masquerading","reference":"https://attack.mitre.org/techniques/T1036/","subtechnique":[{"id":"T1036.005","name":"Match Legitimate Resource Name or Location","reference":"https://attack.mitre.org/techniques/T1036/005/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"d7fc6774-59f0-48d4-9d47-a7e34b8c7ca5","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.1.21:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and event.code:4104 and\npowershell.file.script_block_text:*Add-Type* and\npowershell.file.script_block_text:*-OutputAssembly* and\npowershell.file.script_block_text:*Temp* and\n(\n  powershell.file.script_block_text:(\n    *svchost.exe* or *lsass.exe* or *services.exe* or *csrss.exe* or \n    *explorer.exe* or *rundll32.exe* or *regsvr32.exe* or *mshta.exe*\n  )\n) and\n(\n  powershell.file.script_block_text:(*public* or *class* or *Main* or *System.Console*)\n)","filters":[]}
{"id":"72826762-cd92-4d8e-9f51-13fac0c2dc24","rule_id":"70f85135-9364-4797-b9f0-dbfbc81687c7","name":"Excel4MacroSheets XLM Creation","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.414Z","updated_by":"aswin","created_at":"2025-12-08T06:59:05.541Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects Excel4MacroSheets creation and XLM macro execution via PowerShell COM object.\nAPT36 creates Excel 4 Macros (XLM) programmatically using Excel.Application COM object.\nXLM macros bypass modern macro security controls and can download files, execute commands, and persist.","tags":["MITRE","Windows","APT36"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1204","name":"User Execution","reference":"https://attack.mitre.org/techniques/T1204/","subtechnique":[{"id":"T1204.002","name":"Malicious File","reference":"https://attack.mitre.org/techniques/T1204/002/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"88226724-381a-4254-86b7-04cf3d6c965c","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type: \"windows\" AND\nevent.code: \"4104\" AND\nevent.provider: \"Microsoft-Windows-PowerShell\" AND\n(\n  (message: *Excel4MacroSheets.Add* AND message: *Cells.Item*) OR\n  \n  (message: *Excel.Application* AND message: *FOPEN* AND message: *FWRITELN*) OR\n  \n  (message: *Excel4MacroSheets* AND message: *EXEC* AND message: *FCLOSE*)\n)","filters":[]}
{"id":"e88b42d5-e832-4111-856a-b1ad9f32df2c","rule_id":"2b0fd167-2817-4dfe-8a71-b77db8272cdc","name":"TI Match – Malicious IP","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":6,"updated_at":"2025-12-08T21:59:26.419Z","updated_by":"aswin","created_at":"2025-12-01T15:36:40.119Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Identify Malacious IPS","tags":["ThreatIntel"],"author":[],"license":"","threat":[],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"3ca92d52-3ba5-4bd6-a337-9592be04f3cc","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"threat_match","language":"kuery","index":["auditbeat-*","winlogbeat-*","pfsense-*","zeek-*","ubuntu-auditd*"],"query":"*:*","filters":[],"threat_filters":[],"threat_query":"@timestamp >= \"now-30d/d\"","threat_mapping":[{"entries":[{"field":"source.ip","type":"mapping","value":"threat.indicator.ip","negate":false}]},{"entries":[{"field":"destination.ip","type":"mapping","value":"threat.indicator.ip","negate":false}]},{"entries":[{"field":"client.ip","type":"mapping","value":"threat.indicator.ip","negate":false}]},{"entries":[{"field":"destination.as.ip","type":"mapping","value":"threat.indicator.url.domain","negate":false}]},{"entries":[{"field":"destination.ip","type":"mapping","value":"threat.indicator.url.domain","negate":false}]}],"threat_language":"kuery","threat_index":["logs-ti_*"],"threat_indicator_path":"threat.indicator"}
{"id":"535d0c4f-7dd3-4ada-80fa-e03842b40660","rule_id":"5b8d7b94-23c6-4e3f-baed-3a4d0da4f19d","name":"Successful SSH Authentication from Unusual User","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":3,"revision":0,"updated_at":"2025-12-08T19:33:26.780Z","updated_by":"aswin","created_at":"2025-12-08T19:33:24.691Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"This rule leverages the new_terms rule type to detect successful SSH authentications by a user who has not been authenticated in the last 10 days. This behavior may indicate an attacker attempting to gain access to the system using a valid account.","tags":["Domain: Endpoint","OS: Linux","Use Case: Threat Detection","Tactic: Initial Access","Data Source: Elastic Defend","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0001","name":"Initial Access","reference":"https://attack.mitre.org/tactics/TA0001/"},"technique":[{"id":"T1078","name":"Valid Accounts","reference":"https://attack.mitre.org/techniques/T1078/"}]}],"related_integrations":[{"package":"system","version":"^2.0.0"}],"required_fields":[{"name":"event.action","type":"keyword","ecs":true},{"name":"event.category","type":"keyword","ecs":true},{"name":"event.outcome","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true}],"setup":"","note":" ## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating Successful SSH Authentication from Unusual User\n\nSSH (Secure Shell) is a protocol used to securely access and manage Linux systems. Adversaries may exploit valid user accounts to gain unauthorized access, bypassing traditional security measures. The detection rule identifies unusual SSH logins by flagging users who haven't logged in for over 10 days, indicating potential misuse of credentials. This proactive approach helps in early detection of unauthorized access attempts.\n\n### Possible investigation steps\n\n- Review the specific user account involved in the alert to determine if the login is expected or authorized, considering the user's typical login patterns and responsibilities.\n- Check the source IP address of the SSH login to see if it is recognized or associated with previous legitimate access, or if it appears unusual or suspicious.\n- Analyze the timing of the login event to see if it coincides with any known maintenance windows or scheduled activities that could explain the access.\n- Investigate any recent changes to the user's account, such as password resets or modifications to permissions, that could indicate potential compromise.\n- Correlate the SSH login event with other logs or alerts from the same timeframe to identify any additional suspicious activities or patterns that could suggest a broader security incident.\n\n### False positive analysis\n\n- Users returning from extended leave or vacation may trigger the rule. To manage this, create exceptions for users with known absence periods.\n- System administrators or service accounts that log in infrequently for maintenance tasks can be excluded by identifying and documenting these accounts.\n- Automated scripts or processes that authenticate sporadically might be flagged. Review and whitelist these processes if they are legitimate and necessary for operations.\n- Temporary contractors or consultants with limited access periods may cause alerts. Ensure their access is documented and create exceptions for their accounts during their engagement period.\n- Accounts used for testing or development purposes that are not regularly active can be excluded by maintaining a list of such accounts and updating it as needed.\n\n### Response and remediation\n\n- Immediately isolate the affected system from the network to prevent further unauthorized access or lateral movement by the attacker.\n- Terminate the active SSH session associated with the unusual login to cut off the attacker's access.\n- Reset the password for the compromised user account and any other accounts that may have been accessed using the same credentials.\n- Conduct a thorough review of the affected system's logs and configurations to identify any unauthorized changes or additional compromised accounts.\n- Escalate the incident to the security operations team for further investigation and to determine if additional systems or accounts have been affected.\n- Implement multi-factor authentication (MFA) for SSH access to enhance security and prevent similar unauthorized access attempts in the future.\n- Update and enhance monitoring rules to detect similar unusual login patterns, ensuring early detection of potential threats.\n","false_positives":["This rule may trigger in cases where a user has routine work patterns that result in infrequent authentications."],"references":[],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"type":"new_terms","query":"event.category:authentication and host.os.type:linux and event.action:ssh_login and event.outcome:success\n","new_terms_fields":["related.user"],"history_window_start":"now-10d","index":["logs-system.auth-*","filebeat-*"],"language":"kuery"}
{"id":"ca4abeb4-3dee-4d82-9c6f-a9cb2ae3e1dc","rule_id":"2f8a1226-5720-437d-9c20-e0029deb6194","name":"Attempt to Disable Syslog Service","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":215,"revision":1,"updated_at":"2025-12-05T18:48:21.659Z","updated_by":"aswin","created_at":"2025-12-03T17:25:33.232Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Adversaries may attempt to disable the syslog service in an attempt to an attempt to disrupt event logging and evade detection by security controls.","tags":["Domain: Endpoint","OS: Linux","Use Case: Threat Detection","Tactic: Defense Evasion","Data Source: Elastic Endgame","Data Source: Elastic Defend","Data Source: Crowdstrike","Data Source: SentinelOne","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1562","name":"Impair Defenses","reference":"https://attack.mitre.org/techniques/T1562/","subtechnique":[{"id":"T1562.001","name":"Disable or Modify Tools","reference":"https://attack.mitre.org/techniques/T1562/001/"}]}]}],"related_integrations":[{"package":"endpoint","version":"^9.0.0"},{"package":"crowdstrike","version":"^2.0.0"},{"package":"sentinel_one_cloud_funnel","version":"^1.9.0"}],"required_fields":[{"name":"event.action","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.args","type":"keyword","ecs":true},{"name":"process.name","type":"keyword","ecs":true},{"name":"process.parent.name","type":"keyword","ecs":true}],"setup":"## Setup\n\nThis rule requires data coming in from one of the following integrations:\n- Elastic Defend\n- Auditbeat\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n\n### Auditbeat Setup\nAuditbeat is a lightweight shipper that you can install on your servers to audit the activities of users and processes on your systems. For example, you can use Auditbeat to collect and centralize audit events from the Linux Audit Framework. You can also use Auditbeat to detect changes to critical files, like binaries and configuration files, and identify potential security policy violations.\n\n#### The following steps should be executed in order to add the Auditbeat on a Linux System:\n- Elastic provides repositories available for APT and YUM-based distributions. Note that we provide binary packages, but no source packages.\n- To install the APT and YUM repositories follow the setup instructions in this [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/setup-repositories.html).\n- To run Auditbeat on Docker follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/running-on-docker.html).\n- To run Auditbeat on Kubernetes follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/running-on-kubernetes.html).\n- For complete “Setup and Run Auditbeat” information refer to the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/setting-up-and-running.html).\n","note":"## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating Attempt to Disable Syslog Service\n\nSyslog is a critical component in Linux environments, responsible for logging system events and activities. Adversaries may target syslog to disable logging, thereby evading detection and obscuring their malicious actions. The detection rule identifies attempts to stop or disable syslog services by monitoring specific process actions and arguments, flagging suspicious commands that could indicate an attempt to impair logging defenses.\n\n### Possible investigation steps\n\n- Review the process details to identify the user account associated with the command execution, focusing on the process.name and process.args fields to determine if the action was legitimate or suspicious.\n- Check the system's recent login history and user activity to identify any unauthorized access attempts or anomalies around the time the syslog service was targeted.\n- Investigate the parent process of the flagged command to understand the context of its execution and determine if it was initiated by a legitimate application or script.\n- Examine other logs and alerts from the same host around the time of the event to identify any correlated suspicious activities or patterns that might indicate a broader attack.\n- Assess the system for any signs of compromise, such as unexpected changes in configuration files, unauthorized software installations, or unusual network connections, to determine if the attempt to disable syslog is part of a larger attack.\n\n### False positive analysis\n\n- Routine maintenance activities may trigger this rule, such as scheduled service restarts or system updates. To manage this, create exceptions for known maintenance windows or specific administrative accounts performing these tasks.\n- Automated scripts or configuration management tools like Ansible or Puppet might stop or disable syslog services as part of their operations. Identify these scripts and whitelist their execution paths or associated user accounts.\n- Testing environments often simulate service disruptions, including syslog, for resilience testing. Exclude these environments from the rule or adjust the rule to ignore specific test-related processes.\n- Some legitimate software installations or updates may require stopping syslog services temporarily. Monitor installation logs and exclude these processes if they are verified as non-threatening.\n- In environments with multiple syslog implementations, ensure that the rule is not overly broad by refining the process arguments to match only the specific syslog services in use.\n\n### Response and remediation\n\n- Immediately isolate the affected system from the network to prevent further malicious activity and potential lateral movement by the adversary.\n- Terminate any suspicious processes identified in the alert, specifically those attempting to stop or disable syslog services, to restore normal logging functionality.\n- Restart the syslog service on the affected system to ensure that logging is re-enabled and operational, using commands like `systemctl start syslog` or `service syslog start`.\n- Conduct a thorough review of recent logs, if available, to identify any additional suspicious activities or indicators of compromise that may have occurred prior to the syslog service being disabled.\n- Escalate the incident to the security operations team for further investigation and to determine if the attack is part of a larger campaign or if other systems are affected.\n- Implement additional monitoring on the affected system and similar systems to detect any further attempts to disable logging services, using enhanced logging and alerting mechanisms.\n- Review and update access controls and permissions to ensure that only authorized personnel have the ability to modify or stop critical services like syslog, reducing the risk of future incidents.","false_positives":[],"references":["https://www.elastic.co/security-labs/detecting-log4j2-with-elastic-security"],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"22524949-e9e9-4d40-b8bb-9dd1be1ab156","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["auditbeat-*","endgame-*","logs-crowdstrike.fdr*","logs-endpoint.events.process*","logs-sentinel_one_cloud_funnel.*"],"query":"process where host.os.type == \"linux\" and event.action in (\"exec\", \"exec_event\", \"start\", \"ProcessRollup2\") and\n ( (process.name == \"service\" and process.args == \"stop\") or\n   (process.name == \"chkconfig\" and process.args == \"off\") or\n   (process.name == \"systemctl\" and process.args in (\"disable\", \"stop\", \"kill\"))\n ) and process.args in (\"syslog\", \"rsyslog\", \"syslog-ng\", \"syslog.service\", \"rsyslog.service\", \"syslog-ng.service\") and\nnot (\n  process.parent.name == \"rsyslog-rotate\" or\n  process.args == \"HUP\"\n)\n"}
{"id":"7fc185d4-b8d3-4d17-a24c-09472f4319c1","rule_id":"871ea072-1b71-4def-b016-6278b505138d","name":"Enumeration of Administrator Accounts","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":218,"revision":1,"updated_at":"2025-12-05T18:48:20.797Z","updated_by":"aswin","created_at":"2025-12-04T15:10:19.155Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Identifies instances of lower privilege accounts enumerating Administrator accounts or groups using built-in Windows tools.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Discovery","Resources: Investigation Guide","Data Source: Elastic Endgame","Data Source: Elastic Defend","Data Source: Windows Security Event Logs","Data Source: Microsoft Defender for Endpoint","Data Source: Crowdstrike"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0007","name":"Discovery","reference":"https://attack.mitre.org/tactics/TA0007/"},"technique":[{"id":"T1069","name":"Permission Groups Discovery","reference":"https://attack.mitre.org/techniques/T1069/","subtechnique":[{"id":"T1069.001","name":"Local Groups","reference":"https://attack.mitre.org/techniques/T1069/001/"},{"id":"T1069.002","name":"Domain Groups","reference":"https://attack.mitre.org/techniques/T1069/002/"}]},{"id":"T1087","name":"Account Discovery","reference":"https://attack.mitre.org/techniques/T1087/","subtechnique":[{"id":"T1087.001","name":"Local Account","reference":"https://attack.mitre.org/techniques/T1087/001/"},{"id":"T1087.002","name":"Domain Account","reference":"https://attack.mitre.org/techniques/T1087/002/"}]}]}],"related_integrations":[{"package":"endpoint","version":"^9.0.0"},{"package":"windows","version":"^3.0.0"},{"package":"system","version":"^2.0.0"},{"package":"m365_defender","version":"^5.0.0"},{"package":"crowdstrike","version":"^2.0.0"}],"required_fields":[{"name":"event.type","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.args","type":"keyword","ecs":true},{"name":"process.name","type":"keyword","ecs":true},{"name":"process.parent.name","type":"keyword","ecs":true},{"name":"process.pe.original_file_name","type":"keyword","ecs":true},{"name":"user.id","type":"keyword","ecs":true}],"setup":"","note":"## Triage and analysis\n\n### Investigating Enumeration of Administrator Accounts\n\nAfter successfully compromising an environment, attackers may try to gain situational awareness to plan their next steps. This can happen by running commands to enumerate network resources, users, connections, files, and installed security software.\n\nThis rule looks for the execution of the `net` and `wmic` utilities to enumerate administrator-related users or groups in the domain and local machine scope. Attackers can use this information to plan their next steps of the attack, such as mapping targets for credential compromise and other post-exploitation activities.\n\n#### Possible investigation steps\n\n- Investigate the process execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n- Identify the user account that performed the action and whether it should perform this kind of action.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Investigate any abnormal account behavior, such as command executions, file creations or modifications, and network connections.\n\n### False positive analysis\n\n- Discovery activities are not inherently malicious if they occur in isolation. As long as the analyst did not identify suspicious activity related to the user or host, such alerts can be dismissed.\n\n### Related rules\n\n- AdFind Command Activity - eda499b8-a073-4e35-9733-22ec71f57f3a\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved hosts to prevent further post-compromise behavior.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n","false_positives":[],"references":[],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"e305c24b-4151-44cf-af28-ade6b2b15ab4","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["endgame-*","logs-crowdstrike.fdr*","logs-endpoint.events.process-*","logs-m365_defender.event-*","logs-system.security*","logs-windows.forwarded*","winlogbeat-*"],"query":"process where host.os.type == \"windows\" and event.type == \"start\" and\n(\n  (\n    (\n      (process.name : \"net.exe\" or ?process.pe.original_file_name == \"net.exe\") or\n      ((process.name : \"net1.exe\" or ?process.pe.original_file_name == \"net1.exe\") and not process.parent.name : \"net.exe\")\n    ) and\n    process.args : (\"group\", \"user\", \"localgroup\") and\n    process.args : (\"*admin*\", \"Domain Admins\", \"Remote Desktop Users\", \"Enterprise Admins\", \"Organization Management\")\n    and not process.args : (\"/add\", \"/delete\")\n  ) or\n  (\n    (process.name : \"wmic.exe\" or ?process.pe.original_file_name == \"wmic.exe\") and\n    process.args : (\"group\", \"useraccount\")\n  )\n) and not user.id : (\"S-1-5-18\", \"S-1-5-19\", \"S-1-5-20\")\n"}
{"id":"82541ee5-bb02-4073-97d1-8276a7483755","rule_id":"92a6faf5-78ec-4e25-bea1-73bacc9b59d9","name":"A scheduled task was created","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":114,"revision":1,"updated_at":"2025-12-05T18:48:21.667Z","updated_by":"aswin","created_at":"2025-12-04T15:05:51.598Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Indicates the creation of a scheduled task using Windows event logs. Adversaries can use these to establish persistence, move laterally, and/or escalate privileges.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Persistence","Data Source: Windows Security Event Logs","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0003","name":"Persistence","reference":"https://attack.mitre.org/tactics/TA0003/"},"technique":[{"id":"T1053","name":"Scheduled Task/Job","reference":"https://attack.mitre.org/techniques/T1053/","subtechnique":[{"id":"T1053.005","name":"Scheduled Task","reference":"https://attack.mitre.org/techniques/T1053/005/"}]}]}],"related_integrations":[{"package":"system","version":"^2.0.0"},{"package":"windows","version":"^3.0.0"}],"required_fields":[{"name":"event.action","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"user.name","type":"keyword","ecs":true},{"name":"winlog.event_data.TaskName","type":"unknown","ecs":false}],"setup":"","note":"## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating A scheduled task was created\n\nScheduled tasks in Windows automate routine tasks, enhancing efficiency. However, adversaries exploit this feature to maintain persistence, move laterally, or escalate privileges by creating malicious tasks. The detection rule identifies suspicious task creation by filtering out benign tasks and those initiated by system accounts, focusing on potential threats. This approach helps security analysts pinpoint unauthorized task creation indicative of malicious activity.\n\n### Possible investigation steps\n\n- Review the user account associated with the task creation to determine if it is a known and authorized user, ensuring it is not a system account by checking that the username does not end with a dollar sign.\n- Examine the task name and path in the event data to identify if it matches any known benign tasks or if it appears suspicious or unfamiliar.\n- Investigate the origin of the task creation by checking the source IP address or hostname, if available, to determine if it aligns with expected network activity.\n- Check the task's scheduled actions and triggers to understand what the task is designed to execute and when, looking for any potentially harmful or unexpected actions.\n- Correlate the task creation event with other security events or logs around the same time to identify any related suspicious activities or anomalies.\n\n### False positive analysis\n\n- Scheduled tasks created by system accounts or computer accounts are often benign. These can be excluded by filtering out user names ending with a dollar sign, which typically represent system accounts.\n- Tasks associated with common software updates or maintenance, such as those from Hewlett-Packard or Microsoft Visual Studio, are generally non-threatening. These can be excluded by specifying their full task names in the exclusion list.\n- OneDrive update tasks are frequently triggered and are usually safe. Exclude these by using patterns that match their task names, such as those starting with \"OneDrive Standalone Update Task\".\n- Regularly review and update the exclusion list to include any new benign tasks that are identified over time, ensuring that the rule remains effective without generating unnecessary alerts.\n\n### Response and remediation\n\n- Immediately isolate the affected system from the network to prevent potential lateral movement by the adversary.\n- Terminate any suspicious scheduled tasks identified by the alert to halt any ongoing malicious activity.\n- Conduct a thorough review of the system's scheduled tasks to identify and remove any other unauthorized or suspicious tasks.\n- Restore the system from a known good backup if any malicious activity has been confirmed and has potentially compromised system integrity.\n- Update and patch the system to the latest security standards to close any vulnerabilities that may have been exploited.\n- Monitor the system and network for any signs of re-infection or further unauthorized scheduled task creation.\n- Escalate the incident to the security operations center (SOC) or incident response team for further investigation and to determine if additional systems are affected.","false_positives":["Legitimate scheduled tasks may be created during installation of new software."],"references":["https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4698"],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"9efcdacf-db0e-489c-a02a-49ba9bb1daed","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["logs-system.security*","logs-windows.forwarded*","winlogbeat-*"],"query":"iam where host.os.type == \"windows\" and event.action == \"scheduled-task-created\" and\n\n /* excluding tasks created by the computer account */\n not user.name : \"*$\" and\n\n /* TaskContent is not parsed, exclude by full taskname noisy ones */\n not winlog.event_data.TaskName : (\n              \"\\\\CreateExplorerShellUnelevatedTask\",\n              \"\\\\Hewlett-Packard\\\\HPDeviceCheck\",\n              \"\\\\Hewlett-Packard\\\\HP Support Assistant\\\\WarrantyChecker\",\n              \"\\\\Hewlett-Packard\\\\HP Support Assistant\\\\WarrantyChecker_backup\",\n              \"\\\\Hewlett-Packard\\\\HP Web Products Detection\",\n              \"\\\\Microsoft\\\\VisualStudio\\\\Updates\\\\BackgroundDownload\",\n              \"\\\\OneDrive Standalone Update Task-S-1-5-21*\",\n              \"\\\\OneDrive Standalone Update Task-S-1-12-1-*\"\n )\n"}
{"id":"268f3539-8cd7-4158-9b42-31bd58e94faa","rule_id":"afcce5ad-65de-4ed2-8516-5e093d3ac99a","name":"Local Scheduled Task Creation","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":212,"revision":1,"updated_at":"2025-12-05T18:48:20.693Z","updated_by":"aswin","created_at":"2025-12-04T16:38:47.873Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Indicates the creation of a scheduled task. Adversaries can use these to establish persistence, move laterally, and/or escalate privileges.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Persistence","Data Source: Elastic Defend","Data Source: Sysmon","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0003","name":"Persistence","reference":"https://attack.mitre.org/tactics/TA0003/"},"technique":[{"id":"T1053","name":"Scheduled Task/Job","reference":"https://attack.mitre.org/techniques/T1053/","subtechnique":[{"id":"T1053.005","name":"Scheduled Task","reference":"https://attack.mitre.org/techniques/T1053/005/"}]}]}],"related_integrations":[{"package":"endpoint","version":"^9.0.0"},{"package":"windows","version":"^3.0.0"}],"required_fields":[{"name":"event.type","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.Ext.token.integrity_level_name","type":"unknown","ecs":false},{"name":"process.args","type":"keyword","ecs":true},{"name":"process.code_signature.trusted","type":"boolean","ecs":true},{"name":"process.entity_id","type":"keyword","ecs":true},{"name":"process.name","type":"keyword","ecs":true},{"name":"process.parent.entity_id","type":"keyword","ecs":true},{"name":"process.pe.original_file_name","type":"keyword","ecs":true},{"name":"winlog.event_data.IntegrityLevel","type":"keyword","ecs":false}],"setup":"","note":"## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating Local Scheduled Task Creation\n\nScheduled tasks in Windows automate routine tasks, but adversaries exploit them for persistence, lateral movement, or privilege escalation. They may use command-line tools like `schtasks.exe` to create tasks under non-system accounts. The detection rule identifies suspicious task creation by monitoring specific processes and command-line arguments, excluding those initiated by system-level users, to flag potential misuse.\n\n### Possible investigation steps\n\n- Review the process entity ID to identify the parent process that initiated the scheduled task creation. This can provide context on whether the task was created by a legitimate application or a potentially malicious one.\n- Examine the command-line arguments used with schtasks.exe, specifically looking for unusual or suspicious parameters that might indicate malicious intent, such as unexpected task names or execution paths.\n- Check the user account associated with the task creation to determine if it is a non-system account and assess whether this account should have the capability to create scheduled tasks.\n- Investigate the integrity level of the process to confirm it is not running with elevated privileges, which could indicate an attempt to bypass security controls.\n- Correlate the event with other recent activities on the host, such as file modifications or network connections, to identify any patterns or additional indicators of compromise.\n- Review the code signature of the initiating process to determine if it is trusted or untrusted, which can help assess the legitimacy of the process creating the task.\n\n### False positive analysis\n\n- Scheduled tasks created by legitimate administrative tools or scripts may trigger false positives. Users should identify and whitelist these known benign processes to prevent unnecessary alerts.\n- Routine maintenance tasks initiated by IT departments, such as software updates or system checks, can be mistaken for suspicious activity. Exclude these tasks by specifying their unique process names or command-line arguments.\n- Tasks created by trusted third-party applications for legitimate purposes might be flagged. Review and exclude these applications by verifying their code signatures and adding them to an exception list.\n- Automated tasks set up by non-system accounts for regular operations, like backups or monitoring, can be misinterpreted. Document these tasks and exclude them based on their specific parameters or user accounts involved.\n- Consider excluding tasks with a consistent and verified schedule that aligns with organizational policies, as these are less likely to be malicious.\n\n### Response and remediation\n\n- Immediately isolate the affected system from the network to prevent potential lateral movement by the adversary.\n- Terminate any suspicious scheduled tasks identified by the alert using Task Scheduler or command-line tools like schtasks.exe to stop further execution.\n- Review and remove any unauthorized scheduled tasks created by non-system accounts to eliminate persistence mechanisms.\n- Conduct a thorough scan of the affected system using updated antivirus or endpoint detection and response (EDR) tools to identify and remove any additional malicious artifacts.\n- Analyze the user account involved in the task creation for signs of compromise, and reset credentials if necessary to prevent further unauthorized access.\n- Escalate the incident to the security operations center (SOC) or incident response team for further investigation and to determine if additional systems are affected.\n- Implement enhanced monitoring and logging for scheduled task creation events to detect similar threats in the future, ensuring alerts are configured to notify the appropriate teams promptly.","false_positives":["Legitimate scheduled tasks may be created during installation of new software."],"references":["https://www.elastic.co/security-labs/hunting-for-persistence-using-elastic-security-part-1","https://www.elastic.co/security-labs/hunting-for-persistence-using-elastic-security-part-2","https://www.elastic.co/security-labs/invisible-miners-unveiling-ghostengine","https://www.elastic.co/security-labs/elastic-protects-against-data-wiper-malware-targeting-ukraine-hermeticwiper"],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"be248b50-0a45-42ab-a94b-fe04d6ddfd11","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["winlogbeat-*","logs-endpoint.events.process-*","logs-windows.sysmon_operational-*"],"query":"sequence with maxspan=1m\n  [process where host.os.type == \"windows\" and event.type == \"start\" and\n    ((process.name : (\"cmd.exe\", \"wscript.exe\", \"rundll32.exe\", \"regsvr32.exe\", \"wmic.exe\", \"mshta.exe\",\n                      \"powershell.exe\", \"pwsh.exe\", \"powershell_ise.exe\", \"WmiPrvSe.exe\", \"wsmprovhost.exe\", \"winrshost.exe\") or\n    process.pe.original_file_name : (\"cmd.exe\", \"wscript.exe\", \"rundll32.exe\", \"regsvr32.exe\", \"wmic.exe\", \"mshta.exe\",\n                                     \"powershell.exe\", \"pwsh.dll\", \"powershell_ise.exe\", \"WmiPrvSe.exe\", \"wsmprovhost.exe\",\n                                     \"winrshost.exe\")) or\n    ?process.code_signature.trusted == false)] by process.entity_id\n  [process where host.os.type == \"windows\" and event.type == \"start\" and\n    (process.name : \"schtasks.exe\" or process.pe.original_file_name == \"schtasks.exe\") and\n    process.args : (\"/create\", \"-create\") and process.args : (\"/RU\", \"/SC\", \"/TN\", \"/TR\", \"/F\", \"/XML\") and\n    /* exclude SYSTEM Integrity Level - look for task creations by non-SYSTEM user */\n    not (?process.Ext.token.integrity_level_name : \"System\" or ?winlog.event_data.IntegrityLevel : \"System\")\n  ] by process.parent.entity_id\n"}
{"id":"50efe9ff-78f6-4376-a9b5-95d9e59ebc4b","rule_id":"4d4c35f4-414e-4d0c-bb7e-6db7c80a6957","name":"Kernel Load or Unload via Kexec Detected","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":111,"revision":1,"updated_at":"2025-12-05T18:48:21.641Z","updated_by":"aswin","created_at":"2025-12-03T17:18:11.748Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"This detection rule identifies the usage of kexec, helping to uncover unauthorized kernel replacements and potential compromise of the system's integrity. Kexec is a Linux feature that enables the loading and execution of a different kernel without going through the typical boot process. Malicious actors can abuse kexec to bypass security measures, escalate privileges, establish persistence or hide their activities by loading a malicious kernel, enabling them to tamper with the system's trusted state, allowing e.g. a VM Escape.","tags":["Domain: Endpoint","OS: Linux","Use Case: Threat Detection","Tactic: Persistence","Tactic: Privilege Escalation","Tactic: Defense Evasion","Data Source: Elastic Defend","Data Source: Elastic Endgame","Data Source: Auditd Manager","Data Source: Crowdstrike","Data Source: SentinelOne","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0004","name":"Privilege Escalation","reference":"https://attack.mitre.org/tactics/TA0004/"},"technique":[{"id":"T1611","name":"Escape to Host","reference":"https://attack.mitre.org/techniques/T1611/"}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0003","name":"Persistence","reference":"https://attack.mitre.org/tactics/TA0003/"},"technique":[{"id":"T1547","name":"Boot or Logon Autostart Execution","reference":"https://attack.mitre.org/techniques/T1547/","subtechnique":[{"id":"T1547.006","name":"Kernel Modules and Extensions","reference":"https://attack.mitre.org/techniques/T1547/006/"}]}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1601","name":"Modify System Image","reference":"https://attack.mitre.org/techniques/T1601/","subtechnique":[{"id":"T1601.001","name":"Patch System Image","reference":"https://attack.mitre.org/techniques/T1601/001/"}]}]}],"related_integrations":[{"package":"endpoint","version":"^9.0.0"},{"package":"auditd_manager","version":"^1.18.0"},{"package":"crowdstrike","version":"^2.0.0"},{"package":"sentinel_one_cloud_funnel","version":"^1.9.0"}],"required_fields":[{"name":"event.action","type":"keyword","ecs":true},{"name":"event.type","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.args","type":"keyword","ecs":true},{"name":"process.name","type":"keyword","ecs":true},{"name":"process.parent.name","type":"keyword","ecs":true}],"setup":"## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n","note":"## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating Kernel Load or Unload via Kexec Detected\n\nKexec is a Linux feature allowing a new kernel to load without rebooting, streamlining updates and recovery. However, attackers can exploit kexec to bypass security, escalate privileges, or hide activities by loading malicious kernels. The detection rule identifies suspicious kexec usage by monitoring process actions and arguments, excluding benign parent processes, to flag potential threats.\n\n### Possible investigation steps\n\n- Review the process details to confirm the presence of the kexec command with suspicious arguments such as \"--exec\", \"-e\", \"--load\", \"-l\", \"--unload\", or \"-u\".\n- Investigate the parent process of the kexec command to ensure it is not a benign process like \"kdumpctl\" or \"unload.sh\", which are excluded from the detection rule.\n- Check the user account associated with the kexec process to determine if it has the necessary privileges and if the activity aligns with their typical behavior.\n- Analyze recent system logs and security events for any signs of privilege escalation or unauthorized kernel modifications around the time the kexec command was executed.\n- Examine the system for any signs of persistence mechanisms or other indicators of compromise that may suggest a broader attack campaign.\n- Correlate this event with other alerts or anomalies in the environment to assess if this is part of a larger attack pattern or isolated incident.\n\n### False positive analysis\n\n- Kdump operations may trigger false positives as kdumpctl is a benign parent process for kexec. Ensure kdumpctl is included in the exclusion list to prevent unnecessary alerts.\n- Custom scripts for kernel unloading, such as unload.sh, can cause false positives. Verify these scripts are legitimate and add them to the exclusion list if they are frequently used in your environment.\n- Routine administrative tasks involving kernel updates or testing may involve kexec. Confirm these activities are authorized and consider excluding specific administrative accounts or processes from detection.\n- Automated system recovery processes that utilize kexec might be flagged. Identify these processes and exclude them if they are part of a known and secure recovery mechanism.\n- Security tools or monitoring solutions that use kexec for legitimate purposes should be reviewed and excluded to avoid false alerts, ensuring they are recognized as trusted applications.\n\n### Response and remediation\n\n- Immediately isolate the affected system from the network to prevent further unauthorized access or potential lateral movement by the attacker.\n- Terminate any suspicious kexec processes identified by the detection rule to halt any ongoing malicious kernel loading activities.\n- Conduct a thorough review of system logs and process histories to identify any unauthorized kernel loads or modifications, and revert to a known good state if necessary.\n- Restore the system from a clean backup taken before the suspicious activity was detected to ensure system integrity and remove any potential backdoors or malicious kernels.\n- Update and patch the system to the latest security standards to mitigate any vulnerabilities that could be exploited by similar attacks in the future.\n- Implement strict access controls and monitoring on systems with kexec capabilities to prevent unauthorized usage and ensure only trusted personnel can perform kernel operations.\n- Escalate the incident to the security operations center (SOC) or relevant incident response team for further investigation and to assess the potential impact on other systems within the network.","false_positives":[],"references":["https://www.crowdstrike.com/blog/venom-vulnerability-details/","https://www.makeuseof.com/what-is-venom-vulnerability/","https://madaidans-insecurities.github.io/guides/linux-hardening.html"],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"24fe127f-e48e-4853-8940-55a1be396df5","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["auditbeat-*","endgame-*","logs-auditd_manager.auditd-*","logs-crowdstrike.fdr*","logs-endpoint.events.process*","logs-sentinel_one_cloud_funnel.*"],"query":"process where host.os.type == \"linux\" and event.type == \"start\" and\n  event.action in (\"exec\", \"exec_event\", \"start\", \"ProcessRollup2\", \"executed\", \"process_started\") and\n  process.name == \"kexec\" and process.args in (\"--exec\", \"-e\", \"--load\", \"-l\", \"--unload\", \"-u\") and\n  not process.parent.name in (\"kdumpctl\", \"unload.sh\")\n"}
{"id":"f8e97047-7fe6-4ebc-8193-cfc9ee9e7566","rule_id":"e31b2ad0-3388-4223-b960-c99fb15fd3b6","name":"PowerShell UAC Bypass via Downloaded Payload","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.271Z","updated_by":"aswin","created_at":"2025-12-08T21:19:10.069Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"This rule detects PowerShell scripts attempting to bypass User Account Control (UAC) using a downloaded payload and a custom UAC bypass module.","tags":["MITRE","Kill_chain","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0004","name":"Privilege Escalation","reference":"https://attack.mitre.org/tactics/TA0004/"},"technique":[{"id":"T1548","name":"Abuse Elevation Control Mechanism","reference":"https://attack.mitre.org/techniques/T1548/","subtechnique":[{"id":"T1548.002","name":"Bypass User Account Control","reference":"https://attack.mitre.org/techniques/T1548/002/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:\"windows\" and\nprocess.command_line: *Bypass-UAC* and\nprocess.command_line: *WriteAllBytes* and\nprocess.command_line: *DownloadData* and\nprocess.command_line: *Users\\\\Public*\n","filters":[]}
{"id":"662f8551-f2d6-4e87-aba4-3ea378f84894","rule_id":"9d409bf6-7480-4cb2-991e-72f9b5f3967f","name":"PowerShell Hidden Window Execution","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":2,"updated_at":"2025-12-08T21:59:27.242Z","updated_by":"aswin","created_at":"2025-12-05T18:37:22.386Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects PowerShell execution with hidden window style (-WindowStyle Hidden or -window hidden).\nAPT29 uses hidden PowerShell windows to execute malicious commands without user visibility.\nThis technique is used in their RTLO execution, UAC bypass payloads, and steganography decoder.","tags":["MITRE","APT29","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.001","name":"PowerShell","reference":"https://attack.mitre.org/techniques/T1059/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"cadbda20-5837-4a52-afdb-63f954f53e43","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:windows and\n(\n  (event.category : process and process.name : \"powershell.exe\" and \n   process.command_line : (*-window*hidden* or *-WindowStyle*Hidden* or *-w*hidden*)) or\n  (event.code : \"4104\" and powershell.file.script_block_text : *start-process* and \n   powershell.file.script_block_text : *-WindowStyle*Hidden*)\n)","filters":[]}
{"id":"48c40fe1-3663-48c3-a44f-0c6ec510c9db","rule_id":"bff08610-a62c-4b86-9131-54dae0d02b66","name":"Suspicious Local Account Creation on Windows","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.232Z","updated_by":"aswin","created_at":"2025-12-08T19:51:48.033Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"This rule monitors Windows Security Event ID 4720, which logs whenever a new local account is created.\nIt alerts when the creator is an administrator-level account and the new account shows anomalous properties (e.g., password not set, disabled state, or created by built-in Administrator).","tags":["MITRE","Kill_chain"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0004","name":"Privilege Escalation","reference":"https://attack.mitre.org/tactics/TA0004/"},"technique":[{"id":"T1078","name":"Valid Accounts","reference":"https://attack.mitre.org/techniques/T1078/","subtechnique":[{"id":"T1078.003","name":"Local Accounts","reference":"https://attack.mitre.org/techniques/T1078/003/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"event.code: \"4720\" \n  and event.outcome: \"success\" \n  and winlog.event_data.TargetUserName: *\n  and not winlog.event_data.SubjectUserName: (\"SYSTEM\" or \"LOCAL SERVICE\" or \"NETWORK SERVICE\")","filters":[]}
{"id":"8536bb5a-6027-40b0-bc1f-5e501ee0cc18","rule_id":"f6f9122d-da82-487d-af51-cbf1982952b9","name":"DNS → Outbound DNS to non-internal resolvers","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:27.241Z","updated_by":"aswin","created_at":"2025-12-06T22:27:29.135Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detect endpoints bypassing enterprise DNS resolvers. Possible malware/tunneling.","tags":["tunneling"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0011","name":"Command and Control","reference":"https://attack.mitre.org/tactics/TA0011/"},"technique":[]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"timestamp":"{{date}}","rule_name":"{{rule.name}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","matched_values":"{{context.results}}"}]},"action_type_id":".index","uuid":"948eef86-60d9-4a21-9862-622b2fba7bc6","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["auditbeat-*","zeek-*"],"query":"event.dataset: \"zeek.dns\" and network.transport: \"udp\" \nand destination.port: 53 \nand not destination.ip: (10.10.10.1 or 10.10.10.5)\n","filters":[]}
{"id":"89762664-1b5d-46c4-8232-14d4fc38abac","rule_id":"10b023a5-83b9-4c2e-9972-4fb08d0e10b6","name":"T1560.001 - Staged Data Compressed in Linux","immutable":false,"rule_source":{"type":"internal"},"version":3,"revision":3,"updated_at":"2025-12-08T21:59:27.254Z","updated_by":"aswin","created_at":"2025-12-02T17:37:00.666Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"Detects utilities used to compress, encrypt, or split data located in temporary directories.","tags":["MITRE","Linux","Auditbeat","T1560.001"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0009","name":"Collection","reference":"https://attack.mitre.org/tactics/TA0009/"},"technique":[{"id":"T1560","name":"Archive Collected Data","reference":"https://attack.mitre.org/techniques/T1560/","subtechnique":[{"id":"T1560.001","name":"Archive via Utility","reference":"https://attack.mitre.org/techniques/T1560/001/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":50,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"1d55789c-5098-4efd-9c4a-b5c911be08b5","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"meta":{"kibana_siem_app_url":"http://192.168.0.108:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["auditbeat-*"],"query":"agent.type: \"auditbeat\" AND \nevent.category: \"process\" AND \nevent.action: \"executed\" AND\n\nprocess.name: (\n  \"tar\" OR \"zip\" OR \"gzip\" OR \"bzip2\" OR \"xz\" OR \"7z\" OR\n  \"7za\" OR \"rar\" OR \"gpg\" OR \"openssl\" OR \"split\"\n) AND\n\nprocess.args: (\n  \"*.tar\" OR \"*.tgz\" OR \"*.tar.gz\" OR \"*.gz\" OR \"*.zip\" OR \"*.7z\" OR \"*.rar\" OR \"*.enc\"\n) AND (\n\n  process.args: (\n    \"/etc/*\" OR \"/root/*\" OR \"/home/*/.ssh/*\" OR \"/var/www/*\" OR \"/var/lib/*\"\n  )\n\n  OR process.args: (\n    \"/tmp/*\" OR \"/var/tmp/*\" OR \"/dev/shm/*\" OR \"/run/shm/*\"\n  )\n  OR (process.name: \"tar\" AND process.args: \"-P\")\n\n  OR process.args: (\n    \"*staged*\" OR \"*staging*\" OR \"*exfil*\" OR \"*password*\" OR \"*shadow*\"\n  )\n \n  OR process.args: (\n    \"*/.*.tar\" OR \"*/.*.zip\" OR \"*/.*.gz\" OR \"*/.*.tgz\" OR \"*/.*.7z\"\n  )\n)","filters":[]}
{"id":"686a7078-c0f0-4a00-b9e7-962b88df3623","rule_id":"4a99ac6f-9a54-4ba5-a64f-6eb65695841b","name":"Potential Unauthorized Access via Wildcard Injection Detected","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":109,"revision":1,"updated_at":"2025-12-05T18:48:21.638Z","updated_by":"aswin","created_at":"2025-12-03T17:24:19.284Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"This rule monitors for the execution of the \"chown\" and \"chmod\" commands with command line flags that could indicate a wildcard injection attack. Linux wildcard injection is a type of security vulnerability where attackers manipulate commands or input containing wildcards (e.g., *, ?, []) to execute unintended operations or access sensitive data by tricking the system into interpreting the wildcard characters in unexpected ways.","tags":["Domain: Endpoint","OS: Linux","Use Case: Threat Detection","Tactic: Privilege Escalation","Tactic: Credential Access","Data Source: Elastic Endgame","Data Source: Elastic Defend","Data Source: Auditd Manager","Data Source: Crowdstrike","Data Source: SentinelOne","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0004","name":"Privilege Escalation","reference":"https://attack.mitre.org/tactics/TA0004/"},"technique":[{"id":"T1068","name":"Exploitation for Privilege Escalation","reference":"https://attack.mitre.org/techniques/T1068/"}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0006","name":"Credential Access","reference":"https://attack.mitre.org/tactics/TA0006/"},"technique":[{"id":"T1003","name":"OS Credential Dumping","reference":"https://attack.mitre.org/techniques/T1003/","subtechnique":[{"id":"T1003.008","name":"/etc/passwd and /etc/shadow","reference":"https://attack.mitre.org/techniques/T1003/008/"}]}]}],"related_integrations":[{"package":"endpoint","version":"^9.0.0"},{"package":"auditd_manager","version":"^1.18.0"},{"package":"crowdstrike","version":"^2.0.0"},{"package":"sentinel_one_cloud_funnel","version":"^1.9.0"}],"required_fields":[{"name":"event.action","type":"keyword","ecs":true},{"name":"event.type","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.args","type":"keyword","ecs":true},{"name":"process.name","type":"keyword","ecs":true}],"setup":"## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n","note":"## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating Potential Unauthorized Access via Wildcard Injection Detected\n\nIn Linux environments, commands like `chown` and `chmod` are used to change file ownership and permissions. Adversaries may exploit wildcard characters in these commands to escalate privileges or access sensitive data by executing unintended operations. The detection rule identifies suspicious use of these commands with recursive flags and wildcard references, signaling potential misuse aimed at privilege escalation or unauthorized data access.\n\n### Possible investigation steps\n\n- Review the process execution details to confirm the presence of the \"chown\" or \"chmod\" command with the \"-R\" flag and wildcard usage in the arguments, as indicated by the query fields process.name, process.args, and event.action.\n- Examine the user account associated with the process execution to determine if it has the necessary permissions to perform such operations and assess if the account has been compromised.\n- Check the command execution history and related logs to identify any preceding or subsequent suspicious activities that might indicate a broader attack pattern or unauthorized access attempts.\n- Investigate the source and destination of the command execution by analyzing network logs and connections to determine if the activity originated from a known or unknown IP address or host.\n- Correlate this event with other alerts or anomalies in the system to identify potential patterns or coordinated attacks, focusing on privilege escalation or credential access attempts as suggested by the rule's tags and threat information.\n\n### False positive analysis\n\n- Routine administrative tasks using chown or chmod with recursive flags may trigger the rule. To manage this, identify and whitelist specific scripts or users that regularly perform these tasks without security risks.\n- Automated system maintenance processes that involve changing file permissions or ownership across directories can be mistaken for malicious activity. Exclude these processes by specifying their command patterns or associated user accounts in the monitoring system.\n- Backup operations that involve copying and setting permissions on large sets of files might be flagged. To prevent this, configure exceptions for known backup tools or scripts that use these commands in a controlled manner.\n- Development environments where developers frequently change file permissions for testing purposes can generate false positives. Implement user-based exceptions for development teams to reduce unnecessary alerts.\n- System updates or package installations that modify file permissions as part of their normal operation may be detected. Create exceptions for trusted package managers or update processes to avoid false alarms.\n\n### Response and remediation\n\n- Immediately isolate the affected system from the network to prevent further unauthorized access or data exfiltration.\n- Terminate any suspicious processes identified as running the `chown` or `chmod` commands with wildcard injections to halt potential privilege escalation activities.\n- Conduct a thorough review of system logs and command histories to identify any unauthorized changes made to file permissions or ownership and revert them to their original state.\n- Reset credentials and review access permissions for users on the affected system to ensure no unauthorized access persists.\n- Implement file integrity monitoring to detect unauthorized changes to critical files and directories in the future.\n- Escalate the incident to the security operations center (SOC) or incident response team for further investigation and to determine if additional systems are affected.\n- Update and patch the affected system to address any vulnerabilities that may have been exploited during the attack, ensuring all security updates are applied.","false_positives":[],"references":["https://www.exploit-db.com/papers/33930"],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"447b63a4-688c-436a-be92-bd2ff7302dd8","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["auditbeat-*","endgame-*","logs-auditd_manager.auditd-*","logs-crowdstrike.fdr*","logs-endpoint.events.process*","logs-sentinel_one_cloud_funnel.*"],"query":"process where host.os.type == \"linux\" and event.type == \"start\" and\n  event.action in (\"exec\", \"exec_event\", \"start\", \"ProcessRollup2\", \"executed\", \"process_started\") and\n  process.name in (\"chown\", \"chmod\") and process.args == \"-R\" and process.args : \"--reference=*\"\n"}
{"id":"7a35f1de-9814-42c3-bc15-85d62a212a25","rule_id":"97020e61-e591-4191-8a3b-2861a2b887cd","name":"SeDebugPrivilege Enabled by a Suspicious Process","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":112,"revision":1,"updated_at":"2025-12-05T18:48:20.802Z","updated_by":"aswin","created_at":"2025-12-04T15:07:24.176Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Identifies the creation of a process running as SYSTEM and impersonating a Windows core binary privileges. Adversaries may create a new process with a different token to escalate privileges and bypass access controls.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Privilege Escalation","Data Source: Windows Security Event Logs","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0004","name":"Privilege Escalation","reference":"https://attack.mitre.org/tactics/TA0004/"},"technique":[{"id":"T1134","name":"Access Token Manipulation","reference":"https://attack.mitre.org/techniques/T1134/"}]}],"related_integrations":[{"package":"windows","version":"^3.0.0"},{"package":"system","version":"^2.0.0"}],"required_fields":[{"name":"event.action","type":"keyword","ecs":true},{"name":"event.provider","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"winlog.event_data.EnabledPrivilegeList","type":"unknown","ecs":false},{"name":"winlog.event_data.ProcessName","type":"keyword","ecs":false},{"name":"winlog.event_data.SubjectUserSid","type":"keyword","ecs":false}],"setup":"## Setup\n\nWindows Event 4703 logs Token Privileges changes and need to be configured (Enable).\n\nSteps to implement the logging policy with Advanced Audit Configuration:\n\n```\nComputer Configuration >\nPolicies >\nWindows Settings >\nSecurity Settings >\nAdvanced Audit Policies Configuration >\nAudit Policies >\nDetailed Tracking >\nToken Right Adjusted Events (Success)\n```\n","note":"## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating SeDebugPrivilege Enabled by a Suspicious Process\n\nSeDebugPrivilege is a powerful Windows privilege allowing processes to debug and modify other processes, typically reserved for system-level tasks. Adversaries exploit this to escalate privileges, bypassing security controls by impersonating system processes. The detection rule identifies suspicious processes enabling SeDebugPrivilege, excluding known legitimate processes, to flag potential privilege escalation attempts.\n\n### Possible investigation steps\n\n- Review the event logs for the specific event.provider \"Microsoft-Windows-Security-Auditing\" and event.action \"Token Right Adjusted Events\" to gather more details about the process that enabled SeDebugPrivilege.\n- Identify the process name from winlog.event_data.ProcessName and determine if it is known or expected in the environment. Investigate any unknown or suspicious processes.\n- Check the winlog.event_data.SubjectUserSid to identify the user account associated with the process. Investigate if this account has a history of suspicious activity or if it should have the ability to enable SeDebugPrivilege.\n- Analyze the parent process of the suspicious process to understand how it was initiated and if it was spawned by a legitimate or malicious process.\n- Correlate the timestamp of the event with other security events or alerts to identify any related activities or patterns that could indicate a broader attack or compromise.\n- Investigate the network activity of the suspicious process to determine if it is communicating with any known malicious IP addresses or domains.\n\n### False positive analysis\n\n- Legitimate system maintenance tasks may trigger the rule, such as Windows Update or system diagnostics. Users can monitor the timing of these tasks and correlate them with alerts to determine if they are the cause.\n- Software installations or updates using msiexec.exe might be flagged. Consider excluding msiexec.exe from the rule if it is frequently used in your environment for legitimate purposes.\n- Administrative tools like taskhostw.exe and mmc.exe can sometimes enable SeDebugPrivilege during normal operations. Evaluate the necessity of these tools in your environment and exclude them if they are regularly used by trusted administrators.\n- Temporary files created by legitimate applications, such as DismHost.exe in user temp directories, may be flagged. Review the context of these files and exclude them if they are part of routine application behavior.\n- Regularly review and update the exclusion list to include any new legitimate processes that are identified as false positives, ensuring the rule remains effective without generating unnecessary alerts.\n\n### Response and remediation\n\n- Immediately isolate the affected system from the network to prevent further unauthorized access or lateral movement by the adversary.\n- Terminate the suspicious process identified in the alert to stop any ongoing malicious activity and prevent privilege escalation.\n- Conduct a thorough review of the affected system's event logs, focusing on the \"Token Right Adjusted Events\" to identify any additional unauthorized privilege changes or suspicious activities.\n- Reset credentials for any accounts that may have been compromised or used by the suspicious process, especially those with elevated privileges.\n- Restore the affected system from a known good backup to ensure any malicious changes are removed and the system is returned to a secure state.\n- Implement additional monitoring on the affected system and similar systems to detect any recurrence of the threat, focusing on processes attempting to enable SeDebugPrivilege.\n- Escalate the incident to the security operations center (SOC) or incident response team for further investigation and to determine if additional systems are affected.","false_positives":[],"references":["https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4703","https://blog.palantir.com/windows-privilege-abuse-auditing-detection-and-defense-3078a403d74e"],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"b7560f8a-e6f2-46b6-aab4-52666074141b","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["logs-system.security*","logs-windows.forwarded*","winlogbeat-*"],"query":"any where host.os.type == \"windows\" and event.provider: \"Microsoft-Windows-Security-Auditing\" and\n event.action : \"Token Right Adjusted Events\" and\n\n winlog.event_data.EnabledPrivilegeList : \"SeDebugPrivilege\" and\n\n /* exclude processes with System Integrity  */\n not winlog.event_data.SubjectUserSid : (\"S-1-5-18\", \"S-1-5-19\", \"S-1-5-20\") and\n\n not winlog.event_data.ProcessName :\n         (\"?:\\\\Windows\\\\System32\\\\msiexec.exe\",\n          \"?:\\\\Windows\\\\SysWOW64\\\\msiexec.exe\",\n          \"?:\\\\Windows\\\\System32\\\\lsass.exe\",\n          \"?:\\\\Windows\\\\WinSxS\\\\*\",\n          \"?:\\\\Program Files\\\\*\",\n          \"?:\\\\Program Files (x86)\\\\*\",\n          \"?:\\\\Windows\\\\System32\\\\MRT.exe\",\n          \"?:\\\\Windows\\\\System32\\\\cleanmgr.exe\",\n          \"?:\\\\Windows\\\\System32\\\\taskhostw.exe\",\n          \"?:\\\\Windows\\\\System32\\\\mmc.exe\",\n          \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Temp\\\\*-*\\\\DismHost.exe\",\n          \"?:\\\\Windows\\\\System32\\\\auditpol.exe\",\n          \"?:\\\\Windows\\\\System32\\\\wbem\\\\WmiPrvSe.exe\",\n          \"?:\\\\Windows\\\\SysWOW64\\\\wbem\\\\WmiPrvSe.exe\")\n"}
{"id":"b35d98e9-6eb8-4e80-a179-f7a34100b3c6","rule_id":"7e763fd1-228a-4d43-be88-3ffc14cd7de1","name":"File with Right-to-Left Override Character (RTLO) Created/Executed","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":3,"revision":1,"updated_at":"2025-12-05T18:48:20.665Z","updated_by":"aswin","created_at":"2025-12-05T17:31:58.444Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Identifies the creation or execution of files or processes with names containing the Right-to-Left Override (RTLO) character, which can be used to disguise the file extension and trick users into executing malicious files.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Defense Evasion","Data Source: Elastic Endgame","Data Source: Elastic Defend","Data Source: Sysmon","Data Source: Microsoft Defender for Endpoint","Data Source: SentinelOne","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1036","name":"Masquerading","reference":"https://attack.mitre.org/techniques/T1036/","subtechnique":[{"id":"T1036.002","name":"Right-to-Left Override","reference":"https://attack.mitre.org/techniques/T1036/002/"}]}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1204","name":"User Execution","reference":"https://attack.mitre.org/techniques/T1204/","subtechnique":[{"id":"T1204.002","name":"Malicious File","reference":"https://attack.mitre.org/techniques/T1204/002/"}]}]}],"related_integrations":[{"package":"endpoint","version":"^9.0.0"},{"package":"windows","version":"^3.0.0"},{"package":"m365_defender","version":"^5.0.0"},{"package":"sentinel_one_cloud_funnel","version":"^1.9.0"}],"required_fields":[{"name":"event.category","type":"keyword","ecs":true},{"name":"event.type","type":"keyword","ecs":true},{"name":"file.path","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.name","type":"keyword","ecs":true}],"setup":"","note":"## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating File with Right-to-Left Override Character (RTLO) Created/Executed\n\nThe RTLO character reverses text direction, often used to disguise file extensions, making malicious files appear benign. Adversaries exploit this to trick users into executing harmful files. The detection rule identifies suspicious file or process activities on Windows systems by scanning for RTLO characters in file paths or process names, helping to uncover potential masquerading attempts.\n\n### Possible investigation steps\n\n- Review the alert details to identify the specific file path or process name containing the RTLO character by examining the file.path or process.name fields.\n- Check the event.type field to determine whether the alert was triggered by a file creation or process start event, which can help prioritize the investigation focus.\n- Investigate the origin of the file or process by examining the file's creation time, user account involved, and any associated network activity to identify potential sources or delivery methods.\n- Analyze the file or process for malicious behavior by using endpoint detection tools or sandbox environments to execute and monitor its actions.\n- Cross-reference the file or process with threat intelligence databases to check for known malicious indicators or similar attack patterns.\n- Review system logs and other security alerts around the same timeframe to identify any additional suspicious activities or related incidents.\n\n### False positive analysis\n\n- Legitimate software installations or updates may use RTLO characters in file names to manage versioning or localization, which can trigger false positives. Users can create exceptions for known software vendors or specific installation directories to reduce these alerts.\n- Some file management or backup applications might use RTLO characters in temporary file names for internal processing. Identifying these applications and excluding their specific file paths from monitoring can help minimize false positives.\n- Custom scripts or tools developed in-house might inadvertently use RTLO characters for legitimate purposes. Reviewing these scripts and excluding their execution paths or file names from the detection rule can prevent unnecessary alerts.\n- Certain international or multilingual applications may use RTLO characters as part of their normal operation. Users should identify these applications and configure exceptions based on their file paths or process names to avoid false positives.\n- In environments where file names are dynamically generated and may include RTLO characters, consider implementing a whitelist of trusted file paths or process names to reduce the likelihood of false alerts.\n\n### Response and remediation\n\n- Immediately isolate the affected system from the network to prevent further spread or communication with potential command and control servers.\n- Terminate any suspicious processes identified with the RTLO character in their names to halt any ongoing malicious activity.\n- Quarantine the files containing the RTLO character to prevent execution and further analysis.\n- Conduct a thorough scan of the isolated system using updated antivirus or endpoint detection and response (EDR) tools to identify and remove any additional malicious files or remnants.\n- Review and analyze system logs and security alerts to determine the extent of the compromise and identify any lateral movement or additional affected systems.\n- Escalate the incident to the security operations center (SOC) or incident response team for further investigation and to determine if additional containment measures are necessary.\n- Implement enhanced monitoring and detection rules to identify future attempts to use RTLO characters for masquerading, ensuring that similar threats are detected promptly.","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"3940281c-ec8d-4002-8e17-af3155265108","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["winlogbeat-*","logs-endpoint.events.process-*","logs-endpoint.events.file-*","logs-windows.sysmon_operational-*","logs-m365_defender.event-*","logs-sentinel_one_cloud_funnel.*","endgame-*"],"query":"any where host.os.type == \"windows\" and event.category in (\"file\", \"process\") and \n  (\n    (event.type == \"creation\" and file.path : \"*\\u{202E}*\") or \n    (event.type == \"start\" and process.name : \"*\\u{202E}*\")\n  )\n"}
{"id":"e15f183f-b0ca-4abd-9479-9693b5cc22bd","rule_id":"d00f33e7-b57d-4023-9952-2db91b1767c4","name":"Namespace Manipulation Using Unshare","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":113,"revision":1,"updated_at":"2025-12-05T18:48:21.637Z","updated_by":"aswin","created_at":"2025-12-03T17:19:09.168Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Identifies suspicious usage of unshare to manipulate system namespaces. Unshare can be utilized to escalate privileges or escape container security boundaries. Threat actors have utilized this binary to allow themselves to escape to the host and access other resources or escalate privileges.","tags":["Domain: Endpoint","OS: Linux","Use Case: Threat Detection","Tactic: Privilege Escalation","Data Source: Elastic Endgame","Data Source: Elastic Defend","Data Source: SentinelOne","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0004","name":"Privilege Escalation","reference":"https://attack.mitre.org/tactics/TA0004/"},"technique":[{"id":"T1543","name":"Create or Modify System Process","reference":"https://attack.mitre.org/techniques/T1543/"}]}],"related_integrations":[{"package":"endpoint","version":"^9.0.0"},{"package":"sentinel_one_cloud_funnel","version":"^1.9.0"}],"required_fields":[{"name":"event.action","type":"keyword","ecs":true},{"name":"event.type","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.args","type":"keyword","ecs":true},{"name":"process.executable","type":"keyword","ecs":true},{"name":"process.parent.executable","type":"keyword","ecs":true},{"name":"process.parent.name","type":"keyword","ecs":true}],"setup":"## Setup\n\nThis rule requires data coming in from one of the following integrations:\n- Elastic Defend\n- Auditbeat\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n\n### Auditbeat Setup\nAuditbeat is a lightweight shipper that you can install on your servers to audit the activities of users and processes on your systems. For example, you can use Auditbeat to collect and centralize audit events from the Linux Audit Framework. You can also use Auditbeat to detect changes to critical files, like binaries and configuration files, and identify potential security policy violations.\n\n#### The following steps should be executed in order to add the Auditbeat on a Linux System:\n- Elastic provides repositories available for APT and YUM-based distributions. Note that we provide binary packages, but no source packages.\n- To install the APT and YUM repositories follow the setup instructions in this [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/setup-repositories.html).\n- To run Auditbeat on Docker follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/running-on-docker.html).\n- To run Auditbeat on Kubernetes follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/running-on-kubernetes.html).\n- For complete “Setup and Run Auditbeat” information refer to the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/setting-up-and-running.html).\n","note":"## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating Namespace Manipulation Using Unshare\n\nThe `unshare` command in Linux is used to create new namespaces, isolating processes from the rest of the system. This isolation is crucial for containerization and security. However, attackers can exploit `unshare` to break out of containers or elevate privileges by creating namespaces that bypass security controls. The detection rule identifies suspicious `unshare` executions by monitoring process starts, filtering out benign parent processes, and focusing on unusual usage patterns, thus highlighting potential misuse.\n\n### Possible investigation steps\n\n- Review the process tree to understand the context of the unshare execution, focusing on the parent process and any child processes spawned by unshare.\n- Investigate the user account associated with the unshare execution to determine if it is a legitimate user or potentially compromised.\n- Examine the command-line arguments used with unshare to identify any unusual or suspicious options that may indicate an attempt to bypass security controls.\n- Check for any recent changes or anomalies in the system logs around the time of the unshare execution to identify potential indicators of compromise or privilege escalation attempts.\n- Correlate the unshare event with other security alerts or logs to determine if it is part of a larger attack pattern or campaign.\n\n### False positive analysis\n\n- System management tools like udevadm and systemd-udevd may invoke unshare as part of their normal operations. These should be excluded by ensuring the rule filters out processes with these as parent executables.\n- Snap package management can trigger unshare during its operations. Exclude processes where the arguments include /usr/bin/snap to prevent unnecessary alerts.\n- Java applications might occasionally use unshare for legitimate purposes. Exclude processes with java as the parent name to reduce false positives.\n- Custom scripts or administrative tasks that use unshare for legitimate namespace management should be reviewed and, if deemed safe, added to the exclusion list to prevent repeated alerts.\n\n### Response and remediation\n\n- Immediately isolate the affected system to prevent further unauthorized access or lateral movement within the network.\n- Terminate any suspicious processes associated with the `unshare` command that do not have legitimate parent processes or arguments, as identified in the detection query.\n- Conduct a thorough review of system logs and process trees to identify any additional unauthorized or suspicious activities that may have occurred in conjunction with the `unshare` execution.\n- Revoke any unauthorized access or privileges that may have been granted as a result of the namespace manipulation, ensuring that all user and process permissions are appropriately restricted.\n- Restore the affected system from a known good backup if any unauthorized changes or damage to the system integrity are detected.\n- Implement additional monitoring and alerting for unusual `unshare` usage patterns to enhance detection capabilities and prevent future occurrences.\n- Escalate the incident to the security operations team for further investigation and to determine if additional systems or data have been compromised.","false_positives":[],"references":["https://man7.org/linux/man-pages/man1/unshare.1.html","https://www.crowdstrike.com/blog/cve-2022-0185-kubernetes-container-escape-using-linux-kernel-exploit/"],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"cf662676-ab5b-418f-b4d6-7293ffe809fe","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["auditbeat-*","endgame-*","logs-endpoint.events.process*","logs-sentinel_one_cloud_funnel.*"],"query":"process where host.os.type == \"linux\" and event.type == \"start\" and event.action : (\"exec\", \"exec_event\", \"start\") and\nprocess.executable: \"/usr/bin/unshare\" and\nnot process.parent.executable: (\"/usr/bin/udevadm\", \"*/lib/systemd/systemd-udevd\", \"/usr/bin/unshare\") and\nnot process.args == \"/usr/bin/snap\" and not process.parent.name in (\"zz-proxmox-boot\", \"java\")\n"}
{"id":"43d83eb3-dc60-460f-8c1b-bc056e6c786a","rule_id":"c8cccb06-faf2-4cd5-886e-2c9636cfcb87","name":"Disabling Windows Defender Security Settings via PowerShell","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":317,"revision":1,"updated_at":"2025-12-05T18:48:20.805Z","updated_by":"aswin","created_at":"2025-12-04T15:17:40.761Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Identifies use of the Set-MpPreference PowerShell command to disable or weaken certain Windows Defender settings.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Defense Evasion","Tactic: Execution","Resources: Investigation Guide","Data Source: Elastic Endgame","Data Source: Elastic Defend","Data Source: Windows Security Event Logs","Data Source: Microsoft Defender for Endpoint","Data Source: Sysmon","Data Source: SentinelOne","Data Source: Crowdstrike"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1562","name":"Impair Defenses","reference":"https://attack.mitre.org/techniques/T1562/","subtechnique":[{"id":"T1562.001","name":"Disable or Modify Tools","reference":"https://attack.mitre.org/techniques/T1562/001/"}]}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.001","name":"PowerShell","reference":"https://attack.mitre.org/techniques/T1059/001/"}]}]}],"related_integrations":[{"package":"endpoint","version":"^9.0.0"},{"package":"windows","version":"^3.0.0"},{"package":"system","version":"^2.0.0"},{"package":"m365_defender","version":"^5.0.0"},{"package":"sentinel_one_cloud_funnel","version":"^1.9.0"},{"package":"crowdstrike","version":"^2.0.0"}],"required_fields":[{"name":"event.type","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.args","type":"keyword","ecs":true},{"name":"process.name","type":"keyword","ecs":true},{"name":"process.pe.original_file_name","type":"keyword","ecs":true}],"setup":"","note":"## Triage and analysis\n\n### Investigating Disabling Windows Defender Security Settings via PowerShell\n\nMicrosoft Windows Defender is an antivirus product built into Microsoft Windows, which makes it popular across multiple environments. Disabling it is a common step in threat actor playbooks.\n\nThis rule monitors the execution of commands that can tamper the Windows Defender antivirus features.\n\n#### Possible investigation steps\n\n- Investigate the process execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n- Validate the activity is not related to planned patches, updates, network administrator activity, or legitimate software installations.\n- Identify the user account that performed the action and whether it should perform this kind of action.\n- Contact the account owner and confirm whether they are aware of this activity.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Examine the command line to determine which action was executed. Based on that, examine exceptions, antivirus state, sample submission, etc.\n\n### False positive analysis\n\n- This mechanism can be used legitimately. Analysts can dismiss the alert if the administrator is aware of the activity, the configuration is justified (for example, it is being used to deploy other security solutions or troubleshooting), and no other suspicious activity has been observed.\n\n### Related rules\n\n- Windows Defender Disabled via Registry Modification - 2ffa1f1e-b6db-47fa-994b-1512743847eb\n- Microsoft Windows Defender Tampering - fe794edd-487f-4a90-b285-3ee54f2af2d3\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved hosts to prevent further post-compromise behavior.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Based on the command line, take actions to restore the appropriate Windows Defender antivirus configurations.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Review the privileges assigned to the user to ensure that the least privilege principle is being followed.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n","false_positives":["Planned Windows Defender configuration changes."],"references":["https://docs.microsoft.com/en-us/powershell/module/defender/set-mppreference?view=windowsserver2019-ps","https://www.elastic.co/security-labs/operation-bleeding-bear","https://www.elastic.co/security-labs/invisible-miners-unveiling-ghostengine"],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"9723c372-e1c2-4be4-ba12-686f356b7a2f","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["endgame-*","logs-crowdstrike.fdr*","logs-endpoint.events.process-*","logs-m365_defender.event-*","logs-sentinel_one_cloud_funnel.*","logs-system.security*","logs-windows.forwarded*","logs-windows.sysmon_operational-*","winlogbeat-*"],"query":"process where host.os.type == \"windows\" and event.type == \"start\" and\n  (\n    process.name : (\"powershell.exe\", \"pwsh.exe\", \"powershell_ise.exe\") or\n    ?process.pe.original_file_name in (\"PowerShell.EXE\", \"pwsh.dll\", \"powershell_ise.EXE\")\n  ) and\n  process.args : \"Set-MpPreference\" and process.args : (\"-Disable*\", \"Disabled\", \"NeverSend\", \"-Exclusion*\")\n"}
{"id":"cb52079f-2c48-4e16-a6cf-0b70b2871c41","rule_id":"5c895b4f-9133-4e68-9e23-59902175355c","name":"Potential Meterpreter Reverse Shell","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":10,"revision":1,"updated_at":"2025-12-05T18:48:21.634Z","updated_by":"aswin","created_at":"2025-12-03T15:24:40.531Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"This detection rule identifies a sample of suspicious Linux system file reads used for system fingerprinting, leveraged by the Metasploit Meterpreter shell to gather information about the target that it is executing its shell on. Detecting this pattern is indicative of a successful meterpreter shell connection.","tags":["Data Source: Auditd Manager","Domain: Endpoint","OS: Linux","Use Case: Threat Detection","Tactic: Execution","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.004","name":"Unix Shell","reference":"https://attack.mitre.org/techniques/T1059/004/"}]}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0011","name":"Command and Control","reference":"https://attack.mitre.org/tactics/TA0011/"},"technique":[{"id":"T1071","name":"Application Layer Protocol","reference":"https://attack.mitre.org/techniques/T1071/"}]}],"related_integrations":[{"package":"auditd_manager","version":"^1.18.0"}],"required_fields":[{"name":"auditd.data.a2","type":"unknown","ecs":false},{"name":"auditd.data.syscall","type":"unknown","ecs":false},{"name":"file.path","type":"keyword","ecs":true},{"name":"host.id","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.pid","type":"long","ecs":true},{"name":"user.id","type":"keyword","ecs":true}],"setup":"## Setup\n\nThis rule requires data coming in from one of the following integrations:\n- Auditbeat\n- Auditd Manager\n\n### Auditbeat Setup\nAuditbeat is a lightweight shipper that you can install on your servers to audit the activities of users and processes on your systems. For example, you can use Auditbeat to collect and centralize audit events from the Linux Audit Framework. You can also use Auditbeat to detect changes to critical files, like binaries and configuration files, and identify potential security policy violations.\n\n#### The following steps should be executed in order to add the Auditbeat on a Linux System:\n- Elastic provides repositories available for APT and YUM-based distributions. Note that we provide binary packages, but no source packages.\n- To install the APT and YUM repositories follow the setup instructions in this [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/setup-repositories.html).\n- To run Auditbeat on Docker follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/running-on-docker.html).\n- To run Auditbeat on Kubernetes follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/running-on-kubernetes.html).\n- For complete “Setup and Run Auditbeat” information refer to the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/setting-up-and-running.html).\n\n### Auditd Manager Integration Setup\nThe Auditd Manager Integration receives audit events from the Linux Audit Framework which is a part of the Linux kernel.\nAuditd Manager provides a user-friendly interface and automation capabilities for configuring and monitoring system auditing through the auditd daemon. With `auditd_manager`, administrators can easily define audit rules, track system events, and generate comprehensive audit reports, improving overall security and compliance in the system.\n\n#### The following steps should be executed in order to add the Elastic Agent System integration \"auditd_manager\" on a Linux System:\n- Go to the Kibana home page and click “Add integrations”.\n- In the query bar, search for “Auditd Manager” and select the integration to see more details about it.\n- Click “Add Auditd Manager”.\n- Configure the integration name and optionally add a description.\n- Review optional and advanced settings accordingly.\n- Add the newly installed “auditd manager” to an existing or a new agent policy, and deploy the agent on a Linux system from which auditd log files are desirable.\n- Click “Save and Continue”.\n- For more details on the integration refer to the [helper guide](https://docs.elastic.co/integrations/auditd_manager).\n\n#### Rule Specific Setup Note\nAuditd Manager subscribes to the kernel and receives events as they occur without any additional configuration.\nHowever, if more advanced configuration is required to detect specific behavior, audit rules can be added to the integration in either the \"audit rules\" configuration box or the \"auditd rule files\" box by specifying a file to read the audit rules from.\n- For this detection rule the following additional audit rules are required to be added to the integration:\n  -w /proc/net/ -p r -k audit_proc\n  -w /etc/machine-id -p wa -k machineid\n  -w /etc/passwd -p wa -k passwd\n","note":"## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating Potential Meterpreter Reverse Shell\n\nMeterpreter is a sophisticated payload within the Metasploit framework, enabling attackers to execute commands and scripts on compromised systems. Adversaries exploit it to perform system reconnaissance and data exfiltration. The detection rule identifies suspicious file access patterns typical of Meterpreter's system fingerprinting activities, such as reading key system files, indicating a potential reverse shell connection.\n\n### Possible investigation steps\n\n- Review the process associated with the alert by examining the process ID (process.pid) and user ID (user.id) to determine if the process is legitimate or potentially malicious.\n- Check the host ID (host.id) to identify the specific system where the suspicious activity was detected and assess if it is a high-value target or has been previously compromised.\n- Investigate the command history and running processes on the affected host to identify any unusual or unauthorized activities that may indicate a Meterpreter session.\n- Analyze network connections from the host to detect any suspicious outbound connections that could suggest a reverse shell communication.\n- Examine the file access patterns, particularly the access to files like /etc/machine-id, /etc/passwd, /proc/net/route, /proc/net/ipv6_route, and /proc/net/if_inet6, to understand the context and purpose of these reads and whether they align with normal system operations.\n- Correlate the alert with other security events or logs from the same timeframe to identify any additional indicators of compromise or related malicious activities.\n\n### False positive analysis\n\n- System administration scripts or tools that perform regular checks on system files like /etc/machine-id or /etc/passwd may trigger this rule. To manage this, identify and whitelist these legitimate processes by their process ID or user ID.\n- Backup or monitoring software that accesses network configuration files such as /proc/net/route or /proc/net/ipv6_route can cause false positives. Exclude these applications by adding exceptions for their specific file access patterns.\n- Security tools that perform network diagnostics or inventory checks might read files like /proc/net/if_inet6. Review these tools and exclude their known benign activities from triggering the rule.\n- Custom scripts used for system health checks or inventory management that access the flagged files should be reviewed. If deemed safe, add them to an exception list based on their host ID or user ID.\n\n### Response and remediation\n\n- Isolate the affected system from the network immediately to prevent further data exfiltration or lateral movement by the attacker.\n- Terminate any suspicious processes identified by the detection rule, particularly those associated with the process IDs flagged in the alert.\n- Conduct a thorough review of the affected system's logs and file access history to identify any additional unauthorized access or data exfiltration attempts.\n- Change all credentials and keys that may have been exposed or compromised on the affected system, especially those related to user accounts identified in the alert.\n- Restore the affected system from a known good backup to ensure any malicious changes are removed, and verify the integrity of the restored system.\n- Implement network segmentation to limit the potential impact of future attacks and enhance monitoring of critical systems for similar suspicious activities.\n- Escalate the incident to the security operations center (SOC) or incident response team for further investigation and to determine if additional systems are affected.","false_positives":[],"references":["https://www.elastic.co/security-labs/primer-on-persistence-mechanisms","https://www.elastic.co/security-labs/linux-detection-engineering-with-auditd"],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"d9178abd-e88d-42e5-aed4-5930a28106f6","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["auditbeat-*","logs-auditd_manager.auditd-*"],"query":"sample by host.id, process.pid, user.id\n  [file where host.os.type == \"linux\" and auditd.data.syscall == \"open\" and auditd.data.a2 == \"1b6\" and file.path == \"/etc/machine-id\"]\n  [file where host.os.type == \"linux\" and auditd.data.syscall == \"open\" and auditd.data.a2 == \"1b6\" and file.path == \"/etc/passwd\"]\n  [file where host.os.type == \"linux\" and auditd.data.syscall == \"open\" and auditd.data.a2 == \"1b6\" and file.path == \"/proc/net/route\"]\n  [file where host.os.type == \"linux\" and auditd.data.syscall == \"open\" and auditd.data.a2 == \"1b6\" and file.path == \"/proc/net/ipv6_route\"]\n  [file where host.os.type == \"linux\" and auditd.data.syscall == \"open\" and auditd.data.a2 == \"1b6\" and file.path == \"/proc/net/if_inet6\"]\n"}
{"id":"367a2c59-6970-4297-ac7b-51abe2d7a5b6","rule_id":"2339f03c-f53f-40fa-834b-40c5983fc41f","name":"Kernel Module Load via insmod","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":214,"revision":1,"updated_at":"2025-12-05T18:48:21.666Z","updated_by":"aswin","created_at":"2025-12-03T15:36:27.797Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Detects the use of the insmod binary to load a Linux kernel object file. Threat actors can use this binary, given they have root privileges, to load a rootkit on a system providing them with complete control and the ability to hide from security products. Manually loading a kernel module in this manner should not be at all common and can indicate suspcious or malicious behavior.","tags":["Domain: Endpoint","OS: Linux","Use Case: Threat Detection","Tactic: Persistence","Threat: Rootkit","Data Source: Elastic Endgame","Data Source: Elastic Defend","Data Source: Auditd Manager","Data Source: SentinelOne","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0003","name":"Persistence","reference":"https://attack.mitre.org/tactics/TA0003/"},"technique":[{"id":"T1547","name":"Boot or Logon Autostart Execution","reference":"https://attack.mitre.org/techniques/T1547/","subtechnique":[{"id":"T1547.006","name":"Kernel Modules and Extensions","reference":"https://attack.mitre.org/techniques/T1547/006/"}]}]}],"related_integrations":[{"package":"endpoint","version":"^9.0.0"},{"package":"auditd_manager","version":"^1.18.0"},{"package":"sentinel_one_cloud_funnel","version":"^1.9.0"}],"required_fields":[{"name":"event.type","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.args","type":"keyword","ecs":true},{"name":"process.name","type":"keyword","ecs":true},{"name":"process.parent.executable","type":"keyword","ecs":true}],"setup":"## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n","note":"## Triage and analysis\n\n### Investigating Kernel module load via insmod\n\nThe insmod binary is a Linux utility that allows users with root privileges to load kernel modules, which are object files that extend the functionality of the kernel. \n\nThreat actors can abuse this utility to load rootkits, granting them full control over the system and the ability to evade security products.\n\nThe detection rule 'Kernel module load via insmod' is designed to identify instances where the insmod binary is used to load a kernel object file (with a .ko extension) on a Linux system. This activity is uncommon and may indicate suspicious or malicious behavior.\n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/current/invest-guide-run-osquery.html) introduced in Elastic Stack version 8.5.0. Older Elastic Stack versions will display unrendered Markdown in this guide.\n> This investigation guide uses [placeholder fields](https://www.elastic.co/guide/en/security/current/osquery-placeholder-fields.html) to dynamically pass alert data into Osquery queries. Placeholder fields were introduced in Elastic Stack version 8.7.0. If you're using Elastic Stack version 8.6.0 or earlier, you'll need to manually adjust this investigation guide's queries to ensure they properly run.\n\n### Possible investigation steps\n\n- Investigate the kernel object file that was loaded via insmod.\n  - !{osquery{\"label\":\"Osquery - Retrieve Running Processes by User\",\"query\":\"SELECT pid, username, name FROM processes p JOIN users u ON u.uid = p.uid ORDER BY username\"}}\n- Investigate the script execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence and whether they are located in expected locations.\n  - !{osquery{\"label\":\"Osquery - Retrieve Listening Ports\",\"query\":\"SELECT pid, address, port, socket, protocol, path FROM listening_ports\"}}\n- Investigate the kernel ring buffer for any warnings or messages, such as tainted or out-of-tree kernel module loads through `dmesg`.\n- Investigate syslog for any unusual segfaults or other messages. Rootkits may be installed on targets with different architecture as expected, and could potentially cause segmentation faults. \n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Validate the activity is not related to planned patches, updates, network administrator activity, or legitimate software installations.\n- Investigate whether the altered scripts call other malicious scripts elsewhere on the file system. \n  - If scripts or executables were dropped, retrieve the files and determine if they are malicious:\n    - Use a private sandboxed malware analysis system to perform analysis.\n      - Observe and collect information about the following activities:\n        - Attempts to contact external domains and addresses.\n          - Check if the domain is newly registered or unexpected.\n          - Check the reputation of the domain or IP address.\n        - File access, modification, and creation activities.\n- Investigate abnormal behaviors by the subject process/user such as network connections, file modifications, and any other spawned child processes.\n  - Investigate listening ports and open sockets to look for potential command and control traffic or data exfiltration.\n    - !{osquery{\"label\":\"Osquery - Retrieve Open Sockets\",\"query\":\"SELECT pid, family, remote_address, remote_port, socket, state FROM process_open_sockets\"}}\n    - !{osquery{\"label\":\"Osquery - Retrieve Information for a Specific User\",\"query\":\"SELECT * FROM users WHERE username = {{user.name}}\"}}\n  - Identify the user account that performed the action, analyze it, and check whether it should perform this kind of action.\n    - !{osquery{\"label\":\"Osquery - Investigate the Account Authentication Status\",\"query\":\"SELECT * FROM logged_in_users WHERE user = {{user.name}}\"}}\n- Investigate whether the user is currently logged in and active.\n    - $osquery_6\n\n### False positive analysis\n\n- If this activity is related to new benign software installation activity, consider adding exceptions — preferably with a combination of user and command line conditions.\n- If this activity is related to a system administrator who uses cron jobs for administrative purposes, consider adding exceptions for this specific administrator user account. \n- Try to understand the context of the execution by thinking about the user, machine, or business purpose. A small number of endpoints, such as servers with unique software, might appear unusual but satisfy a specific business need.\n\n### Related Rules\n\n- Kernel Driver Load - 3e12a439-d002-4944-bc42-171c0dcb9b96\n- Tainted Out-Of-Tree Kernel Module Load - 51a09737-80f7-4551-a3be-dac8ef5d181a\n- Tainted Kernel Module Load - 05cad2fb-200c-407f-b472-02ea8c9e5e4a\n- Attempt to Clear Kernel Ring Buffer - 2724808c-ba5d-48b2-86d2-0002103df753\n- Enumeration of Kernel Modules via Proc - 80084fa9-8677-4453-8680-b891d3c0c778\n- Suspicious Modprobe File Event - 40ddbcc8-6561-44d9-afc8-eefdbfe0cccd\n- Kernel Module Removal - cd66a5af-e34b-4bb0-8931-57d0a043f2ef\n- Enumeration of Kernel Modules - 2d8043ed-5bda-4caf-801c-c1feb7410504\n\n### Response and Remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors like reverse shells, reverse proxies, or droppers that attackers could use to reinfect the system.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Leverage the incident response data and logging to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n","false_positives":[],"references":["https://decoded.avast.io/davidalvarez/linux-threat-hunting-syslogk-a-kernel-rootkit-found-under-development-in-the-wild/"],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"47dc226f-f17b-4eef-9ecc-b4ec0463d177","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["auditbeat-*","endgame-*","logs-auditd_manager.auditd-*","logs-endpoint.events.process*","logs-sentinel_one_cloud_funnel.*"],"query":"process where host.os.type == \"linux\" and event.type == \"start\" and process.name == \"insmod\" and process.args : \"*.ko\" and\nnot process.parent.executable like (\n  \"/opt/ds_agent/*\", \"/usr/sbin/veeamsnap-loader\", \"/opt/TrendMicro/vls_agent/*\", \"/opt/intel/oneapi/*\",\n  \"/opt/commvault/Base/linux_drv\", \"/bin/falcoctl\"\n)\n"}
{"id":"77bcd124-d240-488a-9f36-030e45631fda","rule_id":"6aace640-e631-4870-ba8e-5fdda09325db","name":"Exporting Exchange Mailbox via PowerShell","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":420,"revision":1,"updated_at":"2025-12-05T18:48:21.632Z","updated_by":"aswin","created_at":"2025-12-04T14:37:36.025Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Identifies the use of the Exchange PowerShell cmdlet, New-MailBoxExportRequest, to export the contents of a primary mailbox or archive to a .pst file. Adversaries may target user email to collect sensitive information.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Collection","Tactic: Execution","Resources: Investigation Guide","Data Source: Elastic Endgame","Data Source: Elastic Defend","Data Source: SentinelOne","Data Source: Microsoft Defender for Endpoint","Data Source: Windows Security Event Logs","Data Source: Crowdstrike","Data Source: Sysmon"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0009","name":"Collection","reference":"https://attack.mitre.org/tactics/TA0009/"},"technique":[{"id":"T1005","name":"Data from Local System","reference":"https://attack.mitre.org/techniques/T1005/"},{"id":"T1114","name":"Email Collection","reference":"https://attack.mitre.org/techniques/T1114/","subtechnique":[{"id":"T1114.002","name":"Remote Email Collection","reference":"https://attack.mitre.org/techniques/T1114/002/"}]}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.001","name":"PowerShell","reference":"https://attack.mitre.org/techniques/T1059/001/"}]}]}],"related_integrations":[{"package":"endpoint","version":"^9.0.0"},{"package":"windows","version":"^3.0.0"},{"package":"system","version":"^2.0.0"},{"package":"sentinel_one_cloud_funnel","version":"^1.9.0"},{"package":"m365_defender","version":"^5.0.0"},{"package":"crowdstrike","version":"^2.0.0"}],"required_fields":[{"name":"event.type","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.command_line","type":"wildcard","ecs":true},{"name":"process.name","type":"keyword","ecs":true}],"setup":"","note":"## Triage and analysis\n\n### Investigating Exporting Exchange Mailbox via PowerShell\n\nEmail mailboxes and their information can be valuable assets for attackers. Company mailboxes often contain sensitive information such as login credentials, intellectual property, financial data, and personal information, making them high-value targets for malicious actors.\n\nThe `New-MailBoxExportRequest` cmdlet is used to begin the process of exporting contents of a primary mailbox or archive to a .pst file. Note that this is done on a per-mailbox basis and this cmdlet is available only in on-premises Exchange.\n\nAttackers can abuse this functionality in preparation for exfiltrating contents, which is likely to contain sensitive and strategic data.\n\n#### Possible investigation steps\n\n- Investigate the process execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Investigate the export operation:\n  - Identify the user account that performed the action and whether it should perform this kind of action.\n  - Contact the account owner and confirm whether they are aware of this activity.\n  - Check if this operation was approved and performed according to the organization's change management policy.\n  - Retrieve the operation status and use the `Get-MailboxExportRequest` cmdlet to review previous requests.\n  - By default, no group in Exchange has the privilege to import or export mailboxes. Investigate administrators that assigned the \"Mailbox Import Export\" privilege for abnormal activity.\n- Investigate if there is a significant quantity of export requests in the alert timeframe. This operation is done on a per-mailbox basis and can be part of a mass export.\n- If the operation was completed successfully:\n  - Check if the file is on the path specified in the command.\n  - Investigate if the file was compressed, archived, or retrieved by the attacker for exfiltration.\n\n### False positive analysis\n\n- This mechanism can be used legitimately. Analysts can dismiss the alert if the administrator is aware of the activity and it is done with proper approval.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- If the involved host is not the Exchange server, isolate the host to prevent further post-compromise behavior.\n- Use the `Remove-MailboxExportRequest` cmdlet to remove fully or partially completed export requests.\n- Prioritize cases that involve personally identifiable information (PII) or other classified data.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Review the privileges of users with the \"Mailbox Import Export\" privilege to ensure that the least privilege principle is being followed.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n","false_positives":["Legitimate exchange system administration activity."],"references":["https://www.volexity.com/blog/2020/12/14/dark-halo-leverages-solarwinds-compromise-to-breach-organizations/","https://docs.microsoft.com/en-us/powershell/module/exchange/new-mailboxexportrequest?view=exchange-ps","https://www.elastic.co/security-labs/siestagraph-new-implant-uncovered-in-asean-member-foreign-ministry"],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"ad0bc08e-03ab-45e6-ac3b-c5e2ccdc3358","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["endgame-*","logs-crowdstrike.fdr*","logs-endpoint.events.process-*","logs-m365_defender.event-*","logs-sentinel_one_cloud_funnel.*","logs-system.security*","logs-windows.forwarded*","logs-windows.sysmon_operational-*","winlogbeat-*"],"query":"process where host.os.type == \"windows\" and event.type == \"start\" and\n  process.name: (\"powershell.exe\", \"pwsh.exe\", \"powershell_ise.exe\") and\n  process.command_line : (\"*MailboxExportRequest*\", \"*-Mailbox*-ContentFilter*\")\n"}
{"id":"ee1ef027-d307-4015-8ab7-d6f2c716642a","rule_id":"c5a5c420-5bef-4d7c-a1c2-f161016cde7f","name":"PowerShell Registry Modification to Load DLL into LSASS via LsaDbExtPt","immutable":false,"rule_source":{"type":"internal"},"version":2,"revision":1,"updated_at":"2025-12-08T21:59:26.281Z","updated_by":"aswin","created_at":"2025-12-08T21:13:31.856Z","created_by":"aswin","enabled":true,"interval":"1m","from":"now-120s","to":"now","description":"This rule detects modification of the Windows Registry value LsaDbExtPt under:\n\nHKLM\\SYSTEM\\CurrentControlSet\\Services\\NTDS\n\nThis registry key forces LSASS (Local Security Authority Subsystem Service) to load an arbitrary DLL during system startup.","tags":["MITRE","Kill_chain","Windows"],"author":[],"license":"","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0003","name":"Persistence","reference":"https://attack.mitre.org/tactics/TA0003/"},"technique":[{"id":"T1547","name":"Boot or Logon Autostart Execution","reference":"https://attack.mitre.org/techniques/T1547/","subtechnique":[{"id":"T1547.008","name":"LSASS Driver","reference":"https://attack.mitre.org/techniques/T1547/008/"}]}]}],"related_integrations":[],"required_fields":[],"setup":"","false_positives":[],"references":[],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"output_index":"","max_signals":100,"exceptions_list":[],"actions":[],"meta":{"kibana_siem_app_url":"http://10.10.10.3:5601/app/security","from":"1m"},"type":"query","language":"kuery","index":["winlogbeat-*"],"query":"host.os.type:\"windows\" and\nprocess.command_line: *LsaDbExtPt* and\nprocess.command_line: *New-ItemProperty* and\nprocess.command_line: *Services\\\\NTDS*\n","filters":[]}
{"id":"767bc4a8-c2dd-4b6d-a962-34e60cf78bea","rule_id":"5bda8597-69a6-4b9e-87a2-69a7c963ea83","name":"Boot File Copy","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":4,"revision":1,"updated_at":"2025-12-05T18:48:21.660Z","updated_by":"aswin","created_at":"2025-12-03T15:41:11.092Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"This rule detects the process of copying or moving files from or to the `/boot` directory on Linux systems. The `/boot` directory contains files that are essential for the system to boot, such as the kernel and initramfs images. Attackers may copy or move files to the `/boot` directory to modify the boot process, which can be leveraged to maintain access to the system.","tags":["Domain: Endpoint","OS: Linux","Use Case: Threat Detection","Tactic: Persistence","Data Source: Elastic Endgame","Data Source: Elastic Defend","Data Source: Auditd Manager","Data Source: Crowdstrike","Data Source: SentinelOne","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0003","name":"Persistence","reference":"https://attack.mitre.org/tactics/TA0003/"},"technique":[{"id":"T1542","name":"Pre-OS Boot","reference":"https://attack.mitre.org/techniques/T1542/"},{"id":"T1543","name":"Create or Modify System Process","reference":"https://attack.mitre.org/techniques/T1543/"},{"id":"T1574","name":"Hijack Execution Flow","reference":"https://attack.mitre.org/techniques/T1574/"}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.004","name":"Unix Shell","reference":"https://attack.mitre.org/techniques/T1059/004/"}]}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[]}],"related_integrations":[{"package":"endpoint","version":"^9.0.0"},{"package":"auditd_manager","version":"^1.18.0"},{"package":"crowdstrike","version":"^2.0.0"},{"package":"sentinel_one_cloud_funnel","version":"^1.9.0"}],"required_fields":[{"name":"event.action","type":"keyword","ecs":true},{"name":"event.type","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.args","type":"keyword","ecs":true},{"name":"process.name","type":"keyword","ecs":true},{"name":"process.parent.args","type":"keyword","ecs":true},{"name":"process.parent.executable","type":"keyword","ecs":true},{"name":"process.parent.name","type":"keyword","ecs":true}],"setup":"## Setup\nThis rule requires data coming in from Elastic Defend.\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n","note":"## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating Boot File Copy\nThe `/boot` directory in Linux systems is crucial for storing files necessary for booting, such as the kernel. Adversaries may exploit this by copying or moving files to alter the boot process, potentially gaining persistent access. The 'Boot File Copy' detection rule identifies suspicious file operations in this directory, excluding legitimate processes, to flag potential unauthorized modifications.\n\n### Possible investigation steps\n\n- Review the process details to identify the specific file operation by examining the process name and arguments, particularly focusing on the use of 'cp' or 'mv' commands with paths involving '/boot/*'.\n- Investigate the parent process executable and name to determine if the operation was initiated by a known legitimate process or script, ensuring it is not one of the excluded processes like 'update-initramfs' or 'grub-mkconfig'.\n- Check the user account associated with the process to assess whether it is a privileged account and if the activity aligns with typical user behavior.\n- Analyze recent system logs and audit records for any other suspicious activities or anomalies around the time of the alert to identify potential patterns or related events.\n- Verify the integrity and authenticity of the files in the /boot directory to ensure no unauthorized modifications have been made, focusing on critical files like the kernel and initramfs images.\n- If possible, correlate the alert with other data sources such as Elastic Endgame or Crowdstrike to gather additional context and confirm whether this is part of a broader attack pattern.\n\n### False positive analysis\n\n- System updates and maintenance tasks often involve legitimate processes that interact with the /boot directory. Processes like update-initramfs, dracut, and grub-mkconfig are common during these operations. Users can exclude these processes by adding them to the exception list in the detection rule.\n- Custom scripts or administrative tasks that require copying or moving files to the /boot directory may trigger false positives. Identify these scripts and add their parent process names or paths to the exclusion criteria.\n- Package management operations, such as those involving dpkg or rpm, may also interact with the /boot directory. Exclude paths like /var/lib/dpkg/info/* and /var/tmp/rpm-tmp.* to prevent these from being flagged.\n- Temporary system recovery or installation processes might use directories like /tmp/newroot. Exclude these paths to avoid unnecessary alerts during legitimate recovery operations.\n\n### Response and remediation\n\n- Immediately isolate the affected system from the network to prevent further unauthorized access or potential lateral movement by the adversary.\n- Terminate any suspicious processes identified by the detection rule, specifically those involving unauthorized 'cp' or 'mv' operations in the /boot directory.\n- Conduct a thorough review of the /boot directory to identify and remove any unauthorized files or modifications. Restore any altered files from a known good backup if necessary.\n- Check for any unauthorized changes to boot configuration files, such as GRUB or LILO, and restore them to their original state.\n- Escalate the incident to the security operations team for further investigation and to determine if additional systems are affected.\n- Implement additional monitoring on the affected system and similar systems to detect any further unauthorized access attempts or modifications.\n- Review and update access controls and permissions for the /boot directory to ensure only authorized processes and users can make changes.","false_positives":[],"references":[],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"49e97281-78ae-4000-a36a-309824e0a667","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["logs-endpoint.events.process*","endgame-*","auditbeat-*","logs-auditd_manager.auditd-*","logs-crowdstrike.fdr*","logs-sentinel_one_cloud_funnel.*"],"query":"process where host.os.type == \"linux\" and event.type == \"start\" and\nevent.action in (\"exec\", \"exec_event\", \"start\", \"ProcessRollup2\", \"executed\") and\nprocess.name in (\"cp\", \"mv\") and process.parent.executable != null and process.args like~ \"/boot/*\" and not (\n  process.parent.name in (\"update-initramfs\", \"dracut\", \"grub-mkconfig\", \"shim-install\", \"sudo\", \"activate-theme\", \"update-grub-gfxpayload\", \"grub-pc.postinst\") or\n  process.parent.executable like~ (\"/usr/lib/kernel/install.d/*\", \"/tmp/newroot/*\", \"/var/lib/dpkg/info/*\") or\n  process.parent.args like~ (\"/usr/bin/mkinitcpio\", \"/var/tmp/rpm-tmp.*\")\n)\n"}
{"id":"bf989313-c8b1-4535-b76f-331115869ec9","rule_id":"3e12a439-d002-4944-bc42-171c0dcb9b96","name":"Kernel Driver Load","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":7,"revision":1,"updated_at":"2025-12-05T18:48:21.654Z","updated_by":"aswin","created_at":"2025-12-03T15:35:14.901Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Detects the loading of a Linux kernel module through system calls. Threat actors may leverage Linux kernel modules to load a rootkit on a system providing them with complete control and the ability to hide from security products. As other rules monitor for the addition of Linux kernel modules through system utilities or .ko files, this rule covers the gap that evasive rootkits leverage by monitoring for kernel module additions on the lowest level through auditd_manager.","tags":["Data Source: Auditd Manager","Domain: Endpoint","OS: Linux","Use Case: Threat Detection","Tactic: Persistence","Tactic: Defense Evasion","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0003","name":"Persistence","reference":"https://attack.mitre.org/tactics/TA0003/"},"technique":[{"id":"T1547","name":"Boot or Logon Autostart Execution","reference":"https://attack.mitre.org/techniques/T1547/","subtechnique":[{"id":"T1547.006","name":"Kernel Modules and Extensions","reference":"https://attack.mitre.org/techniques/T1547/006/"}]}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1014","name":"Rootkit","reference":"https://attack.mitre.org/techniques/T1014/"}]}],"related_integrations":[{"package":"auditd_manager","version":"^1.18.0"}],"required_fields":[{"name":"auditd.data.syscall","type":"unknown","ecs":false},{"name":"event.action","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true}],"setup":"## Setup\nThis rule requires the use of the `auditd_manager` integration. `Auditd_manager` is a tool designed to simplify and enhance the management of the audit subsystem in Linux systems. It provides a user-friendly interface and automation capabilities for configuring and monitoring system auditing through the auditd daemon. With `auditd_manager`, administrators can easily define audit rules, track system events, and generate comprehensive audit reports, improving overall security and compliance in the system. The following steps should be executed in order to install and deploy `auditd_manager` on a Linux system.\n\n```\nKibana -->\nManagement -->\nIntegrations -->\nAuditd Manager -->\nAdd Auditd Manager\n```\n\n`Auditd_manager` subscribes to the kernel and receives events as they occur without any additional configuration. However, if more advanced configuration is required to detect specific behavior, audit rules can be added to the integration in either the \"audit rules\" configuration box or the \"auditd rule files\" box by specifying a file to read the audit rules from.\n\nFor this detection rule to trigger, the following additional audit rules are required to be added to the integration:\n```\n-a always,exit -F arch=b64 -S finit_module -S init_module -S delete_module -F auid!=-1 -k modules\n-a always,exit -F arch=b32 -S finit_module -S init_module -S delete_module -F auid!=-1 -k modules\n```\n\nAdd the newly installed `auditd manager` to an agent policy, and deploy the agent on a Linux system from which auditd log files are desirable.\n","note":"## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating Kernel Driver Load\n\nKernel modules extend the functionality of the Linux kernel, allowing dynamic loading of drivers and other components. Adversaries exploit this by loading malicious modules, or rootkits, to gain stealthy control over systems. The 'Kernel Driver Load' detection rule leverages auditd to monitor system calls like `init_module`, identifying unauthorized module loads indicative of potential rootkit activity, thus enhancing threat detection and system integrity.\n\n### Possible investigation steps\n\n- Review the alert details to identify the specific host where the kernel module was loaded, focusing on the host.os.type field to confirm it is a Linux system.\n- Examine the event.action field to verify that the action was indeed \"loaded-kernel-module\" and check the auditd.data.syscall field for the specific system call used, either \"init_module\" or \"finit_module\".\n- Investigate the timeline of events on the affected host around the time of the alert to identify any suspicious activities or changes, such as new user accounts, unexpected network connections, or file modifications.\n- Check the system logs and audit logs on the affected host for any additional context or anomalies that coincide with the module load event.\n- Identify the source and legitimacy of the loaded kernel module by examining the module's file path, signature, and associated metadata, if available.\n- Assess the potential impact and scope of the incident by determining if similar alerts have been triggered on other hosts within the environment, indicating a broader campaign or attack.\n\n### False positive analysis\n\n- Legitimate kernel module updates or installations can trigger alerts. Regularly scheduled updates or installations by trusted administrators should be documented and excluded from monitoring to reduce noise.\n- System utilities that load kernel modules as part of their normal operation may cause false positives. Identify these utilities and create exceptions for their expected behavior.\n- Automated configuration management tools that deploy or update kernel modules can generate alerts. Ensure these tools are recognized and their activities are whitelisted.\n- Development environments where kernel modules are frequently compiled and tested may lead to frequent alerts. Exclude specific development hosts or processes from monitoring to avoid unnecessary alerts.\n- Security software that loads kernel modules for protection purposes might be flagged. Verify and exclude these modules if they are from trusted vendors.\n\n### Response and remediation\n\n- Isolate the affected system from the network immediately to prevent further malicious activity and lateral movement.\n- Verify the legitimacy of the loaded kernel module by checking its source and integrity. If the module is unauthorized or suspicious, unload it using appropriate system commands.\n- Conduct a thorough scan of the system using updated antivirus or anti-malware tools to identify and remove any additional malicious components or rootkits.\n- Review and analyze system logs, especially those related to auditd, to identify any unauthorized access or changes made by the adversary. This can help in understanding the scope of the compromise.\n- Restore the system from a known good backup if the integrity of the system is in question and if the malicious activity cannot be fully remediated.\n- Implement stricter access controls and monitoring on kernel module loading activities to prevent unauthorized actions in the future. This may include restricting module loading to trusted users or processes.\n- Escalate the incident to the security operations center (SOC) or incident response team for further investigation and to determine if additional systems are affected.","false_positives":[],"references":[],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"138323d6-f7d5-4482-9dac-19903982ba14","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["auditbeat-*","logs-auditd_manager.auditd-*"],"query":"driver where host.os.type == \"linux\" and event.action == \"loaded-kernel-module\" and\nauditd.data.syscall in (\"init_module\", \"finit_module\")\n"}
{"id":"acf7f60a-2b90-4156-8bb2-66112b1ef6ea","rule_id":"9c865691-5599-447a-bac9-b3f2df5f9a9d","name":"Remote Scheduled Task Creation via RPC","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":114,"revision":1,"updated_at":"2025-12-05T18:48:21.139Z","updated_by":"aswin","created_at":"2025-12-04T15:10:50.725Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"Identifies scheduled task creation from a remote source. This could be indicative of adversary lateral movement.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Lateral Movement","Data Source: Windows Security Event Logs","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0008","name":"Lateral Movement","reference":"https://attack.mitre.org/tactics/TA0008/"},"technique":[{"id":"T1021","name":"Remote Services","reference":"https://attack.mitre.org/techniques/T1021/"}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1053","name":"Scheduled Task/Job","reference":"https://attack.mitre.org/techniques/T1053/","subtechnique":[{"id":"T1053.005","name":"Scheduled Task","reference":"https://attack.mitre.org/techniques/T1053/005/"}]}]}],"related_integrations":[{"package":"system","version":"^2.0.0"},{"package":"windows","version":"^3.0.0"}],"required_fields":[{"name":"event.action","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"winlog.event_data.ClientProcessId","type":"unknown","ecs":false},{"name":"winlog.event_data.RpcCallClientLocality","type":"unknown","ecs":false}],"setup":"","note":"## Triage and analysis\n\n### Remote Scheduled Task Creation via RPC\n\n[Scheduled tasks](https://docs.microsoft.com/en-us/windows/win32/taskschd/about-the-task-scheduler) are a great mechanism for persistence and program execution. These features can be used remotely for a variety of legitimate reasons, but at the same time used by malware and adversaries. When investigating scheduled tasks that were set up remotely, one of the first steps should be to determine the original intent behind the configuration and to verify if the activity is tied to benign behavior such as software installation or any kind of network administrator work. One objective for these alerts is to understand the configured action within the scheduled task. This is captured within the registry event data for this rule and can be base64 decoded to view the value.\n\n#### Possible investigation steps\n\n- Review the TaskContent value to investigate the task configured action.\n- Validate if the activity is not related to planned patches, updates, network administrator activity, or legitimate software installations.\n- Further examination should include review of host-based artifacts and network logs from around when the scheduled task was created, on both the source and target machines.\n\n### False positive analysis\n\n- There is a high possibility of benign activity tied to the creation of remote scheduled tasks as it is a general feature within Windows and used for legitimate purposes for a wide range of activity. Any kind of context should be found to further understand the source of the activity and determine the intent based on the scheduled task's contents.\n\n### Related rules\n\n- Service Command Lateral Movement - d61cbcf8-1bc1-4cff-85ba-e7b21c5beedc\n- Remotely Started Services via RPC - aa9a274d-6b53-424d-ac5e-cb8ca4251650\n- Remote Scheduled Task Creation - 954ee7c8-5437-49ae-b2d6-2960883898e9\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- Remove scheduled task and any other related artifacts.\n- Review privileged account management and user account management settings. Consider implementing group policy object (GPO) policies to further restrict activity, or configuring settings that only allow administrators to create remote scheduled tasks.\n","false_positives":[],"references":[],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"720a464a-6867-4009-8d6d-3987d74ee012","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["logs-system.security*","logs-windows.forwarded*","winlogbeat-*"],"query":"iam where host.os.type == \"windows\" and event.action == \"scheduled-task-created\" and\n winlog.event_data.RpcCallClientLocality : \"0\" and winlog.event_data.ClientProcessId : \"0\"\n"}
{"id":"ce8be5a8-899c-42db-bf29-2523745993b1","rule_id":"8af5b42f-8d74-48c8-a8d0-6d14b4197288","name":"Potential Sudo Privilege Escalation via CVE-2019-14287","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":108,"revision":1,"updated_at":"2025-12-05T18:48:21.661Z","updated_by":"aswin","created_at":"2025-12-03T17:16:33.053Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"This rule monitors for the execution of a suspicious sudo command that is leveraged in CVE-2019-14287 to escalate privileges to root. Sudo does not verify the presence of the designated user ID and proceeds to execute using a user ID that can be chosen arbitrarily. By using the sudo privileges, the command \"sudo -u#-1\" translates to an ID of 0, representing the root user. This exploit may work for sudo versions prior to v1.28.","tags":["Domain: Endpoint","OS: Linux","Use Case: Threat Detection","Tactic: Privilege Escalation","Data Source: Elastic Defend","Use Case: Vulnerability","Data Source: Elastic Endgame","Data Source: Auditd Manager","Data Source: Crowdstrike","Data Source: SentinelOne","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0004","name":"Privilege Escalation","reference":"https://attack.mitre.org/tactics/TA0004/"},"technique":[{"id":"T1068","name":"Exploitation for Privilege Escalation","reference":"https://attack.mitre.org/techniques/T1068/"}]}],"related_integrations":[{"package":"endpoint","version":"^9.0.0"},{"package":"auditd_manager","version":"^1.18.0"},{"package":"crowdstrike","version":"^2.0.0"},{"package":"sentinel_one_cloud_funnel","version":"^1.9.0"}],"required_fields":[{"name":"event.action","type":"keyword","ecs":true},{"name":"event.type","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"process.args","type":"keyword","ecs":true},{"name":"process.name","type":"keyword","ecs":true}],"setup":"## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n","note":"## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating Potential Sudo Privilege Escalation via CVE-2019-14287\n\nCVE-2019-14287 exploits a flaw in certain sudo versions, allowing users to execute commands as root by bypassing user ID verification. Attackers can misuse this to gain unauthorized root access, posing significant security risks. The detection rule identifies suspicious sudo commands indicative of this exploit, focusing on specific command patterns that translate to root execution, thereby alerting security teams to potential privilege escalation attempts.\n\n### Possible investigation steps\n\n- Review the alert details to confirm the presence of the suspicious command pattern \"sudo -u#-1\" in the process arguments, as this is indicative of the CVE-2019-14287 exploit attempt.\n- Identify the user account associated with the process execution to determine if the user should have legitimate access to execute commands with elevated privileges.\n- Examine the process execution timeline to identify any preceding or subsequent suspicious activities that might indicate a broader attack or compromise.\n- Check the version of sudo installed on the affected system to verify if it is vulnerable to CVE-2019-14287, specifically versions prior to v1.28.\n- Investigate the source IP address and hostname of the affected system to assess if it is part of a larger attack pattern or if there are other systems potentially compromised.\n- Review system logs and audit trails for any additional unauthorized access attempts or privilege escalation activities around the time of the alert.\n- If possible, isolate the affected system to prevent further unauthorized access while conducting a more thorough forensic analysis.\n\n### False positive analysis\n\n- Legitimate administrative tasks using sudo with unconventional user ID arguments may trigger the rule. Review the context of the command execution to determine if it aligns with expected administrative activities.\n- Automated scripts or maintenance tools that use sudo with arbitrary user IDs for testing or configuration purposes might be flagged. Identify and document these scripts, then create exceptions in the monitoring system to exclude them from alerts.\n- Development environments where developers have elevated privileges for testing purposes could generate false positives. Ensure that such environments are well-documented and consider excluding them from this specific rule if they consistently trigger alerts.\n- Security tools or monitoring systems that simulate attacks for testing detection capabilities may inadvertently trigger this rule. Coordinate with security teams to whitelist these tools or adjust their configurations to prevent unnecessary alerts.\n\n### Response and remediation\n\n- Immediately isolate the affected system from the network to prevent further unauthorized access or lateral movement by the attacker.\n- Terminate any suspicious processes identified with the command pattern \"sudo -u#-1\" to halt any ongoing unauthorized activities.\n- Conduct a thorough review of system logs and sudo logs to identify any additional unauthorized access attempts or successful privilege escalations.\n- Reset passwords and review user accounts on the affected system to ensure no unauthorized accounts have been created or existing accounts have been compromised.\n- Apply patches or upgrade sudo to a version later than v1.28 to mitigate the vulnerability exploited by CVE-2019-14287.\n- Monitor the network for any signs of data exfiltration or further exploitation attempts, using enhanced logging and alerting mechanisms.\n- Report the incident to the appropriate internal security team or external authorities if required, providing them with detailed findings and actions taken.","false_positives":[],"references":["https://www.exploit-db.com/exploits/47502"],"risk_score":47,"risk_score_mapping":[],"severity":"medium","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"7301e279-29c2-4410-9919-85a89b7844ac","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"eql","language":"eql","index":["auditbeat-*","endgame-*","logs-auditd_manager.auditd-*","logs-crowdstrike.fdr*","logs-endpoint.events.process*","logs-sentinel_one_cloud_funnel.*"],"query":"process where host.os.type == \"linux\" and event.type == \"start\" and\n  event.action in (\"exec\", \"exec_event\", \"start\", \"ProcessRollup2\", \"executed\", \"process_started\") and\n  process.name == \"sudo\" and process.args == \"-u#-1\"\n"}
{"id":"27b03bad-521a-4334-8205-eae5b51b026d","rule_id":"577ec21e-56fe-4065-91d8-45eb8224fe77","name":"PowerShell MiniDump Script","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":212,"revision":1,"updated_at":"2025-12-05T18:48:20.654Z","updated_by":"aswin","created_at":"2025-12-04T15:04:05.023Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-9m","to":"now","description":"This rule detects PowerShell scripts capable of dumping process memory using WindowsErrorReporting or Dbghelp.dll MiniDumpWriteDump. Attackers can use this tooling to dump LSASS and get access to credentials.","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Credential Access","Resources: Investigation Guide","Data Source: PowerShell Logs"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0006","name":"Credential Access","reference":"https://attack.mitre.org/tactics/TA0006/"},"technique":[{"id":"T1003","name":"OS Credential Dumping","reference":"https://attack.mitre.org/techniques/T1003/","subtechnique":[{"id":"T1003.001","name":"LSASS Memory","reference":"https://attack.mitre.org/techniques/T1003/001/"}]}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.001","name":"PowerShell","reference":"https://attack.mitre.org/techniques/T1059/001/"}]}]}],"related_integrations":[{"package":"windows","version":"^3.0.0"}],"required_fields":[{"name":"event.category","type":"keyword","ecs":true},{"name":"host.os.type","type":"keyword","ecs":true},{"name":"powershell.file.script_block_text","type":"unknown","ecs":false},{"name":"user.id","type":"keyword","ecs":true}],"setup":"## Setup\n\nThe 'PowerShell Script Block Logging' logging policy must be enabled.\nSteps to implement the logging policy with Advanced Audit Configuration:\n\n```\nComputer Configuration >\nAdministrative Templates >\nWindows PowerShell >\nTurn on PowerShell Script Block Logging (Enable)\n```\n\nSteps to implement the logging policy via registry:\n\n```\nreg add \"hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging\" /v EnableScriptBlockLogging /t REG_DWORD /d 1\n```\n","note":"## Triage and analysis\n\n### Investigating PowerShell MiniDump Script\n\nPowerShell is one of the main tools system administrators use for automation, report routines, and other tasks. This makes it available for use in various environments, and creates an attractive way for attackers to execute code.\n\nAttackers can abuse Process Memory Dump capabilities to extract credentials from LSASS or to obtain other privileged information stored in the process memory.\n\n#### Possible investigation steps\n\n- Examine the script content that triggered the detection; look for suspicious DLL imports, collection or exfiltration capabilities, suspicious functions, encoded or compressed data, and other potentially malicious characteristics.\n- Investigate the script execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n- Examine file or network events from the involved PowerShell process for suspicious behavior.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Evaluate whether the user needs to use PowerShell to complete tasks.\n- Check if the imported function was executed and which process it targeted.\n\n### False positive analysis\n\n- Regular users do not have a business justification for using scripting utilities to dump process memory, making false positives unlikely.\n\n### Related rules\n\n- PowerShell PSReflect Script - 56f2e9b5-4803-4e44-a0a4-a52dc79d57fe\n- Potential Process Injection via PowerShell - 2e29e96a-b67c-455a-afe4-de6183431d0d\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved hosts to prevent further post-compromise behavior.\n- Restrict PowerShell usage outside of IT and engineering business units using GPOs, AppLocker, Intune, or similar software.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n","false_positives":["PowerShell scripts that use this capability for troubleshooting."],"references":["https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Out-Minidump.ps1","https://github.com/FuzzySecurity/PowerShell-Suite/blob/master/Get-ProcessMiniDump.ps1","https://github.com/atc-project/atc-data/blob/master/docs/Logging_Policies/LP_0109_windows_powershell_script_block_log.md"],"risk_score":73,"risk_score_mapping":[],"severity":"high","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"554e9c00-207e-48c4-bc78-af5a9e2b6a56","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"query","language":"kuery","index":["winlogbeat-*","logs-windows.powershell*"],"query":"event.category:process and host.os.type:windows and powershell.file.script_block_text:(MiniDumpWriteDump or MiniDumpWithFullMemory or pmuDetirWpmuDiniM) and not user.id : \"S-1-5-18\"\n"}
{"id":"66d19d73-e538-431e-9b70-8bfa338f48f4","rule_id":"867616ec-41e5-4edc-ada2-ab13ab45de8a","name":"AWS IAM Group Deletion","immutable":true,"rule_source":{"type":"external","is_customized":false,"customized_fields":[],"has_base_version":true},"version":210,"revision":1,"updated_at":"2025-12-05T18:48:21.141Z","updated_by":"aswin","created_at":"2025-12-03T14:30:04.740Z","created_by":"aswin","enabled":true,"interval":"5m","from":"now-6m","to":"now","description":"Detects when an IAM group is deleted using the DeleteGroup API call. Deletion of an IAM group may represent a malicious attempt to remove audit trails, disrupt operations, or hide adversary activity (for example after using the group briefly for privileged access). This can be an indicator of impact or cleanup in an attack lifecycle.","tags":["Domain: Cloud","Data Source: AWS","Data Source: Amazon Web Services","Data Source: AWS IAM","Tactic: Impact","Resources: Investigation Guide"],"author":["Elastic"],"license":"Elastic License v2","threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0040","name":"Impact","reference":"https://attack.mitre.org/tactics/TA0040/"},"technique":[{"id":"T1531","name":"Account Access Removal","reference":"https://attack.mitre.org/techniques/T1531/"}]}],"investigation_fields":{"field_names":["@timestamp","user.name","user_agent.original","source.ip","aws.cloudtrail.user_identity.arn","aws.cloudtrail.user_identity.type","aws.cloudtrail.user_identity.access_key_id","event.action","event.outcome","cloud.account.id","cloud.region","aws.cloudtrail.request_parameters"]},"related_integrations":[{"package":"aws","version":"^4.0.0","integration":"cloudtrail"}],"required_fields":[{"name":"event.action","type":"keyword","ecs":true},{"name":"event.dataset","type":"keyword","ecs":true},{"name":"event.outcome","type":"keyword","ecs":true},{"name":"event.provider","type":"keyword","ecs":true}],"setup":"","note":"## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating AWS IAM Group Deletion\n\nAttackers sometimes remove groups to erase evidence, disrupt operations, or prevent users from receiving needed permissions (Impact). Deletion can also follow malicious cleanup after attaching policies and using the group briefly. This alert fires on `DeleteGroup` API call. Consider intentional disruption or covering tracks, particularly if the group was privileged or recently modified.\n\n### Possible investigation steps\n\n- **Identify the actor and environment**  \n  - Review `aws.cloudtrail.user_identity.arn`, `aws.cloudtrail.user_identity.access_key_id`.  \n  - Check `source.ip`, `user_agent.original`, `cloud.account.id`, `cloud.region` for atypical activity.\n\n- **Determine what was lost**\n  - From `aws.cloudtrail.request_parameters`, capture `groupName`.  \n  - Use history or logs to identify existing members and attached policies prior to deletion (ex: `GetGroup`, `ListAttachedGroupPolicies`).  \n  - Determine if the group contained privileged roles/policies that could have been weaponized.\n\n- **Correlate with related activity**\n  - Look in the prior 1–24h for `DetachGroupPolicy`, `RemoveUserFromGroup`, `DeleteGroupPolicy`, which often precede deletion in adversary cleanup workflows.  \n  - After deletion, monitor for creation of new similarly-named groups, or re-attachment of policies to other groups/roles.\n\n### False positive analysis\n\n- Projects & services that are being decommissioned often require group deletion. Confirm through internal inventory and change control.  \n- Sandbox or dev accounts frequently create and delete groups; ensure the environment context is understood.\n\n### Response and remediation\n\n- **Containment**: If deletion was unauthorized, restrict the actor’s IAM privileges and block further configuration changes.  \n- **Investigation and scoping**: Recover details of the deleted group (members, policies) from logs or AWS Config, and determine the impact of the deletion (which users lost membership, service account disruption).  \n- **Recovery and hardening**: Recreate the group if necessary, restore intended policies and memberships, enforce change-control for group deletions, restrict `iam:DeleteGroup` privileges, and create alerts for destructive IAM operations.\n\n### Additional information\n[AWS Security Best Practices](https://aws.amazon.com/premiumsupport/knowledge-center/security-best-practices/)\n","false_positives":["Legitimate group deletion during decommissioning of projects, clean-up of service accounts, or identity lifecycle changes may trigger this alert. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Resource group deletions by unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule."],"references":["https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/delete-group.html","https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteGroup.html"],"risk_score":21,"risk_score_mapping":[],"severity":"low","severity_mapping":[],"timestamp_override":"event.ingested","output_index":"","max_signals":100,"exceptions_list":[],"actions":[{"id":"fe657fec-3395-4855-b453-d84829531b38","params":{"documents":[{"rule_name":"{{rule.name}}","rule_id":"{{rule.id}}","alert_id":"{{alert.id}}","status":"{{alert.status}}","message":"{{context.message}}","timestamp":"{{date}}","tags":"{{rule.tags}}"}]},"action_type_id":".index","uuid":"51813fb9-9a9b-496d-816e-04d94933f77f","frequency":{"summary":true,"notifyWhen":"onActiveAlert","throttle":null},"group":"default"}],"type":"query","language":"kuery","index":["filebeat-*","logs-aws.cloudtrail-*"],"query":"event.dataset: aws.cloudtrail and \n    event.provider: iam.amazonaws.com and \n    event.action: DeleteGroup and \n    event.outcome: success\n"}
{"id":"fe657fec-3395-4855-b453-d84829531b38","type":"action","updated_at":"2025-12-05T18:53:05.288Z","created_at":"2025-12-05T18:53:05.288Z","version":"WzEwNDQxNywxMl0=","attributes":{"actionTypeId":".index","name":"Security_alerts_indexer","isMissingSecrets":false,"config":{"refresh":false,"index":"adapt-security-alerts","executionTimeField":null},"secrets":{}},"references":[],"managed":false,"coreMigrationVersion":"8.8.0","typeMigrationVersion":"10.1.0"}
{"exported_count":101,"exported_rules_count":100,"missing_rules":[],"missing_rules_count":0,"exported_exception_list_count":0,"exported_exception_list_item_count":0,"missing_exception_list_item_count":0,"missing_exception_list_items":[],"missing_exception_lists":[],"missing_exception_lists_count":0,"exported_action_connector_count":1,"missing_action_connection_count":0,"missing_action_connections":[],"excluded_action_connection_count":0,"excluded_action_connections":[]}
